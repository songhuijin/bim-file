"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),version="2020-8-12-17-40",Glodon=window.Glodon||{};Glodon.Version=version,function(){function e(e,t){for(var i=t.split("."),n=e,o=i.length,a=0;a<o;a++)void 0===n[i[a]]&&(n[i[a]]={}),n=n[i[a]];return n}e(Glodon,"Web.Lang.Utility.Namespace").ensureNamespace=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Common"),t=function(e){"string"==typeof e&&(e=JSON.parse(res)),this.code=e.code,this.message=e.message};t.prototype={getErrorCode:function(){return this.code},getErrorMessage:function(){return this.message}},e.Error=t}();var Vector3$1=function(){function e(t,i,n){_classCallCheck(this,e),this.x=t||0,this.y=i||0,this.z=n||0}return _createClass(e,[{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}}]),e}(),Box3=function(){function e(t,i){_classCallCheck(this,e),this.min=t||new Vector3$1(1/0,1/0,1/0),this.max=i||new Vector3$1(-1/0,-1/0,-1/0)}return _createClass(e,[{key:"getSize",value:function(){return new Vector3$1(this.max.x-this.min.x,this.max.y-this.min.y,this.max.z-this.min.z)}},{key:"setFromCenterAndSize",value:function(e,t){var i=new Vector3$1(t.x,t.y).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"getCenter",value:function(){return new Vector3$1(this.min.x+this.max.x,this.min.y+this.max.y,this.min.z+this.max.z).multiplyScalar(.5)}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}}]),e}();!function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Algorithm"),t=function(){function e(t,i){_classCallCheck(this,e),this.points=t,this.searchRangeSquared=Math.pow(i,2),this.EPSILON_SQR=.1,this.clusters=[]}return _createClass(e,[{key:"meanShift",value:function(e){for(var t=e.clone(),i=[];;){var n=this.rangeSearch(t);this.connect(i,n);var o=this.mean(n);if(t.distanceToSquared(o)<=this.EPSILON_SQR)break;t=o}return i}},{key:"mean",value:function(e){var t=new Vector3$1,i=!0,n=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value;t.add(s)}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}return t.multiplyScalar(1/e.length),t}},{key:"rangeSearch",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var a,r=this.points[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value;e.distanceToSquared(s)<=this.searchRangeSquared&&t.push(s)}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}return t}},{key:"clustering",value:function(){var e=1,t=!0,i=!1,n=void 0;try{for(var o,a=this.points[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;if(!r.stopMoving){var s=this.meanShift(r);this.mergeClusters({points:s,center:this.mean(s),id:e++})}}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"mergeClusters",value:function(e){var t=!1,i=!0,n=!1,o=void 0;try{for(var a,r=this.clusters[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value;if(e.center.distanceToSquared(s.center)<=4*this.searchRangeSquared){this.connect(s.points,e.points,!0),s.center=this.mean(s.points),this.updateClusterBbox(s),t=!0;break}}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}!1===t&&(this.updateClusterBbox(e),this.clusters.push(e))}},{key:"updateClusterBbox",value:function(e){var t=(new Box3).setFromPoints(e.points);e.bbox=t}},{key:"connect",value:function(e,t,i){var n=!0,o=!1,a=void 0;try{for(var r,s=t[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;l.stopMoving&&!i||e.push(l),l.stopMoving=!0}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return e}}]),e}();e.MeanShift=t}();var Vector2$1=function(){function e(t,i){_classCallCheck(this,e),this.x=t||0,this.y=i||0}return _createClass(e,[{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"normalize",value:function(){return this.multiplyScalar(1/this.length())}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"rotateAround",value:function(e,t){var i=Math.cos(t),n=Math.sin(t),o=this.x-e.x,a=this.y-e.y;return this.x=o*i-a*n+e.x,this.y=o*n+a*i+e.y,this}},{key:"setLength",value:function(e){return this.multiplyScalar(e/this.length())}},{key:"angle",value:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}}]),e}(),Box2=function(){function e(t,i){_classCallCheck(this,e),this.min=t||new Vector2$1(1/0,1/0),this.max=i||new Vector2$1(-1/0,-1/0)}return _createClass(e,[{key:"getSize",value:function(){return new Vector2$1(this.max.x-this.min.x,this.max.y-this.min.y)}},{key:"setFromCenterAndSize",value:function(e,t){var i=new Vector2$1(t.x,t.y).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}},{key:"getCenter",value:function(){return new Vector2$1(this.min.x+this.max.x,this.min.y+this.max.y).multiplyScalar(.5)}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}}]),e}();!function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Algorithm"),t=function e(){_classCallCheck(this,e)};t.toThreeJsBox2=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=[],n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value,u=Math.min(t,100)/100,c=Math.max(l[1][1]-l[0][1],l[1][0]-l[0][0]),d=c*u,h=new Vector2$1(l[0][0],l[0][1]),f=new Vector2$1(l[1][0],l[1][1]),g=new Box2(h,f),v=g.getSize();i.push((new Box2).setFromCenterAndSize(g.getCenter(),v.addScalar(2*d)))}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}var m=0,p=!0,y=!1,w=void 0;try{for(var b,C=i[Symbol.iterator]();!(p=(b=C.next()).done);p=!0){b.value.indices=[m++]}}catch(e){y=!0,w=e}finally{try{!p&&C.return&&C.return()}finally{if(y)throw w}}return i},t.toDrawingBox2=function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value,l=[];l.push([s.min.x,s.min.y]),l.push([s.max.x,s.max.y]),t.push(l)}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}return t},t.merge=function(e,t){for(var i=e.length,n=0;n<=i;n++){if(n===i){e.push(t);break}var o=e[n];if(o.intersectsBox(t)){o.union(t),o.indices=o.indices.concat(t.indices);break}}},t.mergeBoundingBox=function(e){for(var i=e,n=[];;){for(var o=0;o<i.length;o++)t.merge(n,i[o]);if(n.length===i.length)break;i=n.slice(0,n.length),n=[]}return n},e.BoundingBoxUtil=t}(),function(){function e(e){function t(){}return t.prototype=e,new t}function t(t,i){var n=e(i.prototype);n.constructor=t,t.prototype=n}Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Type").inheritPrototype=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),t=function(e){var t,i={type:"get",cache:!0,headers:{"Content-type":"application/x-www-form-urlencoded"},data:null,async:!0,success:null,failure:null},n=Object.assign(i,e);t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),t.onreadystatechange=function(){if(4==t.readyState){var e=t.status;e>=200&&e<300||0==e?n.success&&n.success(t.responseText,t.responseXML):n.failure&&n.failure(e)}},t.open(n.type,n.url,n.async);for(var o in n.headers)t.setRequestHeader(o,n.headers[o]);t.send(n.data)},i=function(e,t){var i={};if(i[e])t&&t();else{var n=document.createElement("script");n.type="text/javascript",n.src=e,document.head.appendChild(n),i[e]=!0,n.readyState?n.onreadystatechange=function(){"loaded"!=n.readyState&&"complete"!=n.readyState||(n.onreadystatechange=null,t&&t())}:n.onload=function(){t&&t()}}},n=function(e,i){return new Promise(function(n,o){t({url:e,method:"GET",success:function(e){try{var t=JSON.parse(e)}catch(t){return n(e)}"success"==t.code||"noCode"==i?n("noCode"==i?t:t.data):o("requestErrorï¼ŒdataCode:"+t.code+", dataMessage:"+t.message)},failure:function(e){o(e)}})})};e.ajax=t,e.promiseJSONRequest=n,e.getScript=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.FullScreen"),t=function(e){if(!e)return!1;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()},i=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()},n=function(){return document.webkitIsFullScreen||!!document.mozFullScreenElement||!!document.msFullScreenElement||!1},o=function(e){var t=function(){e&&e()};document.onfullscreenchange=t,document.onwebkitfullscreenchange=t,document.documentElement.onwebkitfullscreenchange=t,document.onmozfullscreenchange=t,document.onmsfullscreenchange=t};e.fullScreen=t,e.exitFullScreen=i,e.onFullScreenChanged=o,e.isFullScreen=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.ClientHelper"),t=function(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),o=/(?:Firefox)/.test(e),a=(/(?:Chrome|CriOS)/.test(e),/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||o&&/(?:Tablet)/.test(e));return!(/(?:iPhone)/.test(e)&&!a||n||i||a)},i=function(){return/(?:iPhone)/.test(navigator.userAgent)},n=function(e){var t=function(e){return e.replace("viewToken.json","").replace(/\.\//g,"/").replace(/\/\//g,"/")};if(e.indexOf("://")>-1){var i=e.split("://");e=i[0]+"://"+t(i[1])}else e="./"!=e.slice(0,2)?t(e):"."+t(e.slice(1));return e},o=function(e,t,i){i=i||"asc";var n=!1;return t?t.indexOf(".")>-1&&(n=!0):t="name",e=e.sort(function(e,o){if(n){var a=l(e,t),r=l(o,t);return"asc"==i?a.localeCompare(r):r.localeCompare(a)}return"asc"==i?e[t].localeCompare(o[t]):o[t].localeCompare(e[t])}),s(e,t,n)},a=function(e,t,i){i=i||"asc";var n=!1;return t?t.indexOf(".")>-1&&(n=!0):t="name",e=e.sort(r(t,n)),s(e,t,n)},r=function(e,t){return function(i,n){function o(e,t,i){if(i){for(s=t;(i=o(e,s))<76&&i>65;)++s;return+e.slice(t-1,s)}return i=f&&f.indexOf(e.charAt(t)),i>-1?i+76:(i=e.charCodeAt(t)||0)<45||i>127?i:i<46?65:i<48?i-1:i<58?i+18:i<65?i-11:i<91?i+11:i<97?i-37:i<123?i+5:i-63}var a,r;t?(a=l(i,e),r=l(n,e)):(a=i[e],r=n[e]);var s,u,c=1,d=0,h=0,f=String.alphabet;if((a+="")!=(r+=""))for(;c;)if(u=o(a,d++),c=o(r,h++),u<76&&c<76&&u>66&&c>66&&(u=o(a,d,d),c=o(r,h,d=s),h=s),u!=c)return u<c?-1:1;return 0}},s=function(e,t,i){var n=[],o=[],a=[],r=[];return e.map(function(e,s){var u;u=i?l(e,t):e[t],/^[a-zA-Z]*$/.test(u.slice(0,1))?n.push(e):/^[\u4e00-\u9fa5]*$/.test(u.slice(0,1))?o.push(e):/^\d+(\.\d+)?$/.test(u.slice(0,1))?a.push(e):r.push(e)}),r.concat(a,n,o)},l=function(e,t){var i=t.split("."),n=e;return i.map(function(e,t){n=n[e]}),n},u=function(){return!!(window.ActiveXObject||"ActiveXObject"in window)},c=function(e,t,i,n,o,a){var r=void 0,s=void 0,l=void 0,u=void 0,c=0,d=Math.sqrt((i-e)*(i-e)+(n-t)*(n-t));if(0===d)return[0,{x:i,y:n}];var h=Math.sqrt((o-e)*(o-e)+(a-t)*(a-t));if(0===h)return[0,{x:o,y:a}];var f=Math.sqrt((i-o)*(i-o)+(n-a)*(n-a));if(0===f)return c=d,[c,{x:i,y:n}];if(d<h){if(n===a?r=i<o?0:Math.PI:(u=(o-i)/f,u-1>1e-5&&(u=1),r=Math.acos(u),n>a&&(r=2*Math.PI-r)),u=(e-i)/d,u-1>1e-5&&(u=1),s=Math.acos(u),n>t&&(s=2*Math.PI-s),l=s-r,l<0&&(l=-l),l>Math.PI&&(l=2*Math.PI-l),l>Math.PI/2)return[d,{x:i,y:n}];if(i===o)return[h*Math.sin(l),{x:i,y:t}];if(n===a)return[h*Math.sin(l),{x:e,y:n}];var g=0,v=0,m=(a-n)/o-i,p=-1/m,y=t-e*p;return g=(a-o*m-y)/(p-m),v=p*g+y,[d*Math.sin(l),{x:g,y:v}]}if(n===a?r=i<o?Math.PI:0:(u=(i-o)/f,u-1>1e-5&&(u=1),r=Math.acos(u),a>n&&(r=2*Math.PI-r)),u=(e-o)/h,u-1>1e-5&&(u=1),s=Math.acos(u),a>t&&(s=2*Math.PI-s),l=s-r,l<0&&(l=-l),l>Math.PI&&(l=2*Math.PI-l),l>Math.PI/2)return[h,{x:o,y:a}];if(i===o)return[h*Math.sin(l),{x:i,y:t}];if(n===a)return[h*Math.sin(l),{x:e,y:n}];var w=0,b=0,C=(a-n)/o-i,x=-1/C,E=t-e*x;return w=(a-o*C-E)/(x-C),b=x*w+E,[h*Math.sin(l),{x:w,y:b}]},d=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}},h=function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}};e.getIsDesktop=t,e.getIsIphone=i,e.getIsIE=u,e.formatURL=n,e.sortByName=o,e.sortByRules=a,e.PointToLineDistance=c,e.isWebGLAvailable=d,e.isWebGL2Available=h}();var Cursor={pan:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABjRJREFUWAnFlstvU1cQxu/1fcR2HMd52DV5kVABUZ4tkIqIx6KRKBKbCqJukKjURbtghSr4S1gg0U2zQqjbthISYkElVCoEIZAQkiYpCXm/4zh+u7+xcoxDbCe0UjvS6B7fO2fmOzPfzLGm/c+i/4v4uXvT/9RPrpNiPpSdY9tIfovKbwmeylGW+xfluNgOsTFQEy1B1R55JyoSQyNoElWA5LlnZpQzbHeJ+iZBJHAZWurz+by2bSfD4XDK7/d/YllWgPWTqampYb7HUQEhgERVZljmFzlVPlHB5buNusvKysrr6uouezyer3UklUrFq6qq3IZhOBYXF58C5Ifl5eUxPqVXV1cX2bOGhtGimVApxG6HCAAJ7kQ9LpfLGQgEWg8ePHj+2rVrrZcuXXItLCykL1686Llx44YvFovVjo2NnaysrLxcXV39LeqLx+PDW1tbm+xXZWG5W4plwMLcS+DGAwcOfEPaewmUxrHW1dXlGR4ettfX1/XS0lK9ubk51tTU5Ozt7fU2NjYat2/f/hzbUTLShw9Virx8yJcBOb2w24WWE7znzJkzX1y/fj1ACSycagQ00un01uvXr9fcbrfe2trqXllZMQFjnjt3zkVJyvr7+xcTicQQ/FjFT8EsqLbCZpcIEAlkojplSJ89e1bDafjx48fh48ePl0HIyhcvXlhwwWhoaNCmp6ejb9++TbS3tyf53klJTuJDyigHVbxi+U4KZUAspDyukpISN+lsOnz48McAcFFrg/o72traTE4XHhkZCQHEcejQIWtoaChO3TXs3PPz85XPnj2bZ+8A79bxJR2xqwz5AGCXQSuI7Wg0Gie19cFgsAUQFt2QJNAGWUmfOHFCuGDCBcfp06ftN2/epMmCduTIEclchNbUKNkc+ie+pEUFxA4pBEAZGbSbTRYkSFVtbW2NnG50dNSizuaxY8eMpaWlyPj4+BYzwQSk/vLlyzCg06dOnfKQhcDAwMBcJBJ5yjtpyV1ZKARA1SuTBRxE6ILG+vr6jpaWFpPej7569WrdNE2ts7PTRUa0jY0NHXBO6Yry8nIDW3NtbS08MTERB/wMJJ0AgOoIdcDsKM2+YKGCqyHkJAslkNCi5BU1NTV+0u2h9hanN7q7u03mgwMSGl6v10EWLDTT3pDTJlPBwcHBWUA8gcBR/EtHZCVfBgSAOHCj3m21IdMqJ68j0KcdHR0G7ZkisF5RUZEJLMGx3SFOp1OHsFF4EmZ+TJOFKQwSaJYL7wOQ4OJIWqeCIdQCu78jnd9zmnaItQSjY2Shivq7JTijF9PCQocIT4JkbGZubu4JlpKFogAEVClaSeDenp6er65evVrNpPsIVjfMzs7WcPpysqAz/zErLtwdDpkNz58/n8dyFF7IU7KQacl8GZB3mSlIBj5jCnZduHChRGbA0aNHTUhlAiRGKRIAlItqT4GgMVo0DJARWnKUDdKSBQEoDrioYenMzEyAU/hhv0XNbSacRurj2223dwqIFAqFUnTKJu3bDykHtwFkypBhKy9yRT5Iu2xMTk7+To2dt27dsql925UrV5yc3BbN3bDXWuYCJIzBoezJ1Z73S6DeS3oESJqaLfCcg0R+xoFfLiJasjjzlJftJyM58uDBgyFK95D/CuO8FiLmLYHaqgBkyEINl0E/wz1QRTqDcEEXcinjYk9mh3b//n0H+hst+QuZXMa+IAlzfeWCSBF4NZlMUpVJH/1cS3sKFwplMOvn3r17oTt37gzRgr+SgT/4ICM5O4z2ciAgxFgQy//AENNsnAvHA5BaukBXU4/vO4SMaY8ePQr39fVtMrZ/JvhdhtkKRjsupb0AiFMFQoAkSWF4c3NzhFrq1LYGcunyR0X+mIixCExPS+CbN2+uwZ2fCP4jo3iaT1uoHCYr2U3ZN/kXYic1F/bLv2MfF5Hcjt1Mui8J3ow6uIgSZMkiWArm9/O8S+8/5ORC5BC66zLaLwD2vvuPwFoGlQCRu8LNPVANKYNMRjcl2qBz/oIzKqj8GZG6Z8rIc4d8CADZKPaiUjoZQnJniMpazRQplbSZUjm1vMvOf9ZZ+VAAslHtkaeURcCIym9RFUw9hUOieUU5y/txHy9z9+euiwbdh9//zuRvyW3yFM73IK0AAAAASUVORK5CYII=",orbit:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAB55JREFUWAntlltM1PkVx2eG28ww3EdA5CKgSBXEKO6Klxq3dsFbDTZa120Tre1ufdjY1sRoNqm1aaPxYetjEy/RxLrbpGiiVWQbUPfBW8CqRHe1UapVizCIIMMwwMz0852d34RycdOnvvSXnPld/7/zPed8z/mNxfI/btb/Qr/OjhbzeYjBaDF7b+y/CcBIhTHcNFJszM33QcYBZDjSazwSENPxm7lgvF3tSYmUxiHxiB1JiIxj6bUvRVI8iAwg/ogM0QuIwOnMuG0iALpYIiVSmoi4CgsLv52YmPhOfHx8ZUxMTGYoFEq0Wq2DwWCw3e/33+7v7//86dOnFwcHB19zvh8RIAERCMmYNh4AY7msdiIpRUVFNampqb9IS0vLqKmpCVRXV2fk5ubakpOTLT6fz/LkyZPQ+fPnXzU0NIRe0l69evXJo0ePPufbXsSLyDvjgpgIgNzuSElJmVRQUPA7FK3Ys2dP/Jw5cxzHjh3zXL58OeTxeBKHh4cT4uLifADzLV++3Lpp0yZ3S0uLd//+/UPd3d0NDx48+A3e8HBXXwSE4QbTr9tIABobkeuds2fP3mO323926tSphMOHD3vOnTvnwOK/9vX1Xezt7f2KcY/D4UgDYInL5VrG+LsrVqzwbd++3b1t27ZOADy4d+/eB4Do5D4DYkJOmJiLZC4kIyEhoRgQdZWVlYP0lzIyMr7D+gwkH8lBsiO95jPS09Ory8vLL61atcrT2dkZ2rBhQ0dZWdln7BUjaYiILD1jmhZNzNPz8vLKmE9GpiBTp02b9j59ISKlbkSXpY4QzbWeh5TNnDnzjwLR1dUVWrJkSTcc2sa67hKZFd5o00RuFwChc+Xk5JRkZ2efY9yIq3voffDqPr1YLTIppQTWpKTCpaZUFOOHsb6F0FX29PS4Nm7caL969WoZYOoCgYBSVOcUhnATAGO90KWB9iCuLiC9Sl+8eNHAmlJJIgLpvAtXT83Pz38PoGsYl5KOHvjgYy8MgN4CQb9C6fs7duxIrK+vt6C8DWI+ipzRXWpWXSiRNSnFxcXrsrKyNpw5cybl9OnTqeT6Cz76O3u6WEBd7H+rpKTkL4sXL160evXq+awtGBoa+pBaUO/1epV2utwKniDZUUiWuDHKdvfu3Tg88wV78qIBwPBr5Zkw+S3I5rly5coAFoXUa87625yZguRgbdW8efNCR48e1ZFo03zhwoW9KFzEuVxEpKzAS7tXrlzZifLg3Llz/8Ga7hKXxBkZHaP4hasd+f5zFAaqqqqUBRb18+fP76HCbW9tbf01S8FJkyatgtX+LVu2hM/onBpzy82bN2OoDSvx2LHS0tIavDcbhFnwxwkQq81my2H9o9jY2D7WWwD1KZ8G5FYbLiqnvP4gKSnJtm/fvm5deuDAgW5y26Z1wJWzFMelOQsWLBABx7RZs2bZuVyZE4v7n0PCH5MJVbW1tX7usaxbt65vzZo11aT2T7XPOekO/wQpIJOx9NDZs2cbKDou2G+BAwkUnqsDAwNHtc9ZeDX8L5CLyWPatWvXhrTPxtDjx49bKT5/ev36dXDnzp1yt2X37t1pmmudMt3KkjIh/EgpFjqk2LxNrNoUM9B3KoasVSCKaa5irFiPxwFxQxzhnGrFFHFnAk69xX4mIr02ZYCaQWPjknJevCwywgIQC8xtYl+vmx9vePFU0/37938ESf3t7e2248ePD+CpAaxeDQceck6PzxDnAnjuZXNzc9X69evtW7du7SOt9/HNjch9yoagipApREKUCh++h/z2xIkTacSs/+HDh9+HSF9GPqKzOAGZJ0IS82zy+3lHR0c9Z/7JnpTrYt0ZrisVFRV/4Ow8Fafbt29/wPpLRO+CUjtoPMA43GzkcidkrIWxdizwPXv2bAYKGtlVBZMMQqIeisxN5TVWNzPXi6diJU/qTmWWSBaC/X+jFtRi/YdwQBxRRZXycPxHA7BikU2uu3PnzrKDBw+mNzU1JXHBZFkQ+UhKVEh0iaw1l0mpA0ni7XgHj7QzDkDoLjz1ZwxpY26Um5D/x8Mgt6lZyeXnkKjgxo0b2YcOHXLz/ueotqu8Yq2UyjqBl+gNkeJkSvi06dOnfwKHPnK73VP5Y3IRg7w83V3sy0PmHRCAcBvtAS3KNSE+bsZ9i65fv+44cuSIWw8Lbv8h8S9yOp129mRxAkDzKc9L+If0k8zMzI/Xrl2bRg1JqqurK+JfVAyuv8Q5pa6Uh++mjzZjtVnQ3Fjlogi5qfu/Iv2qd+3aFUeqOU+ePNnV2Niov14O3gAH7vVjrXfp0qXWzZs3u2/duuXbu3fvIFbXkxkfA1x/RnyIwhaOO320jQagjXB1pJdrxeRksuJdrPkl1qfzf9BKfU9VeYUrFhRZ+CMa5P9g14ULF2IIXxfe+z3F5gLf6jkfE3fWom08ANo0IMy778QbSbh5Ge5/l3JaQQiyqenxPNte4txBhWsmg5ra2tq+4HulmVJy3LizHm0TAdAB7RmyCYgeIInqhbwjDuiMCBVOT3rFWkpNdsjtUcYzHtPeBECHtW/EsF6KNRY4NcVVSqRspBjCjYk756LtmwBEDzIwQEb2Zn+kMjM2e//v3+iBfwN/OI2ZyYaa1QAAAABJRU5ErkJggg==",measure:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAbCAYAAAH3zbSEAAAAAXNSR0IArs4c6QAAAn5JREFUSA29lr9uGkEQxu8A47MTKSf5j2RbjnDhAAUVVKbhBeiiNHmLPIxbt64i+QF4A3iBpEiUIkWUCEVBcSz/uXy/1S1aH3fxcoKM9LG7szv77c7MzhEEQRAKFWEutXkvCKoMqkmS3Foly+vCa6ugjdwBm907imoo+8QqwjCMavp5axVqzWTUarWuNKg6E/MurJvCS2F+lHR2Q+0XFkSiuU6VjxrRbaHg3OyyIJVut3sj7cHCjBTWOZ+zkzJKrLMa2UnGISvyJtAZy/F4vDDf6/VMUAaaOVyYDYKv6OpsPZ1Ok06nc6Hxs5yFharNfr9/qdmGkOvuIksTBjH/KVpQpJ9MJhF+fCha8ITe2EXcOU/+pdfGhrmQIC8E7mLuDEgzmwrufFGfI99iiIcJNv27FGqeliPuOhwOyekTwZu9KSPSeSAslRg8r7NljbhXLNBOBR/ZZhFOiRW7Tz4Wdo0y6QSmhrArfBd8xKzFcE+M33ws7Box7mN4qmh8sEqfVmXnFTHzjpuzaaWMkbEvbUg4ZjrzG7Uku49Qi2c4x01yH0PK4p013FJIfmWt4jg+H41G76SHpWzlyG5rxnwETqkaVFAeS7vdfi8duX8k8D0r7UfZ5gqbGtKUbKBxQ+CFLlWFtd5LcC+BfCHwQCkJPFDqifuB1rC0wAHwFiFK6KCoyb0fUQgIB8EDqwAeO9D+5MWesEHqQmyLXUv9mUC5XZXA8TzdjPYnt+QfxU6K3yiFVZMSPurljxSG9JjsdWUdYxEeC3VcC0zVVrtugQc+kyzN7M3cW6+iz/7iasJnWGH+n0JmcQJT4vj3t2Yx75Tsperwx9hm2DpuD5l9Gdd/AVIlXMI9fgkPAAAAAElFTkSuQmCC",section:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABBpJREFUWAntVUtLG1EUniRjEo2amKjVxBiFqlAXRUVFEBFKF6KLgii47kIKXVX36rra0lXRnd1IFftYqFAoBFyJ2AdUixqoMU18a3ylSZwk/b6pCRmfP6AZuJlz7znfd8797rkTQUg9KQVSCqQUSClwgwKxWEzV0NBgrq6u/tbf36/m/IZw2cUYxhJD7G0Y9XWEJGlsbKw5Ozv7qlKp7h8eHuoGBgZuLYAxjCWGWHKQ67o8VxISMDMz8yASiUyUlZUZV1ZWhNra2jvRaPTAarVGpqamHsF+AVLHObFbrVY/a21t/eDz+TSwc+bn57fKy8uF1dXVQ41G09HS0vIZvNGLhVyqjMmR4LEkSZ/a2tqMw8PDMgZzQzgc1kxPT7cj+WRzc7ODPg7aXKOPMYwliD5ykIucVymhKKCjo4MJXoFspKurS+jr6xOysrLkAtLS0rSwtfANIaEwODgo1NTUyIM21+hjDGMJIpYc5CInuZlDJjz/kQtgo9TV1VnW1tZGIftTVCr09PQkxwk4U7Xb7S5ErJ2EFx+u0RcKhQyMTfaTi5zkZg7mijenHNjZ2aluamoK4ux0ycBkGzvQYGeyHNzZdQ+SZzL2Oj9zMBdzMkb+qaysVB0dHaVXVVU9B/l7Vjs0NKTg4K4sFksIBDsjIyMKHydjY2MCfUjOY1I0N7nISW7mYC7mJE4hFSSKVVRUvMvPz39LQlwp4fj4mHGJJzc3943T6RR6e3uFhYUFgTeENtfgG00EwiCWHOQiJ7mZIzlGPJ/wegS0Wu02Agx2u33GYDD40LlPlpeX9YzBmUUxwkVFRU7s1DQ7O9uOpCb6cM38BQUFkzabzQmlwhjyUXZ3dwsulytYWlr62mw2f8f6b+bA9yEAmHwlE1KxOx0Ohx7yWJDADhkdfr+/en19vQsAa319/T1cJz9IbPDdxTsfI50FoLA/GNvAufD2iqJompubW0LP+IqLi8dMJtMX+NzAebKzs/fQzMGJiYkIsYlmWVpaimEHUcgYCgQCQZBIOp3uBIAf+/v7FbA/Go3GDRTBZpWADeN9iiL8SLoF28PkiDvd3d214mv4EB+ilzj3n/D9wvdhHfaex+MJxZOzgIQCnPBBs6hxVbR6vT4bUxtIefUkyOzC2sbBwUEMdgZGJpLLUsMfwtGdYARycnJUwWCwEDZVEjE2wOPF2lFJSUkY/Iqv4aUC4kXgLe7s7GShcgtsqJm2h/k+uldaXFwkToNzl/Gbm5tsrAh8MfjEvLw8M46NuDOc+R7m7GTpYnKsXVaAi3ywKxWaCCch6kAi4ljC2L1Cvn+Ryl/2ElTQZWRkaFE8TkwK4ZMsQQlF98dRimsYX+SbAAJxfQJer/cYf0LB8fFxhXzJ8XGbMYwlhtibkscxqXdKgf9bgb8e4D98kWiZrgAAAABJRU5ErkJggg==",rotate:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABUhJREFUWAntVmssZGcY/s6YGYPBYC3WfRsqS2tTiawUcUuUSFRdE3GtS2ormuxqJEK1iR9t0jaSjVtRIUII5U9VdhsjVSl1DSK2a+LaDcZl3OZiZk6fz8ZkzVKxPzZp6kuO855z3u99nu95L4OQ63WtwLUC/3cFmNcRIDMz03Rra0skEAiER0dHips3b8rq6up2GIZhrxrvUgIsy3KioqLeR/APARimUChcNRoNTIHa0NBQe3x8zCiVSgO1Ws2YmJisarXaYfh0ubq6/lJZWXlwGaELCZSVlXFHR0fvczicInNzc7PAwECBj48Px9nZmQCYQAGyvb1NhEIhsbKyInw+n6yurpLZ2Vl2YGBAvrCwwPB4vEYjI6MvW1tb1y8ici6B6OjoOzhxN8CcsrKyDHEqIhaLWRBiKKiBgQExNjYmUIHFycnh4SEjl8uJqakp8fT0ZAMCAhh3d3fS1dWlefLkiRyHyOru7m4/L0WvEEhMTPRCXoeys7OFLi4uTEVFBQVg7ezsjmxsbGQikUiFQMc4kQx3KrEAlzlSZQQ/7vr6unBzc9Nsd3eXk5aWRtzc3EhxcTHdc7+zs7Nen8QZAjU1NbzHjx9PJycnvw1H0tzcTLy8vKT29vbzAOjFyf/AXQK5VVBFg2ct8s/A5oAED8+2qA8f7P1AJpO9NzMzc8vJyYmTnp5OCgoKlI6Ojneqqqok8NUtrs6CMT4+7ge53vL29iYPHz5kkfdZSP0Nl8sVA3gXEivj4+OP9U9xGqO/v//vlZWVWZDqsrCw8PLz8/tseHg4fGxsjBcSEsIfGhr6tL29vTAhIUFzukdHAJu5TU1N9yA7B8yJtbX1HgroE+R5IiUl5egi0NNA9B4cHKzGjV6HANpBGlZsbW2tRkZG7gUFBTGTk5OB6BCaskNcJ4tKd7JQRAaQ6HBpaYnx8PAgGxsbgsXFRem/gUNaUWRk5HdQ50wqaUCcUgXya8vLy3ykkSAuLVo1UsR7gfjir44ATqtB1Y/jpGq0EImJieHPzc39FhsbG3QeAN67geQo/JMaGhqELweldlJS0q2enh6aCu/Q0FCmr6+PxWwQY1ZQhXRLR4DKh7V49+7dP6urqwmKh3nw4MEN5P9ngI2iNSMpEXrBDkOeJ8LDw28joAj9bkQj5ufnm2FoJcfFxfXu7+8v4HtYYWEht6ioiHbDhqWl5U9IrUKHDuOMdMgbH3kLRK8/Qs+7gwyDjiD19fWap0+ftkdERGSinz/Gvm9LSkoM6QDKy8tjUagSTEQrlUolxCnVyLcAs4BgIJG2tjaCmSAFga9B/ofc3FzZhQToB7SiMWQNQLAvnj179g7qQAibBZnK+fn55wcHB1+hlTgAIrDJ1NQULViCaUnoUKLpGxwcJKh+ggJUA3gJs+MRWrQlIyNDql/MZxSgBKjEvb29/LW1tduwY1E0CSBhgUD5GFDWExMT30N2k/LycoJnUlpaSjB4TsjQsQyZtbgOHBwctqGMGG39I2JM5eTk7OmDU7xXCNCXdAGc09LSQn/tbPHoiUADeGcOu2x6evojgAoxLQl+cFhfX99NFDH9cdqBz1/w6Yf/7xhQS7BlkJ1OznPXhQROvSmRxsZGPlpO2dHRwdnZ2bFH8ByJRJID+a0BrESxxaFYJZBZhj5X4p0cLad4eeCcxtO/X0pAfwMlhBF9A3MjRiqVfg41RCjOd1NTU59DYq2+/2XPukl4mePpdwoCEpu1tbVt+Edkxd/fPxwdIH8dcBrzygToJlpMWHso1l9RrGNmZmZnWov6vLEFIldO4xsjdw30n1DgH4y0hp8mM/gUAAAAAElFTkSuQmCC",translate:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAABLxJREFUWAntVllIZEcUvd1jOxrbNW7jihoRxQWhjaKixiUS42DEBZn8iCGifghxIWAQhsjgR0JIPiL4pRkTFDU/CsK4oOJCUHFBUVEEcUSNg6Ktjt3a7cupgtdp5fXrkTDkx4LuV6+We86799xbRfTQHjzwP3tAcR/8oqIij/Pz8xfY461Wq+svLy81RqPxCfq/9fT0vLmPLXGtUuxYe1ZVValPT0836urqvi4sLHx6cnKyEBQU9HtmZuYPZ2dnf7W1tdlZsyE1b9UDgiAo8vPz47C5VK/XV/b19XE7JSUl1NjYSDExMVRTU0MHBwcVIPgYk64RERE/ol1IAd4ds+qB4uLiGGyazMvLq3RwcKCZmRmysbGhtLQ0WllZ4faysrLo6Ojo19jY2F/S09Ofr66u9nR3dz+6Cyb1LktgdHTUxtbW9llSUpKqtLSUysrKaGhoyAQq9lNSUugRWkVFBdXW1pK/v/9nS0tLPlKAd8dkCWxsbNgGBgbqxC9lQAsLCwQhUlhYGCkUClpbWyPmmcTERAKoidzOzk4hwidrny22tuA6ODh4XKvVGkQgjUZD4+PjHAgCpOHhYROo2EcYCCL9tqOjw55PyvzJEigvLzeoVKp1X1/f16Jxc1DWZ2QMBgMxYru7u7S/v0+urq4UGRnptbi4+JEMNp+SJQAXCzCuBYHesbExDhQXF2cC8vLyooCAAC5MSIALc2RkhBtm5EColOlIjoQsAbYRIbh0c3P7E57QswxgQKmpqSQCsQyYnp7mGNnZ2TQ/P8/7TBPX19eV0JEDH7DwJ5kqLPchqE8hwJdTU1NPUe0mXVxcPt7b23vCwJ2dnQmVj3JzcykkJITXAmQLgShlZGSQUqnkqQoh2kA7r+bm5rYt4EsPI4ft8TVabBT6+/uFnJycNw0NDT8D8AZVD/wE4fj4mD/l/iYmJoSCgoKXra2tKmkkC1mAiucCl9v7+fnxr0TFc0cqfoWvNIgZwIRmrYWHh5NOp/scaWoxGyQ1AOEJUPVmfX09F1xCQgI1NTWpMa4Ss8EaOJt3cnKim5sbR/wsnhOSBLD3xMfH5zkq2t+szq+vr1N0dDShvrOaTzgF3wWfLi4uuBawXlJrzIgkAZRdPWL7Cqfdd1FRUbuIP0+10NBQ6uzsJHt7ix69RWxra4twVL9F6IRbE2YvkgRY/qMIaeG6Xm9v79r4+PjN5uZmQaz9Zvtlu4ODg+Tp6bmJrLi2tFCSAFsskkD6Dbi7u1cnJycvtbS0CF1dXZZs3RpHBtHs7KwRafoHbOluTZq9vNN9ADlvh7Neg1i+mJycxOGYpGQnH8t9qXZ4eMhPRWTBLLT0JUK6BRI3UmstekBczDyBO8ElyvEMYv8N7gEDy8vLV9XV1bwCokiJS+nq6ooGBgaIzaFE73t4eHyPydeWwNlGqx4wWUeHFRRcRoKRjlU4dJ5BZG4oTEoA8WXsIIJQdXD7NrzzE4TczbTEPsLcjnn/XgTYRnbTQXH5EMXqEwB8AaEmIDQfgJjRzs7uAEt6AdiHGrCNS+yFHDizd28CbBOAFe3t7Y/hcjUU7oifE7yiBwktps8cHR3fImz/xoZtel+NkWFewdOqnt4Xhwe7/8kD/wDeTzMCbKkf6QAAAABJRU5ErkJggg==",zoom:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAA6pJREFUWAntVltIk2EY/rZ/bO7gNCx1aswrYzSGkKAYIUE3mg6TlPBwIcEoJnRVkCFOJAblTeAo5lUIEi5spLCbBCUSBIOh1KAbldIxSZdzOZ079L6jf/yb23/q0n7Yvu89Ps/3fkdC/n9nvQLUvxSgp6enqqKiwt3Q0DC/trYWEpNLKiYIY/r7+y/s7e3NG43G69iiLCaXKAI2m00TCAQ8bW1tNWNjYwRblFEvhoSgGACRt7S0zNvt9iTzQxn1aBeUUIgzAEpbW1tdg4ODyVgsxsRPyahHO/rxzSvh64hJodSOo6Oje3TMxMQEqa6uJuvr68RisdBqUlBQ8Gp2dtYqkUgSaWWejiyP/pTa5XKpzGbzVzB4gUzZzMyMrry8POWn0+kIRVGko6PDD6ABUH5Ff2jDKQeWP96l6uzsPFSpVK8B6ObW1tZdrVaLI02lxhZl1KMd/dCfBTdt4k0Ay9nb2xsqLCwM+P3+Mhw180MZ9WhHPz7lx3jeBBhgVDweN+YigHrwE3S4CSYQDAZlJycnNbkIoB7tDLKcXcEE1Go1EtDnIaBHOycqw0EwAZhbKhqNlsEdwEhDCBJCPdozDByCYALHx8cy+BVnVwAJoR7tHJgZZsEEYKtpEomEoqSkJCMRyqhHe4aBQxBEAA4gCWy1S9mjpzFQj3b0o3VcrSACCwsLFJTYxEYA7ejHBUzbWZniSOByeQBJn0NAem7b29uJ1Wqlc6Rbh8NB3G53WoZOTKFQPJybm3sBizPJNNB9VgLT09PK/f19M8zrk5WVlctw4eCFRMfmbeEiIk6nM1FXV/elsrLyaVFR0fuurq5IrgBWAliBqamp4nA4fOPg4MC2tLRkaGpqkgwMDBCp9PTswSIk4+PjZHFxMdnY2OiDY9mm0Wg+dHd3/xJVAWSMJCYnJ1Wwx6/AVWxbXl6+VlpaKhseHiYAkB4UECQjIyNkZ2cnVl9f/xEuKJtcLv/c19d3mA8cg1krkM4OHZgOeSgUqoHz/tHq6upt6CtHR0eJXq8nm5ubZGhoCG/EiMlkegs34jPof4OyR5k5cvV5E8BgIEEBcBWQsGxsbNz3+Xzn4A1A4G1ADAZDEB4nLwHcCeA/ADyeCzBbJ4gABsOUSGFKzkcikVu7u7uPvV7vxdra2u9wENmVSuU7KPlPKDnnS4gmIpjAXxISWOVaWIhXgdAdAHwDC/AT7BJ8B+TcbjRgdiuKAE3C4/HIt7e31XAP/G5ubo4KBc8mczblP8eTrmVjlSb0AAAAAElFTkSuQmCC"};if(function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.MouseMotion"),t=function(e){function t(){i&&"walk"==e.getViewer().getEditorManager().editor.name||(n.addClass("motion-zoom"),o=Date.now(),setTimeout(function(){Date.now()-o>180&&n.removeClass("motion-zoom")},200))}var i=!1,n=e.getDomElement(),o=void 0,a=!1,r=!1,s=null;Glodon.Bimface.Viewer.Viewer3D&&e instanceof Glodon.Bimface.Viewer.Viewer3D&&(i=!0),n.addEventListener("keydown",function(e){17==event.keyCode&&(a=!0)}),n.addEventListener("keyup",function(e){17==event.keyCode&&(a=!1)}),n.addEventListener("mousedown",function(t){e._opt.enableZoomRect||a||(s={x:t.clientX,y:t.clientY})}),n.addEventListener("mousemove",function(t){if(s&&!r&&!(Math.abs(s.x-t.clientX)<2&&Math.abs(s.y-t.clientY)<2)){if(i){var o=e.getUseLeftHandedInput();if("walk"==e.getViewer().getEditorManager().editor.name)1==t.buttons&&n.addClass("motion-rotate");else{var a=e._getIsCursorEnabled();1==t.buttons?a&&n.addClass(o?"motion-rotate":"motion-translate"):n.addClass(o?"motion-translate":"motion-rotate")}}else 1==t.buttons&&n.addClass("motion-translate");r=!0}}),n.addEventListener("mousewheel",t,!1),n.addEventListener("DOMMouseScroll",t,!1),n.addEventListener("mouseup",function(e){s=!1,r=!1,n.removeClass("motion-translate"),n.removeClass("motion-rotate")})};e.setCursor=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e,t){var i=document.createElement(e);return i.setAttribute("class",t),i};e.create=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e,t){var i=document.createElementNS("http://www.w3.org/2000/svg",e);return i.setAttribute("class",t),i};e.createNS=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e){return e.indexof("#")?document.getElementById(e.replace("#","")):e.indexof(".")?document.getElementsByClassName(e.replace(".","")):document.getElementsByTagName(e)};e.select=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop(),i=function(e){var i={element:null,handle:null,axis:"all",cursor:"move",distance:0,start:null,move:null,stop:null,bBoxDetection:!1},n=Object.assign(i,e),o=n.element;if(!o)return!1;var a=n.handle||o,r=void 0,s=!1,l=this,u=function(e){return Math.pow(e.x,2)+Math.pow(e.y,2)>Math.pow(n.distance,2)&&(n.start&&n.start(r),!0)},c=function(e){var t=navigator.userAgent;return t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!isOpera?1==e:0==e};this.resize=function(e,t,i){t=t||{x:0,y:0};var o=e.getBoundingClientRect(),a=e.parentElement.getBoundingClientRect(),r=o.left-a.left,s=o.top-a.top,l=e.offsetWidth,u=e.offsetHeight,c=e.parentElement.offsetWidth,d=e.parentElement.offsetHeight,h=Math.min(r+t.x,c-l),f=Math.min(s+t.y,d-u),g=r+t.x<0?0:h>0&&h||0,v=s+t.y<0?0:f>0&&f||0;i&&0!=g&&0!=v||(e.style.left=g+"px",e.style.top=v+"px",e.style.transform="none",n.record&&n.record(g,v))}
;var d=function(e){var t=o.getBoundingClientRect(),i=o.parentElement.getBoundingClientRect(),a=t.left-i.left,r=t.top-i.top;if(n.bBoxDetection)l.resize(o,e);else{var s=a+e.x,u=r+e.y;switch(n.axis){case"x":o.style.left=s+"px";break;case"y":o.style.top=u+"px";break;case"all":default:o.style.left=s+"px",o.style.top=u+"px"}}},h=function(e){var i=e;if(t){if(!c(i.button))return;r={x:i.clientX,y:i.clientY},document.addEventListener("mousemove",f)}else r={x:i.touches[0].clientX,y:i.touches[0].clientY},a.addEventListener("touchmove",f);n.start&&n.start(r)},f=function(e){var i=e;if(t)var o={x:i.clientX,y:i.clientY};else var o={x:i.touches[0].clientX,y:i.touches[0].clientY};var a={x:o.x-r.x,y:o.y-r.y};s?(n.move&&n.move(r,o,a),r=o,d(a)):s=u(a),e.preventDefault(),e.stopPropagation()},g=function(){s&&n.end&&n.end(r),s=!1,document.removeEventListener("mousemove",f),a.removeEventListener("touchmove",f)};t?(a.style.cursor=n.cursor,a.style.userSelect="none",a.addEventListener("mousedown",h),document.addEventListener("mouseup",g)):(a.addEventListener("touchend",g),a.addEventListener("touchstart",h))};e.drag=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(t){var i={element:null,axis:"all",minWidth:100,minHeight:100,distance:0,start:null,sizable:null,stop:null},n=Object.assign(i,t),o=n.element;if(!o)return!1;var a,r,s=void 0,l=!1,u=e.create("div","bf-resize"),c=function(e){return Math.pow(e.x,2)+Math.pow(e.y,2)>Math.pow(n.distance,2)&&(n.start&&n.start(s),!0)},d=function(e){var t=navigator.userAgent;return t.indexOf("compatible")>-1&&t.indexOf("MSIE")>-1&&!isOpera?1==e:0==e},h=function(e){var t=o.offsetLeft,i=o.offsetTop,s=a+e.x<n.minWidth?n.minWidth:a+e.x,l=r+e.y<n.minHeight?n.minHeight:r+e.y;switch(n.resize&&n.resize(s,l),o.style.left=t+"px",o.style.top=i+"px",n.axis){case"x":o.style.width=s+"px";break;case"y":o.style.height=l+"px";break;case"all":default:o.style.width=s+"px",o.style.height=l+"px"}},f=function(e){a=o.clientWidth,r=o.clientHeight;var t=e;d(t.button)&&(s={x:t.clientX,y:t.clientY},document.addEventListener("mousemove",g),document.addEventListener("touchmove",g))},g=function(e){var t=e,i={x:t.clientX,y:t.clientY},o={x:i.x-s.x,y:i.y-s.y};l?(n.sizable&&n.sizable(s,i,o),h(o)):l=c(o)},v=function(){l&&n.end&&n.end(s),l=!1,document.removeEventListener("mousemove",g),document.removeEventListener("touchmove",g)};o.addClass("bf-sizable"),o.appendChild(u),u.addEventListener("mousedown",f),u.addEventListener("touchstart",f),document.addEventListener("mouseup",v),document.addEventListener("touchend",v)};e.sizable=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(t){var i=this,n={element:null,min:0,max:100,cur:50,step:1,isShowProgress:!0,input:null,change:null,currentColor:"#11dab7",defaultColor:"#999"},o=Object.assign(n,t);this._opt=o;var a=e.create("div","bf-range"),r=e.create("input","bf-input-range");i.input=r,r.setAttribute("type","range"),r.setAttribute("step",o.step),r.setAttribute("min",o.min),r.setAttribute("max",o.max),r.setAttribute("value",o.cur);var s=e.create("span","bf-range-min");s.innerText=o.min;var l=e.create("span","bf-range-cur");i.cur=l,l.innerText=o.cur;var u=e.create("span","bf-range-max");u.innerText=o.max;var c=e.create("span","bf-range-progress");a.appendChild(r),o.isShowProgress&&(a.appendChild(s),a.appendChild(l),a.appendChild(u)),a.appendChild(c),o.element.appendChild(a),i.setProgress(o.cur),r.addEventListener("input",function(){i.setProgress(this.value),o.input&&o.input(this.value)}),r.addEventListener("change",function(){i.setProgress(this.value),o.change&&o.change(this.value)})};t.prototype.setProgress=function(e){var t=this._opt,i=t.max-t.min,n=this.input,o=this.cur,a=(e-t.min)/i*100;n.value=e,n.style.background="linear-gradient(to right,"+t.currentColor+" 0%,"+t.currentColor+"  "+a+"%,"+t.defaultColor+" "+a+"%, "+t.defaultColor+" 100%)",o.innerText=e},t.prototype.reset=function(){this.setProgress(this._opt.cur)},e.range=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=function(e){var t={element:null,min:0,max:100,from:null,to:null,step:1,currentColor:"#11dab7",defaultColor:"#999",change:null};this._opt=Object.assign(t,e),this._opt.from=this._opt.from||this._opt.min,this._opt.to=this._opt.to||this._opt.max,this.init()};t.prototype={init:function(){var t=e.create("div","bf-multiple-range"),i=e.create("div","bf-range-track"),n=e.create("span","bf-slider bf-slider-min");n.id="minSlider",n.type="minimum";var o=e.create("span","bf-slider bf-slider-max");o.id="maxSlider",o.type="maximum",this._state={from:this._opt.from,to:this._opt.to},i.style.backgroundColor=this._opt.currentColor,t.style.backgroundColor=this._opt.defaultColor,t.appendChild(i),t.appendChild(n),t.appendChild(o),this._opt.element.appendChild(t),this._track=i,this._sliders={min:n,max:o},this._element=t,this.bindEvent(),this.update(!1)},bindEvent:function(){var e,t,i=this,n=!1,o=function(i){var i=i||event;t=i.screenX,e=this,n=!0},a=function(o){if(n){var o=o||event,a=o.screenX-t,r=Math.round(a/i._pix/i._opt.step)*i._opt.step;0!=r&&(t=r*i._pix+t,"minimum"==e.type?i._state.from+=r:i._state.to+=r,i.recalculate(e),i.update(!0))}},r=function(){e=null,n=!1};this._sliders.min.addEventListener("mousedown",o),this._sliders.max.addEventListener("mousedown",o),document.addEventListener("mousemove",a),document.addEventListener("mouseup",r)},update:function(e){var t=this._sliders.min.offsetWidth,i=this._sliders.max.offsetWidth;if(!this._pix){var n=this._element.offsetWidth,o=this._opt.max-this._opt.min,a=(n-t-i)/o;this._pix=a}var r=(this._state.from-this._opt.min)*this._pix,s=(this._state.to-this._opt.min)*this._pix+t+i;this._track.style.left=r+t/2+"px",this._track.style.width=s-r-t/2-i/2+"px",this._sliders.min.style.left=r+"px",this._sliders.max.style.left=s+"px",this._opt.change&&e&&this._opt.change(this._state)},recalculate:function(e){this._state.to>=this._opt.max&&(this._state.to=this._opt.max),this._state.from<=this._opt.min&&(this._state.from=this._opt.min),e&&("maximum"==e.type&&this._state.to<=this._state.from&&(this._state.to=this._state.from),"minimum"==e.type&&this._state.from>=this._state.to&&(this._state.from=this._state.to))},getProgress:function(){return this._state},setProgress:function(e){this._state=e,this.recalculate(),this.update(!1)}},e.multipleRange=t}(),function(){var e=function(e){var t,i;this.addEventListener("touchstart",function(e){t=Date.now()}),this.addEventListener("touchend",function(n){(i=Date.now())-t<200&&e(n)})};HTMLElement.prototype.tap=e}(),function(){(window.ActiveXObject||"ActiveXObject"in window)&&(HTMLElement.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)},window.Element&&function(e){e.matches=e.matches||e.matchesSelector||e.webkitMatchesSelector||e.msMatchesSelector||function(e){for(var t=this,i=(t.parentNode||t.document).querySelectorAll(e),n=-1;i[++n]&&i[n]!=t;);return!!i[n]}}(Element.prototype),window.Element&&function(e){e.closest=e.closest||function(e){for(var t=this;t.matches&&!t.matches(e);)t=t.parentNode;return t.matches?t:null}}(Element.prototype))}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.UUID"),t=function(){for(var e=[],t="0123456789abcdef",i=0;i<36;i++)e[i]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")};e.createUUID=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),t=function(e,t){var i=null,n=Date.now();return void 0==t&&(t=30),function(){var o=Date.now(),a=t-(o-n),r=this,s=arguments;clearTimeout(i),a<=0?(e.apply(r,s),n=Date.now()):i=setTimeout(e,a)}};e.throttle=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang"),t=function(){this.container={}};t.prototype.addEvent=function(e,t){return"string"==typeof e&&"function"==typeof t&&(void 0===this.container[e]?this.container[e]=[t]:this.container[e].push(t)),this},t.prototype.fireEvent=function(e){if(e&&this.container[e]){var t=Array.prototype.slice.call(arguments);t.shift();for(var i=this.container[e].length,n=0;n<i;n++){this.container[e][n].apply(null,t)}}return this},t.prototype.removeEvent=function(e,t){if("function"==typeof t&&"string"==typeof e){var i=this.container[e];if(i instanceof Array){for(var n=0,o=i.length;n<o;n+=1)if(i[n]===t){i.splice(n,1);break}0==i.length&&delete this.container[e]}return this}},e.EventManager=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Geometry"),t=function(e,t,i){this.x=e,this.y=t,this.z=i};t.prototype={get:function(){return{x:this.x,y:this.y,z:this.z}},set:function(e,t,i){this.x=e,this.y=t,this.z=i}},e.Point3d=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Geometry"),t=function(t,i){var n={},o=new e.Point3d,a=new e.Point3d;return o.set(t.x,t.y,t.z),a.set(i.x,i.y,i.z),n.min=o,n.max=a,n};e.BoundingBox=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics.Utility"),t=function(e){var t=e.toString(16);return 1==t.length&&(t="0"+t),t};e.RGBToHex=t}(),!hostConfig)var hostConfig={APIHost:"https://api.bimface.com",resourceHost:"https://m.bimface.com",staticHost:"https://static.bimface.com",dataEnvType:"BIMFACE"};!function(){function e(e,t){function i(e){return"FloorPlan"==e||"CeilingPlan"==e}if("DrawingSheet"!=t.viewType)return null;var n=t.viewInfo,o=n.preview.width,a=n.preview.height,r=n.outline[0],s=n.outline[2],l=n.outline[1],u=n.outline[3],c=s-r,d=u-l;n=t;for(var h=n.portsAndViews,f=0;f<h.length;f++){var g=h[f];if(i(g.viewType)){var v=function(t,i,n,s,u){var h=e.x/o,f=(a-e.y)/a;if("Elevation"==u.viewType){f=(o-e.x)/o,h=e.y/a;var g=u.viewPoint.viewDirection;1!=Math.round(g[0])&&-1!=Math.round(g[1])||(h=(a-e.y)/a)}var v=(t-r)/c,m=(i-r)/c;if(h<v||h>m)return null;var p=(n-l)/d,y=(s-l)/d;if(f<p||f>y)return null;var w=(h-v)/(m-v),b=(f-p)/(y-p),C=((u.outline[2]-u.outline[0])*w+u.outline[0])*u.viewPoint.scale,x=((u.outline[3]-u.outline[1])*b+u.outline[1])*u.viewPoint.scale;return new THREE.Vector3(C,x,0)}(g.viewport[0],g.viewport[3],g.viewport[1],g.viewport[4],g);if(null!=v){if(i(g.viewType))null!==v&&(v.z=g.elevation);else if("Elevation"==g.viewType){var m=g.viewPoint.viewDirection,p=g.cropBox;0!=Math.round(m[0])?null!==v&&(v.z=v.y,v.y=v.x,v.x=m[0]<0?p[3]:p[0]):0!=Math.round(m[1])&&null!==v&&(v.z=v.y,v.y=m[1]<0?p[4]:p[1])}return v}}}return null}function t(e,t,i){if("DrawingSheet"!=t.viewType)return!1;var n=t.preview.width,o=t.preview.height,a=t.outline[0],r=t.outline[2],s=t.outline[1],l=t.outline[3],u=t.portsAndViews;for(var c in u){var d=u[c];if("FloorPlan"===d.viewType){var h=d.viewPoint.scale,f=d.outline[0]*h,g=d.outline[2]*h,v=d.outline[1]*h,m=d.outline[3]*h;if(!(e.x<f||e.x>g||e.y<v||e.y>m)){var p=(e.x-f)/(g-f),y=(e.y-v)/(m-v),w=d.viewport[3]-d.viewport[0],b=d.viewport[4]-d.viewport[1];i(n*((d.viewport[0]+w*p-a)/(r-a)),o-o*((d.viewport[1]+b*y-s)/(l-s)),d)}}}return!0}var i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics.Utility.Relation"),n=function(e,t,i){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:hostConfig.resourceHost+"/"+e+"/metadata/views.json",success:function(n){var o=JSON.parse(n).viewList,n=[];for(var a in o){var r=o[a];r.viewType==t&&(r.preview.path=hostConfig.resourceHost+"/"+e+"/"+r.preview.path,n.push(r))}i&&i(n)}})},o=function(e,t,i){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:hostConfig.resourceHost+"/"+e+"/metadata/drawings.json",success:function(e){for(var n=JSON.parse(e).drawingList,o=0;o<n.length;o++){var a=n[o];if(a.viewInfo.id==t){i&&i(a);break}}}})},a=function(t,i){if("DrawingSheet"==i.viewType)return e(t,i);if("FloorPlan"!=i.viewType)return console.warn("Not support yet!"),null;var n=i.preview.width,o=i.preview.height,a=i.outline[0],r=i.outline[2],s=i.outline[1],l=i.outline[3],u=r-a,c=l-s,d=(0-a)/u,h=l/c,f=(t.x-n*d)/n,g=(o*h-t.y)/o;return f=f*u*i.viewPoint.scale,g=g*c*i.viewPoint.scale,new Glodon.Web.Geometry.Point3d(f,g,i.elevation)},r=function(e,i){var n=[];if(t(e,i,function(e,t,i){n.append({x:e,y:t})}))return 0==n.length?null:n;if("FloorPlan"!=i.viewType)return console.warn("Not support yet!"),null;var o=i.preview.width,a=i.preview.height,r=i.outline[0],s=i.outline[2],l=i.outline[1],u=i.outline[3],c=s-r,d=u-l,h=(0-r)/(s-r),f=u/(u-l),g=e.x/(c*i.viewPoint.scale),v=e.y/(d*i.viewPoint.scale);return g=g*o+o*h,v=a*f-v*a,{x:g,y:v,z:0}};i.getViews=n,i.getDrawingSheets=o,i.point2DToPoint3D=a,i.point3DToPoint2D=r}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics.Utility"),t=function(e){var t=new Image;return new Promise(function(i,n){t.onload=function(){i(t)},t.onerror=function(e){n(e)},t.crossOrigin="anonymous",t.src=e,!0===t.complete&&i(t)})};e.ImageContainer=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics"),t=Glodon.Web.Graphics.Utility.RGBToHex,i=function(e,t,i,n){this.red=e,this.green=t,this.blue=i,this.alpha=n},n=function(e,t){/^#[0-9a-fA-F]{6}$/.test(e)&&(this.red=parseInt(e.slice(1,3),16),this.green=parseInt(e.slice(3,5),16),this.blue=parseInt(e.slice(5),16)),"number"==typeof t?(t>1&&(t=1),t<0&&(t=0),this.alpha=t):this.alpha=1},o=function(){arguments.length<4?n.apply(this,arguments):i.apply(this,arguments)};o.prototype={getRGB:function(){return"rgba("+this.red+","+this.green+","+this.blue+")"},getRGBA:function(){return"rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")"},getHEX:function(){return""+t(this.red)+t(this.green)+t(this.blue)},getAlpha:function(){return this.alpha},fromObject:function(e){return this.red=e.red,this.green=e.green,this.blue=e.blue,this.alpha=e.alpha,this}},e.Color=o}(),function(){SVGElement.prototype.getClass=HTMLElement.prototype.getClass=function(e){return this.getAttribute("class")},SVGElement.prototype.hasClass=HTMLElement.prototype.hasClass=function(e){var t=this.getClass();return!!t&&(t&&t.split(" ")).indexOf(e)>-1},SVGElement.prototype.addClass=HTMLElement.prototype.addClass=function(e){var t=this.getClass(),i=t&&t.split(" ");return t?-1==i.indexOf(e)&&(i.push(e),t=i.join(" "),this.setAttribute("class",""+t)):this.setAttribute("class",""+e),this},SVGElement.prototype.removeClass=HTMLElement.prototype.removeClass=function(e){if(!this.hasClass(e))return this;var t=this.getClass().replace(e,"").trim();return t?this.setAttribute("class",""+t):this.removeAttribute("class"),this},SVGElement.prototype.toggleClass=HTMLElement.prototype.toggleClass=function(e,t){var i=(this.getClass(),this.hasClass(e));return void 0!=t?(t&&!i&&this.addClass(e),t||this.removeClass(e)):i?this.removeClass(e):this.addClass(e),!i}}(),function(){Array.prototype.getObjectByAttribute=function(e,t){for(var i=this,n=i.length,o=0;o<n;o++)if(i[o][e]==t)return i[o];return!1},Array.prototype.removeObjectByAttribute=function(e,t){for(var i=this,n=i.length,o=0;o<n;o++)if(i[o][e]==t)return i=i.splice(o,1);return!1},Array.prototype.getAllObjectByAttribute=function(e,t){for(var i=this,n=i.length,o=0,a=[];o<n;o++)i[o][e]==t&&a.push(i[o]);return a},Array.prototype.removeByValue=function(e){for(var t=this,i=t.length,n=i-1;n>=0;n--)t[n]==e&&t.splice(n,1);return t},Array.prototype.insert=function(e,t){return this.splice(e,0,t),this}}(),function(){SVGElement.prototype.setCss=HTMLElement.prototype.setCss=function(e){if(e)for(var t in e)this.style[t]=e[t]},SVGElement.prototype.getCss=HTMLElement.prototype.getCss=function(){return this.style}}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Authentication"),t=function(){return{APIHost:hostConfig.APIHost,viewToken:null}};e.AuthenticationConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Authentication"),t=(Glodon.Web,Glodon.Web.Lang.Utility.HttpRequest),i=function(e){this.config=e};i.prototype.authenticate=function(e,i){var n=this,o=n.config;t.ajax({url:o.APIHost+"/inside/databag?viewToken="+o.viewToken,success:function(t){var a=JSON.parse(t);"success"==a.code?(a.data.viewToken=o.viewToken,n.data=a.data,e&&e(a.data)):i&&i(a)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);i&&i(t)})})},e.AuthenticationManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{APIHost:hostConfig.APIHost,resourceHost:hostConfig.resourceHost,viewToken:null,modelId:null,modelType:"singleModel",dataEnvType:hostConfig.dataEnvType||"BIMFACE"}};e.MetaDataManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest.promiseJSONRequest,i=Glodon.Web.Lang.Utility.HttpRequest.ajax,n={getAreas:function(e){var i=e.relativeUrl+"/data/spaces.json";return t(i)},getMepSystem:function(e,i){if("integrateModel"==i.modelType)var n=i.relativeUrl+"/metadata/"+e+"/mepsystem.json";else var n=i.relativeUrl+"/metadata/mepsystem.json";return t(n,"noCode")},getTreeOldData:function(e){if("singleModel"==e.modelType)var i=e.relativeUrl+"/data/tree.json";else var i=e.relativeUrl+"/data/specialtyTree.json";return t(i)},getTreeNewData:function(e){var i=e.relativeUrl+"/data/tree.json";return t(i)},getObjectData:function(e,t){return new Promise(function(i,n){if(t._objectData)i(t._objectData);else{var o=new Glodon.Bimface.Data.ObjectPropertyManager(e.relativeUrl+"/property");o.load(function(){t._objectData=o,i(t._objectData)})}})},getMaterialProperty:function(e,i){var n=i.split(".");if("singleModel"==e.modelType)var o=e.relativeUrl+"/metadata/materialmap.json";else var o=e.relativeUrl+"/metadata/"+n[0]+"/materialmap.json";return t(o,"noCode")},getMaterialPropertyItem:function(e,i,n){var o=i.split("."),a="singleModel"==e.modelType?e.relativeUrl+"/metadata/materials/"+n+".json":e.relativeUrl+"/metadata/"+o[0]+"/materials/"+n+".json";return t(a,"noCode")},getAreaProperty:function(e,i){var n=e.split("_");if("singleModel"==i.modelType)var o=i.relativeUrl+"/metadata/areas.json";else var o=i.relativeUrl+"/metadata/"+n[0]+"/areas.json";return t(o,"noCode")},getRoomProperty:function(e,i){var n=e.split("_");if("singleModel"==i.modelType)var o=i.relativeUrl+"/metadata/rooms.json";else var o=i.relativeUrl+"/metadata/"+n[0]+"/rooms.json";return t(o,"noCode")},getFiles:function(e){var i=e.relativeUrl+"/data/files.json";return t(i)},getDrawingsheets:function(e,i){var n=e.relativeUrl+"/metadata/drawings.json";return t(n,"noCode")},getMapInfo:function(e){var t=this,n=(t._opt,{}),o=[];t._helper;return i({url:e.relativeUrl+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),i=[],o=0,a=t.grids.length;o<a;o++){var r=t.grids[o];r.start.X=r.start.x,r.start.Y=r.start.y,r.start.Z=r.start.z,r.end.X=r.end.x,r.end.Y=r.end.y,r.end.Z=r.end.z,i.push(r)}n.Grids=i}}),i({async:!1,url:e.relativeUrl+"/metadata/levels.json",success:function(e){n.Levels=JSON.parse(e).levels}}),i({async:!1,url:e.relativeUrl+"/resource/v3/maps/output.json",dataType:"text",success:function(t){var i=JSON.parse(t);for(var n in i){var a=i[n];void 0==a.id&&(a.id=n),a.path=e.relativeUrl+"/resource/v3/maps/"+a.id+".png",a.name=n,o.push(a)}}}),{axisGrid:n,floors:o}},getLevels:function(e,i){var n=i.relativeUrl+"/metadata/levels.json";return e&&(n=i.relativeUrl+"/metadata/"+e+"/levels.json"),t(n,"noCode")},getFloors:function(e){var i=e.relativeUrl+"/data/spaces.json";return t(i,"noCode")},getViews:function(e){var t={data:null,resourceHost:"./"};return i({url:e.relativeUrl+"/metadata/views.json",async:!1,success:function(e){t.data=e}}),t},getViewsById:function(e){var t={data:null,resourceHost:"./"};return i({url:e.relativeUrl+"/metadata/"+e.fileId+"/views.json",async:!1,success:function(e){t.data=e}}),t},getViewData:function(e){var i=e.relativeUrl+"/metadata/viewStates/"+e.viewId+".json";return t(i,"noCode")},getRooms:function(e){var t=null;return i({url:e.relativeUrl+"/metadata/rooms.json",async:!1,success:function(e){t=e}}),t},getRoomBoundary:function(e,t){var n=null;return i({url:t.relativeUrl+"/metadata/roomsboundary/"+e+".json",async:!1,success:function(e){n=e}}),n},getAllDrawingsheets:function(e){var i=e.relativeUrl+"/metadata/drawings.json";return t(i,"noCode")},decodeElementId:function(e,t){if(/^[0-9]*\.*[0-9]*$/.test(t))return Promise.resolve(t);var i=t.split("."),n=i[0];return this.getFiles(e).then(function(e){var t=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var l=r.value,u=!0,c=!1,d=void 0;try{for(var h,f=l.linkedBy[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){if(h.value==n)return l.fileId+"."+i[1]}}catch(e){c=!0,d=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw d}}}}catch(e){o=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(o)throw a}}}).then(function(e){return e})},getCategoryVisibility:function(e){var i=e.relativeUrl+"/metadata/categoryVisibility.json";return t(i,"noCode")},getSegmentGroups:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups?view_token="+e.viewToken;return t(i,"noCode")},getSegmentFromGroups:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups/"+i+"/segments?view_token="+e.viewToken;return t(n,"noCode")},getSegmentTree:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentTree?view_token="+e.viewToken;return t(i,"noCode")},getSegmentById:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"?view_token="+e.viewToken;return t(n,"noCode")},getSegmentElementIds:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"/elementIds?view_token="+e.viewToken;return t(n,"noCode")},getPartialElementsMetadata:function(e,i){var n=e.relativeUrlWithoutDatabagId+"/"+i+"/metadata/partial_elements_metadata.json";return t(n,"noCode")},getPartialElementsMetadataFile:function(e,t){return e.relativeUrlWithoutDatabagId+"/"+t+"/metadata/partial_elements_metadata.json"},getDatabagResource:function(e,t){return e.relativeUrlWithoutDatabagId+"/"+t+"/resource/v3/model"},getModelGroup:function(e,i){var n=e.relativeUrl+"/metadata/modelSetsTree.json";return t(n,"noCode")},getManifest:function(e){var i=e.relativeUrl+"/manifest.json";return t(i,"noCode")},getNestedComponents:function(e){var i=e.relativeUrl+"/metadata/nestedComponents.json";return t(i,"noCode")},getWalkthrough:function(e){var i=e.relativeUrl+"/data_ext/walkthrough.json";return t(i,"noCode")}};e.OfflineDataProdiver=n}(),function(){function e(e){this._config=e}var t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data.OfflineDataProdiver");e.prototype={getComponentProperty:function(e,t,n){var o=this;if(!e)return console.warn("elementId must not be empty!."),void(n&&n());var a=null;i.getObjectData(this._config,this).then(function(t){return a=t,i.decodeElementId(o._config,e)}).then(function(e){var i=a.getBoundingBox(e),n=a.getElementProperties(e),o={},r=!0,s=!1,l=void 0;try{for(var u,c=n[0].items[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var d=u.value;o[d.key]=d.value}}catch(e){s=!0,l=e}finally{try{!r&&c.return&&c.return()}finally{if(s)throw l}}t({boundingBox:i,elementId:o.ID,familyGuid:"",guid:o.GUID,name:o.familyType,properties:n})})},getMaterialProperty:function(e,t,n){var o=this;i.decodeElementId(o._config,e).then(function(e){i.getMaterialProperty(o._config,e).then(function(a){var r=e.split(".");r="singleModel"==o._config.modelType?r[0]:r[1];var s=[];if(a[r]){var l=!0,u=!1,c=void 0;try{for(var d,h=a[r][Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var f=d.value;s.push(i.getMaterialPropertyItem(o._config,e,f))}}catch(e){u=!0,c=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw c}}Promise.all(s).then(function(e){t&&t(e)})}else n&&n(a)})})},getAreas:function(e,t){i.getAreas(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getMepSystem:function(e,t,n){var o=this;i.getMepSystem(e,o._config).then(function(e){t&&t(e,o._config.modelType)}).catch(function(e){n&&n(e)})},getTreeOldData:function(e,t){var n=this;i.getTreeOldData(n._config).then(function(t){e&&e(t,n._config.modelType,"old")}).catch(function(e){t&&t(e)})},getTreeNewData:function(e,t){var n=this;i.getTreeNewData(n._config).then(function(t){var i=!0;t&&t.length>0&&function e(t){"familyType"===t.type?t.items&&0!==t.items.length||(i=!1):t.items&&t.items.length>0&&e(t.items[0])}(t[0]),e&&e(t,n._config.modelType,i?void 0:"old")}).catch(function(e){t&&t(e)})},getRoomProperty:function(e,t,n){var o=this;i.getRoomProperty(e,this._config).then(function(n){var a="singleModel"==o._config.modelType?e:e.split("_")[1],r=!0,s=!1,l=void 0;try{for(var u,c=n[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var d=u.value;if(d.id==a)return void i.getObjectData(o._config,o).then(function(i){e="singleModel"==o._config.modelType?e:e.split("_")[0]+"."+e.split("_")[1];var n=i.getElementProperties(e);n.splice(0,1),d.properties=n,t&&t(d)})}}catch(e){s=!0,l=e}finally{try{!r&&c.return&&c.return()}finally{if(s)throw l}}})},getAreaProperty:function(e,t,n){var o=this;i.getAreaProperty(e,this._config).then(function(n){var a="singleModel"==o._config.modelType?e:e.split("_")[1],r=!0,s=!1,l=void 0;try{for(var u,c=n.areas[Symbol.iterator]();!(r=(u=c.next()).done);r=!0){var d=u.value;d.id==a&&i.getObjectData(o._config,o).then(function(i){e="singleModel"==o._config.modelType?e:e.split("_")[0]+"."+e.split("_")[1];var n=i.getElementProperties(e);n.splice(0,1),d.properties=n,t&&t(d)})}}catch(e){s=!0,l=e}finally{try{!r&&c.return&&c.return()}finally{if(s)throw l}}})},getModelGroup:function(e,t){i.getModelGroup(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getFiles:function(e,t){i.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getLinkGraph:function(e,t){i.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getDrawingsheets:function(e,t,n,o){var a=this;i.getDrawingsheets(this._config,e).then(function(e){n&&n(e,a._config.modelType,a._config.dataEnvType)})},getFloors:function(e,t){var n=this;i.getFloors(this._config).then(function(t){var i=!0,o=!1,a=void 0;try{for(var r,s=t.data[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var l=r.value;l.miniMap=n._config.databagId+"/resource/v3/maps/"+l.name+".png"}}catch(e){o=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}e&&e(t.data)})},getElementByConditions:function(e,t,n){var o=this;i.getObjectData(this._config,o).then(function(i){n&&n(i.getElementByConditions(e,t,o._config))})},getMapInfo:function(e){var t=i.getMapInfo(this._config);e&&e(t)},getLevels:function(e,t,n){i.getLevels(e,this._config).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getViews:function(e){var t=i.getViews(this._config);e&&e(t)},getViewsById:function(e,t){var n=this._config;n.fileId=e;var o=i.getViewsById(n);t&&t(o)},getViewData:function(e,t){var n=Object.assign({},this._config);n.viewId=e,i.getViewData(n).then(function(e){"[object Function]"===Object.prototype.toString.call(t)&&t(e)}).catch(function(e){"[object Function]"===Object.prototype.toString.call(failure)&&failure(e)})},getRooms:function(e){var t=i.getRooms(this._config);e&&e(t)},getRoomBoundary:function(e,t){var n=i.getRoomBoundary(e,this._config);t&&t(n)},getAllDrawingsheets:function(e,t,n,o){var a=this;i.getAllDrawingsheets(this._config).then(function(e){n&&n(e,a._config.modelType)}).catch(function(e){n&&n({drawingList:[]},a._config.modelType)})},getCategoryVisibility:function(e,t){i.getCategoryVisibility(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentGroups:function(e,t){i.getSegmentGroups(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentFromGroups:function(e,t,n){i.getSegmentFromGroups(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentTree:function(e,t){i.getSegmentTree(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentById:function(e,t,n){i.getSegmentById(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getSegmentElementIds:function(e,t,n){i.getSegmentElementIds(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getPartialElementsMetadata:function(e,t,n){i.getPartialElementsMetadata(this._config,e).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},getPartialElementsMetadataFile:function(e){return i.getPartialElementsMetadataFile(this._config,e)},getDatabagResource:function(e){return i.getDatabagResource(this._config,e)},getManifest:function(e,t){i.getManifest(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getNestedComponents:function(e,t){i.getNestedComponents(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getWalkthrough:function(e,t){i.getWalkthrough(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}},t.OfflineDataManager=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest.promiseJSONRequest,i=Glodon.Web.Lang.Utility.HttpRequest.ajax,n={getMepSystem:function(e,i){if("integrateModel"==i.modelType)var n=i.resourceHost+"/"+i.databagId+"/metadata/"+e+"/mepsystem.json";else var n=i.resourceHost+"/"+i.databagId+"/metadata/mepsystem.json";return t(n,"noCode")},getTreeNewData:function(e){var i=e.resourceHost+"/"+e.databagId+"/data/tree.json";return t(i)},getTreeOldData:function(e){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/tree?v=2.0&view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/tree?view_token="+e.viewToken+"&treeType=specialty";return t(i)},getDrawingList:function(e){function i(i,n){var o=e.APIHost+"/data/v2/files/"+i+"/drawingsheets?elementId="+n+"&view_token="+e.viewToken;return t(o)}function n(i,n,o){var a=e.APIHost+"/data/v2/integrations/"+i+"/drawingsheets?fileIdHash="+n+"&elementId="+o+"&view_token="+e.viewToken;return t(a)}var e=e;return{fromSingleModel:i,fromIntegrateModel:n}},getAreas:function(e){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/floors?includeRoom=true&includeArea=true&view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/floors?includeRoom=true&includeArea=true&view_token="+e.viewToken;return t(i)},getRoomProperty:function(e,i){if("singleModel"==i.modelType)var n=i.APIHost+"/data/v2/files/"+i.modelId+"/rooms/"+e+"?view_token="+i.viewToken;else var n=i.APIHost+"/data/v2/integrations/"+i.modelId+"/rooms/"+e+"?view_token="+i.viewToken;return t(n)},getAreaProperty:function(e,i){if("singleModel"==i.modelType)var n=i.APIHost+"/data/v2/files/"+i.modelId+"/areas/"+e+"?view_token="+i.viewToken;else var n=i.APIHost+"/data/v2/integrations/"+i.modelId+"/areas/"+e+"?view_token="+i.viewToken;return t(n)},getObjectData:function(e,i){if("singleModel"==e.modelType)var n=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+i+"?view_token="+e.viewToken;else if("integrateModel"==e.modelType){var o=i.split(".");if(1==o.length)var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/elements/"+i+"?view_token="+e.viewToken;else var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+o[0]+"/elements/"+o[1]+"?view_token="+e.viewToken}else var n=e.APIHost+"/data/v2/sections/"+e.modelId+"/elements/"+i+"?view_token="+e.viewToken;return t(n)},getEditedObjectData:function(e,i){if("singleModel"==e.modelType)var n=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+i+"?includeOverrides=true&view_token="+e.viewToken;else{var o=i.split(".")
;if(1==o.length)var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/elements/"+i+"?includeOverrides=true&view_token="+e.viewToken;else var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+o[0]+"/elements/"+o[1]+"?includeOverrides=true&view_token="+e.viewToken}return t(n)},getFiles:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files?includeDrawingSheet=true&view_token="+e.viewToken;return t(i)},getMaterialOverride:function(e,i,n){i=void 0==i?n.viewToken:i,e=void 0==e?n.modelId:e;var o=n.APIHost+"/data/v2/materialoverridesets/"+e+"?materialFormat=FULL_INSTANCE_JSON&sort=true&view_token="+i+"&compact=true";return t(o)},getLinkGraph:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/linkGraph?view_token="+e.viewToken;return t(i)},getMaterialProperty:function(e,i){if(!i)return void(failure&&failure({}));var n=i.split(".");if("singleModel"==e.modelType)var o=e.APIHost+"/data/v2/files/"+e.modelId+"/elements/"+n[0]+"/materials?view_token="+e.viewToken;else if("integrateModel"==e.modelType)var o=e.APIHost+"/data/v2/integrations/"+e.modelId+"/files/"+n[0]+"/elements/"+n[1]+"/materials?view_token="+e.viewToken;else var o=e.APIHost+"/data/v2/sections/"+e.modelId+"/elements/"+i+"/materials?view_token="+e.viewToken;return t(o)},getDrawingsheets:function(e,i){var n=e.APIHost+"/data/v2/files/"+i+"/drawingsheets?fileId="+i+"&view_token="+e.viewToken;return t(n)},getAllDrawingsheets:function(e,i){var n=e.resourceHost+"/"+(e.integrateDrawings&&e.integrateDrawings.databagId||e.databagId)+"/metadata/drawings.json";return t(n,"noCode")},getLinksJson:function(e,i){var n=e.resourceHost+"/"+e.databagId+"/metadata/links.json";return t(n,"noCode")},getFloors:function(e){if("singleModel"==e.modelType)var i=e.APIHost+"/data/v2/files/"+e.modelId+"/floors?view_token="+e.viewToken;else var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/floors?view_token="+e.viewToken;return t(i)},getElementByConditions:function(e,i,n){var o="";for(var a in n)o+="&"+a+"="+n[a];if("singleModel"==e.modelType)var r=e.APIHost+"/data/element/id?fileId="+i+o+"&view_token="+e.viewToken;else var r=e.APIHost+"/data/v2/integrations/"+i+"/elementIds?view_token="+e.viewToken+o;return t(r)},getMapInfo:function(e){var t=this,n=(t._opt,{}),o=[];t._helper;return i({url:e.resourceHost+"/"+e.databagId+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),i=[],o=0,a=t.grids.length;o<a;o++){var r=t.grids[o];r.start.X=r.start.x,r.start.Y=r.start.y,r.start.Z=r.start.z,r.end.X=r.end.x,r.end.Y=r.end.y,r.end.Z=r.end.z,i.push(r)}n.Grids=i}}),i({async:!1,url:e.resourceHost+"/"+e.databagId+"/metadata/levels.json",success:function(e){n.Levels=JSON.parse(e).levels}}),i({async:!1,url:e.resourceHost+"/"+e.databagId+"/resource/model/maps/output.json",dataType:"text",success:function(t){var i=JSON.parse(t);for(var n in i){var a=i[n];void 0==a.id&&(a.id=n),a.path=e.resourceHost+"/"+e.databagId+"/resource/model/maps/"+a.id+".png",a.name=n,o.push(a)}}}),{axisGrid:n,floors:o}},getLevels:function(e,i){var n=i.resourceHost+"/"+i.databagId+"/metadata/levels.json";return e&&(n=i.resourceHost+"/"+i.databagId+"/metadata/"+e+"/levels.json"),t(n,"noCode")},getViews:function(e){var t={data:null,resourceHost:e.resourceHost};return i({url:e.resourceHost+"/"+e.databagId+"/metadata/views.json",async:!1,success:function(e){t.data=e}}),t},getViewsById:function(e){var t={data:null,resourceHost:e.resourceHost};return i({url:e.resourceHost+"/"+e.databagId+"/metadata/"+e.fileId+"/views.json",async:!1,success:function(e){t.data=e}}),t},getViewData:function(e){var i=e.resourceHost+"/"+e.databagId+"/metadata/viewStates/"+e.viewId+".json";return t(i,"noCode")},getRooms:function(e){var t=null;return i({url:e.resourceHost+"/"+e.databagId+"/metadata/rooms.json",async:!1,success:function(e){t=e}}),t},getRoomBoundary:function(e,t){var n=null;return i({url:t.resourceHost+"/"+t.databagId+"/metadata/roomsboundary/"+e+".json",async:!1,success:function(e){n=e}}),n},getCategoryVisibility:function(e){var i=e.resourceHost+"/"+e.databagId+"/metadata/categoryVisibility.json";return t(i,"noCode")},getScheduleList:function(e){var i=e.resourceHost+"/"+e.databagId+"/metadata/schedule.json";return t(i,"noCode")},getScheduleById:function(e,i){var n=i.resourceHost+"/"+i.databagId+"/metadata/schedule/"+e+".txt";return t(n,"noCode")},getSegmentGroups:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups?view_token="+e.viewToken;return t(i,"noCode")},getSegmentFromGroups:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentGroups/"+i+"/segments?view_token="+e.viewToken;return t(n,"noCode")},getSegmentTree:function(e){var i=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segmentTree?view_token="+e.viewToken;return t(i,"noCode")},getSegmentById:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"?view_token="+e.viewToken;return t(n,"noCode")},getSegmentElementIds:function(e,i){var n=e.APIHost+"/data/v2/integrations/"+e.modelId+"/segments/"+i+"/elementIds?view_token="+e.viewToken;return t(n,"noCode")},getPartialElementsMetadata:function(e,i){var n=e.resourceHost+"/"+i+"/metadata/partial_elements_metadata.json";return t(n,"noCode")},getPartialElementsMetadataFile:function(e,t){return e.resourceHost+"/"+t+"/metadata/partial_elements_metadata.json"},getDatabagResource:function(e,t){return e.resourceHost+"/"+t+"/resource/v3/model"},getModelGroup:function(e,i){var n=e.resourceHost+"/"+e.databagId+"/metadata/modelSetsTree.json";return t(n,"noCode")},getManifest:function(e){var i=e.resourceHost+"/"+e.databagId+"/manifest.json";return t(i,"noCode")},getNestedComponents:function(e){var i=e.relativeUrl+"/metadata/nestedComponents.json";return t(i,"noCode")},getWalkthrough:function(e){var i=e.relativeUrl+"/data_ext/walkthrough.json";return t(i,"noCode")}};e.OnlineDataProdiver=n}(),function(){function e(e){this._config=e}var t,i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data.OnlineDataProdiver");e.prototype=(t={getComponentProperty:function(e,t,i){if(!e)return console.warn("elementId must not be empty!."),void(i&&i());n.getObjectData(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getComponentOverriddenProperty:function(e,t,i){if(!e)return console.warn("elementId must not be empty!."),void(i&&i());n.getEditedObjectData(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getMaterialProperty:function(e,t,i){n.getMaterialProperty(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getTreeOldData:function(e,t){var i=this;n.getTreeOldData(i._config).then(function(t){e&&e(t,i._config.modelType,"old")}).catch(function(e){t&&t(e)})},getTreeNewData:function(e,t){var i=this;n.getTreeNewData(i._config).then(function(t){e&&e(t,i._config.modelType)}).catch(function(e){t&&t(e)})},getMepSystem:function(e,t,i){var o=this;n.getMepSystem(e,o._config).then(function(e){t&&t(e,o._config.modelType)}).catch(function(e){i&&i(e)})},getAreas:function(e,t){n.getAreas(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getRoomProperty:function(e,t,i){n.getRoomProperty(e,this._config).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getDrawingList:function(e,t,i,o){var a=this._config.modelType;if("integrateModel"==a){var r=t.split(".")[0],s=t.split(".")[1];n.getDrawingList(this._config).fromIntegrateModel(e,r,s).then(function(e){i&&i(e)}).catch(function(e){o&&o(e)})}else"singleModel"==a&&n.getDrawingList(this._config).fromSingleModel(e,t).then(function(e){i&&i(e)}).catch(function(e){o&&o(e)})},getModelGroup:function(e,t){n.getModelGroup(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getAreaProperty:function(e,t,i){n.getAreaProperty(e,this._config).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getFiles:function(e,t){n.getFiles(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getMaterialOverride:function(e,t,i,o){n.getMaterialOverride(e,t,this._config).then(function(e){i&&i(e)}).catch(function(e){o&&o(e)})},getLinkGraph:function(e,t){n.getLinkGraph(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getDrawingsheets:function(e,t,i,o){var a=this;e=e||a._config.modelId,n.getDrawingsheets(this._config,e).then(function(e){i&&i(e,a._config.modelType)}).catch(function(e){o&&o(e)})},getAllDrawingsheets:function(e,t,i,o){var a=this;e=e||a._config.modelId,n.getAllDrawingsheets(this._config,e).then(function(e){i&&i(e,a._config.modelType)}).catch(function(e){o&&o(e)})},getLinksJson:function(e,t,i,o){var a=this;e=e||a._config.modelId,n.getLinksJson(this._config,e).then(function(e){i&&i(e,a._config.modelType)}).catch(function(e){o&&o(e)})},getFloors:function(e,t){n.getFloors(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getElementByConditions:function(e,t,i,o){n.getElementByConditions(this._config,e,t).then(function(e){i&&i(e)}).catch(function(e){o&&o(e)})},getMapInfo:function(e){var t=n.getMapInfo(this._config);e&&e(t)},getLevels:function(e,t,i){n.getLevels(e,this._config).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getViews:function(e){var t=n.getViews(this._config);e&&e(t)},getViewsById:function(e,t){var i=this._config;i.fileId=e;var o=n.getViewsById(i);t&&t(o)},getViewData:function(e,t,i){var o=Object.assign({},this._config);o.viewId=e,n.getViewData(o).then(function(e){"[object Function]"===Object.prototype.toString.call(t)&&t(e)}).catch(function(e){"[object Function]"===Object.prototype.toString.call(i)&&i(e)})},getRooms:function(e){var t=n.getRooms(this._config);e&&e(t)},getRoomBoundary:function(e,t){var i=n.getRoomBoundary(e,this._config);t&&t(i)},getCategoryVisibility:function(e,t){n.getCategoryVisibility(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getScheduleList:function(e,t){n.getScheduleList(this._config).then(function(t){e&&e(t.scheduleList)}).catch(function(e){t&&t(e)})},getScheduleById:function(e,t,i){n.getScheduleById(e,this._config).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getSegmentGroups:function(e,t){n.getSegmentGroups(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentFromGroups:function(e,t,i){n.getSegmentFromGroups(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getSegmentTree:function(e,t){n.getSegmentTree(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})},getSegmentById:function(e,t,i){n.getSegmentById(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getSegmentElementIds:function(e,t,i){n.getSegmentElementIds(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getPartialElementsMetadata:function(e,t,i){n.getPartialElementsMetadata(this._config,e).then(function(e){t&&t(e)}).catch(function(e){i&&i(e)})},getPartialElementsMetadataFile:function(e){return n.getPartialElementsMetadataFile(this._config,e)},getDatabagResource:function(e){return n.getDatabagResource(this._config,e)}},_defineProperty(t,"getDatabagResource",function(e){return n.getDatabagResource(this._config,e)}),_defineProperty(t,"getManifest",function(e,t){n.getManifest(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getNestedComponents",function(e,t){n.getNestedComponents(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),_defineProperty(t,"getWalkthrough",function(e,t){n.getWalkthrough(this._config).then(function(t){e&&e(t)}).catch(function(e){t&&t(e)})}),t),i.OnlineDataManager=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=(Glodon.Web.Lang.Utility.HttpRequest,function(t){if(this._config=t,this._objectData=null,this._cache={},"Local"==t.dataEnvType?this.dataManager=new e.OfflineDataManager(t):this.dataManager=new e.OnlineDataManager(t),!t.viewToken)return!1});t.prototype={getComponentProperty:function(e,t,i){this.dataManager.getComponentProperty(e,t,i)},getComponentOverriddenProperty:function(e,t,i){this.dataManager.getComponentOverriddenProperty(e,t,i)},getDrawingList:function(e,t,i,n){this.dataManager.getDrawingList(e,t,i,n)},getTreeOldData:function(e,t){this.dataManager.getTreeOldData(e,t)},getTreeNewData:function(e,t){this.dataManager.getTreeNewData(e,t)},getMepSystem:function(e,t,i){this.dataManager.getMepSystem(e,t,i)},getModeTree:function(e,t){console.warn("This function is deprecated. Please use getTreeOldData instead."),this.getTreeOldData(e,t)},getFloors:function(e,t){this.dataManager.getFloors(e,t)},getAreas:function(e,t){this.dataManager.getAreas(e,t)},getAreaProperty:function(e,t,i){this.dataManager.getAreaProperty(e,t,i)},getModelGroup:function(e,t){this.dataManager.getModelGroup(e,t)},getMaterialProperty:function(e,t,i){this.dataManager.getMaterialProperty(e,t,i)},getRoomProperty:function(e,t,i){this.dataManager.getRoomProperty(e,t,i)},getFiles:function(e,t){this.dataManager.getFiles(e,t)},getMaterialOverride:function(e,t,i,n){this.dataManager.getMaterialOverride(e,t,i,n)},getLinkGraph:function(e,t){this.dataManager.getLinkGraph(e,t)},getDrawingsheets:function(e,t,i,n){this.dataManager.getDrawingsheets(e,t,i,n)},getElementByConditions:function(e,t,i,n){this.dataManager.getElementByConditions(e,t,i,n)},getAllDrawingsheets:function(e,t,i,n){this.dataManager.getAllDrawingsheets(e,t,i,n)},getLinksJson:function(e,t,i,n){this.dataManager.getLinksJson(e,t,i,n)},getMapInfo:function(e){this.dataManager.getMapInfo(e)},getCategoryVisibility:function(e,t){this.dataManager.getCategoryVisibility(e,t)},getScheduleList:function(e,t){this.dataManager.getScheduleList(e,t)},getScheduleById:function(e,t,i){this.dataManager.getScheduleById(e,t,i)},getSegmentGroups:function(e,t){this.dataManager.getSegmentGroups(e,t)},getSegmentFromGroups:function(e,t,i){this.dataManager.getSegmentFromGroups(e,t,i)},getSegmentTree:function(e,t){this.dataManager.getSegmentTree(e,t)},getSegmentById:function(e,t,i){this.dataManager.getSegmentById(e,t,i)},getSegmentElementIds:function(e,t,i){this.dataManager.getSegmentElementIds(e,t,i)},getPartialElementsMetadata:function(e,t,i){this.dataManager.getPartialElementsMetadata(e,t,i)},getPartialElementsMetadataFile:function(e){return this.dataManager.getPartialElementsMetadataFile(e)},getDatabagResource:function(e){return this.dataManager.getDatabagResource(e)},getManifest:function(e,t){return this.dataManager.getManifest(e,t)},getNestedComponents:function(e){return this.dataManager.getNestedComponents(e)},getWalkthrough:function(e){return this.dataManager.getWalkthrough(e)},getViews:function(e){return this.dataManager.getViews(e)},getViewData:function(e,t,i){return this.dataManager.getViewData(e,t,i)}},e.MetaDataManager=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{resourceHost:hostConfig.resourceHost,databagId:null}};e.FamilyDataManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest,i=function(e){if(!e.databagId)return!1;this.__config=e};i.prototype.getFamilyTypes=function(e,i){var n=this.__config,o=void 0;o="Local"==n.dataEnvType?"./"+n.databagId+"/metadata/floorTree.json":n.resourceHost+"/"+n.databagId+"/metadata/familyInfo.json",t.ajax({url:o,success:function(t){for(var t=JSON.parse(t),i=t.Types||t.types,n=0,o=i.length;n<o;n++)i[n].id=i[n].Id||i[n].id,i[n].name=i[n].Name||i[n].name,delete i[n].Id,delete i[n].Name;e&&e(i)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);i&&i(t)})})},e.FamilyDataManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{resourceHost:hostConfig.staticHost}};e.IBLManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest,i=function(e){this.__config=e};i.prototype.getIBLConfig=function(e,i){var n=this.__config,o=void 0;if("Local"==n.dataEnvType)return!1;o=n.resourceHost+"/resources/IBL/IBLConfig.json",t.ajax({url:o,success:function(t){var i=JSON.parse(t);e&&e(i)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);i&&i(t)})})},e.IBLManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=(Glodon.Web.Lang.Utility.HttpRequest,t||{});t.version=1,t.EnumObjectTableIndex={OTI_OBJECTS_VALUES:0,OTI_PROPERTY_SCHEMAS:1,OTI_ELEMENT_PROPERTIES:2,OTI_FAMILY_PROPERTIES:3,OTI_FAMILIES:4,OTI_ELEMENTS:5,OTI_BOUNDING_BOX:6,OTI_ELEMENTS_CLASS:7};var i=function(e){this.url=e,this.objectsDB=[]};i.prototype={load:function(e){for(var t=this,i=["Values.json","Schemas.json","ElementProperties.json","FamilyTypeProperties.json","Families.json","Elements.json","BoundingBox.json","ElementsClass.json"],n=i.length,o=0,a=i.length;o<a;++o)!function(o){(new THREE.FileLoader).load(t.url+"/"+i[o]+CLOUD.GlobalData.ZipResourcePostfix,function(i){t.objectsDB[o]=JSON.parse(i),0==(n-=1)&&e()})}(o)},getFamilyTypeProperties:function(e){var i=this.objectsDB[t.EnumObjectTableIndex.OTI_FAMILIES],n=i[e];if(void 0===n)return null;for(var o=this.objectsDB[t.EnumObjectTableIndex.OTI_OBJECTS_VALUES],a=this.objectsDB[t.EnumObjectTableIndex.OTI_FAMILY_PROPERTIES],r=this.objectsDB[t.EnumObjectTableIndex.OTI_PROPERTY_SCHEMAS],s=0,l=0,u=0,c={},d=[],h=0,f=0,g=n[2],v=n[1];f<g;++f){s=2*(v+f),l=4*a[s],u=a[s+1],h=r[l];var m=c[h];void 0===m&&(m=[],c[h]=m,d.push(h)),m.push({key:o[r[l+1]],unit:o[r[l+3]],valueType:r[l+2],value:o[u]})}for(var p=[],f=0,y=d.length;f<y;++f)h=d[f],p.push({group:o[h],items:c[h]});return p},getElementProperties:function(e){if(null==e)return null;var i=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENTS],n=i[e];if(void 0===n)return null;for(var o=this.objectsDB[t.EnumObjectTableIndex.OTI_OBJECTS_VALUES],a=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENT_PROPERTIES],r=this.objectsDB[t.EnumObjectTableIndex.OTI_PROPERTY_SCHEMAS],s=0,l=0,u=0,c={},d=[],h=0,f=0,g=n[2],v=n[1];f<g;++f){s=2*(v+f),l=4*a[s],u=a[s+1],h=r[l];var m=c[h];void 0===m&&(m=[],c[h]=m,d.push(h)),m.push({key:o[r[l+1]],unit:o[r[l+3]],valueType:r[l+2],value:o[u]})}for(var p=[],f=0,y=d.length;f<y;++f)h=d[f],p.push({group:o[h],items:c[h]});var w=this.getFamilyTypeProperties(n[3]);if(!w)return p;var b={},C=[];p=w.concat(p);var x=!0,E=!1,P=void 0;try{for(var k,M=p[Symbol.iterator]();!(x=(k=M.next()).done);x=!0){var I=k.value;if(b[I.group]){var S=[].concat.apply(b[I.group].items,I.items),B=[],_=!0,D=!1,L=void 0;try{for(var A,T=S[Symbol.iterator]();!(_=(A=T.next()).done);_=!0){var G=A.value,N=!0,O=!0,V=!1,U=void 0;try{for(var W,R=B[Symbol.iterator]();!(O=(W=R.next()).done);O=!0){var H=W.value;G.key==H.key&&(N=!1)}}catch(e){V=!0,U=e}finally{try{!O&&R.return&&R.return()}finally{if(V)throw U}}N&&B.push(G)}}catch(e){D=!0,L=e}finally{try{!_&&T.return&&T.return()}finally{if(D)throw L}}b[I.group]={group:b[I.group].group,items:B}}else b[I.group]=I}}catch(e){E=!0,P=e}finally{try{!x&&M.return&&M.return()}finally{if(E)throw P}}for(var I in b)"åŸºæœ¬å±žæ€§"==b[I].group?C.unshift(b[I]):C.push(b[I]);return C},getElementByConditions:function(e,i,n){var o=this.objectsDB[t.EnumObjectTableIndex.OTI_ELEMENTS_CLASS],a=Object.keys(i),r=[],s=[],l={},u={min:{x:null,y:null,z:null},max:{x:null,y:null,z:null}},c=[],d=!0,h=!1,f=void 0;try{for(var g,v=a[Symbol.iterator]();!(d=(g=v.next()).done);d=!0){var m=g.value;c.push({typeIndex:this._getGroupsKey(m,i[m],o),typeValue:i[m]})}}catch(e){h=!0,f=e}finally{try{!d&&v.return&&v.return()}finally{if(h)throw f}}for(var p=0;p<o.groups.length;p+=3){var y=!0,w=!0,b=!1,C=void 0;try{for(var x,E=c[Symbol.iterator]();!(w=(x=E.next()).done);w=!0){var P=x.value,k=o.groups[p][P.typeIndex];if(o.values[k]!=P.typeValue){y=!1;break}}}catch(e){b=!0,C=e}finally{try{!w&&E.return&&E.return()}finally{if(b)throw C}}if(y)if("singleModel"==n.modelType)r=r.concat(o.groups[p+1][""]);else{var M=o.groups[p+1],I=o.groups[p+2];for(var S in M){var B=!0,_=!1,D=void 0;try{for(var L,A=M[S][Symbol.iterator]();!(B=(L=A.next()).done);B=!0){var T=L.value;s.push({fileId:S,elementId:T})}}catch(e){_=!0,D=e}finally{try{!B&&A.return&&A.return()}finally{if(_)throw D}}}(u.min.x>I[0]||null==u.min.x)&&(u.min.x=I[0]),(u.min.y>I[1]||null==u.min.y)&&(u.min.y=I[1]),(u.min.z>I[2]||null==u.min.z)&&(u.min.z=I[2]),(u.max.x<I[3]||null==u.max.x)&&(u.max.x=I[3]),(u.max.y<I[4]||null==u.max.y)&&(u.max.y=I[4]),(u.max.z<I[5]||null==u.max.z)&&(u.max.z=I[5])}}return"singleModel"==n.modelType?r:0==s.length?[]:(l.elements=s,l.boundingBox=u,l)},_getGroupsKey:function(e,t,i){for(var n=0,o=0;o<i.keys.length;o++)if(i.keys[o]==e){n=o;break}return n},getBoundingBox:function(e){if(null==e)return null;var i=this.objectsDB[t.EnumObjectTableIndex.OTI_BOUNDING_BOX],n="";try{n={min:{x:i[e][0],y:i[e][1],z:i[e][2]},max:{x:i[e][3],y:i[e][4],z:i[e][5]}}}catch(e){console.log("no boundingBox Data"),n=""}return n}},e.ObjectPropertyManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=function(){return{APIHost:hostConfig.APIHost,resourceHost:hostConfig.resourceHost,viewToken:null,modelId:null,modelType:"singleModel",dataEnvType:hostConfig.dataEnvType||"BIMFACE"}};e.FileManagerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Data"),t=Glodon.Web.Lang.Utility.HttpRequest,i=function(e){this.__config=e};i.prototype.getViewToken=function(e,i,n){var o=this.__config,a=void 0;return"singleModel"!=o.modelType&&("Local"==o.dataEnvType?void(i&&i()):(a=o.APIHost+"/data/v2/integrations/"+o.modelId+"/files/"+e+"/viewToken?view_token="+o.viewToken,void t.ajax({url:a,type:"post",success:function(e){var t=JSON.parse(e);i&&i(t.data)},failure:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=JSON.parse(e);n&&n(t)})})))},e.FileManager=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=Glodon.Web.Lang.Utility.ClientHelper.isWebGLAvailable(),n=(Object.freeze({TranslucentOthers:"",HideOthers:""}),function(){var e=new Glodon.Web.Lang.EventManager;this.viewerType="Viewer",this.getEventManager=function(){return e}});n.prototype.destroy=function(){this.getEventManager=null},n.prototype.init=function(){},n.prototype.getViewerType=function(e){return this.viewerType},n.prototype.addView=function(e,t,n){if(i){var o=this,a=Glodon.Bimface.Authentication.AuthenticationManager,r=(o._opt,new Glodon.Bimface.Authentication.AuthenticationConfig);r.viewToken=e,r.APIHost=this._opt.APIHost;(this.authenticate=new a(r)).authenticate(function(e){"bimView"==e.renderType&&("pdf-transfer"!==e.workerType?e.renderType="3DView":e.renderType="pdfView"),o.loadViewCore(e,t,n)},function(e){var t=Glodon.Bimface.Viewer.Viewer3DEvent;o.getEventManager().fireEvent(t.Error,e)})}},n.prototype.loadViewCore=function(){},n.prototype.addEventListener=function(e,t){this.getEventManager().addEvent(e,t)},n.prototype.removeEventListener=function(e,t){this.getEventManager().removeEvent(e,t)},n.prototype.enableFullScreen=function(e){var t=this._opt.domElement,i=this;e?Glodon.Web.Lang.Utility.FullScreen.fullScreen(t):Glodon.Web.Lang.Utility.FullScreen.exitFullScreen(),setTimeout(function(){i.resize()},200)},n.prototype._loadNotSuportPromptPage=function(e){var i=t.create("div","bf-waring-container"),n=t.create("div","bf-waring"),o=t.create("span","bf-waring-icon"),a=t.create("span","bf-waring-text");a.innerText=BimfaceLanguage.bf_browser_notSupported,n.appendChild(o),n.appendChild(a),i.appendChild(n);var r=t.create("div","bf-suggestion");r.innerText=BimfaceLanguage.bf_browser_suggestion,i.appendChild(r);var s=t.create("div","bf-logo");i.appendChild(s),e.appendChild(i)},e.Viewer=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=function(){return{domElement:null,resourceHost:hostConfig.resourceHost,staticHost:hostConfig.staticHost+"/api/Glodon",APIHost:hostConfig.APIHost,sdkUrl:null,staticPath:"/api/Glodon",enableLineWidth:!1,displayMode:0,enableHover:!0,enableViewport:!1}};e.ViewerDrawingConfig=t}(),function(){var e=Object.freeze({ViewAdded:"ViewAdded",ViewLoading:"ViewLoading",ComponentsSelectionChanged:"ComponentsSelectionChanged",ComponentsHoverChanged:"ComponentsHoverChanged",Error:"Error",Loaded:"Loaded",MouseClicked:"MouseClicked",MouseDragged:"MouseDragged",ContextMenu:"ContextMenu",Rendered:"Rendered",ViewChanged:"ViewChanged",ViewMoving:"ViewMoving",ViewMoved:"ViewMoved",ViewZooming:"ViewZooming",ViewZoomed:"ViewZoomed",Hover:"Hover",ZoomFactorChanged:"ZoomFactorChanged",ButtonOnToolbarClicked:"ButtonOnToolbarClicked"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer").ViewerDrawingEvent=e}(),function(){var e=Object.freeze({Pan:"pan",RectZoom:"rectZoom",Zoom:"zoom",AreaMeasure:"area-measure",Pick:"pick",Measure:"measure"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer").NavigationModeDrawing=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=Object.freeze({Endpoint:"endpoint",Midpoint:"midpoint",Intersection:"intersection",Line:"line",Face:"face"});e.SnapObject=t}(),function(){var e=(Glodon.Bimface.Data.StatisticsDataManager.getInstance(),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer")),t=function(){function e(){_classCallCheck(this,e),this.snapList={},this.snapConditions=[]}return _createClass(e,[{key:"setSnap2DList",value:function(e){this.snapList=e}},{key:"getSnap2DList",value:function(){return this.snapList}},{key:"setSnap3DList",value:function(e){this.snapList=e}},{key:"getSnap3DList",value:function(){return this.snapList}},{key:"setSnapConditions",value:function(e){this.snapConditions=e}},{key:"getSnapConditions",value:function(){return this.snapConditions}}]),e}();e.SnapMode=t}(),function(){var e="Glodon.Bimface.Viewer.ViewerDrawing",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"GlobalData"),o=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),a=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Graphics"),r=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),s=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),Glodon.Bimface.Viewer.ViewerDrawingEvent);n.isInitialized=n.isInitialized||!1;var l=Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop(),u=Glodon.Web.Lang.Utility.ClientHelper.isWebGLAvailable(),c=function(n){if(i.Viewer.call(this),u){var o=this;this.viewerType="ViewerDrawing";var a=n;this._opt=n,this.isInitialized=!1,this.hasBindEvents=!1,this.grids=null,this.cursorReady=!1,this.snapIsEnabled=!1,this._cache={};var c=r.create("div","bf-drawing-container ");if(l)var d=r.create("div","bf-drawing-wrap");else{var d=r.create("div","bf-drawing-wrap bf-mobile"),h=n.domElement.offsetWidth,f=n.domElement.offsetHeight;d.style.fontSize=90*Math.min(h,f,414)/750+"px"}var g,v=n.domElement;v.addClass("viewerDrawingWrap"),v.id?g=v.id:(g=Glodon.Web.Lang.Utility.UUID.createUUID(),v.id=g),c.id="Drawing"+g,c.setCss({width:"100%",height:"100%",position:"relative",zIndex:1,background:0==this._opt.displayMode?"rgb(50, 50, 55)":""}),d.setCss({width:"100%",height:"100%",position:"relative",overflow:"hidden"}),d.appendChild(c),v.appendChild(d),a.domElement=c,this._domElement=v,this._viewConfig=a,this.rootElement=c,this.getDomElement=function(){return d},this.getRootElement=function(){return c},this.getViewer=function(){return this._drawingViewer},l?(c.addEventListener("mousedown",function(e){if(e.preventDefault(),e.stopPropagation(),this.oldMouseX=e.clientX,this.oldMouseY=e.clientY,2===e.button&&"2"==o.version){var t={},i=o.getDomElement().getBoundingClientRect(),n={x:e.clientX-i.left,y:e.clientY-i.top},a={width:i.width,height:i.height};t.clientPosition=n,t.containerBox=a,o.getEventManager().fireEvent(s.ContextMenu,t)}}),c.addEventListener("mouseup",function(e){e.preventDefault();var t=Math.abs(this.oldMouseX-e.clientX)<=1&&Math.abs(this.oldMouseY-e.clientY)<=1;if(0===e.button){var i,n,a,r=this.getBoundingClientRect(),l={};if(i=e.clientX-r.left,n=e.clientY-r.top,a={x:i,y:n},t){if(!e.target.hasClass("bf-drawable-context")&&"canvas"!=e.target.tagName.toLocaleLowerCase())return;var u,c;if(c=o._drawingViewer.toWorldPoint([i,n]),o._drawingViewer.preSelect(i,n),u=o._drawingViewer.getHighlightIds(),l={worldPosition:{x:c[0],y:c[1]},clientPosition:a,objectId:u[0]||null,clientX:e.clientX,clientY:e.clientY,event:e},l.objectId){var d=o.getLayerIdFromElementId(l.objectId),h=o.getLayerById(d);l.layerId=d||null,l.layerName=h&&h.name||null}else l.layer=null;if(o.grids&&(l.grid=o.getNearestGrid({x:i,y:n})),o.snapIsEnabled){var f=o._drawingViewer.snapToPoint(i,n);if(0!=f.GetID()){var g=f.GetSnapType(),v={x:f.GetPoint()[0],y:f.GetPoint()[1]},m=o._drawingViewer.toScreenPoint([v.x,v.y]),a={x:m[0],y:m[1]};l.snapPoint={type:g,clientPosition:a,worldPosition:v}}}o.getEventManager().fireEvent(s.MouseClicked,l)}else l={clientPosition:a},o.getEventManager().fireEvent(s.MouseDragged,l)}})):(c.addEventListener("touchstart",function(e){if(e.target.hasClass("bf-drawable-context")||"canvas"==e.target.tagName.toLocaleLowerCase()){var t=e.targetTouches[0];this.oldTouchX=t.clientX,this.oldTouchY=t.clientY}}),c.addEventListener("touchend",function(e){var t,i,n,a=e.changedTouches[0],r=this.oldTouchX==a.clientX&&this.oldTouchY==a.clientY,l=this.getBoundingClientRect(),u={};if(t=a.clientX-l.left,i=a.clientY-l.top,n={x:t,y:i},r){if(!e.target.hasClass("bf-drawable-context")&&"canvas"!=e.target.tagName.toLocaleLowerCase())return;var c,d;if(d=o._drawingViewer.toWorldPoint([t,i]),o._drawingViewer.preSelect(t,i),c=o._drawingViewer.getHighlightIds(),u={worldPosition:{x:d[0],y:d[1]},clientPosition:n,objectId:c[0]||null,clientX:a.clientX,clientY:a.clientY,event:e},u.objectId){var h=o.getLayerIdFromElementId(u.objectId),f=o.getLayerById(h);u.layerId=h||null,u.layerName=f&&f.name||null}else u.layer=null;o.grids&&(u.grid=o.getNearestGrid({x:t,y:i})),o.getEventManager().fireEvent(s.MouseClicked,u)}else u={clientPosition:n},o.getEventManager().fireEvent(s.MouseDragged,u)})),Glodon.Bimface.WebglDrawingSheet.onLoadProgress=function(e){var t=document.querySelector(".bf-drawing-container  .bf-loading-text");t&&e&&(t.innerText=parseInt(100*e)+"%")},o.addEventListener(s.Loaded,function(){var i={eventId:"åŠ è½½",loadModel:"expert",type:"drawing"};t.send(e,"Loaded",i)})}else this._loadNotSuportPromptPage(n.domElement)};o.Type.inheritPrototype(c,i.Viewer),c.prototype=Object.assign({},i.Viewer.prototype,{addModel:function(e,t,i,o){if(!u||this._data&&this._data.renderVersion!=e.renderVersion)return console.log("this model can not be added."),!1;var a=Glodon.Bimface.Data.StatisticsDataManager.getInstance();a.modelType=e.modelType,a.modelId=e.modelId;var r=this.getDomElement();r.removeClass("drawingFrame");var s,l=this,c=(l.getViewer(),l._opt,e.dataPath,e.integrateDrawings&&e.integrateDrawings.databagId||e.databagId),d=Glodon.Web.Lang.Utility.ClientHelper.formatURL((e.path||this._viewConfig.resourceHost)+"/"+c+"/resource/drawing");e.drawingUrl=d,l._data=e;var s="number"==typeof o?d+"/Frames":d,h="number"==typeof o;if(h){var r=this.getDomElement();r.addClass("drawingFrame")}l.isInitialized||n.isInitialized?l.loadIndexJson(e,t,i,function(){"1"==l.version||"1"==l.prevVersion?l.destroy(!0):l.destroy(),"1"==l.version&&(l._drawingViewer=l.createDrawingViewer(l.rootElement.id)),
l._drawingViewer&&l._drawingViewer.clearAll(),"2"==l.version?l.loadWebGL(s,t,i,o):l.loadModel(s,t,i),l._viewMetaData=e}):l.loadIndexJson(e,t,i,function(){"1"==l.version||"1"==l.prevVersion?l.destroy(!0):l.destroy();var a=e.sdkPath?e.sdkPath+"/bimface":e.sdkPath;if("bimView"==e.renderType&&e.subRenders&&0!=e.subRenders.length)for(var r=0;r<e.subRenders.length;r++)"drawingView"==e.subRenders[r].renderType&&(Glodon.Bimface.DrawingSheet.sdkUrl=l._viewConfig.sdkUrl||BimfaceSDKLoader.sdkUrlForWebApp||a||l._viewConfig.staticHost+"/"+e.subRenders[r].jsSDKVersion);else Glodon.Bimface.DrawingSheet.sdkUrl=l._viewConfig.sdkUrl||BimfaceSDKLoader.sdkUrlForWebApp||a||l._viewConfig.staticHost+"/"+e.jsSDKVersion;"2"==l.version?l.loadWebGL(s,t,i,o,h):Glodon.Bimface.DrawingSheet.initialize(function(){l._drawingViewer=l.createDrawingViewer(l.rootElement.id),l.loadModel(s,t,i),n.isInitialized=!0})}),this.showLoading()},showLoading:function(){this.rootElement.style.zIndex=5;var e=r.create("div","bf-loading"),t=r.create("div","bf-loading-gif"),i=r.create("div","bf-loading-text");e.appendChild(t),e.appendChild(i),this.loading=e,this.rootElement.appendChild(e)},enableHover:function(i){t.send(e,"enableHover"),this._opt.enableHover=i,this._drawingViewer.enableHover(i)},enableSnap:function(i){t.send(e,"enableSnap"),this.snapIsEnabled=i,this._drawingViewer.mouseEditorMgr.enableSnap(i)},setSnapMode:function(i){t.send(e,"setSnapMode"),this.getViewer().setSnapMode(i)},destroy:function(e){if(this._drawingViewer&&this._drawingViewer.mouseEditorMgr&&this._drawingViewer.mouseEditorMgr.unbindAllEvent(),e){this._drawingViewer=null;for(var t=document.querySelectorAll("#"+this.rootElement.id+" canvas"),i=0;i<t.length;i++)t[i].remove()}this.hasBindEvents=!1},enableMiniMap:function(i,n){t.send(e,"enableMiniMap");var o=this._drawingViewer;if(!0===i){if(1==o.hasMinimap())return void o.enableMinimap(!0);var a=this.rootElement.id,r={width:300,height:240},s=this._viewConfig.resourceHost,l=this.authenticate.data.databagId,u=s+"/"+l+"/thumbnail/512.png",c=s+"/"+l+"/resource/preview/Model_4028.json";Glodon.Web.Lang.Utility.HttpRequest.ajax({url:c,success:function(e){function t(e){var t=e.indexOf("{"),i=e.indexOf("}"),n=e.slice(t+1,i).split(",");return{x:parseFloat(n[0]),y:parseFloat(n[1])}}var i=JSON.parse(e).boundingbox,s=t(i.minPoint),l=t(i.maxPoint);o.createMinimap(a,u,r.width,r.height),n&&n(),o.setMinimapBoundingBox({min:s,max:l})}})}else o.enableMinimap(!1)},getDrawingFrame:function(e){function t(t){var n=(Glodon.Web.Lang.Utility.HttpRequest,t.integrateDrawings&&t.integrateDrawings.databagId||t.databagId),o=Glodon.Web.Lang.Utility.ClientHelper.formatURL((t.path||i._viewConfig.resourceHost)+"/"+n+"/resource/drawing/Frames");i.getIndexJson(o,e)}var i=this,n=i._viewMetaData||i._data,o=window.BimfaceLoaderConfig.dataEnvType,a=window.BimfaceLoaderConfig.viewToken;if(n)t(n);else if("Local"==o){var r=window.BimfaceLoaderConfig.path;i._ajaxGet(r,function(e){var o=r.split("/");o.pop(),e.path=o.join("/")+"/",i._data=n,t(e)})}else i.getViewMetaData(a,function(e){t(e)})},loadFrame:function(e,t){var i=this;this.destroy(),this.showLoading(),this.getDomElement().addClass("drawingFrame"),this.getViewMetaData(e,function(e){var n=e.drawingUrl;i.getIndexJson(n,function(n){"2"==n.metadata.version||"2"==n.metadata["version:"]?i.version="2":i.version="1";var o=e.drawingUrl+"/Frames";i._drawingViewer&&i._drawingViewer.clearAll(),i.loadWebGL(o,null,null,t,!0),i._viewMetaData=e})})},load:function(e,t,i){if(!u)return!1;var o=this,a=arguments;if(this.getDomElement().removeClass("drawingFrame"),n.loading)return setTimeout(function(){o.load.apply(o,a)},500);n.loading=!0,o.isInitialized||n.isInitialized?e&&this.getViewMetaData(e,function(e){o.loadIndexJson(e,t,i,function(){"1"==o.version||"1"==o.prevVersion?o.destroy(!0):o.destroy(),"1"==o.version&&(o._drawingViewer=o.createDrawingViewer(o.rootElement.id)),o._drawingViewer&&o._drawingViewer.clearAll(),"2"==o.version?o.loadWebGL(e.drawingUrl,t,i):o.loadModel(e.drawingUrl,t,i),o._viewMetaData=e})}):e&&this.getViewMetaData(e,function(e){o._viewMetaData=e,o.loadIndexJson(e,t,i,function(){"1"==o.version||"1"==o.prevVersion?o.destroy(!0):o.destroy();var n=Glodon.Bimface.Data.StatisticsDataManager.getInstance();n.modelType=e.modelType,n.modelId=e.modelId,o.initialize(e,t,i)})}),this.showLoading()},loadIndexJson:function(e,t,i,n){var o=this,a=e.drawingUrl;t&&(a=a+(i?"/"+i:"")+"/"+t),this.url=a,this.getIndexJson(a,function(e){var t=document.querySelector(".bf-drawing-container  .bf-loading-text");o.version&&(o.prevVersion=o.version),"2"==e.metadata.version||"2"==e.metadata["version:"]?(o.version="2",t.innerText="0%"):(o.version="1",t.innerText=BimfaceLanguage.bf_load),n()})},getViews:function(){return this._drawingViewer.getLayouts()},getModelPosition:function(i,n,o){t.send(e,"getModelPosition");var a=this.authenticate.data.databagId,r=null,s=this._drawingViewer.getModelBBox().GetMinPt(),l=this._drawingViewer.getModelBBox().GetMaxPt(),u=new THREE.Vector2(s[0],s[1]),c=new THREE.Vector2(l[0],l[1]),d=new THREE.Box2(u,c),h=(n.x-d.min.x)/d.getSize().x,f=(n.y-d.min.y)/d.getSize().y,g=new THREE.Vector3(h,f);Glodon.Web.Graphics.Utility.Relation.getDrawingSheets(a,i,function(e){r=e,r.viewType=e.viewInfo.viewType;var t=r.viewInfo.preview.width,i=r.viewInfo.preview.height,n=new THREE.Vector2(t*g.x,i*(1-g.y)),a=Glodon.Web.Graphics.Utility.Relation.point2DToPoint3D(n,r);o&&o(a)})},getLayers:function(){return this._drawingViewer.getLayers()},getLayerIdFromElementId:function(e){if(this._drawingViewer.getLayerIdFromElementId)return this._drawingViewer.getLayerIdFromElementId(e)},changeLayers:function(i){t.send(e,"changeLayers"),this._drawingViewer.changeLayers(i),this.update()},getColor:function(e){return"rgba("+(255&e)+", "+(e>>8&255)+", "+(e>>16&255)+", 1)"},hideLayer:function(i){t.send(e,"hideLayer");for(var n=this.getLayers(),o=0,a=n.length;o<a;++o){var r=n[o];if(r.id==i){r.visible=!1;break}}this.changeLayers(n)},getLayerById:function(e){for(var t=this.getLayers(),i=0,n=t.length;i<n;++i){var o=t[i];if(o.id==e)return o}return!1},showLayer:function(i){t.send(e,"showLayer");for(var n=this.getLayers(),o=0,a=n.length;o<a;++o){var r=n[o];if(r.id==i){r.visible=!0;break}}this.changeLayers(n)},hideAllLayers:function(){t.send(e,"hideAllLayers");for(var i=this.getLayers(),n=0,o=i.length;n<o;++n){i[n].visible=!1}this.changeLayers(i)},showAllLayers:function(i){t.send(e,"showAllLayers");for(var n=this.getLayers(),o=0,a=n.length;o<a;++o){n[o].visible=!0}this.changeLayers(n)},showAllElements:function(){this._drawingViewer.showAllElements()},getElementBoxColor:function(){t.send(e,"getElementBoxColor");var i=this._drawingViewer.getElementBoxColor();return new Glodon.Web.Graphics.Color(i.red,i.green,i.blue,i.alpha)},setElementBoxColor:function(i){t.send(e,"setElementBoxColor"),this._drawingViewer.setElementBoxColor(i.red,i.green,i.blue,i.alpha)},getElementBoxStyle:function(){return t.send(e,"getElementBoxStyle"),this._drawingViewer.getElementBoxStyle()},setElementBoxStyle:function(i){return t.send(e,"setElementBoxStyle"),-1==["Rectangle","CloudRect"].indexOf(i)?void console.error("params error!"):this._drawingViewer.setElementBoxStyle(i)},showViewById:function(i){t.send(e,"showViewById"),this._drawingViewer.activeLayoutById(i||0),this.getEventManager().fireEvent(s.ViewChanged,i)},getCurrentViewId:function(){return this._drawingViewer.getActiveLayoutId()},rectZoom:function(){t.send(e,"rectZoom"),this._drawingViewer.mouseEditorMgr.activeEditorByName("zoom"),this._opt.enableZoomRect=!0},getZoomFactor:function(){return this._drawingViewer.getZoomFactor()},getCurrentState:function(){return this._drawingViewer.getState()},setState:function(i){t.send(e,"setState"),this._drawingViewer&&(this._drawingViewer.setState(i),this._drawingViewer.update())},createSnapshotAsync:function(i,n){t.send(e,"createSnapshotAsync"),i&&(i="rgba("+i.red+","+i.green+","+i.blue+","+i.alpha+")"),n&&n(this._drawingViewer.snapshot(i))},enableFullScreen:function(e){var t=this.getDomElement();e?Glodon.Web.Lang.Utility.FullScreen.fullScreen(t):Glodon.Web.Lang.Utility.FullScreen.exitFullScreen()},home:function(){var e="2"===this.version?.2:void 0;this.modelBBox?this._drawingViewer.zoomToWorldBox(this.modelBBox[0],this.modelBBox[1],e):this._drawingViewer.zoomToExtent(e),this._drawingViewer.update()},getViewMetaData:function(e,t,i){var n=this,o=Glodon.Bimface.Authentication.AuthenticationManager,a=new Glodon.Bimface.Authentication.AuthenticationConfig,r=void 0;a.viewToken=e,a.APIHost=this._viewConfig.APIHost,r=i?new o(a):this.authenticate=new o(a),r.authenticate(function(e){var i=e.integrateDrawings&&e.integrateDrawings.databagId||e.databagId;e.drawingUrl=n._viewConfig.resourceHost+"/"+i+"/resource/drawing",t(e)})},getIndexJson:function(e,t){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:e+"/index.json",success:function(e){var i=JSON.parse(e);i&&t(i)}})},initialize:function(e,t,i){if(this.isInitialized)return!1;var o=this;if("bimView"==e.renderType&&e.subRenders&&0!=e.subRenders.length)for(var a=0;a<e.subRenders.length;a++)"drawingView"==e.subRenders[a].renderType&&(Glodon.Bimface.DrawingSheet.sdkUrl=o._viewConfig.sdkUrl||BimfaceSDKLoader.sdkUrlForWebApp||o._viewConfig.staticHost+"/"+e.subRenders[a].jsSDKVersion);else Glodon.Bimface.DrawingSheet.sdkUrl=o._viewConfig.sdkUrl||BimfaceSDKLoader.sdkUrlForWebApp||o._viewConfig.staticHost+"/"+e.jsSDKVersion;"2"==o.version||"2.0"==e.renderVersion?this.loadWebGL(e.drawingUrl,t,i):Glodon.Bimface.DrawingSheet.initialize(function(){o._drawingViewer=o.createDrawingViewer(o.rootElement.id),o.loadModel(e.drawingUrl,t,i),n.isInitialized=!0})},loadWebGL:function(e,t,i,o,a){var r=this;this.grids=null,t&&(e=e+(i?"/"+i:"")+"/"+t);var u;r._drawingViewer?u=r._drawingViewer:r._drawingViewer=u=r.createDrawingViewer(r.rootElement.id),Glodon.Bimface.WebglDrawingSheet.loadModel(e,r.rootElement.id,u,function(e){for(var i=document.querySelectorAll(".bf-drawing-container .bf-loading"),o=i.length,c=0;c<o;c++)i[c].remove();r.rootElement.style.zIndex=1,n.loading=!1,r.enableViewport(r._opt.enableViewport);var d=u.getLayouts();if(a&&d.length>1)r._drawingViewer.activeLayoutById(d[1].id);else if(t){for(var h=null,c=0;c<d.length;c++)if("Layout1"==d[c].name){h=d[c].id;break}h&&r.showViewById(h),u.model={Url:e.url+"/"};var f;f=new Glodon.Bimface.RevitInterop,f.initialize(u),u.revitInterop=f}r._drawingViewer.mouseEditorMgr=l?Glodon.Bimface.WebglDrawingSheet.createMouseEditorManager(u):Glodon.Bimface.WebglDrawingSheet.createTouchEditorManager(u),r._drawingViewer.mouseEditorMgr.bindEvents(),r.observer(r._drawingViewer.mouseEditorMgr),r._drawingViewer.mouseEditorMgr.activeEditorByName("pick"),window.addEventListener("resize",function(){u&&u.onResize()}),r._drawingViewer.onViewChanges=function(){r.getEventManager().fireEvent(s.Rendered,r._drawingViewer)},r.setDisplayMode(r._opt.displayMode),!r._opt.enableViewport&&r.home(),r.getEventManager().fireEvent(s.Loaded,r._drawingViewer.mouseEditorMgr),r.cursorReady||(Glodon.Web.Lang.Utility.MouseMotion.setCursor(r),r.cursorReady=!0),r.enableHover(r._opt.enableHover)},o)},observer:function(e){var t=null,i=this;e.observer=function(e,n,o,a,r,l){if("zoom"==e&&"exit"==n&&(i.getEventManager().fireEvent(s.ViewZoomed),i._opt.enableZoomRect=!1),"zoomFactorChanged"==n&&i.getEventManager().fireEvent(s.ZoomFactorChanged,o),("measure"==e||"area-measure"==e)&&"change"==n){var u=i.getViewScale(),c=null;o&&o.distance?c={type:"Distance",distance:o.distance*u,start:[o.start[0]*u,o.start[1]*u],end:[o.end[0]*u,o.end[1]*u],isOnLayout:o.isOnLayout}:o&&o.area&&(c={type:"Area",points:o.points,area:o.area*u*u}),c?i.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Measured,c):i.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Measuring,c)}if("pick"==e&&"selection"==n&&i.getEventManager().fireEvent(s.ComponentsSelectionChanged,o),"pick"==e&&"highlight"==n)if(o.length>0){if(t==o[0])return;var d=i._drawingViewer.toWorldPoint([a,r]);i.getEventManager().fireEvent(s.Hover,{objectId:o[0],clientPosition:{x:a,y:r},worldPosition:{x:d[0],y:d[1]},event:l}),t=o[0]}else t=null}},createDrawingViewer:function(e,t){var i;"2"==this.version?i=Glodon.Bimface.WebglDrawingSheet:(i=Glodon.Bimface.DrawingSheet,this.isInitialized=!0);var n=i.createDrawing(e,t);return n.mouseEditorMgr=l?i.createMouseEditorManager(n):i.createTouchEditorManager(n),n},zoomToBoundingBox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;if("2"!==this.version)return void console.log("Drawing of old version doesn't support zoomToBoundingBox.");if(!e)return void console.log("Parameter boundingBox is required.");var i=this.getViewer(),n=e[0],o=e[1];i.zoomToWorldBox(n,o,t)},getAxisGridsIntersection:function(e,t){var i=this.url+"/AxisGrid.json",n=[];this.getAxisGrid(i,function(i){for(var o=0;o<e.length-1;o++)for(var a=e[o],r=o+1;r<e.length;r++){var s=e[r],l=a>s?s:a,u=a>s?a:s,c=i[l]&&i[l][u];c&&n.push({intersection:c,axisNames:[l,u]})}t&&t(n)})},getAxisGrid:function(e,t){var i=this._cache;if(i.AxisGrid)return t(i.AxisGrid);Glodon.Web.Lang.Utility.HttpRequest.ajax({url:e,success:function(e){var n=JSON.parse(e);if(n){for(var o={},a=n.intersection,r=0;r<a.length;r++){var s=a[r].axisGrids[0],l=a[r].axisGrids[1],u=s>l?l:s,c=s>l?s:l;o[u]||(o[u]={}),o[u][c]||(o[u][c]=[]),o[u][c].push(a[r].intersection)}i.AxisGrid=o,t(o)}}})},toRevitId:function(e){return console.log("This method is obsolete,  please use  toModelId() instead "),this.toModelId(e)},toLinkRevitId:function(i,n){return t.send(e,"toLinkRevitId"),this._drawingViewer.revitInterop.toLinkRevitId(i,n)},fromRevitId:function(e){return this._drawingViewer.revitInterop.fromRevitId(e)},fromLinkRevitId:function(i,n){return t.send(e,"fromLinkRevitId"),this._drawingViewer.revitInterop.fromLinkRevitId(i,n)},toModelId:function(i){return t.send(e,"toModelId"),this._drawingViewer.revitInterop.toRevitId(i)},toDrawingId:function(i){return t.send(e,"toDrawingId"),this._drawingViewer.revitInterop.fromRevitId(i)},zoomToObject:function(i,n){t.send(e,"zoomToObject"),n=n||.5,this.clearSelection(),this._drawingViewer.zoomToObject(i,n),this._drawingViewer.canSelectInBlock()?this.selectIdWithBlock(0,i):this.selectByIds(i)},zoomToObjectWithBlock:function(e,t,i){i=i||.5,this.clearSelection(),this._drawingViewer.zoomToObjectWithBlock(e,t[0],i);for(var n=0;n<t.length;n++)this.selectIdWithBlock(e,t[n]);this.update()},setZoomRatio:function(e){e=e||1.1,(e>=2||e<0)&&(e=1.9),this._drawingViewer.setZoomRatio(e)},getZoomRatio:function(){return this._drawingViewer.getZoomRatio()},selectByIds:function(i){t.send(e,"selectByIds"),Array.isArray(i)||(i=[i]),this._drawingViewer.selectByIds(i),this.update()},getSelectedIds:function(){return this._drawingViewer.getSelectedIds()},selectIdWithBlock:function(e,t){("string"==typeof e||e instanceof String)&&(e=parseInt(e)),("string"==typeof t||t instanceof String)&&(t=parseInt(t)),this._drawingViewer.selectIdWithBlock(e,t)},clearSelection:function(){this._drawingViewer.clearSelection(),this.update(!0)},showLineWidth:function(i){t.send(e,"showLineWidth"),this._opt.enableLineWidth=i,this._drawingViewer.viewer.ShowLineWidth=i,this.update(!0)},isEnableLineWidth:function(){return this._opt.enableLineWidth},loadModel:function(e,t,i){var o=this,a=this._drawingViewer,r=a.mouseEditorMgr;a.touchEditorMgr;this.grids=null,t&&(e=e+(i?"/"+i:"")+"/"+t,Glodon.Bimface.DrawingSheet.loadGrids(e,function(e){e&&(o.grids=e.grids,console.log(e))})),Glodon.Bimface.DrawingSheet.loadModel(e,function(e){if(null===e){console.log("failed to load model!"),n.loading=!1;for(var i=document.querySelectorAll(".bf-drawing-container  .bf-loading"),l=0;l<i.length;l++)i[l].remove();return void(o.rootElement.style.zIndex=1)}if(a.setModel(e),a.clearSelection(),t){for(var u=a.getLayouts(),c=null,l=0;l<u.length;l++)if("Layout1"==u[l].name){c=u[l].id;break}c&&o.showViewById(c);var d;d=new Glodon.Bimface.RevitInterop,d.initialize(a),a.revitInterop=d}o.hasBindEvents||(r.bindEvents(),o.hasBindEvents=!0),o.observer(r),r.activeEditorByName("pick"),n.loading=!1;for(var i=document.querySelectorAll(".bf-drawing-container .bf-loading"),h=i.length,l=0;l<h;l++)i[l].remove();o.rootElement.style.zIndex=1,window.addEventListener("resize",function(){a&&a.onResize()}),a.onViewChanges=function(){o.getEventManager().fireEvent(s.Rendered,a)},o.enableViewport(o._opt.enableViewport),o.setDisplayMode(o._opt.displayMode),!o._opt.enableViewport&&o.home(),o.showLineWidth(o._opt.enableLineWidth),o.getEventManager().fireEvent(s.Loaded,r),o.cursorReady||(Glodon.Web.Lang.Utility.MouseMotion.setCursor(o),o.cursorReady=!0),o.enableHover(o._opt.enableHover)})},setNavigationMode:function(i){t.send(e,"setNavigationMode"),"rectZoom"==i?this.rectZoom():this._drawingViewer.mouseEditorMgr.activeEditorByName(i)},zoomIn:function(){this._drawingViewer.zoomPan(1.1)},zoomOut:function(){this._drawingViewer.zoomPan(.9)},zoom:function(e){this._drawingViewer.zoomPan(e)},resize:function(){this._drawingViewer.onResize()},worldToClient:function(e){var t=this._drawingViewer.toScreenPoint([e.x,e.y]);return{x:t[0],y:t[1]}},clientToWorld:function(e){var t=this._drawingViewer.toWorldPoint([e.x,e.y]);return{x:t[0],y:t[1]}},update:function(e){this._drawingViewer.update(e)},setPrintMode:function(e){this._drawingViewer&&(this._drawingViewer.setPrintMode(e),this._drawingViewer.update(!0))},setGlobalOpacity:function(e){this._drawingViewer.dc.setGlobalOpacity(e),this._drawingViewer.update(!0)},setDisplayMode:function(i){t.send(e,"setDisplayMode"),i=i||0,0==i?(this.rootElement.style.background="rgb(50,50,55)","2"==this.version&&this._drawingViewer.setSelectWireframeColor(1,1,1,1)):3!=i&&(this.rootElement.style.background="rgb(255,255,255)","2"==this.version&&this._drawingViewer.setSelectWireframeColor(.733,.733,.733,1)),1!=i&&2!=i||"2"!=this.version?"2"==this.version&&this._drawingViewer.enableReplaceElementColor(!1):(this._drawingViewer.enableReplaceElementColor(!0),this._drawingViewer.replaceElementColor(1,1,1,0,0,0)),this._opt.displayMode=i;var n=["Normal","White","Black","Custom"];this.setPrintMode(n[i])},getGlobalOpacity:function(){return this._drawingViewer.dc.getGlobalOpacity()},setGlobalColor:function(e){e instanceof a.Color?(this._drawingViewer.setGlobalColor(e),this._drawingViewer.update(!0)):console.error("param use Glodon.Web.Graphics.Color ")},restoreGlobalColor:function(){if("1"==this.version)return console.error(" restoreGlobalColor is not compatible with the data source. Please upgrade the data source and try again.");this._drawingViewer.restoreGlobalColor(),this._drawingViewer.update(!0)},getGlobalColor:function(){if(3==this.getDisplayMode())return this._drawingViewer.getGlobalColor();console.error("Only available when using customized display mode.")},restoreGlobalOpacity:function(){this._drawingViewer.dc.restoreGlobalOpacity(),this._drawingViewer.update(!0)},getDisplayMode:function(){return this._opt.displayMode},getViewScale:function(){return this._drawingViewer.getViewScale()},setViewScale:function(e){this._drawingViewer.setViewScale(e)},setSnapDistance:function(e){"number"!=typeof e||e<0||e>25||this._drawingViewer.setSnapDistance(e)},showMergedBoundingBoxById:function(e,t){var i=[],n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;i.push(this.getObjectBoundingBox(l))}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}var u=Glodon.Web.Algorithm.BoundingBoxUtil,c=u.toThreeJsBox2(i,t),d=u.mergeBoundingBox(c),h=u.toDrawingBox2(d),f=!0,g=!1,v=void 0;try{for(var m,p=h[Symbol.iterator]();!(f=(m=p.next()).done);f=!0){var y=m.value;this._drawingViewer.showElementBoxByBBox(y,0)}}catch(e){g=!0,v=e}finally{try{!f&&p.return&&p.return()}finally{if(g)throw v}}this._drawingViewer.update()},showElementBox:function(e,t){this.showElementBoxByBBox(this.getObjectBoundingBox(e),t)},showElementBoxByBBox:function(e,t){if(t){t=Math.min(t,100)/100;var i=Math.max(e[1][1]-e[0][1],e[1][0]-e[0][0])}this._drawingViewer.showElementBoxByBBox(e,t&&i*t),this._drawingViewer.update()},hideElementBox:function(e){this._drawingViewer.hideElementBox(parseInt(e)),this._drawingViewer.update(!0)},clearElementBox:function(){this._drawingViewer.clearElementBox(),this._drawingViewer.update(!0)},getObjectBoundingBox:function(e){return this._drawingViewer.getObjectBoundingBox(parseInt(e))},getVisibleBoxIds:function(){return this._drawingViewer.getVisibleBoxIds()},enableHighlightEvent:function(e){this._drawingViewer.enableHighlightEvent(e)},highlightById:function(e){if(Array.isArray(e))for(var t=0,i=e.length;t<i;t++)this._drawingViewer.highlightById(parseInt(e[t]));else this._drawingViewer.highlightById(parseInt(e));this._drawingViewer.update(!0)},clearHighlight:function(){this._drawingViewer.clearHighlight(),this._drawingViewer.update(!0)},ignoreImage:function(e){this._drawingViewer.dc.ignoreImage=e,this._drawingViewer.update(!0)},clientToModelWorld:function(e){var t=this._drawingViewer.viewer.ToModelWorldPoint([e.x,e.y]);return[t[0],t[1]]},getNearestGrid:function(e){e=this.clientToModelWorld(e);for(var t=this.grids,i=null,n=t.length-1;n>=0;n--){var o=t[n].gridInfo;o.distance=Glodon.Web.Lang.Utility.ClientHelper.PointToLineDistance(e[0],e[1],o.start.x,o.start.y,o.end.x,o.end.y),i?i.distance[0]>o.distance[0]&&(i=o):i=o}return i},scale:function(e,t){this._drawingViewer.scaleDrawing(e,t)},getScaleFactor:function(){return this._drawingViewer.getAlignScale()},getExternalReferencesList:function(e){var t=this.url+"/externalBlocks.json";this._ajaxGet(t,e)},getAlignState:function(){return this._drawingViewer.getAlignState()},setAlignState:function(e){this._drawingViewer.setAlignState(e)},overrideElementsColorById:function(e,t){if("1"==this.version)return console.error(" overrideElementsColorById is not compatible with the data source. Please upgrade the data source and try again.");t instanceof a.Color?this._drawingViewer.overrideElementsColorById(e,t):console.error("param use Glodon.Web.Graphics.Color ")},restoreElementsColorById:function(e){if("1"==this.version)return console.error(" restoreElementsColorById is not compatible with the data source. Please upgrade the data source and try again.");this._drawingViewer.restoreElementsColorById(e)},addImage:function(e,t,i,n,o){var a=this._drawingViewer.customManager,r=a.markups,s=this,l=new Image;l.src=t;for(var u=0;u<r.length;u++){if(r[u].id==e)return console.error("id"+e+"å·²ç»å­˜åœ¨,å›¾ç‰‡æ·»åŠ å¤±è´¥!"),!1}a.setStyle("Chartlet"),a.add([i.x,n.y],[n.x,i.y],0,l,e),l.onload=function(){s.update(),o&&o()},this.calculateBBox()},calculateBBox:function(){for(var e=this._drawingViewer.customManager,t=e.markups,i=this._drawingViewer.getModelBBox().GetMinPt(),n=this._drawingViewer.getModelBBox().GetMaxPt(),o=0;o<t.length;o++){var a=t[o];a.min&&(i[0]=Math.min(a.min[0],i[0]),i[1]=Math.min(a.min[1],i[1]),n[0]=Math.max(a.max[0],n[0]),n[1]=Math.max(a.max[1],n[1]))}this.modelBBox=[i,n]},clearImages:function(){this._drawingViewer.customManager.markups=[],this.modelBBox=null},removeImagesById:function(e){for(var t=this._drawingViewer.customManager,i=t.markups,n=0;n<e.length;n++)for(var o=e[n],a=0;a<i.length;a++){var r=i[a];if(r.id==o){i.splice(a,1);break}}this.calculateBBox()},enableViewport:function(e){this._drawingViewer.enableViewport&&this._drawingViewer.enableViewport(e)},getRenderInfo:function(e,t){var i=this;this.getViewMetaData(e,function(e){var n=e.drawingUrl;i.getIndexJson(n,function(e){t&&t(e)})})},getAxisInfo:function(e){var t=this.url+"/AxisGrid.json";this._ajaxGet(t,e)},getManifest:function(e){var t=this,i=Glodon.Web.Lang.Utility.HttpRequest,n=t._viewMetaData||t._data,o=n.integrateDrawings&&n.integrateDrawings.databagId||n.databagId,a=Glodon.Web.Lang.Utility.ClientHelper.formatURL((n.path||this._viewConfig.resourceHost)+"/"+o+"/manifest.json");i.ajax({url:""+a,success:function(t){var i=JSON.parse(t);i&&e(i)},failure:function(t){e(t)}})},_ajaxGet:function(e,t){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:e,success:function(e){var i=JSON.parse(e);i&&t(i)}})},hideElementsById:function(e){this._drawingViewer.hideElementsById&&this._drawingViewer.hideElementsById(e)},showElementsById:function(e){this._drawingViewer.showElementsById&&this._drawingViewer.showElementsById(e)}}),i.ViewerDrawing=c}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=function(){return{domElement:null,resourceHost:hostConfig.resourceHost,staticHost:hostConfig.staticHost+"/api/Glodon",APIHost:hostConfig.APIHost,sdkUrl:null,staticPath:"/api/Glodon",enableLineWidth:!1,displayMode:0,enableViewport:!1}};e.ViewerDrawingSetConfig=t}(),function(){var e=Object.freeze({ViewAdded:"ViewAdded",ViewLoading:"ViewLoading",ComponentsSelectionChanged:"ComponentsSelectionChanged",ComponentsHoverChanged:"ComponentsHoverChanged",Error:"Error",Loaded:"Loaded",MouseClicked:"MouseClicked",ActiveViewChanged:"ActiveViewChanged",MouseDragged:"MouseDragged",ContextMenu:"ContextMenu",Rendered:"Rendered",ViewChanged:"ViewChanged",ViewMoving:"ViewMoving",ViewMoved:"ViewMoved",ViewZooming:"ViewZooming",ViewZoomed:"ViewZoomed",AddDrawing:"AddDrawing",Hover:"Hover",ZoomFactorChanged:"ZoomFactorChanged"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer").ViewerDrawingSetEvent=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Viewer"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"GlobalData"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),o=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),Glodon.Bimface.Viewer.ViewerDrawingSetEvent);t.isInitialized=t.isInitialized||!1;var a=(Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop(),Glodon.Bimface.Data.StatisticsDataManager.getInstance()),r=function(t){e.Viewer.call(this);var i=this;this.viewerType="ViewerDrawingSet";var r=t;this._opt=t,this.isAlignment=!1,this.sets=[],this.activeState=null,this._displayMode=t.displayMode,this._state={},this.hasInit=!1,this._databagId=null;var s,l=n.create("div","bf-drawingSet-container "),u=t.domElement;u.id?s=u.id:(s=Glodon.Web.Lang.Utility.UUID.createUUID(),u.id=s),l.id="DrawingSet"+s,l.setCss({width:"100%",height:"100%",position:"relative"}),u.appendChild(l),r.domElement=l,this.getRenderInfo=function(e,t){var i=this;this.getViewMetaData(e,function(e){var n=e.drawingUrl;i.getIndexJson(n,function(e){t&&t(e)})})},this._domElement=u,this._viewConfig=r,this.rootElement=l,this.haveActiveDrawing=!1,this.getRootElement=function(){return l},i.addEventListener(o.Loaded,function(){var e={eventId:"åŠ è½½",loadModel:"expert",type:"DrawingSet"};a.send("Glodon.Bimface.Viewer.ViewerDrawingSet","Loaded",e)})};i.Type.inheritPrototype(r,e.Viewer),r.prototype=Object.assign({},e.Viewer.prototype,{addDrawing:function(e,t,i){var n=this;this.getViewMetaData(t,function(o){var a=new Glodon.Bimface.Viewer.ViewerDrawingSetConfig,r=n.createWrap(e);a.domElement=r,a.drawingUrl=o.drawingUrl,a.displayMode=n._displayMode,a.viewToken=t,a.enableViewport=n._viewConfig.enableViewport,n.getViewMetaData(t,function(e){n._databagId=e.databagId});var s=Glodon.Bimface.Viewer.ViewerDrawingSetEvent,l=void 0;l=new Glodon.Bimface.Viewer.ViewerDrawing(a),l.load(a.viewToken);var u={id:e,wrap:r,viewerDrawing:l,active:!1,visible:!0,fileName:o.name};n.sets.push(u),n.haveActiveDrawing||(n.haveActiveDrawing=!0,n.setActiveDrawing(e,!0)),l.addEventListener(s.MouseClicked,function(t){n.onMouseClick(e,t)}),l.addEventListener(s.Rendered,function(e){n.activeState=e.getState(),n.sync(),n.getEventManager().fireEvent(s.Rendered,n)}),l.addEventListener(s.Loaded,function(e){n.setDisplayMode(n.getDisplayMode()),n.hasInit||(n.getEventManager().fireEvent(s.Loaded,n),n.hasInit=!0),n.getEventManager().fireEvent(s.AddDrawing,n),n.getEventManager().fireEvent(s.ViewChanged,n),i&&i(e)}),l.addEventListener(s.ViewZoomed,function(){n.getEventManager().fireEvent(s.ViewZoomed,n)}),l.addEventListener(s.ZoomFactorChanged,function(e){n.getEventManager().fireEvent(s.ZoomFactorChanged,e)}),l.addEventListener(s.MouseDragged,function(e){n.getEventManager().fireEvent(s.MouseDragged,e)}),l.addEventListener(s.ContextMenu,function(e){n.getEventManager().fireEvent(s.ContextMenu,e)})})},addDrawings:function(e,t){var i=e.slice(),n=i.shift(),o=n.viewToken,a=n.id,r=t,s=this;void 0==a&&(a=Date.now()),this.addDrawing(a,o);var l=function e(){var t=i.shift();if(t){var n=t.id;void 0==n&&(n=Date.now()),s.addDrawing(n,t.viewToken)}else r&&r(s),s.removeEventListener("AddDrawing",e)};this.addEventListener("AddDrawing",l)},sync:function(){for(var e=this.sets,t=this.activeState,i=0;i<e.length;i++)e[i].active||e[i].viewerDrawing.setState(t)},setNavigationMode:function(e){this.getActiveDrawing().viewerDrawing.setNavigationMode(e)},removeDrawing:function(e){if(null==e||void 0==e)return console.error("id is necessary!"),!1;var t=this.getDrawingById(e);t.active&&(1==this.sets.length?this.haveActiveDrawing=!1:this.setActiveDrawing(this.sets[this.sets[0].id==e?1:0].id)),t.wrap.remove(),this.sets.removeObjectByAttribute("id",e),this.getEventManager().fireEvent(o.ViewChanged,self)},rectZoom:function(){this._state.rectZoom=!0,this.getActiveDrawing().viewerDrawing.rectZoom()},enableFullScreen:function(e){var t=this.getRootElement();e?Glodon.Web.Lang.Utility.FullScreen.fullScreen(t):Glodon.Web.Lang.Utility.FullScreen.exitFullScreen();var i=this;setTimeout(function(){i.getActiveDrawing().viewerDrawing.resize()},500)},getCurrentState:function(){for(var e=[],t=this.sets,i=0;i<t.length;i++){var n=t[i],o=n.id,a=n.active,r=n.visible,s=n.viewerDrawing,l=this.getOffsetDistance(o),u=s.getAlignState(),c=s.getCurrentState(),d={id:o,active:a,visible:r,alignState:u,allState:c,translate:l};e.push(d)}return e},setCurrentState:function(e){for(var t=this.sets,i=0;i<t.length;i++){var n=t[i],o=n.id,a=n.active,r=n.visible,s=n.viewerDrawing,l=e.getObjectByAttribute("id",o);l&&(l.visible!=r&&(l.visible?this.showDrawing(o):this.hideDrawing(o)),l.active&&!a&&this.setActiveDrawing(o),l.alignState&&s.setAlignState(l.alignState),l.allState&&s.setState(l.allState))}},onMouseClick:function(e,t){t.id=e;var i=this.alignmentPoints,n=this.getSelectDrawing(),a=n.viewerDrawing.getViewer();if(this.isAlignment){if(this.selectId){var r=a.toModelWorld([t.clientPosition.x,t.clientPosition.y]);this.alignmentPoints.push({x:r[0],y:r[1]})}else this.alignmentPoints.push(t.worldPosition);if(1==i.length){var s=a,l=s.snapToPoint(t.clientPosition.x,t.clientPosition.y),u=l.GetPoint();if(0!=l.GetID())i[0]={x:u[0],y:u[1]};else{var c=this.verify([t.clientPosition.x,t.clientPosition.y]);if(c){var d=s.toModelWorld(c),h=d.slice(0,2);i[0]={x:h[0],y:h[1]}}}}else if(2==i.length){var f=a;"capture"!=f.mouseEditorMgr.editors[0].name&&n.viewerDrawing.setNavigationMode("capture");var g=this.verify([t.clientPosition.x,t.clientPosition.y]);if(g){var v=f.toModelWorld(g),m=v.slice(0,2);i[1]={x:m[0],y:m[1]}}this.moveDrawing(n.id,[i[1].x-i[0].x,i[1].y-i[0].y]),this.alignmentPoints=[]}}else if(this.snapping){var p=a.snapToPoint(t.clientPosition.x,t.clientPosition.y);if(0!=p.GetID()){var y=p.GetSnapType(),w={x:p.GetPoint()[0],y:p.GetPoint()[1]},b=a.toScreenPoint([w.x,w.y]),C={x:b[0],y:b[1]};t.snapPoint={type:y,clientPosition:C,worldPosition:w}}else this.tempSnapPoint&&(t.snapPoint={type:this.tempSnapPoint.type,clientPosition:{x:this.tempSnapPoint.screenPoint[0],y:this.tempSnapPoint.screenPoint[1]},worldPosition:{x:this.tempSnapPoint.worldPoint[0],y:this.tempSnapPoint.worldPoint[1]}})}this.getEventManager().fireEvent(o.MouseClicked,t)},convertCoordinates:function(e,t,i){var n=this.getDrawingById(e),o=this.getDrawingById(t),a=n.viewerDrawing.worldToClient({x:i[0],y:i[1]});return o.viewerDrawing.clientToWorld(a)},showDrawing:function(e){var t=this.getDrawingById(e);t.wrap.setCss({display:"block"}),t.visible=!0},hideDrawing:function(e){
var t=this.getDrawingById(e);if(t.active)return void console.log("can't hide active drawing");t.wrap.setCss({display:"none"}),t.visible=!1},moveDrawing:function(e,t){var i=this.getDrawingById(e);i.viewerDrawing.getViewer().alignDrawing([0,0],[t[0],t[1]]),i.viewerDrawing.update(!0)},startMoving:function(){var e=this;this.isAlignment=!0,this.alignmentPoints=[];var t=this.getActiveDrawing(),i=t.viewerDrawing.getViewer();t.viewerDrawing.setNavigationMode("capture"),i.mouseEditorMgr.editors[0].setIsOnlySnap(!1),i.mouseEditorMgr.editors[0].captureFail=function(t,i,n){return e.verify(t,i,n,!0),!1},this.enterMode(!0)},enableSnap:function(e){var t=this,i=this.getActiveDrawing(),n=i.viewerDrawing.getViewer();this.snapping=e,e?(i.viewerDrawing.setNavigationMode("capture"),n.mouseEditorMgr.editors[0].setIsOnlySnap(!0),n.mouseEditorMgr.editors[0].captureFail=function(e,i,n){return t.verify(e,i,n,!0,!0),!1}):i.viewerDrawing.setNavigationMode("pick")},setSnapMode:function(e){var t=this.getActiveDrawing(),i=t.viewerDrawing;this.snapMode=e,i.getViewer().setSnapMode(e)},enterMode:function(e){var t=void 0;t=e?this.getSelectDrawing():this.getActiveDrawing();for(var i=this.sets,n=0;n<i.length;n++)if(i[n].id!=t.id)i[n].viewerDrawing.setPrintMode("Custom"),i[n].viewerDrawing.setGlobalColor(new Glodon.Web.Graphics.Color("#7D888A"));else if(e)i[n].viewerDrawing.setPrintMode("Custom"),0==this._displayMode?i[n].viewerDrawing.setGlobalColor(new Glodon.Web.Graphics.Color("#ffffff")):i[n].viewerDrawing.setGlobalColor(new Glodon.Web.Graphics.Color("#000000"));else{var o=["Normal","White","Black","Custom"];i[n].viewerDrawing.setPrintMode(o[this._displayMode])}},selectDrawing:function(e){this.selectId=e,this.enterMode(!0)},verify:function(e,t,i,n,o){if(e){for(var a=this.sets,r=null,s=this.getActiveDrawing().id,l=n?s:this.selectId||s,u=0;u<a.length;u++)if(a[u].id!=l){var c=a[u].viewerDrawing.getViewer(),d=c.snapToPoint(e[0],e[1]),h=d.GetPoint(),f=d.GetID();if(0!=f){var g=d.GetSnapTypeName(),v=function(e,t){if(!e)return!1;if(!t)return!0;var i=e.GetSnapTypeName(),n=t.snapList,o={PointOnLine:"line",Intersection:"intersection",MiddlePoint:"midpoint",EndPoint:"endpoint"};return n.includes(o[i])}(d,this.snapMode);if(!v)continue;var m=this.getActiveDrawing(),p=m.viewerDrawing.getViewer();return e=c.toScreenPoint(h),p.mouseEditorMgr.editors[0].drawTmpPoint(t,i,e,g),this.tempSnapPoint={worldPoint:h,id:f,screenPoint:e,type:g},r=e}}return this.tempSnapPoint=null,r}},getSelectDrawing:function(){return this.selectId?this.getDrawingById(this.selectId):this.getActiveDrawing()},endMoving:function(){this.isAlignment=!1,this.selectId=null,this.getActiveDrawing().viewerDrawing.setNavigationMode("pick"),this.enterMode(!1)},createWrap:function(e){var t=n.create("div",this.rootElement.id+e);return this.rootElement.appendChild(t),t},getOffsetDistance:function(e){return this.getDrawingById(e).viewerDrawing.getViewer().getAlignTranslate()},setActiveDrawing:function(e,t){if(null==e||void 0==e)return console.error("id is necessary!"),!1;var i=this.sets.getObjectByAttribute("active",!0);if(!i||i.id!=e){i&&(i.active=!1,i.wrap.setCss({"z-index":0}));var n=this.getDrawingById(e);n.active=!0,n.wrap.setCss({"z-index":5});var a=this.getRootElement().querySelector(".bf-drawable-context");a&&n.wrap.querySelector(".bf-drawing-container ").appendChild(a),t||this.setDisplayMode(this.getDisplayMode()),this.getEventManager().fireEvent(o.ActiveViewChanged,this),this.snapping&&this.enableSnap(!0)}},getActiveDrawing:function(){return this.sets.getObjectByAttribute("active",!0)},getDrawingById:function(e){return null==e||void 0==e?(console.error("id is necessary!"),!1):this.sets.getObjectByAttribute("id",e)},createSnapshotAsync:function(e,t){var i=void 0,n=document.createElement("canvas"),o=this.getRootElement();n.width=o.clientWidth,n.height=o.clientHeight,e&&(e="rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")");var a=n.getContext("2d");a.beginPath(),a.fillStyle=e||o.style.background,a.fillRect(0,0,n.width,n.height),this.sets.reverse().forEach(function(e){if(e.active)i=e.viewerDrawing.getViewer().snapshotPure();else{var t=e.viewerDrawing.getViewer().snapshotPure();a.drawImage(t,0,0)}}),a.drawImage(i,0,0),t(n.toDataURL())},showLineWidth:function(e){this.sets.forEach(function(t){t.viewerDrawing.showLineWidth(e)})},getBBox:function(e){var t=this.sets.getObjectByAttribute("id",e),i=t.viewerDrawing.getViewer().getModelBBox(),n=i.GetMinPt(),o=i.GetMaxPt();return{min:n.slice(0,2),max:o.slice(0,2)}},zoomToBoundingBox:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;this.getActiveDrawing().viewerDrawing.zoomToBoundingBox(e,t)},home:function(){for(var e=this.sets,t=void 0,i=void 0,n=void 0,a=0;a<e.length;a++){var r=e[a],s=r.id,l=r.active,u=r.viewerDrawing,c=this.getOffsetDistance(s),d=this.getBBox(s);l&&(n=u),t?(t=[Math.min(d.min[0]+c[0],t[0]),Math.min(d.min[1]+c[1],t[1])],i=[Math.max(d.max[0]+c[0],i[0]),Math.max(d.max[1]+c[1],i[1])]):(t=[d.min[0]+c[0],d.min[1]+c[1]],i=[d.max[0]+c[0],d.max[1]+c[1]])}n.getViewer().zoomToWorldBox([t[0],t[1],0],[i[0],i[1],0],1),n.update(),this.activeState=n.getCurrentState(),this.sync(),this.getEventManager().fireEvent(o.Rendered,self)},setDisplayMode:function(e){e=e||0,this.sets.forEach(function(t){"2"==t.viewerDrawing.version&&t.viewerDrawing.getViewer().enableReplaceElementColor(!1),t.active?t.viewerDrawing.setDisplayMode(e):0==e?(t.viewerDrawing.setPrintMode("Custom"),t.viewerDrawing.setGlobalColor(new Glodon.Web.Graphics.Color("#7D888A"))):(t.viewerDrawing.setPrintMode("Custom"),t.viewerDrawing.setGlobalColor(new Glodon.Web.Graphics.Color("#778BA3")))}),this.getRootElement().setCss({background:0==e?"rgb(50,50,55)":"#fff"}),this._displayMode=e},getDisplayMode:function(){return this._displayMode},getViewMetaData:function(e,t){var i=this,n=Glodon.Bimface.Authentication.AuthenticationManager,o=new Glodon.Bimface.Authentication.AuthenticationConfig;o.viewToken=e,o.APIHost=this._viewConfig.APIHost,(this.authenticate=new n(o)).authenticate(function(e){e.drawingUrl=i._viewConfig.resourceHost+"/"+e.databagId+"/resource/drawing",t(e)})},getIndexJson:function(e,t){Glodon.Web.Lang.Utility.HttpRequest.ajax({url:e+"/index.json"+(this.offline&&".gz"||""),success:function(e){var i=JSON.parse(e);i&&t(i)}})},getManifest:function(e){var t=this,i=Glodon.Web.Lang.Utility.HttpRequest,n=t._viewConfig.resourceHost+"/"+t._databagId+"/manifest.json";i.ajax({url:""+n,success:function(t){var i=JSON.parse(t);i&&e(i)},failure:function(t){e(t)}})},enableViewport:function(e){this.getActiveDrawing().viewerDrawing.enableViewport(e)}}),e.ViewerDrawingSet=r}();var CLOUD$1=window.CLOUD||{};!function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=function(){return{name:"defaultMap",domElement:null,width:240,height:240,viewer:null,axis:!1,host:hostConfig.resourceHost,onCameraChanged:null,inMoveOnAxisGrid:null}};e.MiniMapConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest")),i=function(e){var t=this,i=e;if(t._opt=i,!i.domElement)return console.log("domElement must not be empty."),!1;if(!i.viewer)return console.log("viewer is not defined."),!1;var n=i.viewer.getViewer();t._helper=new CLOUD$1.Extensions.MiniMapHelper(i.viewer.getViewer());var o=function(){t._helper.renderMiniMap()};n.addCallbacks("render",o),t.init()};i.prototype={init:function(){var e=this,i=e._opt,n={},o=[];e._helper;t.ajax({url:i.host+"/"+i.viewer._data.databagId+"/metadata/grids.json",async:!1,success:function(e){for(var t=JSON.parse(e),i=[],o=0,a=t.grids.length;o<a;o++){var r=t.grids[o];r.start.X=r.start.x,r.start.Y=r.start.y,r.start.Z=r.start.z,r.end.X=r.end.x,r.end.Y=r.end.y,r.end.Z=r.end.z,i.push(r)}n.Grids=i}}),t.ajax({async:!1,url:i.host+"/"+i.viewer._data.databagId+"/metadata/levels.json",success:function(e){n.Levels=JSON.parse(e).levels}}),t.ajax({async:!1,url:i.host+"/"+i.viewer._data.databagId+"/resource/model/maps/output.json",dataType:"text",success:function(e){var t=JSON.parse(e);for(var n in t){var a=t[n];void 0==a.id&&(a.id=n),a.path=i.host+"/"+i.viewer._data.databagId+"/resource/model/maps/"+a.id+".png",a.name=n,o.push(a)}}}),e._floors=o,e.createMap(n,o)},createMap:function(e,t){var i,n=this._helper,o=this._opt,a={left:0,bottom:0,outling:"none",position:"relative"};n.createMiniMap(o.name,o.domElement,o.width,o.height,a,o.onCameraChanged,o.inMoveOnAxisGrid),e.Grids&&e.Levels&&n.setAxisGridData(o.name,e),t.length>0&&(n.setAllFloorPlaneData(o.name,t),n.setFloorPlaneId(o.name,t[0].name)),n.generateAxisGrid(o.name),n.generateFloorPlane(o.name,!1),n.showAxisGrid(o.name,o.axis),i=n.getMiniMap(o.name),i.setMapClickCallback(function(){})},getFloors:function(){return this._floors},showAxisGrid:function(){this._helper.showAxisGrid(this._opt.name,!0)},hideAxisGrid:function(){this._helper.showAxisGrid(this._opt.name,!1)},showFloorById:function(e){var t=this,i=t._opt.name;t._helper.setFloorPlaneData(i,e),t._helper.generateFloorPlane(i,!0)},resize:function(e,t){this._helper.resize(this._opt.name,e,t)},onClick:function(e,t){var i=this,n=i._opt,e=e||"default",o=i._helper.getMiniMap(n.name);o.setMapClickMode(e),o.setMapClickCallback(function(e){t&&"function"==typeof t&&t(e)})},toLocation:function(e,t){var i=this,n=i._opt;i._helper.getMiniMap(n.name).toLocation(e,t)},imageCoord2WordCoord:function(e,t){var i=this,n=i._opt;return i._helper.getMiniMap(n.name).imageCoord2WordCoord(_defineProperty({x:e},"x",t))}},e.MiniMap=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Map"),t=function(){return{id:"defaultMap",name:"defaultMap",domElement:null,viewer:null,width:240,height:240,isShowGrid:!1,navigationMode:"Default",resourceHost:hostConfig.resourceHost}};e.MapConfig=t}(),function(){var e=Object.freeze({ViewerCameraChanged:"ViewerCameraChanged",MouseClicked:"MouseClicked",MouseHoveredGrid:"MouseHoveredGrid",SelectionChanged:"SelectionChanged",SelectionMoved:"SelectionMoved",SelectionEditor:"SelectionEditor",FloorPlaneChanged:"FloorPlaneChanged",Zoom:"Zoom"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Map").MapEvents=e}(),function(){var e=Object.freeze({Default:"Default",Static:"Static"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Map").MapNavigationMode=e}(),function(){var e="Bimface.Plugins.Section.SectionPlane",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Map"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){var t=this,i=e;if(this.defaultFloorPlane="F01",t._opt=i,t.id=e.id,!i.domElement)return console.log("domElement must not be empty."),!1;if(!i.viewer)return console.log("viewer is not defined."),!1;var n=new Glodon.Web.Lang.EventManager;this.getEventManager=function(){return n},this.EventType={RECTPICK_MOUSE_MOVE:1001,RECTPICK_MOUSE_UP:1002,PICK_MOUSE_UP:2002,Floor_Plane_Changed:3e3,Floor_Plane_Changed_For_Panel:3001,Camera_Height_Changed:5e3,ZOOM_MOUSE_WHEEL:6e3,Minimap_Rect_Changed:8e3,Minimap_Rect_Destroyed:8001};var o=i.viewer.getViewer();t.viewerFloor=new ViewerFloor(o,i.domElement),t.viewerFloor.registerCameraHeightChanged(CLOUD$1.EVENTS.ON_CAMERA_HEIGHT_CHANGED),t._helper=this,t.renderCB=function(){t.viewerFloor.renderCameraNode()},o.addCallbacks("render",t.renderCB),t.init()});n.prototype={addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},init:function(){t.send(e,"init");var i=this;i._opt.viewer.getMapInfo(function(e){i._floors=e.floors,i.createMap(e.axisGrid,e.floors)})},createMap:function(i,n){t.send(e,"createMap");var o=this,a=o.getEventManager(),r=Glodon.Bimface.Plugins.Map.MapEvents,s=o._opt;if((i.Grids||i.Levels)&&this.viewerFloor.setAxisGridData(i),n.length>0){this.viewerFloor.setPlanes(n);var l=n.getObjectByAttribute("name",this.defaultFloorPlane);0==l?this.showFloorById(n[0].id):this.showFloorById(l.id)}var u=this.EventType;this.viewerFloor.addEventListener(u.PICK_MOUSE_UP,function(e){a.fireEvent(r.MouseClicked,e.data)}),this.viewerFloor.setMapClickMode(s.navigationMode.toLocaleLowerCase()),this.viewerFloor.addEventListener(u.Minimap_Rect_Changed,function(e){a.fireEvent("MinimapRectChanged",e.rectInfo)}),this.viewerFloor.addEventListener(u.Minimap_Rect_Destroyed,function(e){a.fireEvent("MinimapRectDestroyed",e)}),this.viewerFloor.addEventListener(u.Camera_Height_Changed,function(e){o.viewerFloor.enableFloorPlaneChangedEvent(!1),o.showFloorById(e.id),o.viewerFloor.enableFloorPlaneChangedEvent(!0)}),this.viewerFloor.addEventListener(u.Floor_Plane_Changed_For_Panel,function(e){a.fireEvent("FloorPlaneChanged",e.name)}),this.viewerFloor.addEventListener(u.ZOOM_MOUSE_WHEEL,function(e){a.fireEvent(r.Zoom,e.data)}),this.viewerFloor.addEventListener(u.Floor_Plane_Changed,function(e){if(void 0!=e.elevation){"string"==typeof e.elevation&&(e.elevation=parseFloat(e.elevation));var t=s.viewer.getViewer(),i=t.camera,n=e.elevation,o=s.viewer.sceneToWorld(i.position.clone()),a=new THREE.Vector3(o.x,o.y,n+1750),r=s.viewer.worldToScene(a);t.cameraControl.flyToPointWithParallelEye(new THREE.Vector3(r.x,r.y,r.z))}})},setDefaultFloorPlane:function(e){for(var t=this._floors,i=0;i<t.length;i++)if(t[i].name==e){var n=(this.viewerFloor,this.getEventManager());n.fireEvent("FloorPlaneChanged",e);var o=t.getObjectByAttribute("name",e);return helpershowFloorById(o.id),!0}return!1},getFloorList:function(){return this._floors},getDefaultFloorPlane:function(){return this.defaultFloorPlane},getBoundingBox:function(){return this.viewerFloor.getBoundingBoxIsolate()},showFloorById:function(e){this.viewerFloor.setFloorPlaneId(e),this.viewerFloor.destroy(),this.viewerFloor.rebuildData(),this.viewerFloor.render()},resize:function(e,t,i){var n=this._opt.domElement;n.style.width=e+"px",n.style.height=t+"px",this.viewerFloor.resize(e,t,i),this.getEventManager().fireEvent("Resize",{width:e,height:t})},setPlaneChangedCallback:function(e){this.addEventListener("FloorPlaneChanged",function(t){e&&e(t)})},setMinimapResizeCallback:function(e){this.addEventListener("Resize",function(t){e&&e(t)})},setNavigationMode:function(e){var t=this._opt,i=this.viewerFloor;t.navigationMode=e,i.setMapClickMode(t.navigationMode.toLocaleLowerCase())},clear:function(){this.viewerFloor.clearRectPick()},clearZoomAndPan:function(){this.viewerFloor.clearZoomAndPan();var e=this.EventType;this.viewerFloor.getEventManager().dispatchEvent({type:e.ZOOM_MOUSE_WHEEL,data:{offsetX:0,offsetY:0,zoomFactor:1}})},getMapContainer:function(){return this.viewerFloor.getMapContainer()},getFloorPlaneName:function(){return this.viewerFloor.getFloorPlaneName()},getAxisGridBox2D:function(){return this.viewerFloor.getAxisGridBox2D()},exit:function(){var e=this;e._opt.viewer.getViewer().removeCallbacks("render",e.renderCB),e.clear()}},i.Map=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=function(){function e(t,i){_classCallCheck(this,e),this.viewer=t.getViewer(),this.enumEventTypes={ON_COMPONENT_HOVER:1e3,ON_COMPONENT_CLICK:1001},this.initialize();var n=this;this.bimcube=new BimCube(i,BimfaceLanguage.name,function(){n.hookEvents(),n.bimcube.update(n.viewer.getActiveCameraInfo())})}return _createClass(e,[{key:"initialize",value:function(){this.enumViewMode={Home:0,Top:1,Bottom:2,Front:3,Back:4,Right:5,Left:6,SouthEast:7,SouthWest:8,NorthEast:9,NorthWest:10,BottomFront:11,BottomBack:12,BottomRight:13,BottomLeft:14,BottomSouthEast:15,BottomSouthWest:16,BottomNorthEast:17,BottomNorthWest:18,RoofFront:19,RoofBack:20,RoofRight:21,RoofLeft:22,RoofSouthEast:23,RoofSouthWest:24,RoofNorthEast:25,RoofNorthWest:26,TopTurnRight:27,TopTurnBack:28,TopTurnLeft:29,BottomTurnRight:30,BottomTurnBack:31,BottomTurnLeft:32,FrontTurnRight:33,FrontTurnTop:34,FrontTurnLeft:35,RightTurnBack:36,RightTurnTop:37,RightTurnFront:38,BackTurnRight:39,BackTurnTop:40,BackTurnLeft:41,LeftTurnFront:42,LeftTurnTop:43,LeftTurnBack:44}}},{key:"hookEvents",value:function(){var e=this.bimcube,t=this.viewer,i=this.enumViewMode,n=function(){t.render()};e.addEventListener(this.enumEventTypes.ON_COMPONENT_CLICK,function(e){var o=i[e.viewType];o&&t.setStandardView(o,null,n,n)}),t.addRenderCallback(function(){e.update(t.getActiveCameraInfo())})}},{key:"setVisible",value:function(e){!0===e?this.bimcube.show():this.bimcube.hide()}},{key:"getImpl",value:function(){return this.bimcube}},{key:"destroy",value:function(){this.viewer=null,this.enumEventTypes=null,this.enumViewMode=null,this.bimcube.destroy(),this.bimcube=null}}]),e}();e.ViewHouseNavi=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=function(){return{width:140,height:140,domElement:null,viewer:null}};e.ViewHouseConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Application.UI.Menu"),t=function(e){var t=this,i=e.viewer;this.viewer=i;var n=e.domElement,o=Glodon.Bimface.UI.Control.ControlEvent,a=Glodon.Bimface.Viewer.Viewer3DEvent,r=i.getDomElement(),s=new Glodon.Bimface.UI.Menu.MenuConfig;s.element=n,this.menu=new Glodon.Bimface.UI.Menu.Menu(s),this.menu.element.style.backgroundColor="#EBEFF1",this.menu.element.style.border="1px solid #D0D6D6";var l=this.menu,u=new Glodon.Bimface.UI.Menu.MenuItemConfig;u.id="home";var c=new Glodon.Bimface.UI.Menu.MenuItem(u);c.setText(BimfaceLanguage.bf_viewHouse_home),c.element.addClass("bf-menu-item1"),i.getEventManager().addEvent(a.ToolbarHomeClick,function(){t.switchHomeView()}),c.addEventListener(o.Click,function(){t.switchHomeView(),t.hide()}),this.switchHomeView=function(){var e=i.getCustomedHomeview(),t=i.getDefaultHomeview(),n=e||t,o=n.name;"orth"==o&&h.setText(BimfaceLanguage.bf_viewHouse_perspective),"persp"==o&&h.setText(BimfaceLanguage.bf_viewHouse_orthographic),i.setCameraStatus(n,function(){0==i.getCameraAnimation()&&i.render()})};var d=new Glodon.Bimface.UI.Menu.MenuItemConfig;d.id="orthographic";var h=new Glodon.Bimface.UI.Menu.MenuItem(d);h.setText(BimfaceLanguage.bf_viewHouse_orthographic),h.element.addClass("bf-menu-item1"),h.addEventListener(o.Click,function(){t.hide(),h.element.textContent==BimfaceLanguage.bf_viewHouse_orthographic?(i.setCameraType("OrthographicCamera"),i.render(),h.setText(BimfaceLanguage.bf_viewHouse_perspective)):(i.setCameraType("PerspectiveCamera"),i.render(),h.setText(BimfaceLanguage.bf_viewHouse_orthographic))}),this.orthographic=h;var f=new Glodon.Bimface.UI.Menu.MenuItemConfig;f.id="setAsHome";var g=new Glodon.Bimface.UI.Menu.MenuItem(f);g.setText(BimfaceLanguage.bf_viewHouse_setAsHome),g.element.addClass("bf-menu-item1"),g.addEventListener(o.Click,function(){t.hide();var e=i.getCameraStatus();i.recordCustomedHomeview(e)});var v=new Glodon.Bimface.UI.Menu.MenuItemConfig;v.id="resetHome";var m=new Glodon.Bimface.UI.Menu.MenuItem(v);m.setText(BimfaceLanguage.bf_viewHouse_resetHome),m.element.addClass("bf-menu-item1"),m.addEventListener(o.Click,function(){t.hide(),i.recordCustomedHomeview(null)});var p=new Glodon.Bimface.UI.Menu.Spacer;p.element.style.backgroundColor="#D0D6D6";var y=new Glodon.Bimface.UI.Menu.Spacer;y.element.style.backgroundColor="#D0D6D6",this.menu.addControl(c),this.menu.addControl(p),this.menu.addControl(h),this.menu.addControl(y),this.menu.addControl(g),this.menu.addControl(m),this.hide=function(){this.menu.element.style.display="none"},this.show=function(){this.menu.element.style.display=""},this.isHide=function(){return"none"==this.menu.element.style.display},this.update=function(){var e=this.viewer.getCameraStatus(),t=e.name;"orth"==t&&this.orthographic.setText(BimfaceLanguage.bf_viewHouse_perspective),"persp"==t&&this.orthographic.setText(BimfaceLanguage.bf_viewHouse_orthographic)},this.destroy=function(){this.viewer=null,this.menu=null,this.orthographic=null},r.addEventListener("mousedown",function(e){l&&t.hide()})};e.ViewHouseMenu=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){var i=e,n=t.create("div","bf-house");n.style.width=i.width+"px",n.style.height=i.height+"px",i.domElement.appendChild(n),this._domElement=n,this._opt=i,this.viewer=i.viewer,this.init()});i.prototype={init:function(){var e=this;this.viewHouseNavi=new Glodon.Bimface.Plugins.ViewHouseNavi(this._opt.viewer,this._domElement);var i=t.createNS("svg","bf-home-svg");i.setAttribute("viewBox","0 0 20 20");var n=t.createNS("g","");n.setAttribute("fill","none"),n.setAttribute("fill-rule","evenodd");var o=t.createNS("polygon","");o.setAttribute("fill","#E3E9EC"),o.setAttribute("points","1.207 9.5 3.5 9.5 3.5 16.499 7.501 16.499 7.503 12.5 12.5 12.5 12.5 16.499 16.5 16.499 16.5 9.5 18.793 9.5 10 .707"),i.addEventListener("mouseover",function(){o.setAttribute("fill","#BAFFEC"),a.setAttribute("fill","#32D3A6")}),i.addEventListener("mouseout",function(){o.setAttribute("fill","#E3E9EC"),a.setAttribute("fill","#BCC0C2")}),i.addEventListener("mousedown",function(){e.viewHouseMenu.switchHomeView()});var a=t.createNS("path","");a.setAttribute("fill","#BCC0C2"),a.setAttribute("d","M10,0 L0,10 L3,10 L3,17 L8,17 L8.003,13.001 L12,13.001 L12,17 L17,17 L17,10 L20,10 L10,0 Z M10,1.414 L17.586,9 L17,9 L16,9 L16,10 L16,16 L13,16 L13,13.001 L13,12 L12,12 L8.003,12 L7.004,12 L7.003,12.999 L7.001,16 L4,16 L4,10 L4,9 L3,9 L2.414,9 L10,1.414 Z"),n.appendChild(o),n.appendChild(a),i.appendChild(n),e._domElement.appendChild(i),this.homeSvg=i;var r=t.createNS("svg","bf-menu-svg");r.setAttribute("viewBox","0 0 20 20"),r.style.position="absolute";var s=t.createNS("g","");s.setAttribute("fill","none"),s.setAttribute("fill-rule","evenodd"),s.setAttribute("transform","translate(3 6)");var l=t.createNS("polygon","");l.setAttribute("fill","#E3E9EC"),l.setAttribute("points","1.207 4.5 6.999 10.292 12.793 4.5");var u=t.createNS("path","");u.setAttribute("fill","#BCC0C2"),u.setAttribute("d","M0.0004,3.9998 L6.9994,10.9998 L13.9994,3.9998 L0.0004,3.9998 Z M2.4144,4.9998 L11.5864,4.9998 L6.9994,9.5858 L2.4144,4.9998 Z");var c=t.createNS("polygon","");c.setAttribute("fill","#E3E9EC"),c.setAttribute("points",".5 2.5 13.5 2.5 13.5 .5 .5 .5");var d=t.createNS("path","");d.setAttribute("fill","#BCC0C2"),d.setAttribute("d","M0,3 L14,3 L14,0 L0,0 L0,3 Z M1,2 L13,2 L13,1 L1,1 L1,2 Z"),r.addEventListener("mouseover",function(){l.setAttribute("fill","#BAFFEC"),u.setAttribute("fill","#32D3A6"),c.setAttribute("fill","#BAFFEC"),d.setAttribute("fill","#32D3A6")}),r.addEventListener("mouseout",function(){l.setAttribute("fill","#E3E9EC"),u.setAttribute("fill","#BCC0C2"),c.setAttribute("fill","#E3E9EC"),d.setAttribute("fill","#BCC0C2")}),s.appendChild(l),s.appendChild(u),s.appendChild(c),s.appendChild(d),r.appendChild(s),e._domElement.appendChild(r),this.menuSvg=r;var h=new Glodon.Bimface.Application.UI.Menu.ViewHouseMenu(this._opt);this.viewHouseMenu=h,h.hide(),r.addEventListener("click",function(t){var i=e.viewer.getDomElement();i.getBoundingClientRect();h.isHide()?(h.update(),h.show()):h.hide()})},enableViewHouse:function(e){this.viewHouseNavi.setVisible(e),this._domElement.style.display=!0===e?"block":"none"},getDomElement:function(){return this._domElement},destroy:function(){this.viewHouseNavi.destroy(),this.viewHouseNavi=null,this.viewHouseMenu.destroy(),this.viewHouseMenu=null,this._domElement.removeChild(this.menuSvg),this.menuSvg=null,this._domElement.removeChild(this.homeSvg),this.homeSvg=null,this._domElement=null,this.viewer=null,this._opt=null}},e.ViewHouse=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=function(){return{background:null,domElement:null,viewer:null,style:{"stroke-width":3,"stroke-color":"#ff0000","stroke-opacity":1,"fill-color":"#ff0000","fill-opacity":0,"font-family":"Arial","font-size":16,"font-style":"italic","font-weight":"bold"}}};e.AnnotationConfig=t}(),function(){var e=Object.freeze({Arrow:"Arrow",Rectangle:"Rectangle",Circle:"Circle",Cross:"Cross",Cloud:"Cloud",Text:"Text"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins").AnnotationTypeOption=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){this._opt=e,this.init()});t.prototype={init:function(){var e,t=this,i=t._opt;if(i.viewer)e=new CLOUD$1.Extensions.AnnotationHelper3D(i.viewer.getViewer());else{if(!i.domElement)return alert("domElement must not be empty."),!1;e=new CLOUD$1.Extensions.AnnotationHelper2D,e.setDomContainer(i.domElement)}this._helper=e},begin:function(){var e=this._helper,t=this._opt;e.editAnnotationBegin(t.absBasePoint,t.screenBasePoint,t.zoomFactor)},end:function(){this._helper.editAnnotationEnd()},save:function(){return this._helper.getAnnotationInfoList()},load:function(e){var t=this._helper;this._opt;t.loadAnnotations(e)},createSnapshot:function(e,t){return this._helper.captureAnnotationsScreenSnapshot(e,t)},setType:function(e){var t={arrow:0,rectangle:1,circle:2,cross:3,cloud:4,text:5};this._helper.setAnnotationType(t[e.toLocaleLowerCase()])},setStyle:function(e){this._helper.setAnnotationStyle(e)},destroy:function(){this._helper.destroy()}},e.Annotation=t,e.Annotation.Annotation=e.Annotation,e.Annotation.AnnotationConfig=e.AnnotationConfig}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=function(){return{viewer:null,lineWidth:3,lineColor:new Glodon.Web.Graphics.Color(208,2,27,1),fillColor:new Glodon.Web.Graphics.Color(255,255,255,0),fontFamily:"Arial",fontSize:14,windowAdaption:!1}};e.AnnotationManagerConfig=t}(),function(){var e=Object.freeze({Arrow:"Arrow",Rectangle:"Rectangle",Circle:"Ellips",Ellips:"Ellips",Cross:"Cross",Cloud:"Cloud",CloudRect:"Cloud-rect",Text:"Text",Polyline:"Polyline"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation").AnnotationTypeOption=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){});t.prototype={init:function(){var e,t=this,i=t._opt;e=new CLOUD$1.Extensions.AnnotationHelper3D(i.viewer.getViewer(),i),this._helper=e},startDrawing:function(){var e=this._helper;this._opt;e.editAnnotationBegin(),this.isShowAnnotation=!0},getAnnotationList:function(){return this._helper.getAnnotationInfoList()},setAnnotationList:function(e){if(!e||0==e.length)return void this.clear();this._annotationList=e,this._helper.loadAnnotations(e),this.isShowAnnotation=!0},createSnapshot:function(e){var t=this;t._opt.viewer;t._helper.captureAnnotationsScreenSnapshot("",e)},setState:function(e){var t=this,i=t._opt.viewer;i.setState(e.state),i.render(),setTimeout(function(){t.setAnnotationList(e.annotationList)},1e3)},updateSvg:function(){var e=this,t=this._annotationList,i=e._opt.viewer.getZoomScale();if(!t||0==t.length)return!1;for(var n=0,o=t.length;n<o;n++)t[n].position=e.getSVGPosition(t[n],i),t[n].size.width=t[n].defaultSize.width*i,t[n].size.height=t[n].defaultSize.height*i;this.isShowAnnotation&&this.setAnnotationList(t)},getSVGPosition:function(e,t){var i=this._opt.viewer,n={x:i.screenWidth/2,y:i.screenHeight/2},o=i.worldToClient(e.worldPosition);return{x:o.x-n.x,y:n.y-o.y}},revoke:function(){}},e.AnnotationViewer3dManager=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){var t=Glodon.Bimface.Viewer.Viewer2DEvent,i=e.viewer,n=this;i.addEventListener(t.ViewMoving,function(e){n.updateSvg()}),i.addEventListener(t.ViewZooming,function(e){n.updateSvg()})});t.prototype={init:function(){var e,t=this,i=t._opt;e=new CLOUD$1.Extensions.AnnotationHelper2D(i),e.setDomContainer(i.viewer.getDomElement()),this._helper=e},startDrawing:function(){var e=this._helper,t=this._opt;e.editAnnotationBegin();t.viewer.getZoomScale();e.editor.svg.addEventListener("mousewheel",function(e){e.preventDefault(),e.stopPropagation()}),this.isShowAnnotation=!0},getAnnotationList:function(){var e=this,t=this._helper.getAnnotationInfoList();if(t&&t.length>0)for(var i=e._opt.viewer,n=i.getZoomScale(),o=0,a=t.length;o<a;o++)t[o].worldPosition=e.getWorldPosition(t[o]),t[o].defaultSize={width:t[o].size.width/n,height:t[o].size.height/n};return t},setAnnotationList:function(e){if(!e||0==e.length)return void this.clear();for(var t=this._opt.viewer.getZoomScale(),i=0,n=e.length;i<n;i++)e[i].position=this.getSVGPosition(e[i],t),e[i].size.width=e[i].defaultSize.width*t,e[i].size.height=e[i].defaultSize.height*t;this._annotationList=e,this._helper.loadAnnotations(e),this.isShowAnnotation=!0},createSnapshot:function(e){var t=this;t._opt.viewer.createSnapshotAsync("",function(i){t._helper.captureAnnotationsScreenSnapshot(i,e)})},setState:function(e){var t=this;t._opt.viewer.setState(e.state),t.setAnnotationList(e.annotationList)},updateSvg:function(){var e=this,t=this._annotationList,i=e._opt.viewer.getZoomScale();if(!t||0==t.length)return!1;for(var n=0,o=t.length;n<o;n++)t[n].position=e.getSVGPosition(t[n],i),t[n].size.width=t[n].defaultSize.width*i,t[n].size.height=t[n].defaultSize.height*i;this.isShowAnnotation&&this.setAnnotationList(t)},getSVGPosition:function(e,t){var i=this._opt.viewer,n={x:i.screenWidth/2,y:i.screenHeight/2},o=i.worldToClient(e.worldPosition);return{x:o.x-n.x,y:n.y-o.y}},revoke:function(){}},e.AnnotationViewer2dManager=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){this._viewer=e,this.drawingViewer=e.getViewer()});t.prototype={init:function(){var e,t=this,i=t._opt;e=this.drawingViewer.mouseEditorMgr,this.type="arrow",this.setLineWidth(i.lineWidth),this.setLineColor(i.lineColor),this.setFillColor(i.fillColor),this.setFontFamily(i.fontFamily),this.setFontSize(i.fontSize),this._helper=e},startDrawing:function(){var e,t=this._helper;this._opt;t.activeEditorByName("markup"),e=t.getEditor(),e.setMarkupType(this.type),this.annotationToolbar&&(this.setLineColor({red:208,green:2,blue:27,alpha:1}),this.setLineWidth(2)),this.editor=e,this.isShowAnnotation=!0},endDrawing:function(){this.drawingViewer.markupManager.setFillColor("transparent"),this.clear(),this._helper.activeEditorByName("pick"),this.drawingViewer.update(),this.isShowAnnotation=!1},getAnnotationList:function(){return this.drawingViewer.markupManager.markups},setAnnotationList:function(e){this.drawingViewer.markupManager.markups=e,this.drawingViewer.update()},clear:function(){this.drawingViewer.markupManager.clear(),this.drawingViewer.update()},createSnapshot:function(e){var t=this._viewer.getRootElement();e(this.drawingViewer.snapshot(t.style.background))},resize:function(){this._viewer.resize()},setAnnotationType:function(e){var t={arrow:"arrow",rectangle:"rectangle","cloud-rect":"cloud-rect",
circle:"ellips",cross:"cross",cloud:"cloud",text:"text"};this.type=t[e.toLocaleLowerCase()],this.editor&&this.editor.setMarkupType(this.type)},setLineWidth:function(e){this.drawingViewer.markupManager.setLineWidth(e)},setLineColor:function(e){this.drawingViewer.markupManager.setColor("rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")")},setFillColor:function(e){this.drawingViewer.markupManager.setFillColor("rgba("+e.red+","+e.green+","+e.blue+","+e.alpha+")")},setFontFamily:function(e){this.drawingViewer.markupManager.setFontFamily(e)},setFontSize:function(e){this.drawingViewer.markupManager.setFontSize(e)},getCurrentState:function(){var e=this,t=e._opt.viewer,i=this.getAnnotationList();return{annotationList:this.stringifyAnnotationList(i),state:t.getCurrentState()}},stringifyAnnotationList:function(e){return this.drawingViewer.markupManager.toString(e)},jsonifyAnnotationList:function(e){return this.drawingViewer.markupManager.fromString(e)},setState:function(e){var t=this,i=t._opt.viewer;if("string"==typeof e.annotationList){var n=this.jsonifyAnnotationList(e.annotationList);this.setAnnotationList(n)}else this.setAnnotationList(e.annotationList);i.setState(e.state)},updateSvg:function(){var e=this,t=this._annotationList,i=e._opt.viewer.getZoomScale();if(!t||0==t.length)return!1;for(var n=0,o=t.length;n<o;n++)t[n].position=e.getSVGPosition(t[n],i),t[n].size.width=t[n].defaultSize.width*i,t[n].size.height=t[n].defaultSize.height*i;this.isShowAnnotation&&this.setAnnotationList(t)},getWorldPosition:function(e){var t=this._opt.viewer,i={x:t.screenWidth/2,y:t.screenHeight/2},n={x:i.x+e.position.x,y:i.y-e.position.y};return t.clientToWorld(n)},getSVGPosition:function(e,t){var i=this._opt.viewer,n={x:i.screenWidth/2,y:i.screenHeight/2},o=i.worldToClient(e.worldPosition);return{x:o.x-n.x,y:n.y-o.y}},revoke:function(){}},e.AnnotationDrawingManager=t}(),function(){var e="Bimface.Plugins.Annotation.AnnotationManager",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){var t=this,i=e.viewer;this._opt=e,this.isShowAnnotation=!1,this.historyQueue=[],Glodon.Bimface.Viewer.Viewer3D&&i instanceof Glodon.Bimface.Viewer.Viewer3D?this._helper=new MarkupViewer3D(i,i._opt.domElement):Glodon.Bimface.Viewer.Viewer2D&&i instanceof Glodon.Bimface.Viewer.Viewer2D?(this.isViewer2D=!0,this._helper=new MarkupViewer2D(i,i._opt.domElement.querySelector(".bf-image"))):this._helper=new MarkupDrawing(i,i._opt.domElement),this._helper.viewer.onSelectChange=function(e){t.onSelectChange(e)},this.init()});n.prototype={init:function(){var e=this,t=e._opt;t.lineWidth&&this.setLineWidth(t.lineWidth),t.lineColor&&this.setLineColor(t.lineColor),t.fillColor&&this.setFillColor(t.fillColor),t.fontFamily&&this.setFontFamily(t.fontFamily),t.fontSize&&this.setFontSize(t.fontSize)},exit:function(){this.endDrawing()},onSelectChange:function(e){},onClick:function(e){this._helper.viewer.onClick=e},getAnnotationList:function(){return this._helper.getAnnotationList()},setAnnotationList:function(e){e.length>0&&e[0].id&&(e=this._helper.transform(e)),this._helper.setAnnotationList(e),this._helper.update()},setState:function(e){this._helper.setState(e)},createSnapshot:function(e){this._helper.createSnapshot(e)},startDrawing:function(){this._helper.startDrawing();var e=document.querySelector(".bf-toolbar-select");e&&(e.style.display="none")},endDrawing:function(){t.send(e,"endDrawing"),this._helper.editAnnotationEnd(),this.isShowAnnotation=!1;var i=document.querySelector(".bf-toolbar-select");i&&(i.style.display="block")},clear:function(){t.send(e,"clear"),this._helper.clearAnnotations()},resize:function(){},setAnnotationType:function(i){t.send(e,"setAnnotationType"),this._helper.setAnnotationType(i.toLocaleLowerCase())},setLineWidth:function(i){t.send(e,"setLineWidth"),this._helper.setAnnotationStyle({"stroke-width":i})},setLineColor:function(i){t.send(e,"setLineColor"),this._helper.setAnnotationStyle({"stroke-color":""+i.getRGBA()})},setFillColor:function(i){t.send(e,"setFillColor"),this._helper.setAnnotationStyle({"fill-color":""+i.getRGBA()})},setFontFamily:function(i){t.send(e,"setFontFamily"),this._helper.setAnnotationStyle({"font-family":i})},setFontSize:function(i){t.send(e,"setFontSize"),this._helper.setAnnotationStyle({"font-size":i})},removeSelectedAnnotation:function(){this._helper.removeSelectedAnnotation()},showAnnotation:function(){this._helper.showAnnotation()},hideAnnotation:function(){this._helper.hideAnnotation()},setStyle:function(e){this._helper.setAnnotationStyle(e)},destroy:function(){this.endDrawing()},getCurrentState:function(){if(this.isViewer2D)var e=this._helper.getCurrentState();else{var t=this._opt.viewer.getViewer();this._opt.windowAdaption&&t.setCameraStateWithFrustum&&t.setCameraStateWithFrustum(!0);var e=this._helper.getCurrentState();t.setCameraStateWithFrustum&&t.setCameraStateWithFrustum(!1)}return e},getWorldPosition:function(e){var t=this._opt.viewer,i={x:t.screenWidth/2,y:t.screenHeight/2},n={x:i.x+e.position.x,y:i.y-e.position.y};return t.clientToWorld(n)},inherit:function(e){for(var t in e)this[t]=e[t]},stringifyAnnotationList:function(e){return this._helper.markupManager.toString(e)},jsonifyAnnotationList:function(e){return this._helper.markupManager.fromString(e)}},i.AnnotationManager=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=function(){};e.AnnotationToolbarConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=Object.freeze({Saved:"Saved",Cancelled:"Cancelled"});e.AnnotationToolbarEvent=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Annotation"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),Glodon.Bimface.Plugins.Annotation.AnnotationToolbarEvent),n=function(e){var n=this._eventManager=new Glodon.Web.Lang.EventManager,o=[],a=e.viewer,r=Glodon.Bimface.Viewer.ViewerDrawing&&a instanceof Glodon.Bimface.Viewer.ViewerDrawing;this.isDrawing=r;var s=t.create("div","bf-annotation bf-hide");this.domElement=s;var l=Glodon.Bimface.Plugins.Annotation.AnnotationTypeOption,u=new Glodon.Bimface.Plugins.Annotation.AnnotationManagerConfig,c=u.lineColor;u.viewer=a,u.windowAdaption=e.windowAdaption,u.annotationCallback=e.annotationCallback;var d=new Glodon.Bimface.UI.Toolbar.ToolbarConfig;d.element=s,d.className="bf-toolbar bf-toolbar-annotation";var h=this.annotationToolbar=new Glodon.Bimface.UI.Toolbar.Toolbar(d);this.annotationToolbar=h,o.push(h),r&&(u.annotationToolbar=h);var f=this._annotationManager=new Glodon.Bimface.Plugins.Annotation.AnnotationManager(u);a.getDomElement().appendChild(s),s.addEventListener("mousedown",function(e){e.stopPropagation()}),s.addEventListener("touchstart",function(e){e.stopPropagation()}),s.addEventListener("touchmove",function(e){e.stopPropagation()});var g=new Glodon.Bimface.UI.Toolbar.ToolbarConfig;g.element=s,g.className="bf-toolbar bf-toolbar-control";var v=new Glodon.Bimface.UI.Toolbar.Toolbar(g);o.push(v);var m=new Glodon.Bimface.UI.Button.ButtonConfig;m.className="bf-button gld-bf-narrow ",m.title="ç®­å¤´",r&&(m.id="arrow"),m.groupName="Annotation";var p=new Glodon.Bimface.UI.Button.SingleButton(m);p.addEventListener("Click",function(){f.setAnnotationType(l.Arrow),Y.show(),te.hide()}),h.addControl(p);var y=new Glodon.Bimface.UI.Button.ButtonConfig;y.className="bf-button gld-bf-n-cloud",y.title="äº‘çº¿æ¡†",y.groupName="Annotation";var w=new Glodon.Bimface.UI.Button.SingleButton(y);w.addEventListener("Click",function(){f.setAnnotationType(l.CloudRect),Y.show(),te.hide()}),h.addControl(w);var b=new Glodon.Bimface.UI.Button.ButtonConfig;b.className="bf-button gld-bf-ncloud",b.title="äº‘çº¿",b.groupName="Annotation";var C=new Glodon.Bimface.UI.Button.SingleButton(b);C.addEventListener("Click",function(){f.setAnnotationType(l.Cloud),Y.show(),te.hide()}),h.addControl(C);var x=new Glodon.Bimface.UI.Button.ButtonConfig;x.className="bf-button gld-bf-n-ployline",x.title="æŠ˜çº¿",x.groupName="Annotation";var E=new Glodon.Bimface.UI.Button.SingleButton(x);E.addEventListener("Click",function(){f.setAnnotationType(l.Polyline),Y.show(),te.hide()}),h.addControl(E);var P=new Glodon.Bimface.UI.Button.ButtonConfig;P.className="bf-button gld-bf-nrectangle",P.title="çŸ©å½¢",P.groupName="Annotation";var k=new Glodon.Bimface.UI.Button.SingleButton(P);k.addEventListener("Click",function(){f.setAnnotationType(l.Rectangle),Y.show(),te.hide()}),h.addControl(k);var M=new Glodon.Bimface.UI.Button.ButtonConfig;M.className="bf-button gld-bf-noval",M.title="æ¤­åœ†",M.groupName="Annotation";var I=new Glodon.Bimface.UI.Button.SingleButton(M);I.addEventListener("Click",function(){f.setAnnotationType(l.Ellips),Y.show(),te.hide()}),h.addControl(I);var S=new Glodon.Bimface.UI.Button.ButtonConfig;S.className="bf-button gld-bf-mark",S.title="X",S.groupName="Annotation";var B=new Glodon.Bimface.UI.Button.SingleButton(S);B.addEventListener("Click",function(){f.setAnnotationType(l.Cross),Y.show(),te.hide()}),h.addControl(B);var _=new Glodon.Bimface.UI.Button.ButtonConfig;_.className="bf-button gld-bf-ntext",_.title="æ–‡å­—",_.groupName="Annotation";var D=new Glodon.Bimface.UI.Button.SingleButton(_);D.addEventListener("Click",function(){f.setAnnotationType(l.Text),Y.hide(),te.show()}),h.addControl(D);var L=new Glodon.Bimface.UI.Button.ButtonConfig;L.className="bf-combobox bf-color",L.title="é¢œè‰²",r&&(L.id="color");var A=new Glodon.Bimface.UI.Button.ComboBox(L),T=new Glodon.Bimface.UI.Button.ButtonConfig;T.className="bf-button bf-color",T.title="çº¢",r&&(T.id="red");var G=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(T);G.color=new Glodon.Web.Graphics.Color(208,2,27,1);var N=t.create("div","bf-color-button");N.setCss({backgroundColor:"#"+G.color.getHEX()}),G.setHtml(N.outerHTML),A.addControl(G);var O=new Glodon.Bimface.UI.Button.ButtonConfig;O.className="bf-button bf-color",O.title="é»„";var V=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(O);V.color=new Glodon.Web.Graphics.Color(245,166,35,1);var U=t.create("div","bf-color-button");U.setCss({backgroundColor:"#"+V.color.getHEX()}),V.setHtml(U.outerHTML),A.addControl(V);var W=new Glodon.Bimface.UI.Button.ButtonConfig;W.className="bf-button bf-color",W.title="è“";var R=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(W);R.color=new Glodon.Web.Graphics.Color(74,144,226,1);var H=t.create("div","bf-color-button");H.setCss({backgroundColor:"#"+R.color.getHEX()}),R.setHtml(H.outerHTML),A.addControl(R);var z=new Glodon.Bimface.UI.Button.ButtonConfig;z.className="bf-button bf-color",z.title="ç»¿";var F=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(z);F.color=new Glodon.Web.Graphics.Color(126,211,33,1);var j=t.create("div","bf-color-button");j.setCss({backgroundColor:"#"+F.color.getHEX()}),F.setHtml(j.outerHTML),A.addControl(F),h.addControl(A);var X=new Glodon.Bimface.UI.Button.ButtonConfig;X.className="bf-combobox",X.title="ç²—ç»†",r&&(X.id="line");var Y=new Glodon.Bimface.UI.Button.ComboBox(X),X=new Glodon.Bimface.UI.Button.ButtonConfig;X.className="bf-button bf-line",X.title="ç»†",r&&(X.id="fine");var Z=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(X);Z.lineWidth=3;var q=t.create("div","bf-line-button");q.setCss({height:Z.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-Z.lineWidth)/2+"px 4px"}),Z.element.appendChild(q),Y.addControl(Z),X.title="ä¸­";var J=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(X);J.lineWidth=6;var K=t.create("div","bf-line-button");K.setCss({height:J.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-J.lineWidth)/2+"px 4px"}),J.element.appendChild(K),Y.addControl(J),X.title="ç²—";var Q=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(X);Q.lineWidth=10;var $=t.create("div","bf-line-button");$.setCss({height:Q.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-Q.lineWidth)/2+"px 4px"}),Q.element.appendChild($),Y.addControl(Q),A.addEventListener("Change",function(e){f.setLineColor(e.color),c=e.color;c.getHEX();q.setCss({height:Z.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-Z.lineWidth)/2+"px 4px"}),K.setCss({height:J.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-J.lineWidth)/2+"px 4px"}),$.setCss({height:Q.lineWidth+"px",backgroundColor:"#"+c.getHEX(),margin:(32-Q.lineWidth)/2+"px 4px"});var t=Y.getCurrentControl();Y.setSelectedControlById(t.getId())}),Y.addEventListener("Change",function(e){f.setLineWidth(e.lineWidth)}),h.addControl(Y);var ee=new Glodon.Bimface.UI.Button.ButtonConfig;ee.className="bf-combobox bf-font-button",ee.title="å­—å·";var te=new Glodon.Bimface.UI.Button.ComboBox(ee),ie=new Glodon.Bimface.UI.Button.ButtonConfig;ie.className="bf-button bf-size",ie.title="14";var ne=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(ie);ne.fontSize=14,ne.setHtml("14"),te.addControl(ne),ie.title="18";var oe=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(ie);oe.fontSize=18,oe.setHtml("18"),te.addControl(oe),ie.title="24";var ae=new Glodon.Bimface.UI.Button.ComboBoxOptionButton(ie);ae.fontSize=24,ae.setHtml("24"),te.addControl(ae),te.addEventListener("Change",function(e){f.setFontSize(e.fontSize)}),te.hide(),h.addControl(te);var re=new Glodon.Bimface.UI.Button.ButtonConfig;re.className="bf-save",re.title=BimfaceLanguage.bf_general_save;var se=new Glodon.Bimface.UI.Button.SingleButton(re);se.setHtml(BimfaceLanguage.bf_general_save),se.addEventListener("Click",function(){r?n.fireEvent(i.Saved,{annotationList:f.getAnnotationList()}):n.fireEvent(i.Saved,{annotationList:f.getAnnotationList(),state:f.getCurrentState()}),f.endDrawing(),s.addClass("bf-hide")}),v.addControl(se);var le=new Glodon.Bimface.UI.Button.ButtonConfig;le.className="bf-cancel",le.title=BimfaceLanguage.bf_general_cancel;var ue=new Glodon.Bimface.UI.Button.SingleButton(le);ue.setHtml(BimfaceLanguage.bf_general_cancel),ue.addEventListener("Click",function(){f.endDrawing(),n.fireEvent(i.Cancelled),s.addClass("bf-hide")}),v.addControl(ue),this.getEventManager=function(){return n}};n.prototype={getEventManager:function(){return this._eventManager},addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},show:function(e,t){this.isDrawing||this._annotationManager.clear(),this._annotationManager.startDrawing(),this.domElement.removeClass("bf-hide")},getAnnotationManager:function(){return this._annotationManager},exit:function(){this.annotationToolbar.hide(),this.getAnnotationManager().exit()}},e.AnnotationToolbar=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=function(){return{viewer:null}};e.TagConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(e){var t=this,i=this._viewer=e.viewer.getViewer();if(this._opt=e,this._renderCallback=function(){t.resize()},e.minimap){this.mapHelper=e.minimap;var n=new CLOUD$1.View2dAdapter(this.mapHelper,i);this.mapHelper.setMinimapResizeCallback(function(e){t._tagHelper.updateGroupName(),t._tagHelper.updateDomContainer(),t._tagHelper.resize(e),t._tagHelper.updateByGroup()}),this.mapHelper.setPlaneChangedCallback(function(){t._tagHelper.updateGroupName(),t._tagHelper.updateByGroup()})}else{var n=new CLOUD$1.View3dAdapter(i);i.addCallbacks("render",this._renderCallback)}this._tagHelper=new CLOUD$1.Extensions.MarkerEditor(n),this._tagHelper.disableInteractions(!0),this.init()});t.prototype={init:function(){this._tagHelper.isInitialized()||this._tagHelper.init()},addTag:function(e,t){if(!e)return!1;var i=!1,n=this.getTags();e.userId=e.objectId,e.worldBoundingBox=e.boundingBox,e.worldPosition||(e.worldPosition={x:(e.worldBoundingBox.min.x+e.worldBoundingBox.max.x)/2,y:(e.worldBoundingBox.min.y+e.worldBoundingBox.max.y)/2,z:(e.worldBoundingBox.min.z+e.worldBoundingBox.max.z)/2});for(var o=0,a=n.length;o<a;o++){if(n[o].userId==e.userId)return i=!0,!1}e.floorList?this._tagHelper.setMarkerGroups(e.floorList):this._tagHelper.setMarkerGroups([]),this._tagHelper.updateGroupName(),i||this._tagHelper.createMarkerByIntersect(e,t.shape,t.image,t.size)},deleteTag:function(e,t){var i=this;if(t)return this._tagHelper.removeMarkerInGroup(e,t),!1;for(var n=this.getTags(),o=0,a=n.length;o<a;o++){var r=n[o];if(r.userId==e)return i._tagHelper.deleteMarker(r),!1}},destroy:function(){this._viewer.removeCallbacks("render",this._renderCallback),this._tagHelper.markerClickCallback=null,this.unLoadTags(),this._tagHelper.clearMarkers(),this._tagHelper=null},loadTags:function(e){this._tagHelper.loadMarkers(e)},unLoadTags:function(){this._tagHelper.unloadMarkers()},getTags:function(){return this._tagHelper.getMarkerInfoList()},getTagById:function(e){return this._tagHelper.getMarker(e)},zoomToSelectedTag:function(){this._tagHelper.zoomToSelectedMarkers()},resize:function(){this._tagHelper.onResize()},onSelected:function(e){this._tagHelper.setMarkerClickCallback(e)}},e.Tag=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=function(){return{viewer:null,maxNum:20,affectedBySection:!0}};e.DrawableContainerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=function(){return{id:null,objectId:null,tooltip:"",tooltipStyle:{},draggable:!1,worldPosition:new Glodon.Web.Geometry.Point3d(0,0,0),angle:0}};e.DrawableItemConfig=t}(),function(){var e="Bimface.Plugins.Drawable.DrawableItem",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Common.MouseButton,function(e){this.id=e.id||Glodon.Web.Lang.Utility.UUID.createUUID(),e.worldPosition?this.worldPosition=e.worldPosition:console.log("worldPosition must not be empty."),void 0!=e.viewerDrawingId&&(this.viewerDrawingId=e.viewerDrawingId),this.config=e,this.angle=e.angle,this.explosionOffset=new Vector3$1,this.explosionExtent=0});n.prototype={draw:function(e){},onClick:function(i){t.send(e,"onClick"),this._onclick=i},onRightClick:function(i){t.send(e,"onRightClick"),this._onrightclick=i},onEndDrag:function(i){t.send(e,"onEndDrag"),this._onenddrag=i},setTooltip:function(i){t.send(e,"setTooltip"),this.tipElement.querySelector("span").innerText=i},setTooltipStyle:function(i){t.send(e,"setTooltipStyle");for(var n in i)this.tipElement.style[n]=i[n]},getTooltip:function(){return this.tipElement.querySelector("span").innerText},getTooltipStyle:function(){return this.tipElement.style},getWorldPosition:function(){return this.worldPosition},setWorldPosition:function(i){t.send(e,"setWorldPosition"),this.worldPosition=i},getSize:function(){return{width:this.config.width,height:this.config.height}},hide:function(){t.send(e,"hide"),this._domElement.style.display="none",this.forceHide=!0},show:function(){t.send(e,"show"),this._domElement.style.display="",this.forceHide=!1},updateVisibility:function(){this.isHideByClustering||this.forceHide?this._domElement.style.display="none":this._domElement.style.display="block"},attachExplosionOffset:function(e,t){if(this.worldPosition){var i=this._config.objectId;if(i){var n={};n[i]=!0;var o=e.modelManager.getBoundingBoxByIds(n),a=this.assoiatedComponentBbox,r=o;if(a){var s=r.getCenter().clone();s.sub(a.getCenter().clone()),this.explosionOffset=s,this.explosionExtent>0&&0===t&&(this.worldPosition.x+=s.x,this.worldPosition.y+=s.y,this.worldPosition.z+=s.z,this.explosionExtent=0,this.explosionOffset=new Vector3$1,this.assoiatedComponentBbox=r.clone())}}else{var l=e.getScene().getOriginalBoundingBoxWorld().getCenter(),u=(new Box3).expandByPoint(this.worldPosition),c=CLOUD.Utils.computeExplodeTranslation(l,u,t);this.explosionOffset=c}}},setInitialExplosionInfo:function(e){if("Viewer3D"===e.getViewerType()){this.explosionExtent=e.getExplosionExtent();var t=this._config.objectId;if(t){var i=e.getViewer(),n={};n[t]=!0;var o=i.modelManager.getBoundingBoxByIds(n);o.isEmpty()?(this._config.objectId=null,console.log("Cannot find component with Id "+t)):this.assoiatedComponentBbox=o.clone()}}},clearExplosionOffset:function(){this.explosionOffset=new Vector3$1},getCurrentPosition:function(){return{x:this.worldPosition.x+this.explosionOffset.x,y:this.worldPosition.y+this.explosionOffset.y,z:this.worldPosition.z+this.explosionOffset.z}}},i.DrawableItem=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=function(){this.rootDomElement=t.create("div","bf-drawable-context"),this.clientPosition=null};i.prototype.destroy=function(){this.rootDomElement.parentNode&&this.rootDomElement.parentNode.removeChild(this.rootDomElement)},e.DrawableContext=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={width:32,height:32,viewer:null,opacity:.75,src:null,offsetX:0,offsetY:0};return Object.assign({},t,e)};e.ImageConfig=i}(),function(){var e="Bimface.Plugins.Drawable.Image",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=Glodon.Bimface.Plugins.Drawable.DrawableItem,o=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),a=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),r=function(e){n.call(this,e);var t=this;this.viewer=e.viewer;var i=!1,a=o.create("img","bf-drawable-image");a.draggable=!1,a.src=e.src,a.style.width=e.width+"px",a.style.height=e.height+"px",a.style.opacity=""+e.opacity,a.style.transform="rotate("+e.angle+"deg)",this._config=e,this._domElement=a,this.clientPosition={};var r,s=function(e){var n,o=t.viewer,a="Viewer3D"===o.getViewerType(),s={x:e.x-r.x+t.clientPosition.x,y:e.y-r.y+t.clientPosition.y};if(a){var l=o.pickByPoint(s);if(!l||!l.objectId)return void t.update();if(l.objectId){t._config.objectId=l.objectId;var u=o.getViewer().getComponentInfoByUserId(l.objectId);t.levelName=u&&u.userData&&u.userData.levelName,t.setInitialExplosionInfo(o),t.clearExplosionOffset(),t.needForceUpdate=!0}n=l.worldPosition}else n=o.clientToWorld(s);n?(t.worldPosition=n,t.update(),t._onenddrag&&t._onenddrag(t),i=!1):t.update()},l=function(e){r=e,i=!0};e.draggable&&o.drag({element:a,cursor:"pointer",end:s,start:l}),a.addEventListener("mouseup",function(e){var n=e||window.event;"0"==n.button&&t._onclick&&(!i||r.x==n.clientX&&r.y==n.clientY)&&t._onclick(t)}),a.addEventListener("mousedown",function(e){var i=e||window.event;i.stopPropagation(),"2"==i.button&&t._onrightclick?t._onrightclick(t):"1"==i.button&&t._onmiddleclick&&t._onmiddleclick(t)}),a.addEventListener("dblclick",function(e){var e=e||event;e.stopPropagation()})};a.Type.inheritPrototype(r,n);var s={draw:function(e){var t=this._domElement,i=this._config;this.clientPosition=e.clientPosition,t.style.left=e.clientPosition.x+i.offsetX-i.width/2+"px",t.style.top=e.clientPosition.y+i.offsetY-i.height/2+"px",e.rootDomElement.appendChild(t)},getWidth:function(){return this._config.width},setWidth:function(i){t.send(e,"setWidth");var n=this._config.width,o=this._domElement,a=(n-i)/2,r=parseInt(o.style.left);this._config.width=i,o.style.width=i+"px",o.style.left=r+a+"px"},getHeight:function(){return this._config.height},setHeight:function(i){t.send(e,"setHeight");var n=this._config.height,o=this._domElement,a=(n-i)/2,r=parseInt(o.style.top);this._config.height=i,o.style.height=i+"px",o.style.top=r+a+"px"},getOpacity:function(){return this._config.opacity},setOpacity:function(i){t.send(e,"setOpacity"),this._config.opacity=i,this._domElement.style.opacity=i},getSrc:function(){return this._config.src},setSrc:function(i){t.send(e,"setSrc"),this._config.src=i,this._domElement.src=i},getOffsetX:function(){return this._config.offsetX},setOffsetX:function(i){t.send(e,"setOffsetX");var n=this._config.offsetX,o=this._domElement,a=i-n,r=parseInt(o.style.left);this._config.offsetX=i,o.style.left=r+a+"px"},getOffsetY:function(){return this._config.offsetY},setOffsetY:function(i){t.send(e,"setOffsetY");var n=this._config.offsetY,o=this._domElement,a=i-n,r=parseInt(o.style.top);this._config.offsetY=i,o.style.top=r+a+"px"},getAngle:function(){return this.angle},setAngle:function(i){t.send(e,"setAngle"),this.angle=i,this._domElement.style.transform="rotate("+i+"deg)"}};!function(e,t){var i=t.prototype;for(var n in e)i[n]=e[n]}(s,r),i.Image=r}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={width:0,height:0,opacity:.75,content:"",offsetX:0,offsetY:0,viewer:null};return Object.assign({},t,e)};e.CustomItemConfig=i}(),function(){var e="Bimface.Plugins.Drawable.CustomItem",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins"),o=Glodon.Bimface.Plugins.Drawable.DrawableItem,a=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),r=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility");n.IE11Store={};var s=function(e){o.call(this,e);var t=!1,i=this,n=Glodon.Bimface.Viewer.ViewerDrawing&&e.viewer instanceof Glodon.Bimface.Viewer.ViewerDrawing,r=a.create("div","bf-drawable-text");r.style.width=e.width+"px",r.style.height=e.height+"px";var s=a.create("div","bf-drawable-contentwrap");r.appendChild(s),this._domElement=r,this.name="customItem",this._contentElement=s,this._config=e;var l;this.clientPosition={},this.setContent(e.content);var u=a.create("div","bf-tooltip");u.style.display="none",u.innerHTML='<div class="bf-tooltip-content"><div class="bf-tooltip-arrow"></div><div class="bf-tooltip-inner"><span>'+e.tooltip+"</span></div></div>",u.style.left=e.width+"px",u.style.top="-"+e.height+"px";var c=e.tipCSS;for(var d in c)u.style[d]=c[d];this.tipElement=u,r.appendChild(u);var h=function(e){var o,a=i.viewer,r=Glodon.Bimface.Viewer.Viewer3D&&a instanceof Glodon.Bimface.Viewer.Viewer3D,s={x:e.x-l.x+i.clientPosition.x,y:e.y-l.y+i.clientPosition.y};if(r){var u=a.getDomElement().getBoundingClientRect(),c=a.pickByPoint({x:s.x+u.left,y:s.y+u.top});if(!c||!c.objectId)return void i.update();if(c.objectId){i._config.objectId=c.objectId;var d=a.getViewer().getComponentInfoByUserId(c.objectId);i.levelName=d&&d.userData&&d.userData.levelName,i.setInitialExplosionInfo(a),i.clearExplosionOffset(),i.needForceUpdate=!0}o=c.worldPosition}else if(n){var h=a.getViewer().toWorldPoint([s.x,s.y]);o={x:h[0],y:h[1]}}else o=a.clientToWorld(s);o?(i.worldPosition=o,i.update(),i._onenddrag&&i._onenddrag(i),t=!1):i.update()},f=function(e){l=e,t=!0};e.draggable&&a.drag({element:r,cursor:"pointer",end:h,start:f}),r.style.width=e.width+"px",r.style.height=e.height+"px",r.style.opacity=""+e.opacity,r.addEventListener("mouseover",function(e){i.tipElement&&i.tipElement.querySelector("span").innerText.length>0&&(i.tipElement.style.display="block")}),r.addEventListener("mouseout",function(e){i.tipElement&&(i.tipElement.style.display="none")}),r.addEventListener("keydown",function(e){e.stopPropagation()}),r.addEventListener("mouseup",function(e){var n=e||window.event;"0"==n.button&&i._onclick&&(!t||l.x==n.clientX&&l.y==n.clientY)&&i._onclick(i)}),r.addEventListener("mousedown",function(e){var t=e||window.event;t.stopPropagation(),"2"==t.button&&i._onrightclick?i._onrightclick(i):"1"==t.button&&i._onmiddleclick&&i._onmiddleclick(i)}),r.addEventListener("dblclick",function(e){var e=e||event;e.stopPropagation()}),r.addEventListener("touchstart",function(e){(e||window.event).stopPropagation()}),r.addEventListener("touchmove",function(e){(e||window.event).stopPropagation()}),r.addEventListener("touchend",function(e){var t=e||window.event;t.stopPropagation(),i._onclick&&l.x==t.changedTouches[0].clientX&&l.y==t.changedTouches[0].clientY&&i._onclick(i)})};r.Type.inheritPrototype(s,o);var l={draw:function(e){var t=this._domElement,i=this._config;this.clientPosition=e.clientPosition,t.style.left=e.clientPosition.x+i.offsetX-i.width/2+"px",t.style.top=e.clientPosition.y+i.offsetY-i.height/2+"px",""==t.innerHTML&&(this.dom&&this.domId?t.appendChild(n.IE11Store[this.domId].cloneNode(!0)):this.text&&(t.innerText=this.text)),e.rootDomElement.contains?e.rootDomElement.contains(t)||e.rootDomElement.appendChild(t):e.rootDomElement.appendChild(t)},getWidth:function(){return this._config.width},setWidth:function(i){t.send(e,"setWidth");var n=this._config.width,o=this._domElement,a=(n-i)/2,r=parseInt(o.style.left);this._config.width=i,o.style.width=i+"px",o.style.left=r+a+"px"},getHeight:function(){return this._config.height},setHeight:function(i){t.send(e,"setHeight");var n=this._config.height,o=this._domElement,a=(n-i)/2,r=parseInt(o.style.top);this._config.height=i,o.style.height=i+"px",o.style.top=r+a+"px"},getOpacity:function(){return this._config.opacity},setOpacity:function(i){t.send(e,"setOpacity"),this._config.opacity=i,this._domElement.style.opacity=i},getContent:function(){return this._config.content||this.text},setContent:function(i){t.send(e,"setContent"),this._contentElement.innerHTML="",i instanceof HTMLElement?(i.draggable=!1,this._config.content=i,this._domElement.content=i,this.dom=i,this.domId||(this.domId=Glodon.Web.Lang.Utility.UUID.createUUID()),n.IE11Store[this.domId]=i.cloneNode(!0),this._contentElement.appendChild(i)):(this._contentElement.innerHTML=i,this.text=i,this._config.content="")},getOffsetX:function(){return this._config.offsetX},setOffsetX:function(i){t.send(e,"setOffsetX");var n=this._config.offsetX,o=this._domElement,a=i-n,r=parseInt(o.style.left);this._config.offsetX=i,o.style.left=r+a+"px"},getOffsetY:function(){return this._config.offsetY},setOffsetY:function(i){t.send(e,"setOffsetY");var n=this._config.offsetY,o=this._domElement,a=i-n,r=parseInt(o.style.top);this._config.offsetY=i,o.style.top=r+a+"px"}};!function(e,t){var i=t.prototype;for(var n in e)i[n]=e[n]}(l,s),i.CustomItem=s}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e,i={text:null,viewer:null,containerCss:(e={boxSizing:"border-box",fontSize:"12px",lineHeight:1.5,borderWidth:"2px",borderStyle:"solid",padding:"5px",borderColor:"#1f93ff",backgroundColor:"#eeeeee"},_defineProperty(e,"padding","2px 8px"),_defineProperty(e,"opacity",.9),e),lineCss:{width:"1px",color:"#1f93ff"},pointCss:{radius:4,backgroundColor:"#1f93ff",borderColor:"#ffffff",borderStyle:"solid",borderWidth:"1px"},offset:{x:27,y:-47},height:26,width:140};return Object.assign({},t,i)};e.LeadLabelConfig=i}(),function(){var e="Bimface.Plugins.Drawable.LeadLabel",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=Glodon.Bimface.Plugins.Drawable.DrawableItem,o=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),a=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),r=function(e){n.call(this,e)
;var t=this,i=o.create("div","bf-drawable-lead-label"),a=o.create("div","bf-drawable-lead-label-textarea");i.appendChild(a);var r=o.createNS("line","bf-drawable-lead-line"),s=o.createNS("line","bf-drawable-lead-line"),l=o.createNS("circle","bf-drawable-lead-point"),u=o.createNS("g","bf-drawable-group"),c=e.viewer;t._text=e.text,this.name="LeadLabel",this.isAssociateComponentHide=!1,i.setCss(e.containerCss),a.innerText=t._text.replace(/\n/g," "),i.style.width=parseFloat(e.width)+"px",i.style.height=parseFloat(e.height)+"px";var d=Math.trunc((e.height-8)/18);a.style.webkitLineClamp=d||1,s.setAttribute("stroke-width",e.lineCss.width),s.style.stroke=e.lineCss.color,r.setAttribute("stroke-width",e.lineCss.width),r.style.stroke=e.lineCss.color,l.setAttribute("r",e.pointCss.radius),l.style.fill=e.pointCss.backgroundColor,l.setAttribute("stroke-width",e.pointCss.borderWidth),l.style.stroke=e.pointCss.borderColor,s.setAttribute("x1",0),s.setAttribute("y1",0-e.offset.y+18),s.setAttribute("x2",e.offset.x),s.setAttribute("y2",18),r.setAttribute("x1",e.offset.x),r.setAttribute("y1",18),r.setAttribute("x2",e.offset.x+23),r.setAttribute("y2",18),l.setAttribute("cx",0),l.setAttribute("cy",18-e.offset.y);var h,f=function(e){h=e},g=function(i){var n={x:i.x-h.x+t.clientPosition.x,y:i.y-h.y+t.clientPosition.y};u.setAttribute("transform","translate("+n.x+","+(n.y+e.offset.y-18)+")")},v=function(e){var i=c instanceof Glodon.Bimface.Viewer.Viewer3D,n=c.getDomElement().getBoundingClientRect(),o={x:e.x-h.x+t.clientPosition.x+n.left,y:e.y-h.y+t.clientPosition.y+n.top};if(i){var a=c.pickByPoint(o);if(a){if(t.setWorldPosition(a.worldPosition),t.associateComponentById(a.objectId),a.objectId){t._config.objectId=a.objectId;var r=c.getViewer().getComponentInfoByUserId(a.objectId);t.levelName=r&&r.userData&&r.userData.levelName,t.needForceUpdate=!0}t.setInitialExplosionInfo(c),t.clearExplosionOffset()}c.render()}else{var s=c.clientToWorld(o);s&&t.setWorldPosition(s),c.update()}t._dragEnd&&t._dragEnd()};e.draggable&&o.drag({element:i,cursor:"pointer",start:f,move:g,end:v}),i.addEventListener("mousedown",function(e){var e=e||event;e.stopPropagation()}),i.addEventListener("click",function(e){var e=e||event;e.stopPropagation(),t._click&&t._click(t)}),i.addEventListener("contextmenu",function(e){t._rightClick&&t._rightClick(t)}),i.addEventListener("dblclick",function(e){var e=e||event;e.stopPropagation(),t._doubleClick&&t._doubleClick(t)}),i.addEventListener("mouseenter",function(e){a.innerText=t._text;var n=i.offsetHeight;i.addClass("bf-drawable-show"),a.addClass("bf-drawable-show"),n>i.offsetHeight&&(i.removeClass("bf-drawable-show"),a.removeClass("bf-drawable-show"))}),i.addEventListener("mouseleave",function(e){a.innerText=t._text.replace(/\n/g," "),i.removeClass("bf-drawable-show"),a.removeClass("bf-drawable-show")}),u.appendChild(s),u.appendChild(r),u.appendChild(l),t._objectId=e.objectId,t._container=i,t._domTextArea=a,t._svgGroup=u,t._config=e,t._offset=e.offset};a.Type.inheritPrototype(r,n),r.prototype=Object.assign({},n.prototype,{draw:function(e,t){var i=this._container,n=this._svgGroup,a=this._offset,r=this._config.viewer,s=this._objectId;if(r&&s){var l=r.getComponentStatus(s);if("hidden"==l||"translucent"==l)return this.hide(),void(this.isAssociateComponentHide=!0);this.isAssociateComponentHide&&(this.show(),this.isAssociateComponentHide=!1)}this.clientPosition=e.clientPosition,i.style.left=e.clientPosition.x+a.x+23+"px",i.style.top=e.clientPosition.y+a.y-18+"px",n.setAttribute("transform","translate("+e.clientPosition.x+","+(e.clientPosition.y+a.y-18)+")"),e.domContainer||(e.domContainer=o.create("div","bf-drawable-container"),e.rootDomElement.appendChild(e.domContainer)),e.svgContainer||(e.svgContainer=o.createNS("svg","bf-drawable-svg"),e.rootDomElement.appendChild(e.svgContainer)),this.isShow("default"==t),e.rootDomElement.contains?e.domContainer.contains(i)||(e.domContainer.appendChild(i),e.svgContainer.appendChild(n)):(e.domContainer.appendChild(i),e.svgContainer.appendChild(n))},hide:function(){t.send(e,"hide"),this.forceHide=!0,this._container.style.display="none",this._svgGroup.style.display="none"},show:function(){t.send(e,"show"),this.forceHide=!1,this._container.style.display="",this._svgGroup.style.display=""},onClick:function(i){t.send(e,"onClick"),i&&(this._click=i)},onRightClick:function(i){t.send(e,"onRightClick"),i&&(this._rightClick=i)},onDoubleClick:function(e){e&&(this._doubleClick=e)},onEndDrag:function(i){t.send(e,"onEndDrag"),i&&(this._dragEnd=i)},getText:function(){return this._text},setText:function(i){t.send(e,"setText"),this._domTextArea.innerText=i,this._text=i},getOpacity:function(){return this._container.style.opacity},setOpacity:function(i){t.send(e,"setOpacity"),this._container.style.opacity=i},getHeight:function(){return parseFloat(this._container.style.height)},setHeight:function(i){t.send(e,"setHeight"),this._container.style.height=parseFloat(i)+"px";var n=Math.trunc((i-8)/18);this._domTextArea.style.webkitLineClamp=n||1},getWidth:function(){return parseFloat(this._container.style.width)},setWidth:function(i){t.send(e,"setWidth"),this._container.style.width=parseFloat(i)+"px"},getObjectId:function(){return this._objectId},associateComponentById:function(e){this._objectId=e},clearAssociation:function(){this._objectId=null},isShow:function(e){var t=this._container,i=this._svgGroup;e?(t.removeClass("bf-drawable-mini"),i.removeClass("bf-drawable-mini-svg")):(t.addClass("bf-drawable-mini"),i.addClass("bf-drawable-mini-svg"))}}),i.LeadLabel=r}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={minimap:null,floorList:[],height:20,width:20,objectId:"",src:"",worldPosition:null,viewer:null};return Object.assign({},t,e)};e.MiniTagConfig=i}(),function(){var e="Bimface.Plugins.Drawable.MiniTag",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=Glodon.Bimface.Plugins.Drawable.DrawableItem,o=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility")),a=function e(t){n.call(this,t);var i=this,o=this._viewer=t.viewer.getViewer();if(this.miniTagConfig=t,this._config=t,i.worldPosition=t.worldPosition.clone(),this._renderCallback=function(){i.resize()},t.minimap){this.mapHelper=t.minimap;var a=new Glodon.Bimface.Marker.View2dAdapter(this.mapHelper,o);this.mapHelper.setMinimapResizeCallback(function(t){a.resize(t),e._tagHelper.updateGroupName(),e._tagHelper.updateDomContainer(),e._tagHelper.resize(t),e._tagHelper.updateByGroup()}),this.mapHelper.setPlaneChangedCallback(function(){e._tagHelper.updateGroupName(),e._tagHelper.updateByGroup()});var s={Floor_Plane_Changed_For_Panel:3001,ZOOM_MOUSE_WHEEL:6e3,PAN_MOUSE_MOVE:7e3};this.mapHelper.viewerFloor.addEventListener(s.ZOOM_MOUSE_WHEEL,function(e){var t=e.data;i.zoomAndPan(t.offsetX,t.offsetY,t.zoomFactor)}),this.mapHelper.viewerFloor.addEventListener(s.PAN_MOUSE_MOVE,function(e){var t=e.data;i.zoomAndPan(t.offsetX,t.offsetY,t.zoomFactor)}),this.mapHelper.viewerFloor.addEventListener(s.Floor_Plane_Changed_For_Panel,function(e){var t=i.mapHelper.viewerFloor,n=t.getPanOffset();i.zoomAndPan(n.x,n.y,t.vfData.zoomFactor)})}else{var a=new Glodon.Bimface.Marker.View3dAdapter(o);o.addCallbacks("render",this._renderCallback)}void 0==e._tagHelper&&(e._tagHelper=new MarkerEditor(a),e._tagHelper.disableInteractions(!0)),r()},r=function(){a._tagHelper.isInitialized()||a._tagHelper.init()},s=function(e,t){if(!e)return!1;var i=!1,n=a._tagHelper.getMarkerInfoList();e.userId=e.objectId;for(var o=0,r=n.length;o<r;o++){if(n[o].id==e.id)return i=!0,!1}e.floorList?a._tagHelper.setMarkerGroups(e.floorList):a._tagHelper.setMarkerGroups([]),a._tagHelper.updateGroupName(),i||a._tagHelper.createMarkerByIntersect(e,t.shape,t.image,t.size)},l=function(e){for(var t=a._tagHelper.getMarkerInfoList(),i=0,n=t.length;i<n;i++){var o=t[i];o.id==e&&a._tagHelper.deleteMarker(o)}};a.clear=function(){a._tagHelper&&a._tagHelper.clearMarkers()},o.Type.inheritPrototype(a,n),a.prototype=Object.assign({},n.prototype,{draw:function(){var e=this,t=this.miniTagConfig,i={id:this.id,objectId:t.objectId,worldPosition:t.worldPosition,floorList:t.floorList},n={shape:2,image:t.src,size:{width:t.width,height:t.height}};s(i,n);var o=e.mapHelper.viewerFloor,a=o.getPanOffset();e.zoomAndPan(a.x,a.y,o.vfData.zoomFactor)},show:function(){t.send(e,"show"),a._tagHelper.setVisible(this.id,!0)},hide:function(){t.send(e,"hide"),a._tagHelper.setVisible(this.id,!1)},getFloorList:function(){return this.miniTagConfig.floorList},setFloorList:function(i){t.send(e,"setFloorList"),this.miniTagConfig.floorList=i,l(this.id),this.draw()},getHeight:function(){return this.miniTagConfig.height},setHeight:function(i){t.send(e,"setHeight"),this.miniTagConfig.height=i,l(this.id),this.draw()},getId:function(){return this.id},getObjectId:function(){return this.miniTagConfig.objectId},setObjectId:function(i){t.send(e,"setObjectId");var n=this.miniTagConfig;l(this.id),n.objectId=i,this.draw()},getSrc:function(){return this.miniTagConfig.src},setSrc:function(i){t.send(e,"setSrc"),this.miniTagConfig.src=i,l(this.id),this.draw()},getWidth:function(){return this.miniTagConfig.width},setWidth:function(i){t.send(e,"setWidth"),this.miniTagConfig.width=i,l(this.id),this.draw()},getWorldPosition:function(){return this.miniTagConfig.worldPosition},setWorldPosition:function(i){t.send(e,"setWorldPosition"),this.miniTagConfig.worldPosition=i,l(this.id),this.draw()},onClick:function(i){t.send(e,"onClick"),a._tagHelper.setMarkerClickCallback(i)},onRightClick:function(i){t.send(e,"onRightClick"),a._tagHelper.setMarkerRightClickCallback(i)},onEndDrag:function(i){t.send(e,"onEndDrag")},zoomAndPan:function(e,t,i){a._tagHelper.zoomAndPanMarkerById(this.id,e,t,i)}}),i.MiniTag=a}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=new Glodon.Bimface.Plugins.Drawable.DrawableItemConfig,i=function(){var e={width:47,height:50,content:"",src:null,offsetX:0,offsetY:0};return Object.assign({},t,e)};e.ClusterTagConfig=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),t=Glodon.Bimface.Plugins.Drawable.DrawableItem,i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),o=function(e){t.call(this,e),this.includedTags=[],this.clusterBbox=null;var n=i.create("div","bf-drawable-cluster");n.style.position="absolute",n.style.width=e.width+"px",n.style.height=e.height+"px";var o=i.create("img","bf-drawable-cluster-image");o.src=e.src,o.style.width=e.width+"px",o.style.height=e.height+"px",o.style.position="absolute",n.appendChild(o);var a=i.create("div","bf-drawable-cluster-textarea");a.innerText=e.content,n.appendChild(a),this.forceHide=!1,this._config=e,this._domTextArea=a,this._container=n,this.hookEvents()};n.Type.inheritPrototype(o,t);var a={hookEvents:function(){var e=this._container,t=this;this.isMouseDown=!1,e.addEventListener("mouseup",function(e){t.isMouseDown=!1}),e.addEventListener("mousemove",function(e){t.isMouseDown||t.onHoverCallback&&t.onHoverCallback({id:t.id,position:t.worldPosition,includedTags:t.getIncluded(),boundingBox:t.clusterBbox})}),e.addEventListener("mousedown",function(e){(e||window.event).stopPropagation(),t.isMouseDown=!0,t.onClickCallback&&t.onClickCallback({id:t.id,position:t.worldPosition,includedTags:t.getIncluded(),boundingBox:t.clusterBbox})})},draw:function(e){var t=this._container,i=this._config;t.style.left=e.clientPosition.x+i.offsetX-i.width/2+"px",t.style.top=e.clientPosition.y+i.offsetY-i.height/2+"px",e.rootDomElement.appendChild(t)},getText:function(){return this._domTextArea.innerText},setText:function(e){this._domTextArea.innerText=e},updateText:function(){var e=this.getIncluded().length;e<=99?this.setText(e.toString()):this.setText("99+")},show:function(){this._container.style.display="block",this.forceHide=!1},hide:function(){this._container.style.display="none",this.forceHide=!0},onClick:function(e){this.onClickCallback=e},onHover:function(e){this.onHoverCallback=e},include:function(e){this.includedTags.push(e)},setBoundingBox:function(e){this.clusterBbox=e},getIncluded:function(){return this.includedTags},getContainer:function(){return this._container},hideIncludedTags:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.includedTags[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.isHideByClustering=!0}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}},showIncludedTags:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.includedTags[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.isHideByClustering=!1}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}},getCurrentPosition:function(){return{x:this.worldPosition.x,y:this.worldPosition.y,z:this.worldPosition.z}}};!function(e,t){var i=t.prototype;for(var n in e)i[n]=e[n]}(a,o),e.ClusterTag=o}(),function(){var e="Bimface.Plugins.Drawable.DrawableContainer",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Drawable"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Bimface.Plugins.Drawable.ClusterTag),o=function(e){var t=this,i=this,n=e.viewer;if(n.drawableContainer)return n.drawableContainer;n.drawableContainer=this;var o=Glodon.Bimface.Viewer.ViewerDrawing&&n instanceof Glodon.Bimface.Viewer.ViewerDrawing,a=Glodon.Bimface.Viewer.Viewer3D&&n instanceof Glodon.Bimface.Viewer.Viewer3D,r=Glodon.Bimface.Viewer.ViewerDrawingSet&&n instanceof Glodon.Bimface.Viewer.ViewerDrawingSet,s=new Glodon.Web.Lang.EventManager,l=new Glodon.Bimface.Plugins.Drawable.DrawableContext;if(this.bIsEnableMinitagUpdate=!0,n.addEventListener("Rendered",function(e){i.bIsEnableMinitagUpdate=!1,i.update(e),i.bIsEnableMinitagUpdate=!0}),o){n.getRootElement().appendChild(l.rootDomElement)}else if(r){var u=n.getActiveDrawing();u.viewerDrawing.getRootElement().appendChild(l.rootDomElement)}else{if(n.getDomElement().appendChild(l.rootDomElement),e.affectedBySection){if(n.addEventListener(Glodon.Bimface.Plugins.Section.SectionBoxEvent.SectionBoxUpdate,function(e){i.section=e,i.update()}),n.addEventListener(Glodon.Bimface.Plugins.Section.SectionPlaneEvent.SectionPlaneUpdate,function(e){i.section=e,i.update()}),n.floorData){var c;!function(){t.floorInfos=n.floorData;var e=t.floorInfos,o=e.floorInfos.length,a=[];for(c=0;c<o;c++)!function(){var t=e.floorInfos[c];n.getFloorBoundingBoxById(t.id,function(e){a.push({box:e,floorName:t.name,explodedOffset:t.explodedHeight-t.elevation}),a.length==o&&(i.boxs=a)})}()}()}n.addEventListener(Glodon.Bimface.Viewer.Viewer3DEvent.FloorExplosion,function(e){if(0===n.getFloorExplosionExtent()){var t=!0,o=!1,a=void 0;try{for(var r,s=i.getAllItems()[Symbol.iterator]();!(t=(r=s.next()).done);t=!0)r.value.setInitialExplosionInfo(n)}catch(e){o=!0,a=e}finally{try{!t&&s.return&&s.return()}finally{if(o)throw a}}}var l=e.floorInfos.length,u=[];i.floorInfos=e;if(l)for(var c=0;c<l;c++){var d=e.floorInfos[c],h=e.floorInfos[c+1],f=e.floorInfos[c-1];u.push({box:{min:f?d.boundingBox.min.z:-1/0,max:h?h.boundingBox.min.z:1/0},floorName:d.name,explodedOffset:d.explodedHeight-d.elevation}),u.length==l&&(!function(){for(var e=i._items,t=0,n=e.length;t<n;t++){var o=e[t].getWorldPosition();if(o)if(e[t].levelName){var a=u.getObjectByAttribute("floorName",e[t].levelName);a&&(e[t].explosionOffset={x:0,y:0,z:a.explodedOffset})}else{for(var r=!0,s=0;s<u.length;s++){var l=u[s];if(l.box.min<o.z&&l.box.max>o.z){e[t].explosionOffset={x:0,y:0,z:l.explodedOffset},e[t].levelName=l.floorName,r=!1;break}}r&&(e[t].explosionOffset={x:0,y:0,z:0})}}}(),i.boxs=u)}})}var d=n.getViewer();d.registerEventListener(CLOUD.EVENTS.ON_EXPLOSION,function(e){for(var i=t.getAllItems(),n=0,o=i.length;n<o;n++)i[n]instanceof Glodon.Bimface.Plugins.Drawable.MiniTag||i[n].attachExplosionOffset(d,e.extent)})}i._items=[],i._viewer=n,i._context=l,i._isDrawingView=o,i._isDrawingViewSet=r,i._isViewer3D=a,i._maxNum=e.maxNum,i.getEventManager=function(){return s}};o.prototype={addItem:function(i){t.send(e,"addItem");var n=this._items,o=this._viewer;if(i.viewer=o,i.update=this.update.bind(this),i.worldPosition){if(i instanceof Glodon.Bimface.Plugins.Drawable.MiniTag)n.push(i),this.update();else{var a=this.ifExploded(i);a&&("Viewer3D"===this._viewer.getViewerType()&&a.setInitialExplosionInfo(this._viewer),n.push(a),this.update())}}},getLevelNameById:function(e,t){for(var i=this._areaData,n=this,o=0;o<i.length;o++){var a=i[o];if(a.rooms){if(a.rooms.getObjectByAttribute("id",e))return a.name}}if(!this._spatialRelation){var r=new Glodon.Bimface.Plugins.SpatialRelation.RoomConfig;r.viewer=this._viewer;var s=new Glodon.Bimface.Plugins.SpatialRelation.Room(r);this._spatialRelation=s}var l=this._spatialRelation.getBoundaryByRoomId(e);if(l){if(this._levelsInfo)return function(e,t){for(var i=e[0][2],n=0;n<t.length;n++)if(Math.abs(i-t[n].elevation)<5)return t[n].name;return!1}(l,n._levelsInfo);this._viewer.getMapInfo(function(e){n._levelsInfo=e.axisGrid.Levels,n.addItem(t)})}},ifExploded:function(e){var t=this;if(this.floorInfos&&!this._levelsInfo){for(var i=this.floorInfos.floorInfos,n=[],o=0;o<i.length;o++){var a=i[o];n.push({name:a.name,elevation:a.elevation})}this._levelsInfo=n}var r=function(){if(t.floorInfos){var i=e.worldPosition;if(e.levelName){var n=t.boxs.getObjectByAttribute("floorName",e.levelName);if(n){var o={x:i.x,y:i.y,z:i.z-n.explodedOffset};e.explosionOffset={x:0,y:0,z:n.explodedOffset},e.worldPosition=o}}else for(var a=t.boxs,r=0;r<a.length;r++){var s=a[r],l=s.box.max+s.explodedOffset,u=s.box.min+s.explodedOffset;if(i.z<u){e.explosionOffset={x:0,y:0,z:i.z-s.box.min},e.worldPosition=Object.assign({},i,{z:s.box.min});break}if(i.z<l&&i.z>u){e.explosionOffset={x:0,y:0,z:s.explodedOffset},e.worldPosition=Object.assign({},i,{z:i.z-s.explodedOffset}),e.levelName=s.floorName;break}}}return e};if(!e._config.objectId)return r();var s=this._viewer.getViewer().getComponentInfoByUserId(e._config.objectId);if(s)return e.levelName=s.userData&&s.userData.levelName,r();if(this._areaData){var l=this.getLevelNameById(e._config.objectId,e);if(l)return e.levelName=l,r()}else this._viewer.getAreas(function(i){t._areaData=i,t.addItem(e)})},removeItemById:function(i){t.send(e,"removeItemById");var n=this._items,o=n.removeObjectByAttribute("id",i);o=o&&o[0];var a=o._domElement||o._container;o&&this._context.rootDomElement.contains(a)&&a.remove(),o._svgGroup&&this._context.svgContainer.contains(o._svgGroup)&&this._context.svgContainer.removeChild(o._svgGroup),this.update()},getItemById:function(e){return this._items.getObjectByAttribute("id",e)},getAllItems:function(){return this._items},addItems:function(i){if(t.send(e,"addItems"),i.length)for(var n=0;n<i.length;n++)i[n].update=this.update.bind(this);if("Viewer3D"===this._viewer.getViewerType()){var o=!0,a=!1,r=void 0;try{for(var s,l=i[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value,c=this.ifExploded(u);c&&this._items.push(c),u.setInitialExplosionInfo(this._viewer)}}catch(e){a=!0,r=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw r}}}this.update()},clear:function(){t.send(e,"clear"),this._items=[],this._context.rootDomElement.innerHTML="",this._context.domContainer=null,this._context.svgContainer=null,this.update()},update:function(){var e=this._items,t=this._viewer,i=this._context,n=this._maxNum,o=document.body.getBoundingClientRect(),a=Glodon.Bimface.Plugins.Drawable.MiniTag;if(this.bIsEnableMinitagUpdate&&a.clear(),this._isDrawingView&&(t=t.getViewer()),this._isDrawingView)for(var r=0,s=e.length;r<s;r++){var l=e[r].getWorldPosition();if(l)if(e[r]instanceof Glodon.Bimface.Plugins.Drawable.ClusterTag){var u=t.toScreenPoint([l.x,l.y]);i.clientPosition={x:u[0],y:u[1]},e[r].draw(i)}else{var c=t.toScreenPoint([l.x,l.y]),d=e[r]._domElement.offsetWidth/2,h=e[r]._domElement.offsetHeight/2;if(e[r].isHideByClustering)e[r]._domElement.style.display="none";else{if(c[0]<-d||c[0]>o.width+d||c[1]<-h||c[1]>o.height+h){e[r]._domElement.style.display="none";continue}e[r]._domElement.style.display="block"}i.clientPosition={x:c[0],y:c[1]},e[r].draw(i)}}else if(this._isDrawingViewSet)for(var f=0,g=e.length;f<g;f++){var v=e[f].getWorldPosition(),m=t.getDrawingById(e[f].viewerDrawingId),c=m.viewerDrawing.worldToClient(v);if(i.clientPosition=c,e[f]instanceof Glodon.Bimface.Plugins.Drawable.ClusterTag){var p=t.toScreenPoint([v.x,v.y]);i.clientPosition={x:p[0],y:p[1]},e[f].draw(i)}else e[f].updateVisibility(),e[f].draw(i)}else{for(var y=0,w=e.length;y<w;y++){var b=e[y];b.needForceUpdate&&(b=this.ifExploded(b),b.needForceUpdate=!1);var C=b.getCurrentPosition();b.clientPosition=t.worldToClient(C);var x=b._container||b._domElement,E=b._svgGroup;if(b instanceof Glodon.Bimface.Plugins.Drawable.MiniTag||t.isInViewFrustum(C)){if(this.section&&!this.section.isIncluded(C)||b.forceHide||b.isHideByClustering){x&&(x.style.display="none"),E&&(E.style.display="none");continue}x&&(x.style.display=""),E&&(E.style.display="")}else x&&(x.style.display="none"),E&&(E.style.display="none")}e.sort(function(e,t){return e.clientPosition.z>t.clientPosition.z?1:-1});for(var P=0;P<e.length;P++){var k="default";P>=n&&(k="mini"),i.clientPosition=e[P].clientPosition;var M=e[P]instanceof Glodon.Bimface.Plugins.Drawable.MiniTag;M&&0==this.bIsEnableMinitagUpdate||e[P].draw(i,k)}}},exit:function(){t.send(e,"exit"),this.clear(),this._context.destroy()},hideItemsById:function(i){t.send(e,"hideItemsById");var n=this;if(i&&i.length>0)for(var o=0;o<i.length;o++){var a=n.getItemById(i[o]);a&&a.hide()}},hideAllItems:function(){t.send(e,"hideAllItems");var i=this,n=i._items;if(n&&n.length>0)for(var o=0;o<n.length;o++)n[o].hide()},showItemsById:function(i){t.send(e,"showItemsById");var n=this;if(i&&i.length>0)for(var o=0;o<i.length;o++){var a=n.getItemById(i[o]);a&&a.show()}},showAllItems:function(){t.send(e,"showAllItems");var i=this,n=i._items;if(n&&n.length>0)for(var o=0;o<n.length;o++)n[o].show()},removeClusterTags:function(e){for(var t=this.getAllItems(),i=t.length-1;i>=0;){var o=t[i];if(o instanceof n&&o.clusterItemId===e){t.splice(i--,1);var a=o.getContainer();this._context.rootDomElement.contains(a)&&a.remove()}else i--}}},i.DrawableContainer=o}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Cluster"),t=function(){return{viewer:null}};e.ClusterContainerConfig=t}(),function(){var e="Bimface.Plugins.Cluster",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Cluster")),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"ClusterContainer"),this.viewer=n.viewer,this.isViewer3D="Viewer3D"===n.viewer.getViewerType(),this.clusterItems=[],this.hookEvents(n.viewer)}return _createClass(i,[{key:"hookEvents",value:function(e){var t=e.getViewerType();"Viewer3D"===t?this.hookViewer3DEvents():"ViewerDrawing"===t?this.hookViewerDrawingEvents():this.hookViewerDrawingSetEvents()}},{key:"hookViewer3DEvents",value:function(){var e=this,t=this.viewer.getViewer(),i=[];i.push(CLOUD.EVENTS.ON_EDITOR_ZOOM),i.push(CLOUD.EVENTS.ON_EDITOR_PANING),i.push(CLOUD.EVENTS.ON_EDITOR_ROTATING),i.push(CLOUD.EVENTS.ON_EDITOR_WALKING),i.push(CLOUD.EVENTS.ON_CAMERA_ANIMATION_UPDATE);var n=!0,o=!1,a=void 0;try{for(var r,s=i[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;t.registerEventListener(l,function(){e.update()})}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}t.registerEventListener(CLOUD.EVENTS.ON_EXPLOSION,function(){e.update(!0)}),this.viewer.addEventListener(Glodon.Bimface.Viewer.Viewer3DEvent.FloorExplosion,function(){e.update(!0)})}},{key:"hookViewerDrawingEvents",value:function(){var e=this,t=Glodon.Bimface.Viewer.ViewerDrawingEvent;this.viewer.addEventListener(t.ZoomFactorChanged,function(){e.update()})}},{key:"hookViewerDrawingSetEvents",value:function(){var e=this,t=Glodon.Bimface.Viewer.ViewerDrawingSetEvent;this.viewer.addEventListener(t.ZoomFactorChanged,function(){e.update()})}},{key:"addCluster",value:function(e){this.clusterItems.push(e)}},{key:"addClusters",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;this.addCluster(r)}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"getClusterById",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=this.clusterItems[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;if(r.getId()===e)return r}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}return null}},{key:"getClusters",value:function(){return this.clusterItems}},{key:"removeClustersById",value:function(e){for(var t=this.clusterItems,i=t.length-1;i>=0;){var n=t[i];e.indexOf(n.id)>=0?(n.clearClusterTags(),t.splice(i--,1)):i--}}},{key:"clear",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.clusterItems[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.clearClusterTags()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this.clusterItems=[]}},{key:"update",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=this.clusterItems[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;if(this.isViewer3D){if(0===r.calcClusterLevel()){r.clearClusterTags();continue}}(e||r.isNeedClustering())&&r.clustering(),r.updateClusterTags()}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}}]),i}();i.ClusterContainer=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Cluster"),t=function(){return{tags:[],distance:50,maxLevel:4,style:null,minClusterSize:2,viewer:null}};e.ClusterItemConfig=t}();var ClusterItem3DImpl=function(){function e(t){_classCallCheck(this,e),this.viewer3d=t.viewer,this.currentLevel=0,this._maxLevel=t.maxLevel,this._minClusterSize=t.minClusterSize}return _createClass(e,[{key:"prepareTagPositions",value:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i].getCurrentPosition(),o=new Vector3$1(n.x,n.y,n.z);o.index=i,t.push(o)}return t}},{key:"calcSearchRange",value:function(e){return this.currentLevel=this.calcClusterLevel(e),this.getSearchRangeScalar(this.currentLevel,this.getMaxLevel())*this.getLength(e)[1]}},{key:"getSearchRangeScalar",value:function(e,t){return Math.pow(.5,t-e)}},{key:"calcClusterLevel",value:function(e){for(var t=this.getLength(e),i=this.getMaxLevel(),n=20*t[1]/t[2],o=t[0]*n/t[1],a=Math.exp(Math.log(40)/(i-1)),r=-1,s=i;s>=1;s--)if(o>=.5*Math.pow(a,s-1)){r=s;break}return-1===r&&(r=0),r}},{key:"getLength",value:function(e){var t=this.prepareTagPositions(e),i=this.viewer3d.getCameraStatus().position;i=new Vector3$1(i.x,i.y,i.z);var n=(new Box3).setFromPoints(t),o=n.getSize().length(),a=i.distanceTo(n.getCenter()),r=.995*this.getCameraMaxRange(),s=[];return s.push(a),s.push(o),s.push(r),s}},{key:"getCameraMaxRange",value:function(){var e=this.viewer3d.getViewer(),t=e.camera,i=e.getBoundingBoxWorld(),n=i.getSize().length(),o=.5*n/Math.tan(THREE.Math.degToRad(.5*t.fov));return e.cameraControl.getMaximalRangeofCamera()*o}},{key:"setMaxLevel",value:function(e){this._maxLevel=e}},{key:"getMaxLevel",value:function(){return this._maxLevel}},{key:"getMinClusterSize",value:function(){return this._minClusterSize}},{key:"setMinClusterSize",value:function(e){this._minClusterSize=e}},{key:"isLevelChanged",value:function(e){return this.calcClusterLevel(e)!==this.currentLevel}},{key:"cullingByFrustum",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;this.viewer3d.isInViewFrustum(r.worldPosition)?r.show():r.hide()}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"getBoundingbox",value:function(e){return e.bbox}},{key:"getCenter",value:function(e){return e.center}},{key:"setDistance",value:function(){console.log("ClusterItem3D doesn't support setDistance.")}},{key:"getDistance",value:function(){console.log("ClusterItem3D doesn't support getDistance.")}}]),e}(),ClusterItemDrawingImpl=function(){function e(t){_classCallCheck(this,e),this.viewerDrawing=t.viewer,this.searchRange=t.distance,this._minClusterSize=t.minClusterSize}return _createClass(e,[{key:"prepareTagPositions",value:function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i].getWorldPosition();n=this.viewerDrawing.worldToClient(n);var o=new Vector3$1(n.x,n.y,n.z);o.index=i,t.push(o)}return t}},{key:"calcSearchRange",value:function(e){return this.searchRange}},{key:"isLevelChanged",value:function(){return!0}},{key:"setDistance",value:function(e){this.searchRange=e}},{key:"getDistance",value:function(){return this.searchRange}},{key:"setMaxLevel",value:function(e){console.log("Drawing clustering has no maxlevel.")}},{key:"getMaxLevel",value:function(){console.log("Drawing clustering has no maxLevel.")}},{key:"getMinClusterSize",value:function(){return this._minClusterSize}},{key:"setMinClusterSize",value:function(e){this._minClusterSize=e}},{key:"cullingByFrustum",value:function(){}},{key:"getBoundingbox",value:function(e){return e}},{key:"getCenter",value:function(e){var t=e.center;return this.viewerDrawing.clientToWorld(t)}}]),e}();!function(){var e="Bimface.Plugins.Cluster",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Cluster")),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"ClusterItem"),this.viewer=n.viewer;var o="Viewer3D"===n.viewer.getViewerType();this.impl=o?new ClusterItem3DImpl(n):new ClusterItemDrawingImpl(n),this.id=Glodon.Web.Lang.Utility.UUID.createUUID(),this.setTags(n.tags),this._isVisible=!0,this.clusterTags=[],this._mapTagIsExist={},this._isNeedClustering=!0,this._isNeedMakingClusterTag=!0}return _createClass(i,[{key:"getId",value:function(){return this.id}},{key:"getTags",value:function(){return this._tags}},{key:"addTags",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];i instanceof Glodon.Bimface.Plugins.Drawable.MiniTag||!0!==this._mapTagIsExist[i.id]&&(this._tags.push(i),this._mapTagIsExist[i.id]=!0)}this._isNeedClustering=!0}},{key:"getMinClusterSize",value:function(){return this.impl.getMinClusterSize()}},{key:"setMinClusterSize",value:function(e){"number"==typeof e&&e>0?(this.impl.setMinClusterSize(e),this._isNeedClustering=!0):console.log("Invalid param, please input valid param.")}},{key:"setTags",value:function(e){if(0!==e.length){if(this._tags){var t=!0,i=!1,n=void 0;try{for(var o,a=this._tags[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.isHideByClustering=!1}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}this._tags=[],this._mapTagIsExist={},this.addTags(e)}}},{key:"removeTagsByIds",value:function(e){for(var t=this._tags.length-1;t>=0;){var i=this._tags[t];e.indexOf(i.id)>=0?(this._tags.splice(t--,1),delete this._mapTagIsExist[i.id],i.isHideByClustering=!1):t--}this._isNeedClustering=!0}},{key:"setDistance",value:function(e){this.impl.setDistance(e)}},{key:"getDistance",value:function(){return this.impl.getDistance()}},{key:"getMaxLevel",value:function(){return this.impl.getMaxLevel()}},{key:"setMaxLevel",value:function(e){this.impl.setMaxLevel(e),this._isNeedClustering=!0}},{
key:"onClick",value:function(e){this.onClickCallback=e;var t=!0,i=!1,n=void 0;try{for(var o,a=this.clusterTags[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.onClick(this.onClickCallback)}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"onHover",value:function(e){this.onHoverCallback=e;var t=!0,i=!1,n=void 0;try{for(var o,a=this.clusterTags[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.onClick(this.onHoverCallback)}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.clusterTags[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}for(var a=0;a<this._tags.length;a++)this._tags[a].isHideByClustering=!0;this._getContainer().update(),this._isVisible=!1}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.clusterTags[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.show()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this._isVisible=!0,this.clustering(),this.updateClusterTags()}},{key:"clustering",value:function(){if(!1!==this._isVisible){var e=this.getTags(),t=!0,i=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.isHideByClustering=!1}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}var r=this.impl.calcSearchRange(this.getTags()),s=this.impl.prepareTagPositions(this.getTags());this.meanShift=new Glodon.Web.Algorithm.MeanShift(s,r),this.meanShift.clustering(),this._isNeedClustering=!1,this._isNeedMakingClusterTag=!0}}},{key:"updateClusterTags",value:function(){if(!1!==this._isVisible)if(this.isNeedMakingClusterTag())this.makeClusterTags(),!1===this._isVisible&&this.hide(),this._isNeedMakingClusterTag=!1;else if(this._isVisible)return this.impl.cullingByFrustum(this.clusterTags),void this._getClusterContainer().update()}},{key:"makeClusterTags",value:function(){for(var e=this,t=0;t<this._tags.length;t++)this._tags[t].isHideByClustering=!1;this.clusterTags=[];var n=!0,o=!1,a=void 0;try{for(var r,s=this.meanShift.clusters[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value,u=this._getIndices(l);if(!(u.length<this.impl.getMinClusterSize())){var c=i.makeClusterTag(this.impl.getCenter(l)),d=!0,h=!1,f=void 0;try{for(var g,v=u[Symbol.iterator]();!(d=(g=v.next()).done);d=!0){var m=g.value,p=this._tags[m];p.isHideByClustering=!0,c.include(p),c.setBoundingBox(this.impl.getBoundingbox(l))}}catch(e){h=!0,f=e}finally{try{!d&&v.return&&v.return()}finally{if(h)throw f}}c.clusterItemId=this.id,this.onClickCallback&&c.onClick(this.onClickCallback),this.onHoverCallback&&c.onHover(this.onHoverCallback),this.clusterTags.push(c)}}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}this.impl.cullingByFrustum(this.clusterTags),this._getClusterContainer().removeClusterTags(this.id),this._getClusterContainer().addItems(this.clusterTags),this._getContainer().update(),setTimeout(function(){var t=!0,i=!1,n=void 0;try{for(var o,a=e.clusterTags[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)o.value.updateText()}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}},10)}},{key:"clearClusterTags",value:function(){for(var e=0;e<this._tags.length;e++)this._tags[e].isHideByClustering=!1;this._getClusterContainer().removeClusterTags(this.id),this._getContainer().update()}},{key:"calcClusterLevel",value:function(){return this.impl.calcClusterLevel(this.getTags())}},{key:"_getClusterContainer",value:function(){var e=this.viewer.drawableContainer;if(!e){var t=new Glodon.Bimface.Plugins.Drawable.DrawableContainerConfig;t.viewer=this.viewer,e=new Glodon.Bimface.Plugins.Drawable.DrawableContainer(t)}return e}},{key:"isNeedClustering",value:function(){return this._isNeedClustering||this.impl.isLevelChanged(this.getTags())}},{key:"isNeedMakingClusterTag",value:function(){return this._isNeedMakingClusterTag}},{key:"_getContainer",value:function(){return this._tags[0]instanceof Glodon.Bimface.Plugins.Marker3D.Marker3D?this.viewer.marker3DContainer:this.viewer.drawableContainer}},{key:"_getIndices",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var a,r=e.points[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value;t.push(s.index)}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}return t}}]),i}();n.makeClusterTag=function(e){var t=new Glodon.Bimface.Plugins.Drawable.ClusterTagConfig;return t.src=window.bimfaceStaticHost+"/images/cluster.png",t.worldPosition=e,new Glodon.Bimface.Plugins.Drawable.ClusterTag(t)},i.ClusterItem=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=function(){return{viewer:null,measureType:Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance,color:new Glodon.Web.Graphics.Color(249,157,11,1),hoverColor:new Glodon.Web.Graphics.Color(17,218,183,.2),width:3,radius:25,snapDistance:5,precision:0,scale:1,lengthUnits:Glodon.Bimface.Plugins.Measure.LengthUnits.None}};e.MeasureConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=Object.freeze({Measuring:"Measuring",Measured:"Measured",Reset:"Reset",MeasureSelected:"MeasureSelected",MeasureUnselected:"MeasureUnselected"});e.MeasureEvent=t}(),function(){var e=Object.freeze({Distance:"Distance",Area:"Area",Angle:"Angle",MinimumDistance:"MinimumDistance",Elevation:"Elevation"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure").MeasureTypeOption=e}(),function(){var e=Object.freeze({None:"None",Kilometer:"Kilometer",Meter:"Meter",Centimeter:"Centimeter",Millimeter:"Millimeter"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure").LengthUnits=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=function(){return{id:null,color:new Glodon.Web.Graphics.Color(249,157,11,1),hoverColor:new Glodon.Web.Graphics.Color(17,218,183,.2),objectColor:new Glodon.Web.Graphics.Color(17,218,183,.9),width:3,radius:25,viewer:null}};e.MeasureItemConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),new Glodon.Web.Graphics.Color(17,218,183,.2),function(e){this.id=e.id||Glodon.Web.Lang.Utility.UUID.createUUID(),this.measurePoints=[],this.maxPointsNum=2,this.isReserverd=!1});t.prototype={draw:function(e){},reset:function(){if(this._svg){for(var e=this._svg.childNodes,t=e.length,i=t-1;i>-1;i--)this._svg.removeChild(e[i]);this._svg.innerHTML=""}},addPoint:function(e){if(this.measurePoints.length==this.maxPointsNum)this.measurePoints=[],this.reset();else if(this.measurePoints.length>0){var t=this.measurePoints.length,i=this.measurePoints[t-1];if(e.x===i.x&&e.y===i.y&&e.z===i.z)return}this.measurePoints.push(e),this.setIsReserverd(!1)},redo:function(){this.measurePoints.length>0&&this.measurePoints.length<this.maxPointsNum?this.measurePoints.pop():this.measurePoints=[]},getPoints:function(){return this.measurePoints},setIsReserverd:function(e){this.isReserverd=e},getIsReserverd:function(){return this.isReserverd}},e.MeasureItem=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=new Glodon.Web.Graphics.Color(17,218,183,.2),o=function(e){t.MeasureItem.call(this,e),this.maxPointsNum=2,this.measurePoints=[];var o=e.color.getRGBA(),a=i.createNS("circle","bf-measure-handle");a.setAttribute("stroke-width",0);var r=a.cloneNode();a.setAttribute("r",5),a.setAttribute("stroke","#FFFFFF"),a.setAttribute("stroke-width",2),a.setAttribute("fill",o),a.style.fill=o;var s=a.cloneNode();r.setAttribute("r",e.width),r.setAttribute("fill",n.getRGB()),r.style.fill=n.getRGB();var l=i.createNS("line","bf-measure-line"),u=l.cloneNode();u.style.strokeWidth=2;var c=u.cloneNode();u.setAttribute("stroke-dasharray","6,4");var d=u.cloneNode(),h=u.cloneNode();l.style.strokeWidth=e.width,l.style.stroke=e.color.getRGBA(),c.style.stroke=n.getRGB(),u.style.stroke="#CC021B",d.style.stroke="#7CCF21",h.style.stroke="#4A90E2",l.setAttribute("stroke-width",e.width);var f=i.createNS("polygon","bf-measure-rect");f.setAttribute("fill",n.getRGBA()),f.setAttribute("stroke",n.getRGB()),f.setAttribute("stroke-width",1),this.line=l,this.lineX=u,this.lineY=d,this.lineZ=h,this.hoverLine=c,this.startPoint=a,this.endPoint=s,this.hoverPoint=r,this.hoverPanel=f,this.hoverPanelSize={width:20,height:20}};e.Type.inheritPrototype(o,t.MeasureItem);var a={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.line,i=this.lineX,n=this.lineY,o=this.lineZ,a=this.hoverLine,r=this.startPoint,s=this.endPoint,l=this.hoverPoint,u=this.hoverPanel,c=this.hoverPanelSize;switch(this._svg=e.svg,e.hoverObjectType){case"Point":l.setAttribute("cx",e.hoverPosition.x),l.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(l);break;case"Line":a.setAttribute("x1",e.lineStartPoint.x),a.setAttribute("y1",e.lineStartPoint.y),a.setAttribute("x2",e.lineEndPoint.x),a.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(a);break;case"Panel":var d=e.clientPts,h=d[0].distanceTo(d[1]),f=d[0].distanceTo(d[3]),g=h/c.width,v=f/c.height;if(1!=g){var m=this.stretchOnDirection(d[0],d[1],c.width),p=this.stretchOnDirection(d[2],d[3],c.width);d=m.concat(p)}if(1!=v){var m=this.stretchOnDirection(d[0],d[3],c.height),p=this.stretchOnDirection(d[1],d[2],c.height);d=[m[0],p[0],p[1],m[1]]}for(var y="",w=0;w<d.length;w++)y+=d[w].x+",",y+=d[w].y+" ";u.setAttribute("points",y),e.svg.appendChild(u)}if(!this.getIsReserverd())switch(e.clientPoints.length){case 2:var b=e.auxLines[0],C=e.auxLines[1],x=e.auxLines[2];b&&(i.setAttribute("x1",b.start.x),i.setAttribute("y1",b.start.y),i.setAttribute("x2",b.end.x),i.setAttribute("y2",b.end.y),e.svg.appendChild(i)),C&&(n.setAttribute("x1",C.start.x),n.setAttribute("y1",C.start.y),n.setAttribute("x2",C.end.x),n.setAttribute("y2",C.end.y),e.svg.appendChild(n)),x&&(o.setAttribute("x1",x.start.x),o.setAttribute("y1",x.start.y),o.setAttribute("x2",x.end.x),o.setAttribute("y2",x.end.y),e.svg.appendChild(o)),r.setAttribute("cx",e.clientPoints[1].x),r.setAttribute("cy",e.clientPoints[1].y),s.setAttribute("cx",e.clientPoints[0].x),s.setAttribute("cy",e.clientPoints[0].y),t.setAttribute("x1",e.clientPoints[0].x),t.setAttribute("y1",e.clientPoints[0].y),t.setAttribute("x2",e.clientPoints[1].x),t.setAttribute("y2",e.clientPoints[1].y),e.svg.appendChild(r),e.svg.appendChild(s),e.svg.appendChild(t);break;case 1:r.setAttribute("cx",e.clientPoints[0].x),r.setAttribute("cy",e.clientPoints[0].y);this.getPoints().length!=this.maxPointsNum&&e.hoverPosition&&(t.setAttribute("x1",e.clientPoints[0].x),t.setAttribute("y1",e.clientPoints[0].y),t.setAttribute("x2",e.hoverPosition.x),t.setAttribute("y2",e.hoverPosition.y),e.svg.appendChild(t)),e.svg.appendChild(r)}}};o.prototype=Object.assign(o.prototype,a),t.MeasureDistanceItem=o}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=new Glodon.Web.Graphics.Color(17,218,183,.2),o=function(e){t.MeasureItem.call(this,e),this.maxPointsNum=3,this.radius=e.radius,this.measurePoints=[];var o=e.color.getRGBA(),a=i.createNS("circle","bf-measure-handle");a.setAttribute("stroke-width",0);var r=a.cloneNode();a.setAttribute("r",5),a.setAttribute("stroke","#FFFFFF"),a.setAttribute("stroke-width",2),a.setAttribute("fill",o),a.style.fill=o;var s=a.cloneNode(),l=a.cloneNode();r.setAttribute("r",e.width),r.setAttribute("fill",n.getRGB()),r.style.fill=n.getRGB();var u=i.createNS("path","bf-measure-angle");u.setAttribute("fill","rgba(0,0,0,0)"),u.setAttribute("stroke",o),u.setAttribute("stroke-width",e.width);var c=i.createNS("line","bf-measure-line"),d=c.cloneNode();c.style.strokeWidth=e.width,c.style.stroke=o,c.setAttribute("stroke-width",e.width);var h=c.cloneNode();d.setAttribute("fill","rgba(0,0,0,0)"),d.setAttribute("stroke",n.getRGB()),d.setAttribute("stroke-width",2);var f=i.createNS("polygon","bf-measure-rect");f.setAttribute("fill",n.getRGBA()),f.setAttribute("stroke",n.getRGB()),f.setAttribute("stroke-width",1);var g=i.create("span","bf-measure-number");g.style.backgroundColor=e.color.getRGBA(),this.points=[a,s,l],this.lines=[c,h],this.hoverLine=d,this.angleLine=u,this.hoverPoint=r,this.hoverPanel=f,this.hoverPanelSize={width:20,height:20},this.text=g};e.Type.inheritPrototype(o,t.MeasureItem);var a={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.points,i=this.lines,n=this.hoverLine,o=this.angleLine,a=this.hoverPoint,r=this.hoverPanel;this._svg=e.svg;var s=this.hoverPanelSize;switch(e.hoverObjectType){case"Point":a.setAttribute("cx",e.hoverPosition.x),a.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(a);break;case"Line":n.setAttribute("x1",e.lineStartPoint.x),n.setAttribute("y1",e.lineStartPoint.y),n.setAttribute("x2",e.lineEndPoint.x),n.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(n);break;case"Panel":var l=e.clientPts,u=l[0].distanceTo(l[1]),c=l[0].distanceTo(l[3]),d=u/s.width,h=c/s.height;if(1!=d){var f=this.stretchOnDirection(l[0],l[1],s.width),g=this.stretchOnDirection(l[2],l[3],s.width);l=f.concat(g)}if(1!=h){var f=this.stretchOnDirection(l[0],l[3],s.height),g=this.stretchOnDirection(l[1],l[2],s.height);l=[f[0],g[0],g[1],f[1]]}for(var v="",m=0;m<l.length;m++)v+=l[m].x+",",v+=l[m].y+" ";r.setAttribute("points",v),e.svg.appendChild(r)}if(!this.getIsReserverd()){for(var m=0,p=e.clientPoints.length;m<p;m++)e.clientPoints[m]&&(t[m].setAttribute("cx",e.clientPoints[m].x),t[m].setAttribute("cy",e.clientPoints[m].y),e.svg.appendChild(t[m]));switch(e.clientPoints.length){case 3:i[0].setAttribute("x1",e.clientPoints[0].x),i[0].setAttribute("y1",e.clientPoints[0].y),i[0].setAttribute("x2",e.clientPoints[1].x),i[0].setAttribute("y2",e.clientPoints[1].y),i[1].setAttribute("x1",e.clientPoints[1].x),i[1].setAttribute("y1",e.clientPoints[1].y),i[1].setAttribute("x2",e.clientPoints[2].x),i[1].setAttribute("y2",e.clientPoints[2].y);var y=this.radius,w=function(e,t,i,n){var e=new THREE.Vector2(e.x,e.y),t=new THREE.Vector2(t.x,t.y),i=new THREE.Vector2(i.x,i.y),o=1,a=e.sub(t),r=i.sub(t);if(a.length()<n||r.length()<n)return!1;a.setLength(n),r.setLength(n);var s=a.angle(),l=r.angle(),u=180*(l-s)/Math.PI;return u<0&&(u+=360),o=u<180?1:0,{pointA:t.clone().add(a),pointB:t.clone().add(r),flag:1,direction:o}}(e.clientPoints[0],e.clientPoints[1],e.clientPoints[2],y);w&&(o.setAttribute("d","M "+w.pointA.x+" "+w.pointA.y+" A "+y+" "+y+" 0 0 "+w.direction+" "+w.pointB.x+" "+w.pointB.y),e.svg.appendChild(o)),e.svg.appendChild(i[1]),e.svg.appendChild(i[0]);break;case 2:i[0].setAttribute("x1",e.clientPoints[0].x),i[0].setAttribute("y1",e.clientPoints[0].y),i[0].setAttribute("x2",e.clientPoints[1].x),i[0].setAttribute("y2",e.clientPoints[1].y),e.svg.appendChild(i[0]);var b=this.getPoints().length!=this.maxPointsNum;b&&e.hoverPosition&&(i[1].setAttribute("x1",e.clientPoints[1].x),i[1].setAttribute("y1",e.clientPoints[1].y),i[1].setAttribute("x2",e.hoverPosition.x),i[1].setAttribute("y2",e.hoverPosition.y),e.svg.appendChild(i[1]));break;case 1:var b=this.getPoints().length!=this.maxPointsNum;b&&e.hoverPosition&&(i[0].setAttribute("x1",e.clientPoints[0].x),i[0].setAttribute("y1",e.clientPoints[0].y),i[0].setAttribute("x2",e.hoverPosition.x),i[0].setAttribute("y2",e.hoverPosition.y),e.svg.appendChild(i[0]))}}}};o.prototype=Object.assign(o.prototype,a),t.MeasureAngleItem=o}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=function(e){t.MeasureItem.call(this,e),this.maxPointsNum=2,this.measurePoints=[],this.opt=e,this.minDistanceLine=null,this.svgContainer=i.createNS("svg","bf-minDistanceMeasure-svg"),this.startPoint=i.createNS("circle","bf-minDistanceMeasure-handle"),this.endPoint=i.createNS("circle","bf-minDistanceMeasure-handle"),this.line=i.createNS("line","bf-minDistanceMeasure-line")};e.Type.inheritPrototype(n,t.MeasureItem);var o={draw:function(e){},setMinDistanceLine:function(e){this.minDistanceLine=e},clearMinDistanceLine:function(){var e=this.startPoint;e.parentNode&&this.svgContainer.removeChild(e);var t=this.endPoint;t.parentNode&&this.svgContainer.removeChild(t);var i=this.line;i.parentNode&&this.svgContainer.removeChild(i)},addPoint:function(e){var t=this.opt.viewer;this.opt.objectColor;this.measurePoints.length==this.maxPointsNum&&this.reset(),-1==this.measurePoints.indexOf(e)&&(this.measurePoints.push(e),t.addSelectedComponentsById([e]),t.render())},reset:function(e){var t=this.opt.viewer;!1!==e&&t.removeSelectedId(this.measurePoints),this.measurePoints=[],this.clearMinDistanceLine(),this.minDistanceLine=null,t.render()},redo:function(){var e=this.opt.viewer;if(this.measurePoints.length>0&&this.measurePoints.length<this.maxPointsNum){var t=this.measurePoints.pop();e.removeSelectedId([t]),e.render()}else this.reset()}};n.prototype=Object.assign(n.prototype,o),t.MeasureMinimumDistanceItem=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=function(e){t.MeasureItem.call(this,e),this.viewer=e.viewer,this.maxPointsNum=1;var n=new Glodon.Web.Graphics.Color(17,218,183,.2),o=i.createNS("circle","bf-measure-handle");o.setAttribute("r",e.width),o.setAttribute("fill",n.getRGB()),o.style.fill=n.getRGB();var a=i.createNS("line","bf-measure-line");a.style.strokeWidth=2,a.style.stroke=n.getRGB();var r=i.createNS("polygon","bf-measure-rect");r.setAttribute("fill",n.getRGBA()),r.setAttribute("stroke",n.getRGB()),r.setAttribute("stroke-width",1),this.hoverLine=a,this.hoverPoint=o,this.hoverPanel=r,this.hoverPanelSize={width:20,height:20}};e.Type.inheritPrototype(n,t.MeasureItem);var o={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.hoverLine,i=this.hoverPoint,n=this.hoverPanel,o=this.hoverPanelSize;switch(e.hoverObjectType){case"Point":i.setAttribute("cx",e.hoverPosition.x),i.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(i);break;case"Line":t.setAttribute("x1",e.lineStartPoint.x),t.setAttribute("y1",e.lineStartPoint.y),t.setAttribute("x2",e.lineEndPoint.x),t.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(t);break;case"Panel":var a=e.clientPts,r=a[0].distanceTo(a[1]),s=a[0].distanceTo(a[3]),l=r/o.width,u=s/o.height;if(1!=l){var c=this.stretchOnDirection(a[0],a[1],o.width),d=this.stretchOnDirection(a[2],a[3],o.width);a=c.concat(d)}if(1!=u){var c=this.stretchOnDirection(a[0],a[3],o.height),d=this.stretchOnDirection(a[1],a[2],o.height);a=[c[0],d[0],d[1],c[1]]}for(var h="",f=0;f<a.length;f++)h+=a[f].x+",",h+=a[f].y+" ";n.setAttribute("points",h),e.svg.appendChild(n)}}};n.prototype=Object.assign(n.prototype,o),t.MeasureElevationItem=n}();var MeasureUtil=function e(){_classCallCheck(this,e)};MeasureUtil.xmlns="http://www.w3.org/2000/svg",MeasureUtil.makeCircle=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"circle");return t.style.fill=e.color,t.setAttribute("r",e.radius+""),t.setAttribute("stroke","#FFFFFF"),t.setAttribute("stroke-width",2),t.setAttribute("transform","translate("+e.position.x+","+e.position.y+")"),t},MeasureUtil.makeLine=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"line");return t.setAttribute("stroke",e.color),t.setAttribute("stroke-width",e.lineWidth),t.setAttribute("x1",e.start.x+""),t.setAttribute("y1",e.start.y+""),t.setAttribute("x2",e.end.x+""),t.setAttribute("y2",e.end.y+""),t},MeasureUtil.makePath=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"path"),i=e.info;return t.setAttribute("d","M "+i.pointA.x+" "+i.pointA.y+" A "+e.arcRadius+" "+e.arcRadius+" 0 0 "+i.direction+" "+i.pointB.x+" "+i.pointB.y),t.setAttribute("fill","rgba(0,0,0,0)"),t.setAttribute("stroke",e.color),t.setAttribute("stroke-width",e.lineWidth),t},MeasureUtil.makePolyline=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"polyline");return t.setAttribute("stroke",e.color),t.setAttribute("stroke-width",e.width),t.style.fill=e.fillColor||"none",t.setAttribute("points",e.points),t},MeasureUtil.calcPolylinePoints=function(e){for(var t="",i=0;i<e.length;i++)t+=e[i].x+","+e[i].y+" ";return t},MeasureUtil.makeRectangle=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"rect");return t.setAttribute("stroke-width",2),t.setAttribute("x",e.x),t.setAttribute("y",e.y),t.setAttribute("width",e.width),t.setAttribute("height",e.height),t.setAttribute("rx",e.radius),t.style.fill=e.fillColor||"none",t.setAttribute("stroke",e.strokeColor||"none"),t},MeasureUtil.makeText=function(e){var t=document.createElementNS(MeasureUtil.xmlns,"text");return t.setAttribute("x",e.x),t.setAttribute("y",e.y),t.setAttribute("fill",e.color||"#000"),t.setAttribute("font-size",e.fontsize),t.textContent="  ",t},MeasureUtil.makeDefs=function(){return document.createElementNS(this.xmlns,"defs")},MeasureUtil.measureText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:'14px "Microsoft YaHei',i=document.createElement("canvas"),n=i.getContext("2d");return n.font=t,n.measureText(e).width},MeasureUtil.distanceToSegment=function(e,t,i){var n=t.distanceToSquared(i);if(0==n)return e.distanceTo(t);var o=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;o=Math.max(0,Math.min(1,o));var a=new Vector2$1;return a.x=t.x+o*(i.x-t.x),a.y=t.y+o*(i.y-t.y),e.distanceTo(a)},MeasureUtil.isPointInPolygon=function(e,t){for(var i=0,n=t.length,o=0;o<n;o++){var a=t[o],r=t[(o+1)%n];if(a.y!=r.y&&!(e.y<Math.min(a.y,r.y)||e.y>=Math.max(a.y,r.y))){(e.y-a.y)*(r.x-a.x)/(r.y-a.y)+a.x>e.x&&i++}}return i%2==1};var MeasureNotation=function(){function e(){_classCallCheck(this,e),this.defaultColor="#F99D0B",this.observer=null,this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.notationSegment={},this.notationOutline=null,this.annotationStyle={height:21,radius:4},this.hitTestEpsilon=this.annotationStyle.height/2}},{key:"drawAnnotation",value:function(e,t,i){var n=this.calcAnnotationStyle(e,i,t),o=MeasureUtil.makeRectangle({x:n.offsetRect.x,y:n.offsetRect.y,width:n.width,height:this.annotationStyle.height,radius:this.annotationStyle.radius,fillColor:this.defaultColor});this.notationWithoutOutline=o;var a=MeasureUtil.makeRectangle({x:n.offsetRect.x-2,y:n.offsetRect.y-2,width:n.width+4,height:this.annotationStyle.height+4,radius:this.annotationStyle.radius,strokeColor:"#FFFFFF",fillColor:this.defaultColor});this.notationOutline=a,this.segmentStart=new Vector2$1(n.offsetRect.x,n.offsetRect.y+this.annotationStyle.height/2),this.segmentEnd=new Vector2$1(n.offsetRect.x+n.width,this.segmentStart.y);var r=MeasureUtil.makeText({x:n.offsetText.x,y:n.offsetText.y,color:"#FFFFFF",fontsize:14});return r.textContent=i,this.svgGroup=[],this.svgGroup.push(o),this.svgGroup.push(a),this.svgGroup.push(r),this.unselect(),this.svgGroup}},{key:"calcAnnotationStyle",value:function(e,t,i){var n=0,o=new Vector2$1(i.x,i.y),a=new Vector2$1(i.x,i.y);return"Elevation"!==e&&(n=MeasureUtil.measureText(t),o.x-=n/2,o.y-=this.annotationStyle.height/2,a.x=o.x+5,a.y=o.y+19-3.5),"Elevation"==e&&(o.x-=12,o.y-=39,a.x=o.x+5,a.y=o.y+19-3.5,n=MeasureUtil.measureText(t)),n+=10,{offsetRect:o,offsetText:a,width:n}}},{key:"select",value:function(){this.isInitialized()&&(this.notationWithoutOutline.style.display="none",this.notationOutline.style.display="block")}},{key:"unselect",value:function(){this.isInitialized()&&(this.notationWithoutOutline.style.display="block",this.notationOutline.style.display="none")}},{key:"dropShadow",value:function(e){this.isInitialized()&&(this.notationWithoutOutline.setAttribute("filter",e),this.notationOutline.setAttribute("filter",e))}},{key:"isInitialized",value:function(){return!!this.notationWithoutOutline&&!!this.notationOutline}},{key:"hitTest",value:function(e){if(!this.isInitialized())return!1;var t=this.hitTestEpsilon;return MeasureUtil.distanceToSegment(e,this.segmentStart,this.segmentEnd)<=t}}]),e}(),MeasureDrawable=function(){function e(t){_classCallCheck(this,e),this.id=t,this.isShow=!0,this.type="",this.xmlns="http://www.w3.org/2000/svg",this.defaultColor="#F99D0B",this.svgGroup=[],this.lineWidth="3",this.radius=5,this.hitTestEpsilon=10,this.hitTestSegments=[],this.selectElements=[],this.unSelectElements=[],this.elementsOnTop=[],this.isSelected=!0,this.notation=new MeasureNotation,this.measureParams={precision:0,scale:1,unit:"None"}}return _createClass(e,[{key:"getSvgGroup",value:function(){return this.svgGroup}},{key:"getId",value:function(){return this.id}},{key:"getType",value:function(){return this.type}},{key:"setViewer",value:function(e){this.viewer=e}},{key:"clear",value:function(){this.detach(),this.svgGroup=[]}},{key:"detach",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.svgGroup[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value,r=a.parentNode;r&&r.removeChild(a)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var s=!0,l=!1,u=void 0;try{for(var c,d=this.elementsOnTop[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value,r=h.parentNode;r&&r.removeChild(h)}}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}}},{key:"attach",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=this.svgGroup[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;e.appendChild(r)}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"calcLine",value:function(e,t){var i=[],n=this.viewer.getViewer(),o=this.viewer.getDomElement().getBoundingClientRect(),a=n.worldPointsToClient(e,t);if(a){var e=new Vector2$1(a.start.x-o.left,a.start.y-o.top),t=new Vector2$1(a.end.x-o.left,a.end.y-o.top);i.push(e,t)}return i}},{key:"calcTerminalLines",value:function(e,t,i){if(0===e.length)return[];var n=[],o=e[0],a=e[1],r=o.clone().sub(a).normalize(),s=r.clone().multiplyScalar(i).add(o).rotateAround(o.clone(),t),l=r.clone().multiplyScalar(i).add(o).rotateAround(o.clone(),-t);n.push({start:s,end:l}),r=r.multiplyScalar(-1);var u=r.clone().multiplyScalar(i).add(a).rotateAround(a.clone(),t),c=r.clone().multiplyScalar(i).add(a).rotateAround(a.clone(),-t);return n.push({start:u,end:c}),n}},{key:"select",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.selectElements[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="none"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var a=!0,r=!1,s=void 0;try{for(var l,u=this.unSelectElements[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){l.value.style.display="block"}}catch(e){r=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw s}}this.notation.select(),this.isSelected=!0}},{key:"unselect",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.selectElements[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="block"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var a=!0,r=!1,s=void 0;try{for(var l,u=this.unSelectElements[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){l.value.style.display="none"}}catch(e){r=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw s}}this.notation.unselect(),this.isSelected=!1}},{key:"getIsSelected",value:function(){return this.isSelected}},{key:"actionWhenSelected",value:function(){}},{key:"actionWhenUnselected",value:function(){}},{key:"dropShadow",value:function(e){this.notation.dropShadow(e)}},{key:"setMeasureParams",value:function(e){this.measureParams.precision=e.precision,this.measureParams.scale=e.scale,this.measureParams.unit=e.unit,this.measureParams.defaultUnit=e.defaultUnit}},{key:"show",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.svgGroup[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="block"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var a=!0,r=!1,s=void 0;try{for(var l,u=this.elementsOnTop[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){l.value.style.display="block"}}catch(e){r=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw s}}this.isShow=!0}},{key:"hide",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.svgGroup[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.style.display="none"}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var a=!0,r=!1,s=void 0;try{for(var l,u=this.elementsOnTop[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){l.value.style.display="none"}}catch(e){r=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw s}}this.isShow=!1}},{key:"getNotation",value:function(){return this.notation}},{key:"hitTest",value:function(e){for(var t=this.hitTestEpsilon,i=0;i<this.hitTestSegments.length-1;i++){if(MeasureUtil.distanceToSegment(e,this.hitTestSegments[i],this.hitTestSegments[i+1])<=t)return!0}return!1}}]),e}(),Viewer3dDistance=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i));return n.filterUrl=e.filterUrl,n.type=e.type,n.worldPositions=e.points,n.measureResult=e.distance,n.selectElements=[],n.unSelectElements=[],n.setMeasureParams({precision:e.precision,scale:e.scale,unit:e.lengthUnits,defaultUnit:e.defaultUnit}),n}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this.calcLine(this.worldPositions[0],this.worldPositions[1]);this.hitTestSegments=e;var t=this.calAuxLines(),i=this.calcTerminalLines(e,Math.PI/2,6.5);this.attachSingleLine(e),this.attachTerminalLines(i);var n=["#CC021B","#7CCF21","#4A90E2"];this.attachAuxLines(t,n),this.attachTerminalPoints([t[0].start,t[2].end]);var o={x:(this.worldPositions[0].x+this.worldPositions[1].x)/2,y:(this.worldPositions[0].y+this.worldPositions[1].y)/2,z:(this.worldPositions[0].z+this.worldPositions[1].z)/2},a=this.viewer.worldToClient(o);this.viewer.isInViewFrustum(o)&&(this.attachNotation([a,a]),this.notation.dropShadow(this.filterUrl),this.unselect())}},{key:"attachTerminalPoints",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value,s=MeasureUtil.makeCircle({position:r,radius:this.radius,color:this.defaultColor});this.svgGroup.push(s),s.setAttribute("filter",this.filterUrl),this.unSelectElements.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"attachSingleLine",value:function(e){if(0!==e.length){var t=MeasureUtil.makeLine({start:e[0],end:e[1],color:this.defaultColor,lineWidth:this.lineWidth});this.svgGroup.push(t)}}},{key:"attachTerminalLines",value:function(e){if(0!==e.length)for(var t=0;t<2;t++){var i=MeasureUtil.makeLine({start:e[t].start,end:e[t].end,
color:this.defaultColor,lineWidth:2});this.selectElements.push(i),this.svgGroup.push(i)}}},{key:"attachAuxLines",value:function(e,t){var i=0,n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value,u=MeasureUtil.makeLine({start:l.start,end:l.end,color:this.defaultColor,lineWidth:this.lineWidth});u.setAttribute("stroke-dasharray","6,4"),u.style.stroke=t[i++],this.unSelectElements.push(u),this.svgGroup.push(u)}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}}},{key:"attachNotation",value:function(e){if(0!==e.length){var t=this.notation.drawAnnotation("Distance",{x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},this.getMeasureResult(),this.id),i=!0,n=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value;this.svgGroup.push(s)}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}}}},{key:"calAuxLines",value:function(){for(var e=this.worldPositions,t=this.viewer.getDomElement().getBoundingClientRect(),i={x:e[1].x,y:e[0].y,z:e[0].z},n={x:e[1].x,y:e[1].y,z:e[0].z},o=[],a=[e[0],i,n,e[1]],r=this.viewer.getViewer(),s=0;s<a.length-1;s++){var l=r.worldPointsToClient(a[s],a[s+1]);if(l)l.start.x-=t.left,l.start.y-=t.top,l.end.x-=t.left,l.end.y-=t.top;else{l={start:{x:-1,y:-1},end:{x:-1,y:-1}}}o.push(l)}return o}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult.toString(),i=MeasureResultFormat.formatDistance(t,this.measureParams);return i+=MeasureResultFormat.getPostFix(e,!1),i.split(",").join("")}}]),t}(MeasureDrawable),Viewer3dAngle=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i));return n.filterUrl=e.filterUrl,n.type=e.type,n.worldPositions=e.points,n.measureAngle=e.angle,n.setMeasureParams({precision:e.precision}),n}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this.calcLine(this.worldPositions[0],this.worldPositions[1]),t=this.calcLine(this.worldPositions[1],this.worldPositions[2]),i=[];e.length>0&&i.push(e[0],e[1]),t.length>0&&(i.length>0?i.push(t[1]):i.push(t[0],t[1])),this.hitTestSegments=i;for(var n=0;n<i.length-1;n++){var o=MeasureUtil.makeLine({start:i[n],end:i[n+1],color:this.defaultColor,lineWidth:this.lineWidth});this.svgGroup.push(o)}for(var a=0;a<i.length;a++){var r=MeasureUtil.makeCircle({position:i[a],radius:this.radius,color:this.defaultColor});this.unSelectElements.push(r),this.svgGroup.push(r),r.setAttribute("filter",this.filterUrl)}var s=this.getPoint(i[0],i[1],i[2]);if(!s)return void this.unselect();var l=MeasureUtil.makePath({color:this.defaultColor,lineWidth:this.lineWidth,arcRadius:25,info:s});this.svgGroup.push(l);var u=new Vector2((s.pointA.x+s.pointB.x)/2,(s.pointA.y+s.pointB.y)/2),c=new Vector2(i[1].x,i[1].y),d=u.clone().sub(c).normalize().multiplyScalar(35);u=c.clone().add(d);var h=this.notation.drawAnnotation("Angle",u,this.getMeasureResult(),this.id),f=!0,g=!1,v=void 0;try{for(var m,p=h[Symbol.iterator]();!(f=(m=p.next()).done);f=!0){var y=m.value;this.svgGroup.push(y)}}catch(e){g=!0,v=e}finally{try{!f&&p.return&&p.return()}finally{if(g)throw v}}this.notation.dropShadow(this.filterUrl),this.unselect()}},{key:"getPoint",value:function(e,t,i){if(!e||!t||!i)return!1;var e=new Vector2(e.x,e.y),t=new Vector2(t.x,t.y),i=new Vector2(i.x,i.y),n=1,o=e.sub(t),a=i.sub(t);if(o.length()<25||a.length()<25)return!1;o.setLength(25),a.setLength(25);var r=o.angle(),s=a.angle(),l=180*(s-r)/Math.PI;return l<0&&(l+=360),n=l<180?1:0,{pointA:t.clone().add(o),pointB:t.clone().add(a),flag:1,direction:n}}},{key:"getMeasureResult",value:function(){var e=(this.measureParams.unit,this.measureAngle.toString());return MeasureResultFormat.formatPrecision(e,this.measureParams.precision).split(",").join("")+"Â°"}}]),t}(MeasureDrawable),Viewer3dElevation=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i));return n.filterUrl=e.filterUrl,n.type=e.type,n.elevationPoint=e.points[0],n.setMeasureParams({precision:e.precision,defaultUnit:e.defaultUnit}),n}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){if(this.viewer.isInViewFrustum(this.elevationPoint)){var e=new THREE.Vector3(this.elevationPoint.x,this.elevationPoint.y,this.elevationPoint.z);e=this.viewer.worldToClient(e);for(var t=[58,-12,-12,-12,0,0,12,-12],i="",n=0;n<t.length;n+=2)t[n]+=e.x,t[n+1]+=e.y,i+=t[n]+","+t[n+1]+" ";var o=MeasureUtil.makePolyline({color:this.defaultColor,width:2,points:i});this.svgGroup.push(o);var a=new THREE.Vector2(e.x,e.y),r=this.notation.drawAnnotation("Elevation",a,this.getMeasureResult(),this.id),s=!0,l=!1,u=void 0;try{for(var c,d=r[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value;this.svgGroup.push(h)}}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}this.notation.dropShadow(this.filterUrl),this.unselect()}}},{key:"getMeasureResult",value:function(){var e=this.elevationPoint.z,t=this.measureParams.defaultUnit;t&&"mm"!==t||(e/=1e3);var i=e.toString(),n=MeasureResultFormat.formatPrecision(i,this.measureParams.precision);return n=n.split(",").join(""),0==n&&(n="Â±"+n),n+=" m"}},{key:"hitTest",value:function(e){var t=new THREE.Vector3(this.elevationPoint.x,this.elevationPoint.y,this.elevationPoint.z);t=this.viewer.worldToClient(t);var i=new THREE.Vector2(t.x-12,t.y-22),n=new THREE.Vector2(t.x+58,t.y-22);return MeasureUtil.distanceToSegment(e,i,n)<=22||this.notation.hitTest(e)}}]),t}(MeasureDrawable),Viewer3dMinDistanceLine=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i));return n.filterUrl=e.filterUrl,n.type=e.type,n.selectedComponentsId=e.points,n.worldPositions=[e.start,e.end],n.measureResult=e.distance,n.setMeasureParams({precision:e.precision,scale:e.scale,unit:e.lengthUnits,defaultUnit:e.defaultUnit}),n}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this.calcLine(this.worldPositions[0],this.worldPositions[1]);this.hitTestSegments=e;for(var t=this.calcTerminalLines(e,Math.PI/3,8),i=0;i<t.length;i++){var n=[];n.push(t[i].start,e[i],t[i].end);var o=MeasureUtil.makePolyline({color:this.defaultColor,width:2,points:MeasureUtil.calcPolylinePoints(n)});this.svgGroup.push(o)}if(0===e.length)return void this.unselect();var a=MeasureUtil.makeLine({start:e[0],end:e[1],color:this.defaultColor,lineWidth:this.lineWidth});this.svgGroup.push(a);var r={x:(this.worldPositions[0].x+this.worldPositions[1].x)/2,y:(this.worldPositions[0].y+this.worldPositions[1].y)/2,z:(this.worldPositions[0].z+this.worldPositions[1].z)/2},s=this.viewer.worldToClient(r);if(this.viewer.isInViewFrustum(r)){var l=this.notation.drawAnnotation("Distance",{x:s.x,y:s.y},this.getMeasureResult(),this.id),u=!0,c=!1,d=void 0;try{for(var h,f=l[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var g=h.value;this.svgGroup.push(g)}}catch(e){c=!0,d=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw d}}this.notation.dropShadow(this.filterUrl),this.unselect()}}},{key:"actionWhenSelected",value:function(){this.viewer.addSelectedComponentsById(this.selectedComponentsId),this.viewer.render()}},{key:"actionWhenUnselected",value:function(){this.viewer.removeSelectedId(this.selectedComponentsId),this.viewer.render()}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult.toString(),i=MeasureResultFormat.formatDistance(t,this.measureParams);return i+=MeasureResultFormat.getPostFix(e,!1),i.split(",").join("")}}]),t}(MeasureDrawable),MeasureResultFormat$1=function e(){_classCallCheck(this,e)};MeasureResultFormat$1.formatDistance=function(e,t){if(void 0==e)return null;var i=t.precision,n=t.scale,o=t.unit,a=t.defaultUnit,r=1;return"Centimeter"===o?r=10:"Meter"===o?r=1e3:"Kilometer"===o&&(r=1e6),"m"===a&&(n*=1e3),e*=n,e/=r,this.formatPrecision(e,i)},MeasureResultFormat$1.formatArea=function(e,t){var i=t.precision,n=t.scale,o=t.unit,a=1;return"Centimeter"===o?a=100:"Meter"===o&&(a=1e6),e*=Math.pow(n,2),e/=a,this.formatPrecision(e,i)},MeasureResultFormat$1.getPostFix=function(e,t){if("None"===e)return"";var i={None:"",Kilometer:"km",Meter:"m",Centimeter:"cm",Millimeter:"mm"},n=i[e];return t?n+="Â²":n=" "+n,n},MeasureResultFormat$1.formatPrecision=function(e,t){if(e=parseInt(Math.round(e*Math.pow(10,t)))/Math.pow(10,t),0!=t){var i=e.toFixed(t).split(".");e=Number(i[0]).toLocaleString()+"."+i[1]}else e=e.toLocaleString();return e};var MeasureArea=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,i));return n.filterUrl=e.filterUrl,n.type=e.type,n.worldPositions=e.points,n.measureResult=e.area,n.boundaryPoints=[],n.setMeasureParams({precision:e.precision,scale:e.scale,unit:e.lengthUnits}),n}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=new Box2,t=this.worldPositions,i="";this.boundaryPoints=[];for(var n=0;n<=t.length;n++){var o=this.worldToClient(t[n%t.length]),a=MeasureUtil.makeCircle({position:o,radius:this.radius,color:this.defaultColor});this.svgGroup.push(a),a.setAttribute("filter",this.filterUrl),this.unSelectElements.push(a),this.boundaryPoints.push(o),e.expandByPoint(new Vector2(o.x,o.y)),i+=o.x+","+o.y+" "}var r=MeasureUtil.makePolyline({color:this.defaultColor,fillColor:this.defaultColor,width:2,points:i});r.setAttribute("fill-opacity",.2),this.svgGroup.insert(0,r);var s=e.getCenter(),l=this.notation.drawAnnotation("DrawingArea",s,this.getMeasureResult()),u=!0,c=!1,d=void 0;try{for(var h,f=l[Symbol.iterator]();!(u=(h=f.next()).done);u=!0){var g=h.value;this.svgGroup.push(g)}}catch(e){c=!0,d=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw d}}this.notation.dropShadow(this.filterUrl),this.unselect(),!this.isShow&&this.hide()}},{key:"getType",value:function(){return this.type.split("Drawing")[1]}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult.toString(),i=MeasureResultFormat$1.formatArea(t,this.measureParams);return i+=MeasureResultFormat$1.getPostFix(e,!0),i.split(",").join("")}},{key:"worldToClient",value:function(e){var t=[],i=this.viewer.getViewer();return t=e.isActiveLayoutElement?i.toScreenPoint(e.point):i.toViewportScreenPoint(e.point),{x:t[0],y:t[1]}}},{key:"setViewId",value:function(e){this.viewId=e}},{key:"getViewId",value:function(){return this.viewId}},{key:"hitTest",value:function(e){var t=this.boundaryPoints;return MeasureUtil.isPointInPolygon(e,t)}}]),t}(MeasureDrawable),DrawingDistance=function(e){function t(e,i){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.filterUrl=e.filterUrl,n.type=e.type,n.startPoint=new Vector2(e.start[0],e.start[1]),n.endPoint=new Vector2(e.end[0],e.end[1]),n.measureResult=e.distance,n.setMeasureParams({precision:e.precision,scale:e.scale,unit:e.lengthUnits}),n.isOnLayoutMeasure=e.isOnLayout,n}return _inherits(t,e),_createClass(t,[{key:"initialize",value:function(){var e=this.calAuxLines(),t=[];t.push(e[0].start,e[1].end),this.hitTestSegments=t;var i=this.calcTerminalLines(t,Math.PI/2,6.5);this.attachSingleLine(t),this.attachTerminalLines(i);var n=["#7CCF21","#CC021B"];this.attachAuxLines(e,n),this.attachTerminalPoints(t),this.attachNotation(t),this.notation.dropShadow(this.filterUrl),this.unselect(),!this.isShow&&this.hide()}},{key:"attachNotation",value:function(e){if(0!==e.length){var t=this.notation.drawAnnotation("DrawingDistance",{x:(e[0].x+e[1].x)/2,y:(e[0].y+e[1].y)/2},this.getMeasureResult(),this.id),i=!0,n=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value;this.svgGroup.push(s)}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}}}},{key:"calAuxLines",value:function(){var e=[],t=this.startPoint.clone(),i=this.endPoint.clone(),n={x:i.x,y:t.y};e.push(t,n,i);for(var o=[],a=0;a<e.length-1;a++){var r=this.worldToClient(e[a]),s=this.worldToClient(e[a+1]);o.push({start:new Vector2(r.x,r.y),end:new Vector2(s.x,s.y)})}return o}},{key:"getType",value:function(){return this.type.split("Drawing")[1]}},{key:"getMeasureResult",value:function(){var e=this.measureParams.unit,t=this.measureResult.toString(),i=MeasureResultFormat$1.formatDistance(t,this.measureParams);return i+=MeasureResultFormat$1.getPostFix(e,!1),i.split(",").join("")}},{key:"worldToClient",value:function(e){if(this.isOnLayoutMeasure){var t=this.viewer.getViewer().toViewportScreenPoint([e.x,e.y]);return{x:t[0],y:t[1]}}return this.viewer.worldToClient(e)}},{key:"setViewId",value:function(e){this.viewId=e}},{key:"getViewId",value:function(){return this.viewId}}]),t}(Viewer3dDistance),MeasureItemFactory=function(){function e(t){_classCallCheck(this,e),this.viewer=t}return _createClass(e,[{key:"make",value:function(e,t,i){var n=null;switch(e){case"Distance":n=new Viewer3dDistance(t,i);break;case"Angle":n=new Viewer3dAngle(t,i);break;case"MinimumDistance":n=new Viewer3dMinDistanceLine(t,i);break;case"Elevation":n=new Viewer3dElevation(t,i);break;case"DrawingArea":n=new MeasureArea(t,i);break;case"DrawingDistance":n=new DrawingDistance(t,i)}return n.setViewer(this.viewer),n.initialize(),n}}]),e}(),SelectionControl=function(){function e(t,i){_classCallCheck(this,e),this.domContainer=t,this.measureItems=i,this.selectedItem=null,this.selectionChanged=null,this.hoverChanged=null,this.isEnableSelection=!0,this.offset=t.getBoundingClientRect(),Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop()&&this.hookEvents()}return _createClass(e,[{key:"hookEvents",value:function(){var e=this;this.domContainer.addEventListener("mousemove",function(t){if(e.isEnableSelection){var i=new Vector2$1(t.clientX,t.clientY);i.x-=e.offset.left,i.y-=e.offset.top;var n=e.hitTest(i);e.hoverChanged(n),n?(e.domContainer.style.cursor="default",t.preventDefault(),t.stopPropagation()):e.domContainer.style.cursor=""}},!1),this.domContainer.addEventListener("mousedown",function(t){if(e.isEnableSelection){var i=new Vector2$1(t.clientX,t.clientY);i.x-=e.offset.left,i.y-=e.offset.top;var n=e.hitTest(i);n&&(n.getIsSelected()?(e.selectionChanged(null),e.setSelectedItem(null),n.unselect()):(e.selectionChanged(n),e.setSelectedItem(n),n.select()),t.preventDefault(),t.stopPropagation())}},!1),this.domContainer.addEventListener("mouseup",function(e){},!1),this.domContainer.addEventListener("dblclick",function(){event.preventDefault(),event.stopPropagation()},!1)}},{key:"hitTest",value:function(e){for(var t=this.measureItems.length-1;t>=0;t--){var i=this.measureItems[t];if(i.getNotation().hitTest(e))return i}for(var t=this.measureItems.length-1;t>=0;t--){var n=this.measureItems[t];if(n.hitTest(e))return n}return null}},{key:"setSelectedItem",value:function(e){this.selectedItem&&(this.selectedItem.actionWhenUnselected(),this.selectedItem.unselect()),this.selectedItem=e,e&&e.actionWhenSelected()}},{key:"getSelectedItem",value:function(){return this.selectedItem}},{key:"hasSelected",value:function(){return null!==this.selectedItem}},{key:"setIsEnableSelection",value:function(e){this.isEnableSelection=e}}]),e}(),DropShadow=function(){function e(t){_classCallCheck(this,e),this.filterId=t.filterId,this.filterUnits=t.filterUnits,this.stdDeviation=t.stdDeviation,this.feOffset1=t.feOffset1,this.feOffset2=t.feOffset2,this.shadowOpacity=t.opacity,this.initialize()}return _createClass(e,[{key:"initialize",value:function(){var e=document.createElementNS(this.xmlns,"defs"),t=document.createElementNS(this.xmlns,"filter");t.setAttribute("id",this.filterId),t.setAttribute("filterUnits",this.filterUnits);var i=document.createElementNS(this.xmlns,"feGaussianBlur");i.setAttribute("in","SourceAlpha"),i.setAttribute("stdDeviation",this.stdDeviation),t.appendChild(i);var n=document.createElementNS(this.xmlns,"feOffset");n.setAttribute("dx",this.feOffset1.dx),n.setAttribute("dy",this.feOffset1.dy),n.setAttribute("result","offsetblur");var o=document.createElementNS(this.xmlns,"feOffset");o.setAttribute("dx",this.feOffset2.dx),o.setAttribute("dy",this.feOffset2.dy),o.setAttribute("result","offsetblur"),t.appendChild(n),t.appendChild(o);var a=document.createElementNS(this.xmlns,"feComponentTransfer"),r=document.createElementNS(this.xmlns,"feFuncA");r.setAttribute("type","linear"),r.setAttribute("slope",this.shadowOpacity),a.appendChild(r),t.appendChild(a);var s=document.createElementNS(this.xmlns,"feMerge"),l=document.createElementNS(this.xmlns,"feMergeNode"),u=document.createElementNS(this.xmlns,"feMergeNode");u.setAttribute("in","SourceGraphic");var c=document.createElementNS(this.xmlns,"feMergeNode");c.setAttribute("in","SourceGraphic"),s.appendChild(l),s.appendChild(u),s.appendChild(c),t.appendChild(s),e.appendChild(t),this.dropShadowDefs=e}},{key:"attach",value:function(e){this.dropShadowDefs||this.initialize(),e.appendChild(this.dropShadowDefs);var t=e.innerHTML;e.removeChild(this.dropShadowDefs),e.innerHTML=t}},{key:"getFilterUrl",value:function(){return"url(#"+this.filterId+")"}}]),e}(),MeasureItemManager=function(){function e(t,i,n){_classCallCheck(this,e),this.domContainer=t,this.viewer=i,this.measure=n,this.viewId=0,this.itemList=[],this.mapMeasureInfo={},this.initShadowManager(),this.drawableFactory=new MeasureItemFactory(i,n),this.hookViewer3DEvents()}return _createClass(e,[{key:"hookViewer3DEvents",value:function(){var e=this;this.selectionControl=new SelectionControl(this.domContainer,this.itemList),this.selectionControl.selectionChanged=function(t){if(t){var i=e.mapMeasureInfo[t.getId()];if(i.type=t.getType(),e.eventListener.fireEvent("MeasureSelected",i),e.bringToFront(t),e.itemClickCallback){var n=e.mapMeasureInfo[t.getId()];e.itemClickCallback(n)}}else e.eventListener.fireEvent("MeasureUnselected",{})},this.selectionControl.hoverChanged=function(t){t?(e.measure.disableMeasureCursor(),e.measure.setIsEnableSnap(!1)):t&&!e.measure.isMeasureOpen()||(e.measure.enableMeasureCursor(),e.measure.setIsEnableSnap(!0))},this.viewer.addEventListener("Rendered",function(){e.update()}),document.addEventListener("keyup",function(t){if(46===t.keyCode){var i=e.selectionControl.getSelectedItem();i&&(e.eventListener.fireEvent("MeasureSelected",{type:i.getType(),isDataEmpty:!0}),e.removeItemById(i.getId()),e.selectionControl.setSelectedItem(null))}}),this.viewer.addEventListener("ButtonOnToolbarClicked",function(t){if("LeftSubToolbar"===t.id&&(e.selectionControl.setSelectedItem(null),e.showExclusiveByViewId(t.viewId),e.viewId=t.viewId),"Measure"===t.id){var i=e.selectionControl.getSelectedItem();if(t.isChecked){if(e.showAll(),i){var n=e.mapMeasureInfo[i.getId()];n.type=i.getType(),i&&i.actionWhenSelected(),e.eventListener.fireEvent("MeasureSelected",n)}}else e.hideAll(),i&&i.actionWhenUnselected()}})}},{key:"addItem",value:function(e){var t=e.type,i=e.id;if(!this.mapMeasureInfo[i]){this.mapMeasureInfo[i]=e,e.precision=this.measure.getPrecision(),e.scale=this.measure.getScale(),e.lengthUnits=this.measure.getLengthUnits(),e.defaultUnit=this.measure.getDefaultUnit(),e.filterUrl=this.dropShadowManager.getFilterUrl();var n=this.drawableFactory.make(t,e,i,this.measure);"ViewerDrawing"===this.viewer.getViewerType()&&n.setViewId(this.viewId),n.attach(this.domContainer),n.select(),this.selectionControl.setSelectedItem(n),this.itemList.push(n)}}},{key:"removeItemById",value:function(e){this.mapMeasureInfo[e]&&delete this.mapMeasureInfo[e];for(var t=0;t<this.itemList.length;t++)if(this.itemList[t].getId()===e){this.itemList[t].clear(),this.itemList.splice(t,1);break}}},{key:"update",value:function(){this.clear();var e=!0,t=!1,i=void 0;try{for(var n,o=this.itemList[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value;a.initialize(),a.attach(this.domContainer),a.dropShadow(this.dropShadowManager.getFilterUrl())}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this.selectionControl.hasSelected()&&this.selectionControl.getSelectedItem().select()}},{key:"clear",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=this.itemList[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.clear()}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}e&&(this.itemList.length=0,this.selectionControl.setSelectedItem(null),this.eventListener.fireEvent("MeasureUnselected",{}),this.mapMeasureInfo={})}},{key:"unselctedAll",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.itemList[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.unselect()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this.selectionControl.selectedItem=null}},{key:"hideAll",value:function(){this.domContainer.style.display="none"}},{key:"showAll",value:function(){this.domContainer.style.display="block",this.update()}},{key:"onClick",value:function(e){e&&(this.itemClickCallback=e)}},{key:"save",value:function(){var e=[],t=Object.keys(this.mapMeasureInfo),i=!0,n=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value;e.push(this.mapMeasureInfo[s])}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}return e}},{key:"load",value:function(e){for(var t=0;t<e.length;t++){var i=e[t];this.addItem(i)}this.unselctedAll()}},{key:"setEventListener",value:function(e){var t=this;this.eventListener=e,this.eventListener.addEvent("Measuring",function(){t.selectionControl.setSelectedItem(null),t.selectionControl.setIsEnableSelection(!1)}),this.eventListener.addEvent("Measured",function(){t.selectionControl.setIsEnableSelection(!0)}),this.eventListener.addEvent("SettingPanelSaved",function(){var e=t.measure.getMeasureParams(),i=!0,n=!1,o=void 0;try{for(var a,r=t.itemList[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){a.value.setMeasureParams(e)}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}if(t.updataMeasureInfos(e),t.update(),t.selectionControl.hasSelected()){var s=t.selectionControl.getSelectedItem(),l=t.mapMeasureInfo[s.getId()];l.type=s.getType(),t.eventListener.fireEvent("MeasureSelected",l)}})}},{key:"bringToFront",value:function(e){for(var t=0;t<this.itemList.length;t++)if(this.itemList[t].getId()===e.getId()){this.itemList.splice(t,1);break}e.detach(),this.itemList.push(e),e.attach(this.domContainer)}},{key:"initShadowManager",value:function(){this.dropShadowManager=new DropShadow({filterId:"dropShadow",filterUnits:"userSpaceOnUse",stdDeviation:"2",feOffset1:{dx:5,dy:5},feOffset2:{dx:-5,dy:-5},opacity:"0.3"}),this.dropShadowManager.attach(this.domContainer)}},{key:"updataMeasureInfos",value:function(e){var t=Object.keys(this.mapMeasureInfo),i=!0,n=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value,l=this.mapMeasureInfo[s];l.precision=e.precision,l.scale=e.scale,l.lengthUnits=e.unit}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}}},{key:"showExclusiveByViewId",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=this.itemList[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;r.getViewId()===e?r.show():r.hide()}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}}]),e}();!function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop(),n=null,o=[],a=null,r=null,s=function(e){var i=e.viewer,n=this,o=new Glodon.Web.Lang.EventManager,a=t.create("div","bf-measure-conext");n.isOpen=!1,i.addEventListener("Rendered",function(){n.isOpen&&n.update()}),this.context={rootDomElement:a},this._opt=e,this.type=e.measureType,this.getEventManager=function(){return o},this.isEnableSnap=!0,i.getViewer().registerEventListener(CLOUD$1.EVENTS.ON_MEASURE_PICK,function(e){n.isOpen&&n.measureByPoint(e)})};s.prototype={init:function(){var e=this,i=e.context,n=e._opt.viewer;n.getDomElement().appendChild(i.rootDomElement),n.setSelectedComponentsById();var o=t.createNS("svg","bf-measure-svg"),a=t.createNS("svg","bf-measure-svg"),r=t.create("div","bf-measure-text");i.rootDomElement.innerHTML="",i.rootDomElement.appendChild(o),i.rootDomElement.appendChild(a),this.drawableManager=new MeasureItemManager(a,n,this),this.drawableManager.setEventListener(this.getEventManager()),this.switchOn(),i.svg=o,i.text=r,n.render()},enableMeasureCursor:function(){this._opt.viewer.getDomElement().style.cursor="url("+Cursor.measure+"),auto"},disableMeasureCursor:function(){this._opt.viewer.getDomElement().style.cursor=""},activeByMeasureType:function(){i||this.drawableManager.clear(!0),this.enableMeasureCursor();var e=this._opt.viewer,t=e.getViewer();t.editorManager.enableTool(t,CLOUD$1.EditToolMode.PICK_BY_MEASURE);var n,o=new Glodon.Bimface.Plugins.Measure.MeasureItemConfig;switch(o=Object.assign(o,this._opt),this.type){case Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance:n=new Glodon.Bimface.Plugins.Measure.MeasureDistanceItem(o);break;case Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Angle:n=new Glodon.Bimface.Plugins.Measure.MeasureAngleItem(o);break;case Glodon.Bimface.Plugins.Measure.MeasureTypeOption.MinimumDistance:o.cloudViewer=t,n=new Glodon.Bimface.Plugins.Measure.MeasureMinimumDistanceItem(o);break;case Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Elevation:n=new Glodon.Bimface.Plugins.Measure.MeasureElevationItem(o)}this.measureItem=n},switchOn:function(){this.isOpen||(this.type=Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance,this.activeByMeasureType(),this.isOpen=!0)},switchOff:function(){if(this.isOpen){var e=this,t=e._opt.viewer,i=t.getViewer();this.disableMeasureCursor(),i.editorManager.disableTool(CLOUD$1.EditToolMode.PICK_BY_MEASURE),e.reset(),e.measureItem=null,this.isOpen=!1}},measureByPoint:function(e){var t=this,s=t.measureItem;if(e)if(n=e.pickPoint?e.pickPoint:null,e.pickPlane?(a="Panel",r=e.normal):e.pickLine?(a="Line",o=e.pickLine):a=e.pickPoint?"Point":null,e.pick&&e.pickPoint){var l=this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Elevation,u=this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.MinimumDistance;l?(s.redo(),s.addPoint(e.pickPoint),s.draw(this.context)):u&&e.userId?s.addPoint(e.userId):(s.addPoint(e.pickPoint),t.update());var c=s.getPoints();c.length==s.maxPointsNum?(i||this.drawableManager.clear(!0),this.drawableManager.addItem(this.getInfo()),i||this.drawableManager.unselctedAll(),this.measureItem.setIsReserverd(!0),t.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Measured,t.getInfo()),s.reset(!1)):(i||this.drawableManager.clear(!0),t.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Measuring,t.getInfo()))}else this.isEnableSnap&&t.update()},measureMinimum:function(){},reset:function(){this.isOpen&&(this.measureItem.reset(),this.context.svg.innerHTML="",this.context.points=[],this.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Reset))},setIsEnableSnap:function(e){e||(this.context.svg.innerHTML=""),this.isEnableSnap=e},update:function(){var e=this.measureItem,t=this.context,i=this._opt.viewer,s=i.getDomElement(),l=s.getBoundingClientRect(),u=i.getViewer(),c=e.getPoints(),d=[],h=[];if(this.context.svg.innerHTML="",n?(t.hoverPosition=i.worldToClient(n),t.hoverPositionDS=u.getScene().worldToDrawing(n),0!=c.length&&(d=c.concat([n]))):(t.hoverPosition=null,0!=c.length&&(d=c.concat(c[c.length-1]))),t.hoverObjectType=a,"Line"==a&&2==o.length){t.lineStartPoint=i.worldToClient(o[0]),t.lineEndPoint=i.worldToClient(o[1]);var f=new THREE.Vector2(t.lineStartPoint.x,t.lineStartPoint.y),g=new THREE.Vector2(t.lineEndPoint.x,t.lineEndPoint.y),v=new THREE.Box2;v.min.set(s.clientLeft,s.clientTop),v.max.set(v.min.x+s.clientWidth,v.min.y+s.clientHeight);var m=!v.containsPoint(f),p=!v.containsPoint(g),y={start:f,end:g},w=CLOUD$1.CameraUtil.lineIntersectWithRect(y,v);if(m&&p)2==w.length&&(t.lineStartPoint=w[0],t.lineEndPoint=w[1]);else if(m||p)for(var b=new THREE.Vector2(t.hoverPosition.x,t.hoverPosition.y),C=m?g.clone():f.clone(),x=C.clone().sub(b).normalize(),E=0;E<w.length;E++){var P=C.clone().sub(w[E]).normalize();if(P.dot(x)>0){t.lineStartPoint=C,t.lineEndPoint=w[E];break}}}if("Panel"==t.hoverObjectType){t.normal=u.getScene().worldToDrawing(r),t.normal.normalize();var k=u.cameraControl,M=new THREE.Plane;M.setFromNormalAndCoplanarPoint(t.normal,t.hoverPositionDS);var I=new THREE.Vector2(t.hoverPosition.x-10,t.hoverPosition.y-10),S=new THREE.Vector2(t.hoverPosition.x+10,t.hoverPosition.y-10),B=t.hoverPositionDS,_=k.getRaycaster(I.x,I.y),f=_.ray.intersectPlane(M);_=k.getRaycaster(S.x,S.y);var g=_.ray.intersectPlane(M);if(null==f||null==g)return;var D=new THREE.Vector3(1,0,0),L=new THREE.Vector3(0,1,0),A=new THREE.Vector3(0,0,1),T=Math.abs(t.normal.clone().dot(D))<=.0025,G=Math.abs(t.normal.clone().dot(A))<=.0025;if(T&&G)var N=D.clone(),O=A.clone();else var V=L.clone(),N=V.cross(t.normal).normalize(),O=t.normal.clone().cross(N).normalize();var U=f.distanceTo(g)/2,W=N.clone().multiplyScalar(U),R=O.clone().multiplyScalar(U),H=B.clone().sub(W).add(R),z=B.clone().add(W).add(R),F=B.clone().sub(W).sub(R),j=B.clone().add(W).sub(R),X=[];X.push(H,z,j,F);for(var Y=[],Z=k.getContainerDimensions(),q=0;q<X.length;q++){var J=CLOUD$1.CameraUtil.drawingToCanvas(k.camera,X[q],Z.width,Z.height);Y.push(new THREE.Vector3(J.x,J.y,0))}t.clientPts=Y}for(var E=0;E<d.length-1;E++){var K=u.worldPointsToClient(d[E],d[E+1]);if(K){var Q={x:K.start.x-l.left,y:K.start.y-l.top};h.push(Q)}}if(this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance&&c.length==e.maxPointsNum){for(var $={x:c[1].x,y:c[0].y,z:c[0].z},ee={x:c[1].x,y:c[1].y,z:c[0].z},te=[],ie=[c[0],$,ee,c[1]],q=0;q<ie.length-1;q++){var K=u.worldPointsToClient(ie[q],ie[q+1]);K&&(K.start.x-=l.left,K.start.y-=l.top,K.end.x-=l.left,K.end.y-=l.top),te.push(K)}t.auxLines=te}t.clientPoints=h,e.draw(t)},getInfo:function(){var e={},t=this.measureItem,i=this._opt.viewer,n=t.getPoints();if(e.type=this.type,e.id=Glodon.Web.Lang.Utility.UUID.createUUID(),this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.MinimumDistance){if(2==n.length){var o=i.getMinimumComponentDistanceById(n[0],n[1]);e.distance=o.minDistance,e.start=o.start,e.end=o.end}e.points=n}else if(e.points=n,e.type=this.type,this.type==Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance)n&&2==n.length&&(e.distanceX=Math.abs(n[1].x-n[0].x),e.distanceY=Math.abs(n[1].y-n[0].y),e.distanceZ=Math.abs(n[1].z-n[0].z),e.distance=Math.sqrt(Math.pow(e.distanceX,2)+Math.pow(e.distanceY,2)+Math.pow(e.distanceZ,2)));else if(3==n.length){var a=new THREE.Vector3(n[0].x-n[1].x,n[0].y-n[1].y,n[0].z-n[1].z),r=new THREE.Vector3(n[2].x-n[1].x,n[2].y-n[1].y,n[2].z-n[1].z),s=a.angleTo(r);e.angle=180*s/Math.PI}return e},redo:function(){this.measureItem.redo(),this.update(),this.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Measuring,this.getInfo())},exit:function(){this.switchOff()},isMeasureOpen:function(){return this.isOpen},getDefaultUnit:function(){return this._opt.viewer._manifest.Metadata.Unit}},e.MeasureViewer3D=s}(),function(){var e="Bimface.Plugins.Measure.MeasureDrawing",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),o=Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop(),a=function(e){var t=this;this.isOpen=!1;var i=e.viewer,a=i.getViewer();this.viewer=i,this.viewerDrawing=a,this.domElement=i.getDomElement();var r=i.getEventManager();i.setSnapDistance(e.snapDistance);var s=n.createNS("svg","bf-measure-svg");s.style.position="absolute",s.style.left=0,s.style.top=0,s.style.width="100%",s.style.height="100%",a.dom.appendChild(s),
this.drawableManager=new MeasureItemManager(s,i,this),this.drawableManager.setEventListener(r),i.addEventListener("Measured",function(e){e&&(o||t.drawableManager.clear(!0),e.type="Drawing"+e.type,e.id=Glodon.Web.Lang.Utility.UUID.createUUID(),t.drawableManager.addItem(e),o||t.drawableManager.unselctedAll())}),o||i.addEventListener("Measuring",function(e){t.drawableManager.clear(!0)})};a.prototype={init:function(i){t.send(e,"init");var n=this;i&&(n._callback=i),this.switchOn()},activeByMeasureType:function(){o||this.drawableManager.clear(!0),this.viewerDrawing.mouseEditorMgr.activeEditorByName("Distance"==this.type?"measure":"area-measure")},switchOn:function(){t.send(e,"switchOn"),this.isOpen||(this.isOpen=!0,this.enableMeasureCursor(),this.type=Glodon.Bimface.Plugins.Measure.MeasureTypeOption.Distance,this.activeByMeasureType())},enableMeasureCursor:function(){this.domElement.firstElementChild.style.cursor="url("+Cursor.measure+"),auto"},disableMeasureCursor:function(){this.domElement.firstElementChild.style.cursor=""},switchOff:function(){t.send(e,"switchOff"),this.isOpen&&(this.isOpen=!1,this.disableMeasureCursor(),this.measureItem=null,this.viewerDrawing.mouseEditorMgr.activeEditorByName("pick"))},reset:function(){t.send(e,"reset");var i=this.viewerDrawing.mouseEditorMgr.getEditor();i.reset&&i.reset(),this.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureEvent.Reset),this.viewerDrawing.update()},update:function(){t.send(e,"update")},exit:function(){t.send(e,"exit"),this.switchOff()},isMeasureOpen:function(){return this.isOpen},setIsEnableSnap:function(e){this.viewerDrawing.mouseEditorMgr.getEditor().setIsEnableSnap(e)},getDefaultUnit:function(){return null}},i.MeasureDrawing=a}(),function(){var e=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=function(e){var n=e.viewer;if(n){var o=new Glodon.Web.Lang.EventManager,a=i.create("div","bf-measure-conext");this.context={rootDomElement:a},this.id="Measure",this._opt=e,this.type=e.measureType,this.getEventManager=function(){return o},Glodon.Bimface.Viewer.Viewer3D&&n instanceof Glodon.Bimface.Viewer.Viewer3D?((e.lengthUnits=Glodon.Bimface.Plugins.Measure.LengthUnits.None)&&(e.lengthUnits=Glodon.Bimface.Plugins.Measure.LengthUnits.Millimeter),t.MeasureViewer3D.call(this,e),this.inherit(Glodon.Bimface.Plugins.Measure.MeasureViewer3D.prototype)):(t.MeasureDrawing.call(this,e),this.inherit(Glodon.Bimface.Plugins.Measure.MeasureDrawing.prototype)),this.init();var r=this.getDefaultUnit();"m"===r?e.lengthUnits=Glodon.Bimface.Plugins.Measure.LengthUnits.Meter:"mm"===r&&(e.lengthUnits=Glodon.Bimface.Plugins.Measure.LengthUnits.Millimeter)}};n.prototype={inherit:function(e){for(var t in e)this[t]=e[t]},addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},getMeasureType:function(){return this.type},setMeasureType:function(t){e.send("Bimface.Plugins.Measure.Measure","setMeasureType"),this.type=t,this.reset(),this.activeByMeasureType(),this.getEventManager().fireEvent("typeChange",t)},setPrecision:function(e){this._opt.precision=e},getPrecision:function(){return this._opt.precision},setScale:function(e){this._opt.scale=e},getScale:function(){return this._opt.scale},setLengthUnits:function(e){this._opt.lengthUnits=e},getLengthUnits:function(){return this._opt.lengthUnits},getAllItems:function(){return this.drawableManager.save()},setItems:function(e){this.clear(),this.drawableManager.load(e)},clear:function(){this.drawableManager.clear(!0)},hideAllItems:function(){this.drawableManager.hideAll()},showAllItems:function(){this.drawableManager.showAll()},onClick:function(e){this.drawableManager.onClick(e)},removeSelectedItem:function(){this.drawableManager.unselctedAll()},getMeasureParams:function(){return{precision:this.getPrecision(),scale:this.getScale(),unit:this.getLengthUnits(),defaultUnit:this.getDefaultUnit()}}},t.Measure=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=function(){return{viewer:null,targetsHintColor:new Glodon.Web.Graphics.Color(245,127,35,.6)}};e.MeasureRayConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=function(){return{id:null,color:new Glodon.Web.Graphics.Color(245,127,35,1),width:2,startPoint:new Glodon.Web.Geometry.Point3d(0,0,0),endPoint:new Glodon.Web.Geometry.Point3d(0,0,0),startObjectId:null,endObjectId:null}};e.MeasureRayItemConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=function(e){this.id=e.id||Glodon.Web.Lang.Utility.UUID.createUUID();this.startPoint=e.startPoint,this.endPoint=e.endPoint;this.startComponentId=e.startComponentId,this.endComponentId=e.endComponentId;var i=t.createNS("defs","bf-defs");i.innerHTML='\n      <marker id="end" markerWidth="6" markerHeight="6" refx="5" refy="3" orient="auto" markerUnits="strokeWidth">\n        <path d="M0,0 L0,6 L6,3 z" fill="'+e.color.getRGBA()+'" />\n      </marker>';var n=t.create("i","bf-measure-handle");n.style.width=12*e.width+"px",n.style.height=12*e.width+"px",n.style.backgroundColor=e.color.getRGBA(),n.style.lineHeight=12*e.width+"px";var o=t.createNS("line","bf-measure-line");o.style.stroke=e.color.getRGBA(),o.setAttribute("stroke-width",e.width);var a=t.create("span","bf-measure-number");a.style.backgroundColor=e.color.getRGBA(),this.domElement=i,this.line=o,this.circle=n,this.text=a};i.prototype={draw:function(e){var t=this.domElement,i=this.line,n=this.circle,o=this.text,a=Math.abs(e.endPoint.x-e.startPoint.x),r=Math.abs(e.endPoint.y-e.startPoint.y),s=Math.abs(e.endPoint.z-e.startPoint.z),l=Math.sqrt(Math.pow(a,2)+Math.pow(r,2)+Math.pow(s,2));i.setAttribute("x1",e.startPoint.x),i.setAttribute("y1",e.startPoint.y),i.setAttribute("x2",e.endPoint.x),i.setAttribute("y2",e.endPoint.y),n.style.left=e.startPoint.x+"px",n.style.top=e.startPoint.y+"px",e.isMove&&(n.style.border="2px solid #fff"),l<15?i.removeAttribute("marker-end"):i.setAttribute("marker-end","url(#end)"),o.innerText=e.distance,e.svg.appendChild(t),e.svg.appendChild(i),e.text.appendChild(n),0==e.distance?n.innerText="0":(o.style.left=(e.startPoint.x+e.endPoint.x)/2+"px",o.style.top=(e.startPoint.y+e.endPoint.y)/2+"px",o.style.transform="translate(-50%, 0)",o.style.marginTop="2px",e.text.appendChild(o))}},e.MeasureRayItem=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=Object.freeze({Measured:"Measured",Clear:"Clear"});e.MeasureRayEvent=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Measure"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=function(e){var i=e.viewer;if(i){if(!(i instanceof Glodon.Bimface.Viewer.Viewer3D))return void console.log("Viewer2D is not supported.");var n=this,o=new Glodon.Web.Lang.EventManager,a=t.create("div","bf-measure-conext");i.addEventListener("Rendered",function(){n.measureItem&&n.update()}),this.context={rootDomElement:a},this._opt=e,this._enableMove=!1,this._events={mousedown:function(){this._startTime=(new Date).getTime()},mouseup:function(e){if(0==e.button||1==e.button)if(n._enableMove)n._enableMove=!1,n.measureByPoint(e);else{var t=this._startTime,i=(new Date).getTime();i-t<300&&n.measureByPoint(e)}},mousemove:function(e){n._enableMove&&(e.stopPropagation(),n.measureByPoint(e))}},this.getEventManager=function(){return o}}};i.prototype={addEventListener:function(e,t){this.getEventManager().addEvent(e,t)},removeEventListener:function(e,t){this.getEventManager().removeEvent(e,t)},switchOn:function(e){var i=this.context,n=this;n._opt.viewer.getDomElement().appendChild(i.rootDomElement),e&&(n._callback=e),n._opt.viewer.setSelectedComponentsById();var o=t.createNS("svg","bf-measure-svg"),a=t.create("div","bf-measure-text");i.rootDomElement.appendChild(o),i.rootDomElement.appendChild(a),i.svg=o,i.text=a,i.rootDomElement.addEventListener("mousedown",n._events.mousedown),i.rootDomElement.addEventListener("mouseup",n._events.mouseup),i.rootDomElement.addEventListener("mousemove",n._events.mousemove)},switchOff:function(){var e=this.context.rootDomElement,t=this,i=t._opt.viewer;t.measureItem&&(i.restoreComponentsColorById([t.measureItem.startComponentId,t.measureItem.endComponentId]),i.render()),e.removeEventListener("mousedown",t._events.mousedown),e.removeEventListener("mouseup",t._events.mouseup),e.removeEventListener("mousemove",t._events.mousemove),e.innerHTML="",e.remove(),t.measureItem=null},reset:function(){this.clear()},clear:function(){var e=this.context,t=this,i=t._opt.viewer;t.measureItem&&(i.restoreComponentsColorById([t.measureItem.startComponentId,t.measureItem.endComponentId]),i.render()),e.svg.innerHTML="",e.text.innerHTML="",t.measureItem=null,t.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureRayEvent.Clear,data)},measureByPoint:function(e){var t=this,i=t._opt.viewer,n=i.getViewer(),o=n.pickByPointWithNormal(e);if(o){t.measureItem&&i.restoreComponentsColorById([t.measureItem.startComponentId,t.measureItem.endComponentId]);var a=(Glodon.Bimface.Viewer.Viewer3DEvent,t._getContextData(o)),r=new Glodon.Bimface.Plugins.Measure.MeasureRayItemConfig;r.startComponentId=a.startComponentId,r.endComponentId=a.endComponentId,r.startPoint=a.startPoint,r.endPoint=a.endPoint;var s=new Glodon.Bimface.Plugins.Measure.MeasureRayItem(r);s.circle.addEventListener("mousedown",function(e){2!=e.button&&(t._enableMove=!0)}),t.context.distance=a.distance,i.overrideComponentsColorById([a.startComponentId,a.endComponentId],t._opt.targetsHintColor),setTimeout(function(){t.update(),i.render()},100),t.measureItem=s,t.getEventManager().fireEvent(Glodon.Bimface.Plugins.Measure.MeasureRayEvent.Measured,a)}},update:function(){var e=this.measureItem,t=this.context,i=this._opt.viewer;t.svg.innerHTML="",t.text.innerHTML="",t.isMove=this._enableMove;var n=i.worldToClient(e.startPoint),o=i.worldToClient(e.endPoint);n&&o&&(t.startPoint=new Glodon.Web.Geometry.Point3d(n.x,n.y,n.z),t.endPoint=new Glodon.Web.Geometry.Point3d(o.x,o.y,o.z),e.draw(t))},exit:function(){this.switchOff()},_getContextData:function(e){var t,i,n={};return t=i=e[0],e.length>1&&(i=e[1]),n.startComponentId=t.userId,n.startPoint=t.worldPosition,n.endComponentId=i.userId,n.endPoint=i.worldPosition,n.distanceX=Math.round(Math.abs(n.endPoint.x-n.startPoint.x)),n.distanceY=Math.round(Math.abs(n.endPoint.y-n.startPoint.y)),n.distanceZ=Math.round(Math.abs(n.endPoint.z-n.startPoint.z)),n.distance=Math.round(Math.sqrt(Math.pow(n.distanceX,2)+Math.pow(n.distanceY,2)+Math.pow(n.distanceZ,2))),n}},e.MeasureRay=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Marker3D"),t=function(){return{viewer:null}};e.Marker3DContainerConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Marker3D"),t=function(){return{id:null,objectId:null,size:30,tooltip:"",tooltipStyle:{color:"#333",fontSize:"14px",borderWidth:"1px",borderColor:"#666",borderStyle:"solid",backgroundColor:"#fff"},src:null,worldPosition:new Glodon.Web.Geometry.Point3d(0,0,0)}};e.Marker3DConfig=t}(),function(){var e="Bimface.Plugins.Marker3D.Marker3D",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Marker3D"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),o=function(e){var t=this;this.id=e.id||Glodon.Web.Lang.Utility.UUID.createUUID(),this.size=e.size,this.iconUrl=e.src,this.position=e.worldPosition,this.originalPosition=new THREE.Vector3(this.position.x,this.position.y,this.position.z),this.explosionOffset=new THREE.Vector3,this.tooltip=e.tooltip,this.tooltipElement=n.create("div","bf-tooltip"),this.tooltipElement.innerHTML=e.tooltip,this.tooltipElement.setCss(e.tooltipStyle),this.isHideByClustering=!1,this._tooltipCallback=function(e,i,n){var o=t.tooltipElement;n.appendChild(o);var a=o.offsetWidth,r=o.offsetHeight;o.style.left=i.x-a/2+"px",o.style.top=i.y-r-t.size+"px",t._hoverCallback&&t._hoverCallback(e)},this._config=e};o.prototype={getId:function(){return this.id},getWorldPosition:function(){return this.position},setWorldPosition:function(i){t.send(e,"setWorldPosition"),this.position=i,this.update()},getSize:function(){return this.size},setSize:function(i){t.send(e,"setSize"),this.size=i,this.update()},getSrc:function(){return this.iconUrl},setSrc:function(i){t.send(e,"setSrc"),this.iconUrl=i,this.update()},getTooltip:function(){return this.tooltip},setTooltip:function(i){t.send(e,"setTooltip"),this.tooltip=i,this.tooltipElement.innerHTML=i},onClick:function(i){t.send(e,"onClick"),i&&(this._clickCallback=i)},onHover:function(i){t.send(e,"onHover"),i&&(this._hoverCallback=i)},update:function(){t.send(e,"update"),this.container&&this.container.update()},isHideByClustering:function(){return this.isHideByClustering},hideByClustering:function(e){this.isHideByClustering=!!e},attachExplosionOffset:function(e,t){if(this.getWorldPosition()){var i=this._config.objectId;if(i){var n={};n[i]=!0;var o=e.modelManager.getBoundingBoxByIds(n),a=this.assoiatedComponentBbox,r=o;if(a){var s=r.getCenter().clone();s.sub(a.getCenter().clone()),this.explosionOffset=s,this.explosionExtent>0&&0===t&&(this.originalPosition.x+=s.x,this.originalPosition.y+=s.y,this.originalPosition.z+=s.z,this.explosionExtent=0,this.explosionOffset=new Vector3,this.assoiatedComponentBbox=r.clone())}}else{var l=e.getScene().getOriginalBoundingBoxWorld().getCenter(),u=(new THREE.Box3).expandByPoint(this.getWorldPosition()),c=CLOUD.Utils.computeExplodeTranslation(l,u,t);this.explosionOffset=c}}},updatePosition:function(){this.position.x=this.originalPosition.x+this.explosionOffset.x,this.position.y=this.originalPosition.y+this.explosionOffset.y,this.position.z=this.originalPosition.z+this.explosionOffset.z},getOriginalPosition:function(){return this.originalPosition},setInitialExplosionInfo:function(e){this.explosionExtent=e.getExplosionExtent();var t=this._config.objectId;if(t){var i=e.getViewer(),n={};n[t]=!0;var o=i.modelManager.getBoundingBoxByIds(n);o.isEmpty()?(this._config.objectId=null,console.log("Cannot find component with Id "+t)):this.assoiatedComponentBbox=o.clone()}},getCurrentPosition:function(){return this.position}},i.Marker3D=o}(),function(){var e="Bimface.Plugins.Marker3D.Marker3DContainer",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Marker3D"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.ClientHelper.getIsDesktop()),o=function(e){var t=this;if(!e.viewer)return void console.log("viewer must not be empty.");var i=e.viewer instanceof Glodon.Bimface.Viewer.Viewer3D,o=e.viewer.getDomElement(),a=e.viewer.getViewer();if(!i)return void console.log("Viewer2D is not supported.");if(e.viewer.marker3DContainer)return e.viewer.marker3DContainer;e.viewer.marker3DContainer=this;var r=new CLOUD$1.Marker3D(a,!0),s=this;if(this._helper=r,this._viewer=e.viewer,this._items=[],this._pick=function(e){var t=e.intersectInfo;if(t&&t.objectType===CLOUD$1.PICKABLETYPE.Marker3d){var i=s.getItemById(t.selectedObjectId);i._clickCallback&&i._clickCallback(i)}},this._hover=function(e){s.tooltipElement&&o.contains(s.tooltipElement)&&(o.removeChild(s.tooltipElement),s.tooltipElement=null);var t=e.intersectInfo;if(t&&t.objectType===CLOUD$1.PICKABLETYPE.Marker3d){var i=s.getItemById(t.selectedObjectId);s.tooltipElement=i.tooltipElement,i._tooltipCallback&&""!=s.tooltipElement.innerHTML&&i._tooltipCallback(i,e.canvasPos,o)}},a.registerEventListener(CLOUD$1.EVENTS.ON_CLICK_PICK,s._pick),n&&a.registerEventListener(CLOUD$1.EVENTS.ON_HOVER_PICK,s._hover),e.viewer.floorData){var l;!function(){t.floorInfos=e.viewer.floorData;var i=t.floorInfos,n=i.floorInfos.length,o=[];for(l=0;l<n;l++)!function(){var t=i.floorInfos[l];e.viewer.getFloorBoundingBoxById(t.id,function(e){o.push({box:e,floorName:t.name,explodedOffset:t.explodedHeight-t.elevation}),o.length==n&&(s.boxs=o)})}()}()}e.viewer.addEventListener(Glodon.Bimface.Viewer.Viewer3DEvent.FloorExplosion,function(t){if(0===e.viewer.getFloorExplosionExtent()){var i=!0,n=!1,o=void 0;try{for(var a,r=s.getAllItems()[Symbol.iterator]();!(i=(a=r.next()).done);i=!0)a.value.setInitialExplosionInfo(e.viewer)}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}}var l=t.floorInfos.length,u=[];s.floorInfos=t;var c=function(){for(var e=s._items,t=0,i=e.length;t<i;t++){var n=e[t].getWorldPosition();if(n)if(e[t].levelName){var o=u.getObjectByAttribute("floorName",e[t].levelName);o&&(e[t].explosionOffset={x:0,y:0,z:o.explodedOffset})}else for(var a=0;a<u.length;a++){var r=u[a];if(r.box.containsPoint(n)){e[t].explosionOffset={x:0,y:0,z:r.explodedOffset},e[t].levelName=r.floorName;break}}}};if(l)for(var d=0;d<l;d++)!function(){var i=t.floorInfos[d];e.viewer.getFloorBoundingBoxById(i.id,function(e){u.push({box:e,floorName:i.name,explodedOffset:i.explodedHeight-i.elevation}),u.length==l&&(c(),s.boxs=u)})}();s.update()});var u=e.viewer.getViewer();u.registerEventListener(CLOUD$1.EVENTS.ON_EXPLOSION,function(e){var i=t.getAllItems(),n=!0,o=!1,a=void 0;try{for(var r,s=i[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){r.value.attachExplosionOffset(u,e.extent)}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}t.update()})};o.prototype={addItem:function(i){t.send(e,"addItem"),i.container=this;var n=this.ifExploded(i);n&&(n.setInitialExplosionInfo(this._viewer),this._items.push(n),this.update())},getLevelNameById:function(e,t){for(var i=this._areaData,n=this,o=0;o<i.length;o++){var a=i[o];if(a.rooms){if(a.rooms.getObjectByAttribute("id",e))return a.name}}if(!this._spatialRelation){var r=new Glodon.Bimface.Plugins.SpatialRelation.RoomConfig;r.viewer=this._viewer;var s=new Glodon.Bimface.Plugins.SpatialRelation.Room(r);this._spatialRelation=s}var l=this._spatialRelation.getBoundaryByRoomId(e);if(l){if(this._levelsInfo)return function(e,t){for(var i=e[0][2],n=0;n<t.length;n++)if(Math.abs(i-t[n].elevation)<5)return t[n].name;return!1}(l,n._levelsInfo);this._viewer.getMapInfo(function(e){n._levelsInfo=e.axisGrid.Levels,n.addItem(t)})}},ifExploded:function(e){var t=this;if(this.floorInfos&&!this._levelsInfo){for(var i=this.floorInfos.floorInfos,n=[],o=0;o<i.length;o++){var a=i[o];n.push({name:a.name,elevation:a.elevation})}this._levelsInfo=n}var r=function(){if(t.floorInfos){var i=e.getOriginalPosition();if(e.levelName){var n=t.boxs.getObjectByAttribute("floorName",e.levelName);n&&(e.explosionOffset={x:0,y:0,z:n.explodedOffset},i.z-=n.explodedOffset)}else for(var o=t.boxs,a=0;a<o.length;a++){var r=o[a];if(0!=r.explodedOffset){var s={x:worldPosition.x,y:worldPosition.y,z:worldPosition.z-r.explodedOffset};if(r.box.containsPoint(s)){e.explosionOffset={x:0,y:0,z:r.explodedOffset},i.z-=r.explodedOffset;break}}}}return e};if(!e._config.objectId)return r();var s=this._viewer.getViewer().getComponentInfoByUserId(e._config.objectId);if(s)return e.levelName=s.userData&&s.userData.levelName,r();if(this._areaData){var l=this.getLevelNameById(e._config.objectId,e);if(l)return e.levelName=l,r()}else this._viewer.getAreas(function(i){t._areaData=i,t.addItem(e)})},addItems:function(i){t.send(e,"addItems");var n=!0,o=!1,a=void 0;try{for(var r,s=i[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value,u=this.ifExploded(l);u&&this._items.push(u),l.setInitialExplosionInfo(this._viewer)}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}this.update()},removeItemById:function(i){t.send(e,"removeItemById"),this._items.removeObjectByAttribute("id",i),this.update()},getItemById:function(e){return this._items.getObjectByAttribute("id",e)},getAllItems:function(){return[].concat(_toConsumableArray(this._items))},clear:function(){t.send(e,"clear"),this._items=[],this.update()},update:function(){this._helper.clear();for(var e=this._items.slice(),t=0,i=e.length;t<i;t++){e[t].getWorldPosition()&&e[t].updatePosition()}for(var n=[],o=0,a=e.length;o<a;o++)!1===e[o].isHideByClustering&&n.push(e[o]);this._helper.add(n),this._helper.update(),this._viewer.render()},exit:function(){t.send(e,"exit");var i=this._viewer.getViewer();i.unregisterEventListener(CLOUD$1.EVENTS.ON_CLICK_PICK,this._pick),n&&i.unregisterEventListener(CLOUD$1.EVENTS.ON_HOVER_PICK,this._hover),this.clear()},hideItemsById:function(i){t.send(e,"hideItemsById"),this._helper.hideByIds(i),this._viewer.render()},hideAllItems:function(){t.send(e,"hideAllItems"),this._helper.hide(),this._viewer.render()},showItemsById:function(i){t.send(e,"showItemsById"),this._helper.showByIds(i),this._viewer.render()},showAllItems:function(){t.send(e,"showAllItems"),this._helper.show(),this._viewer.render()}},i.Marker3DContainer=o}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=function(){return{viewer:null}};e.SectionBoxConfig=t}(),function(){var e=Object.freeze({SectionBoxUpdate:"SectionBoxUpdate",SectionBoxChanged:"SectionBoxChanged"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section").SectionBoxEvent=e}(),function(){var e,t,i="Bimface.Plugins.Section.SectionBox",n=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),o=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),a=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),function(i){var n=this,a=i.viewer;return a?a instanceof Glodon.Bimface.Viewer.Viewer3D?(a._sectionPlane&&(a._sectionPlane.hidePlane(),a._sectionPlane.exit()),e&&a==t?(e.id=i.id,e.reset(),e):(e=this,t=a,a._sectionBox?(a._sectionBox.showBox(),a._sectionBox):(a._sectionBox=this,this.sectionBoxEvent=o.SectionBoxEvent,this.eventManager=a.getEventManager(),n.id=i.id,n._opt=i,n._viewer=a,n.boxState=!0,void n.init()))):void console.log("Viewer2D is not supported."):void console.log("domElement must not be empty.")});a.prototype={hookEvens:function(){var e=this._viewer.getViewer(),t=this._viewer.getDomElement();e.registerEventListener(CLOUD$1.EVENTS.ON_CLIP_HOVER,function(e){e.onClipBox?t.style.cursor="url("+Cursor.section+"),auto":t.removeAttribute("style")});var i=this;e.registerEventListener(CLOUD$1.EVENTS.ON_CLIP_MOUSE_MOVE,function(e){i.eventManager.fireEvent(i.sectionBoxEvent.SectionBoxChanged)})},init:function(){n.send(i,"init");var e=this._opt.viewer.getViewer(),t=this;e.editorManager.enableTool(e,CLOUD$1.EditToolMode.CLIP_BY_BOX),this._sectionBox=new CLOUD$1.ClipPlaneService(e),CLOUD$1.ClipPlaneManager.getInstance(e.getScene()).observer=function(){t.eventManager.fireEvent(t.sectionBoxEvent.SectionBoxUpdate,t)},this._sectionBox.reset(),this._sectionBox.toggle(!0,!0),this._sectionBox.setVisible(!0),this.hookEvens()},addEventListener:function(e,t){this.eventManager.addEvent(e,t)},removeEventListener:function(e,t){this.eventManager.removeEvent(e,t)},setBox:function(e){n.send(i,"setBox"),this._sectionBox.getEditor().calculateOffsetByBox(e.min,e.max)},getBox:function(){},hideBox:function(){n.send(i,"hideBox"),this._sectionBox&&this._sectionBox.setVisible(!1),this._viewer.render()},showBox:function(){n.send(i,"showBox"),this._sectionBox&&this._sectionBox.setVisible(!0),this._viewer.render()},setProgress:function(e,t){var i=this,n={x:["Left","Right"],y:["Back","Front"],z:["Bottom","Top"]};t&&(i._sectionBox.setProcess(n[e][0],t[0]/100),2==t.length&&i._sectionBox.setProcess(n[e][1],1-t[1]/100))},getProgress:function(e){var t=this,i=[],n={x:["Left","Right"],y:["Back","Front"],z:["Bottom","Top"]};return i.push(100*t._sectionBox.getProcess(n[e][0])),i.push(100-100*t._sectionBox.getProcess(n[e][1])),i},reset:function(){n.send(i,"reset"),this._sectionBox.toggle(!0,!0),this._sectionBox.reset("Rotate"),this.showBox()},fitToModel:function(){n.send(i,"fitToModel");var e=this._sectionBox.recalculate().clone();e.isEmpty()&&e.expandByPoint(new THREE.Vector3),this.setBox(e),this._sectionBox.getEditor()._isVisible()&&this.showBox(),this.eventManager.fireEvent(this.sectionBoxEvent.SectionBoxChanged)},isIncluded:function(e){var t=this._opt.viewer,i=t.getViewer().getScene(),n=CLOUD$1.ClipPlaneManager.getInstance(i),o=n.getClipBoundingBox(),a=t.worldToScene(e);return o.containsPoint(a)},exit:function(){n.send(i,"exit");var t=this._opt.viewer.getViewer(),o=this._viewer.getDomElement();this.reset(),t.editorManager.disableTool(CLOUD$1.EditToolMode.CLIP_BY_BOX),o.removeAttribute("style"),this._sectionBox=null,this._opt.viewer._sectionBox=null,e=null,this.eventManager.fireEvent(this.sectionBoxEvent.SectionBoxUpdate,null),t.unregisterEventListener(CLOUD$1.EVENTS.ON_CLIP_HOVER,function(e){e.onClipBox?o.style.cursor="url("+Cursor.section+"),auto":o.removeAttribute("style")})},lockBox:function(e){this._opt.viewer.getViewer().editorManager.getToolByName("clipByBox").lockBoxFaces(e)},unlockBox:function(){this._opt.viewer.getViewer().editorManager.getToolByName("clipByBox").unlockBox()},getState:function(){var e=this._opt.viewer,t=this._sectionBox.saveState(),i=t.boundingBox;return i.min=e.sceneToWorld(i.min),i.max=e.sceneToWorld(i.max),t},setState:function(e){this._sectionBox.loadState(e)},restore:function(){var e=this._sectionBox.getEditor()._isVisible();this._sectionBox.toggle(!0,e),this._sectionBox.reset("Rotate")},getSectionBox:function(){n.send(i,"getSectionBox");var e=this._opt.viewer,t=this._sectionBox.saveState().boundingBox;return t.min=e.sceneToWorld(t.min),t.max=e.sceneToWorld(t.max),t},setSectionBox:function(e){n.send(i,"setSectionBox");var t=this._opt.viewer,o=t.getViewer().getScene(),a=CLOUD$1.ClipPlaneManager.getInstance(o),r=t.worldToScene(e.min),s=t.worldToScene(e.max);a.setSectionBox(r,s)},update:function(){this._sectionBox.update()}},o.SectionBox=a}(),function(){var e=Object.freeze({Forward:"Forward",Reverse:"Reverse"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section").SectionPlaneDirection=e}(),function(){var e=Object.freeze({X:"X",Y:"Y",Z:"Z"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section").SectionPlanePlane=e}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=function(){return{viewer:null,progress:50,plane:Glodon.Bimface.Plugins.Section.SectionPlanePlane.X,direction:Glodon.Bimface.Plugins.Section.SectionPlaneDirection.Forward}};e.SectionPlaneConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(){function e(t,i){_classCallCheck(this,e),this.coordinateSystem=t,this.viewer=i,this.container=this.viewer.domElement,this.mapDrawables={},this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.xmlns="http://www.w3.org/2000/svg";var e=document.createElement("div");e.style.left="0px",e.style.top="0px",e.style.width=this.container.offsetWidth+"px",e.style.height=this.container.offsetHeight+"px",e.style.position="absolute",e.style.zIndex=5,this.group=document.createElementNS(this.xmlns,"svg"),this.group.setAttribute("width",this.container.offsetWidth+""),this.group.setAttribute("height",this.container.offsetHeight+""),e.appendChild(this.group),this.container.appendChild(e)}},{key:"makeCircle",value:function(e,t){var i=this.mapDrawables;void 0==i[e]&&(i[e]=document.createElementNS(this.xmlns,"circle"),this.group.appendChild(i[e]));var n=i[e];n.style.fill=t.color||"#FF0000",n.setAttribute("r",t.radius+""),n.setAttribute("transform","translate("+t.center.x+","+t.center.y+")")}},{key:"show",value:function(e,t){var i=this.getDrawable(e);i&&(i.style.display=t?"block":"none")}},{key:"fill",value:function(e,t){this.getDrawable(e).style.fill=t?"block":"none"}},{key:"makeLine",value:function(e,t){var i=this.mapDrawables;void 0==i[e]&&(i[e]=document.createElementNS(this.xmlns,"line"),this.group.appendChild(i[e]));var n=i[e];n.setAttribute("stroke",t.color||"#000000"),n.setAttribute("stroke-width",t.width||3),n.setAttribute("x1",t.start.x+""),n.setAttribute("y1",t.start.y+""),n.setAttribute("x2",t.end.x+""),n.setAttribute("y2",t.end.y+"")}},{key:"makeDashLine",value:function(e,t){this.makeLine(e,t),this.mapDrawables[e].setAttribute("stroke-dasharray",t.dashArray)}},{key:"makePolyline",value:function(e,t){var i=null,n=this.mapDrawables;void 0==n[e]&&(n[e]=document.createElementNS(this.xmlns,"polyline"),this.group.appendChild(n[e])),i=n[e],i.setAttribute("stroke",t.color||"#A9A9A9"),i.setAttribute("stroke-width",t.width||3),i.style.fill="none",i.setAttribute("points",t.points)}},{key:"makeDefs",value:function(e){var t=this.mapDrawables;void 0==t[e]&&(t[e]=document.createElementNS(this.xmlns,"defs"),void 0==t.marker&&(t.marker=this.makeMarker(),t[e].appendChild(t.marker)),this.group.appendChild(t[e]))}},{key:"makeMarker",value:function(){var e=document.createElementNS(this.xmlns,"marker");e.setAttribute("id","arrow"),e.setAttribute("viewBox","0 0 10 10"),e.setAttribute("refX","5"),e.setAttribute("refY","5"),e.setAttribute("markerWidth","6"),e.setAttribute("markerHeight","6"),e.setAttribute("orient","auto-start-reverse");var t=document.createElementNS(this.xmlns,"path");return t.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),t.style.fill="#11DAB7",this.mapDrawables.arrow=t,e.appendChild(t),e}},{key:"getDrawable",value:function(e){return this.mapDrawables[e]}},{key:"attach",value:function(){this.getDrawable("axisZ").setAttribute("marker-end","url(#arrow)")}},{key:"setColor",value:function(e,t){this.getDrawable(e).setAttribute("stroke",t)}},{key:"fill",value:function(e,t){this.getDrawable(e).style.fill=t}},{key:"hideAll",value:function(e){var t=1==e?"none":"block";this.group.parentNode.style.display=t}},{key:"destroy",value:function(){for(var e=this.group.children,t=0;t<e.length;t++)this.group.removeChild(e[t]);var i=this.group.parentNode;i&&i.removeChild(this.group)}}]),e}());e.CoordinateDrawer=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(){function e(t,i){_classCallCheck(this,e),this.coordinateSystem=t,this.viewer=t.viewer,this.drawingImpl=i,this.viewportOffset=this.viewer.domElement.getBoundingClientRect(),this.cameraControl=this.viewer.cameraControl,this.fillClipPlane=CLOUD$1.FillClipPlaneManager.getInstance(this.viewer.getScene()),this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.arrowMouseDown=!1,this.circleXMouseDown=!1,this.circleYMouseDown=!1,this.firstClickDown=!0,this.firstRotate=!0,this.lineOut=!0,this.arrowOut=!0,this.translateStartPt=new THREE.Vector2,this.translateEndPt=new THREE.Vector2,this.rotateAngleA=0,this.rotateAngleB=0,this.config=this.coordinateSystem.config}},{key:"registerArrowEvents",value:function(){var e=this.drawingImpl.getDrawable("axisZ"),t=this,i=this.config.colors;e.onmouseover=function(){1!=t.circleXMouseDown&&1!=t.circleYMouseDown&&(t.drawingImpl.setColor("axisZ",i.highLight),t.drawingImpl.fill("arrow",i.highLight),t.drawingImpl.setColor("tipArcX",i.default),t.drawingImpl.fill("cubeX",i.default),t.drawingImpl.setColor("tipArcY",i.default),t.drawingImpl.fill("cubeY",i.default),t.lineOut=!1)},e.onmouseout=function(){
1!=t.circleXMouseDown&&1!=t.circleYMouseDown&&0==t.arrowMouseDown&&1==t.arrowOut&&(t.drawingImpl.setColor("axisZ",i.arrow),t.drawingImpl.fill("arrow",i.arrow),t.drawingImpl.setColor("tipArcX",i.tipArcX),t.drawingImpl.fill("cubeX",i.cubeX),t.drawingImpl.setColor("tipArcY",i.tipArcY),t.drawingImpl.fill("cubeY",i.cubeY),t.lineOut=!0)},e.onmousedown=function(e){t.arrowMouseDown=!0,t.lineOut=!1;var i=t.config.colors;t.drawingImpl.setColor("axisZ",i.highLight),t.drawingImpl.fill("arrow",i.highLight),t.coordinateSystem.colorUpdate=!1,t.translateStartPt.set(e.clientX,e.clientY)};var n=this.drawingImpl.getDrawable("arrow");n.onmouseover=function(){if(1!=t.circleXMouseDown&&1!=t.circleYMouseDown){t.arrowOut=!1;var e=t.config.colors;t.drawingImpl.fill("arrow",e.highLight),t.drawingImpl.setColor("axisZ",e.highLight),t.drawingImpl.setColor("tipArcX",e.default),t.drawingImpl.fill("cubeX",e.default),t.drawingImpl.setColor("tipArcY",e.default),t.drawingImpl.fill("cubeY",e.default)}},n.onmouseout=function(){if(1!=t.circleXMouseDown&&1!=t.circleYMouseDown&&0==t.arrowMouseDown&&1==t.lineOut){t.arrowOut=!0;var e=t.config.colors;t.drawingImpl.setColor("axisZ",e.arrow),t.drawingImpl.fill("arrow",e.arrow),t.drawingImpl.setColor("tipArcX",e.tipArcX),t.drawingImpl.fill("cubeX",e.cubeX),t.drawingImpl.setColor("tipArcY",e.tipArcY),t.drawingImpl.fill("cubeY",e.cubeY)}},n.onmousedown=function(e){t.arrowMouseDown=!0,t.arrowOut=!1;var i=t.config.colors;t.drawingImpl.setColor("axisZ",i.highLight),t.drawingImpl.fill("arrow",i.highLight),t.translateStartPt.set(e.clientX,e.clientY)},document.onmousemove=function(e){if(1==t.arrowMouseDown){t.fillClipPlane.clearCapsWireframe(),CLOUD$1.GlobalData.ClippingCaps=!1;if(!(e.clientX==t.translateStartPt.x&&e.clientY==t.translateStartPt.y)){var i=t.fillClipPlane.renderClipPlane,n=i.normal.clone();n.w=i.constant;var o=t.cameraControl.movePlane(n,e,t.translateStartPt,!1,t.fillClipPlane.position.clone());null!=o&&t.fillClipPlane.offset(o),t.translateStartPt.set(e.clientX,e.clientY),t.cameraControl.update(!0)}t.coordinateSystem.update();var a=t.config.colors;t.drawingImpl.setColor("axisZ",a.highLight),t.drawingImpl.fill("arrow",a.highLight),t.drawingImpl.setColor("tipArcX",a.default),t.drawingImpl.fill("cubeX",a.default),t.drawingImpl.setColor("tipArcY",a.default),t.drawingImpl.fill("cubeY",a.default),e.preventDefault(),e.stopPropagation()}},document.onmouseup=function(){if(0!=t.arrowMouseDown){t.arrowMouseDown=!1,t.coordinateSystem.colorUpdate=!0;var e=t.config.colors;t.drawingImpl.setColor("axisZ",e.arrow),t.drawingImpl.fill("arrow",e.arrow),t.drawingImpl.setColor("tipArcX",e.tipArcX),t.drawingImpl.fill("cubeX",e.cubeX),t.drawingImpl.setColor("tipArcY",e.tipArcY),t.drawingImpl.fill("cubeY",e.cubeY),t.fillClipPlane.calculateClippingIds(),CLOUD$1.GlobalData.ClippingCaps=!0,t.viewer.render()}}}},{key:"registerCircleXEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcX");i.onmousedown=function(){e.circleXMouseDown=!0,e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.enableCircleXMovement()},i.onmouseout=function(){0==e.circleXMouseDown&&(e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow),e.drawingImpl.setColor("tipArcY",t.tipArcY),e.drawingImpl.fill("cubeY",t.cubeY),e.coordinateSystem.circleToArc("tipArcX"))},document.addEventListener("mouseup",function(){1==e.circleXMouseDown&&(e.fillClipPlane.calculateClippingIds(),CLOUD$1.GlobalData.ClippingCaps=!0,e.viewer.render()),e.circleXMouseDown=!1,e.circleXMouseDown=!1,e.firstClickDown=!0,e.firstRotate=!1,e.lastRotateX=0,e.lastRotateY=0,e.drawingImpl.show("tipArcY",!0),e.drawingImpl.show("axisY",!0),e.drawingImpl.show("axisZ",!0),e.drawingImpl.show("cubeY",!0),e.coordinateSystem.update(),e.drawingImpl.show("dashLineX",!1),e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow)})}},{key:"registerCircleYEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcY");i.onmousedown=function(){e.circleYMouseDown=!0,e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.enableCircleYMovement()},i.onmouseout=function(){0==e.circleYMouseDown&&(e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow),e.coordinateSystem.circleToArc("tipArcY"),e.drawingImpl.setColor("tipArcX",t.tipArcX),e.drawingImpl.fill("cubeX",t.cubeX))},document.addEventListener("mouseup",function(){1==e.circleYMouseDown&&(e.fillClipPlane.calculateClippingIds(),CLOUD$1.GlobalData.ClippingCaps=!0,e.viewer.render()),e.circleYMouseDown=!1,e.drawingImpl.show("tipArcX",!0),e.drawingImpl.show("cubeX",!0),e.coordinateSystem.update(),e.drawingImpl.show("dashLineY",!1),e.drawingImpl.setColor("axisZ",t.arrow),e.drawingImpl.fill("arrow",t.arrow)})}},{key:"enableCircleXMovement",value:function(){var e=this,t=this.config.colors;document.addEventListener("mousemove",function(i){if(1==e.circleXMouseDown){e.drawingImpl.show("dashLineX",!0),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.fillClipPlane.clearCapsWireframe(),CLOUD$1.GlobalData.ClippingCaps=!1;var n=e.fillClipPlane.normalIndex,o=e.viewportOffset,a=new THREE.Vector2(i.clientX-o.left,i.clientY-o.top),r=e.calcRotateAngleIndex(a,e.coordinateSystem.discretePointsX);1==e.firstClickDown&&(e.lastIndex=r);var s=2*(r-e.lastIndex);n>3?s=-s:"Reverse"==e.coordinateSystem.planeDirection&&(s=-s),e.drawingImpl.show("tipArcY",!1),e.coordinateSystem.updateAxisZ();var l=e.fillClipPlane.renderClipPlane.normal.clone(),u=e.coordinateSystem.getCoordinateAxis(),c=e.config.styles;e.coordinateSystem.drawClipPlaneCircle("tipArcZ",u.start.clone(),c.auxCircleRadius,e.coordinateSystem.dirX,l);var d=e.coordinateSystem.drawingToCanvas(u.start.clone()),h=e.coordinateSystem.drawingToCanvas(u.endY.clone());e.coordinateSystem.drawAxisY(d,h,t.highLight),e.coordinateSystem.drawCubeX("cubeX",h,c.cubeRadius),e.drawingImpl.show("cubeY",!1);var f="x";n<2&&(f="y"),e.fillClipPlane.rotateAngleOffset(s,f),e.coordinateSystem.backwardCoordinate(),1==e.firstClickDown?e.firstClickDown=!1:e.lastIndex=r,e.translateStartPt.set(i.clientX,i.clientY),e.viewer.render(),i.preventDefault(),i.stopPropagation()}})}},{key:"enableCircleYMovement",value:function(){var e=this,t=this.config.colors;document.addEventListener("mousemove",function(i){if(1==e.circleYMouseDown){e.drawingImpl.show("dashLineY",!0),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.fillClipPlane.clearCapsWireframe(),CLOUD$1.GlobalData.ClippingCaps=!1;var n=e.fillClipPlane.normalIndex,o=e.viewportOffset,a=new THREE.Vector2(i.clientX-o.left,i.clientY-o.top),r=e.calcRotateAngleIndex(a,e.coordinateSystem.discretePointsY);1==e.firstClickDown&&(e.lastIndex=r);var s=2*(r-e.lastIndex);n>3&&(s=-s,"Reverse"==e.coordinateSystem.planeDirection&&(s=-s)),e.drawingImpl.show("tipArcX",!1),e.coordinateSystem.updateAxisZ();var l=e.fillClipPlane.renderClipPlane.normal.clone(),u=e.coordinateSystem.getCoordinateAxis(),c=e.config.styles;e.coordinateSystem.drawClipPlaneCircle("tipArcZ",u.start.clone(),c.auxCircleRadius,e.coordinateSystem.dirX.clone(),l.clone());var d=e.coordinateSystem.drawingToCanvas(u.start.clone()),h=e.coordinateSystem.drawingToCanvas(u.endX.clone());e.coordinateSystem.drawAxisX(d,h,t.highLight),e.coordinateSystem.drawCubeY("cubeY",h,c.cubeRadius),e.drawingImpl.show("cubeX",!1);var f="z";n>3&&(f="y"),e.fillClipPlane.rotateAngleOffset(s,f),e.coordinateSystem.backwardCoordinate(),1==e.firstClickDown?e.firstClickDown=!1:e.lastIndex=r,e.translateStartPt.set(i.clientX,i.clientY),e.viewer.render(),i.preventDefault(),i.stopPropagation()}})}},{key:"registerTipArcXEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcX");i.onmouseover=function(){0==e.circleYMouseDown&&(e.coordinateSystem.arcToCircle("tipArcX"),e.drawingImpl.setColor("tipArcY",t.default),e.drawingImpl.fill("cubeY",t.default),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.registerCircleXEvents())},i.onmouseout=function(){0==e.circleXMouseDown&&e.coordinateSystem.circleToArc("tipArcX")}}},{key:"registerTipArcYEvents",value:function(){var e=this,t=this.config.colors,i=this.drawingImpl.getDrawable("tipArcY");i.onmouseover=function(){0==e.circleXMouseDown&&(e.coordinateSystem.arcToCircle("tipArcY"),e.drawingImpl.setColor("tipArcX",t.default),e.drawingImpl.fill("cubeX",t.default),e.drawingImpl.setColor("axisZ",t.default),e.drawingImpl.fill("arrow",t.default),e.registerCircleYEvents())},i.onmouseout=function(){0==e.circleYMouseDown&&e.coordinateSystem.circleToArc("tipArcY")}}},{key:"calcRotateAngleIndex",value:function(e,t){for(var i=this.coordinateSystem.cOrigin,n=this.createLine(e,i),o=-1,a=Number.POSITIVE_INFINITY,r=0;r<90;r++){var s=t[r].clone(),l=this.disPointToLine(s,n);l<a&&(a=l,o=r)}var u=90+o;return t[o].clone().distanceTo(e)<t[u].clone().distanceTo(e)?o:u}},{key:"createLine",value:function(e,t){var i={};if(e.x==t.x)i.A=1,i.B=0,i.C=-e.x;else{var n=(t.y-e.y)/(t.x-e.x),o=t.y-n*t.x;i.A=n,i.B=-1,i.C=o}return i}},{key:"disPointToLine",value:function(e,t){return Math.abs(t.A*e.x+t.B*e.y+t.C)/Math.sqrt(t.A*t.A+t.B*t.B)}}]),e}());e.CoordinateAction=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=function(){return{colors:{tipArcX:"#0000FF",cubeX:"#0000FF",tipArcY:"#FF0000",cubeY:"#FF0000",highLight:"#FFFF00",tipLine:"#11DAB7",arrow:"#11DAB7",default:"#A9A9A9"},styles:{dashArray:"10 8",originRadius:5,auxCircleRadius:100,tipLineLength:500,cubeRadius:5,axisXWidth:2,axisYWidth:2,axisZWidth:3,axisXLength:100,axisYLength:100,axisZLength:165,segments:180,tipArcLeftCounts:15,tipArcRightCounts:60}}};e.CoordinateSystemConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),t=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(){function e(t){_classCallCheck(this,e),this.viewer=t,this.cameraControl=t.cameraControl,this.fillClipPlane=CLOUD$1.FillClipPlaneManager.getInstance(t.getScene()),this.container=t.domElement,this.config=new Glodon.Bimface.Plugins.Section.CoordinateSystemConfig,this.drawingImpl=new Glodon.Bimface.Plugins.Section.CoordinateDrawer(this,t),this.coordinateAction=new Glodon.Bimface.Plugins.Section.CoordinateAction(this,this.drawingImpl),this.updateBinded=this.update.bind(this),this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.enable=!0,this.boundingBox=new THREE.Box2,this.bRegisterArrowEvent=!1,this.bRegisterAuxCircleEvent=!1,this.mapDrawableName={ORIGIN:"origin",AXISX:"axisX",AXISY:"axisY",CUBEX:"cubeX",CUBEY:"cubeY",AXISZ:"axisZ",ARROW:"arrow",DASHLINE:"dashLine",TIPARC_X:"tipArcX",TIPARC_Y:"tipArcY",TIPARC_Z:"tipArcZ",DASHLINE_X:"dashLineX",DASHLINE_Y:"dashLineY"}}},{key:"setDirection",value:function(e){this.planeDirection=e}},{key:"saveTransform",value:function(e){this.savedCamera=e.clone()}},{key:"drawingToCanvas",value:function(e,t){var i=this.getCoordinateAxis(),n=i.start.clone(),o=this.cameraControl.camera,a=new THREE.Vector3;if(void 0==this.cameraToCenter){var r=this.viewer.getCamera(),s=this.viewer.getScene().getBoundingBox();o.setStandardView(CLOUD$1.EnumStandardView.ISO,s),o.zoomToBBox(s),n=this.getCoordinateAxis().start.clone(),this.cameraToCenter=n.clone().sub(o.position.clone()).length();var l=this.viewer.getScene().getMatrixGlobal(),u=CLOUD$1.CameraUtil.parseCameraInfo(r),c=CLOUD$1.Camera.worldToDrawing(u,l),d=new THREE.Vector3;d.subVectors(c.target,c.position),o.LookAt(c.target,d,c.up),this.cameraControl.update(!0,!0)}else{var d=n.clone().sub(o.position.clone()).normalize(),h=o.position.clone().sub(n.clone()).length();a=d.multiplyScalar(this.cameraToCenter-h)}var f=this.container.offsetWidth,g=this.container.offsetHeight;!1!==t&&o.isPerspective&&e.add(a);var v=CLOUD$1.CameraUtil.drawingToCanvas(o,e,f,g);return new THREE.Vector2(v.x,v.y)}},{key:"getCoordinateAxis",value:function(){var e=this.fillClipPlane.renderClipPlane,t=e.normal.clone(),i=this.fillClipPlane.getCoordinate(),n=i.axisY.clone(),o=t.clone().cross(n.clone());this.fillClipPlane.normalIndex>3&&(o=i.axisX.clone(),n=o.clone().cross(t.clone()));var a=this.config.styles,r=this.fillClipPlane.position.clone(),s=r.clone().add(o.clone().multiplyScalar(a.axisXLength)),l=r.clone().add(n.clone().multiplyScalar(a.axisYLength)),u=r.clone().add(t.clone().multiplyScalar(a.axisZLength));return this.dirX=o,this.dirY=n,{start:r,endX:s,endY:l,endZ:u}}},{key:"drawOrigin",value:function(e,t){var i=this.mapDrawableName,n={center:e,radius:t,color:this.config.colors.default};this.drawingImpl.makeCircle(i.ORIGIN,n)}},{key:"drawAxisX",value:function(e,t,i){var n=this.mapDrawableName,o=this.config,a={start:e,end:t,width:o.styles.axisXWidth,color:i||this.config.colors.default};this.drawingImpl.makeLine(n.AXISX,a)}},{key:"drawAxisY",value:function(e,t,i){var n=this.mapDrawableName,o=this.config,a={start:e,end:t,width:o.styles.axisYWidth,color:i||o.colors.default};this.drawingImpl.makeLine(n.AXISY,a)}},{key:"drawAxisZ",value:function(e,t){var i=this.mapDrawableName,n=this.config,o={start:e,end:t,width:n.styles.axisZWidth,color:n.colors.arrow};this.drawingImpl.makeLine(i.AXISZ,o),this.drawingImpl.attach(),0==this.bRegisterArrowEvent&&(this.coordinateAction.registerArrowEvents(),this.bRegisterArrowEvent)}},{key:"updateAxisZ",value:function(){var e=this.getCoordinateAxis(),t=this.drawingToCanvas(e.start.clone()),i=this.drawingToCanvas(e.endZ.clone()),n=this.mapDrawableName,o={start:t,end:i,color:this.config.colors.default};this.drawingImpl.makeLine(n.AXISZ,o)}},{key:"drawArrow",value:function(e,t){var i=this.mapDrawableName,n={start:e,end:t};this.drawingImpl.makeLine(i.AXISZ,n),this.drawingImpl.attach(),this.drawingImpl.setColor(i.AXISZ,this.config.colors.default),0==this.bRegisterArrowEvent&&(this.coordinateAction.registerArrowEvents(),this.bRegisterArrowEvent)}},{key:"drawClipPlaneCircle",value:function(e,t,i,n,o){for(var a={center:t.clone(),radius:i,normal:n.clone(),rotateAxis:o.clone()},r=this.config.styles,s=r.segments,l=this.discreteCircle(a,s),u="",c=0;c<s;c++)u+=l[c].x+","+l[c].y,u+=" ";u+=l[0].x+","+l[0].y,u+=" ";var d={points:u,color:this.config.colors.default,width:2};this.drawingImpl.makePolyline(e,d)}},{key:"drawTipArc",value:function(e,t,i,n,o){var a={center:t.clone(),radius:i,normal:n.clone(),rotateAxis:o.clone()},r=this.config.styles,s=r.tipArcRightCounts,l=r.tipArcLeftCounts,u=r.segments,c=this.discreteCircle(a,u);e==this.mapDrawableName.TIPARC_X?(this.discretePointsX=c,s=r.tipArcLeftCounts,l=r.tipArcRightCounts):this.discretePointsY=c;for(var d="",h=u-s-1;h<u;h++)d+=c[h].x+","+c[h].y,d+=" ";for(var f=0;f<=l;f++)d+=c[f].x+","+c[f].y,d+=" ";var g={points:d,color:this.config.colors.tipArcX};e==this.mapDrawableName.TIPARC_X?(this.drawingImpl.makePolyline(e,g),this.coordinateAction.registerTipArcXEvents()):e==this.mapDrawableName.TIPARC_Y&&(g.color=this.config.colors.tipArcY,this.drawingImpl.makePolyline(e,g),this.coordinateAction.registerTipArcYEvents())}},{key:"drawTipLine",value:function(e,t,i){var n=this.drawingToCanvas(t.clone(),!1),o=this.drawingToCanvas(i.clone(),!1),a=this.config,r={start:n,end:o,color:a.colors.tipLine,dashArray:a.styles.dashArray};this.drawingImpl.makeDashLine(e,r),this.drawingImpl.show(e,!1)}},{key:"drawCubeX",value:function(e,t,i){var n={center:t,radius:i,color:this.config.colors.cubeX};this.drawingImpl.makeCircle(e,n)}},{key:"drawCubeY",value:function(e,t,i,n){var o={center:t,radius:i,color:n||this.config.colors.cubeY};this.drawingImpl.makeCircle(e,o)}},{key:"discreteCircle",value:function(e,t){for(var i=e.center.clone(),n=e.radius,o=e.rotateAxis.clone(),a=e.normal.clone(),r=[],s=0;s<t;s++){a.applyAxisAngle(o,2*Math.PI/t);var l=i.clone().add(a.clone().multiplyScalar(n)),u=this.drawingToCanvas(l.clone());r.push(u)}return r}},{key:"arcToCircle",value:function(e){var t="",i=this.discretePointsX;e==this.mapDrawableName.TIPARC_Y&&(i=this.discretePointsY);for(var n=0,o=i.length;n<o;n++)t+=i[n].x+","+i[n].y,t+=" ";t+=i[0].x+","+i[0].y,t+=" ";var a={points:t,color:this.config.colors.highLight};this.drawingImpl.makePolyline(e,a)}},{key:"circleToArc",value:function(e){var t=this.config.styles,i=t.tipArcLeftCounts,n=t.tipArcRightCounts,o=t.segments,a=this.discretePointsX,r={color:this.config.colors.tipArcX};e==this.mapDrawableName.TIPARC_Y&&(a=this.discretePointsY,r.color=this.config.colors.tipArcY,i=t.tipArcRightCounts,n=t.tipArcLeftCounts);for(var s="",l=o-i-1;l<o;l++)s+=a[l].x+","+a[l].y,s+=" ";for(var u=0;u<=n;u++)s+=a[u].x+","+a[u].y,s+=" ";r.points=s,this.drawingImpl.makePolyline(e,r)}},{key:"update",value:function(e){if(1==e||1!=this.bIsCoordinateHided){var t=this.getCoordinateAxis(),i=this.drawingToCanvas(t.start.clone()),n=this.drawingToCanvas(t.endX.clone()),o=this.drawingToCanvas(t.endY.clone()),a=this.drawingToCanvas(t.endZ.clone());void 0==this.createRefs&&(this.drawingImpl.makeDefs("refs"),this.createRefs=!0),this.cOrigin=i.clone(),this.drawAxisZ(i,a),this.drawAxisX(i,n),this.drawAxisY(i,o);var r=this.config.styles,s=this.mapDrawableName,l=this.fillClipPlane.renderClipPlane.normal.clone();this.drawClipPlaneCircle(s.TIPARC_Z,t.start.clone(),r.auxCircleRadius,this.dirX,l),this.drawTipArc(s.TIPARC_X,t.start.clone(),r.auxCircleRadius,l,this.dirX),this.drawTipArc(s.TIPARC_Y,t.start.clone(),r.auxCircleRadius,l,this.dirY);var u=this.fillClipPlane.getSideLength()/2,c=t.start.clone().add(this.dirX.clone().multiplyScalar(u)),d=t.start.clone().sub(this.dirX.clone().multiplyScalar(u));this.drawTipLine(s.DASHLINE_X,c,d);var h=t.start.clone().add(this.dirY.clone().multiplyScalar(u)),f=t.start.clone().sub(this.dirY.clone().multiplyScalar(u));this.drawTipLine(s.DASHLINE_Y,h,f),this.drawOrigin(i,r.originRadius);var g=this.discretePointsX[44].clone();this.drawCubeX(s.CUBEX,g,r.cubeRadius);var v=this.discretePointsY[134].clone();this.drawCubeY(s.CUBEY,v,r.cubeRadius),this.updateBbox()}}},{key:"hide",value:function(e){this.drawingImpl.hideAll(e),this.bIsCoordinateHided=e}},{key:"destroy",value:function(){this.drawingImpl.destroy()}},{key:"updateBbox",value:function(){this.boundingBox.makeEmpty();for(var e=0;e<this.discretePointsX.length;e++){var t=this.discretePointsX[e].clone();this.boundingBox.expandByPoint(t)}for(e=0;e<this.discretePointsY.length;e++){var t=this.discretePointsY[e].clone();this.boundingBox.expandByPoint(t)}var i=this.getCoordinateAxis(),n=this.drawingToCanvas(i.start.clone()),o=this.drawingToCanvas(i.endZ.clone());this.boundingBox.expandByPoint(n),this.boundingBox.expandByPoint(o),this.boundingBox.expandByScalar(5)}},{key:"insideBoundingBox",value:function(e){return this.boundingBox.containsPoint(e.clone())}},{key:"backwardCoordinate",value:function(){var e=this.cameraControl.camera.position,t=this.cameraControl.camera.target,i=t.clone().sub(e.clone()).normalize(),n=this.fillClipPlane.renderClipPlane.normal.clone();i.angleTo(n);Math.PI}}]),e}());e.CoordinateSystem=t}(),function(){var e=Object.freeze({SectionPlaneUpdate:"SectionPlaneUpdate"});Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section").SectionPlaneEvent=e}(),function(){var e="Bimface.Plugins.Section.SectionPlane",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Section"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility")),o={Forward:0,Reverse:1},a={X:0,Y:2,Z:4},r=function(e){var t=this,i=e.viewer;return i?i instanceof Glodon.Bimface.Viewer.Viewer3D?(i._sectionBox&&(i._sectionBox.hideBox(),!1!==e.exitSectionBox&&i._sectionBox.exit()),i._sectionPlane?(i._sectionPlane.showPlane(),i._sectionPlane):(i._sectionPlane=this,t.id=e.id,t._opt=e,t.mode=e.mode,t._plane=e.plane,t._direction=e.direction,t._progress=-1,this.onFloorExplosionBinded=this.onFloorExplosion.bind(this),this.onClipMouseHoverBinded=this.onClipMouseHover.bind(this),this.onClipMouseMoveBinded=this.onClipMouseMove.bind(this),t.init(),void t.setPlane(e.plane))):void console.log("Viewer2D is not supported."):void console.log("domElement must not be empty.")};r.prototype={init:function(){t.send(e,"init"),this.enableCoordinate=!0;var i=this._opt.viewer.getViewer(),n=this;this.coordinateSystem=new Glodon.Bimface.Plugins.Section.CoordinateSystem(i),this.coordinateSystem.setDirection(this._direction),CLOUD$1.GlobalData.ClippingCaps=!0,i.editorManager.enableTool(i,CLOUD$1.EditToolMode.CLIP_FILL),this._sectionTool=CLOUD$1.FillClipPlaneManager.getInstance(i.getScene());var o=this._opt.viewer;this._sectionTool.observer=function(){var e=Glodon.Bimface.Plugins.Section.SectionPlaneEvent;o.getEventManager().fireEvent(e.SectionPlaneUpdate,n)},this._sectionTool.enable(!0,!0),this.hookEvens()},hookEvens:function(){var e=this.coordinateSystem,t=this._opt.viewer.getViewer(),i=n.throttle;t.registerEventListener(CLOUD$1.EVENTS.ON_CLIP_HOVER,this.onClipMouseHoverBinded),t.registerEventListener(CLOUD$1.EVENTS.ON_CLIP_MOUSE_MOVE,this.onClipMouseMoveBinded),t.registerEventListener(CLOUD$1.EVENTS.ON_EDITOR_ZOOM,i(e.updateBinded,50)),t.registerEventListener(CLOUD$1.EVENTS.ON_CAMERA_ANIMATION_UPDATE,i(e.updateBinded,50)),t.registerEventListener(CLOUD$1.EVENTS.ON_EDITOR_END,function(){e.update(!0)}),this._opt.viewer.addEventListener(Glodon.Bimface.Viewer.Viewer3DEvent.FloorExplosion,this.onFloorExplosionBinded)},onFloorExplosion:function(){this.resetSectionTool(),this._opt.viewer.render()},onClipMouseHover:function(e){var t=this.coordinateSystem,i=this._opt.viewer.getDomElement();if(0!=this.enableCoordinate)if(e.onClipPlane)t.hide(!1),t.update();else{i.style.cursor="";var n=new THREE.Vector2(e.event.clientX,e.event.clientY);t.insideBoundingBox(n)?t.hide(!1):t.hide(!0)}},onClipMouseMove:function(){this.coordinateSystem.update()},exit:function(){var e=this._opt.viewer.getViewer(),t=CLOUD$1.FillClipPlaneManager.getInstance(e.getScene());e.editorManager.disableTool(CLOUD$1.EditToolMode.CLIP_FILL),t.clearCapsWireframe(),CLOUD$1.GlobalData.ClippingCaps=!1,t.enable(!1,!1),this.coordinateSystem.destroy(),e.getScene().removeObjectGroup(t),e.getScene().fillClipPlane=null,e.modelManager.resetClippingCapsStatus();var i=Glodon.Bimface.Plugins.Section.SectionPlaneEvent;this._opt.viewer.getEventManager().fireEvent(i.SectionPlaneUpdate,null),this._sectionTool=null,this._opt.viewer._sectionPlane=null,e.unregisterEventListener(CLOUD$1.EVENTS.ON_CLIP_HOVER,this.onClipMouseHoverBinded),e.unregisterEventListener(CLOUD$1.EVENTS.ON_CLIP_MOUSE_MOVE,this.onClipMouseMoveBinded),this._opt.viewer.removeEventListener(Glodon.Bimface.Viewer.Viewer3DEvent.FloorExplosion,this.onFloorExplosionBinded)},setProgress:function(i){t.send(e,"setProgress");var n=1-i/50;this._progress=i,this._sectionTool.setProcess(n),this._sectionTool.clearCapsWireframe(),this._sectionTool.calculateClippingIds()},getProgress:function(){return 50*(1-this._sectionTool.getProcess())},setPlane:function(i){t.send(e,"setPlane");var n=o[this._direction]+a[i];this._plane=i,this._sectionTool.changeNormal(n),this.setProgress(this._opt.progress)},getPlane:function(){return this._plane},setDirection:function(i){t.send(e,"setDirection");var n=o[i]+a[this._plane];this._direction=i,this._sectionTool.changeNormal(n),this.setProgress(this._opt.progress)},getDirection:function(){return this._direction},setRotateAngle:function(e,t){this._sectionTool.setRotateAngle(e,t)},getRotateAngle:function(){return this._sectionTool.getRotateAngle()},hidePlane:function(){t.send(e,"hidePlane"),this._sectionTool&&(this._sectionTool.visible=!1),this.enableCoordinate=!1,this.coordinateSystem.hide(!0)},showPlane:function(){t.send(e,"showPlane"),this._sectionTool&&(this._sectionTool.visible=!0),this.enableCoordinate=!0},rotateByAxis:function(i,n){if(t.send(e,"rotateByAxis"),"YAxis"!==i&&"ZAxis"!==i)return void console.log("Rotate axis must be YAxis or ZAxis.");var r="",s=0,l=o[this.getDirection()]+a[this._plane];0==l||1==l?(s="YAxis"===i?-n:n,r="YAxis"===i?"y":"z"):2==l||3==l?(s="YAxis"===i?-n:n,r="YAxis"===i?"x":"z"):4!=l&&5!=l||(s="YAxis"===i?n:-n,r="YAxis"===i?"x":"y"),s="Reverse"===this._direction?n:s,this._sectionTool&&(this._sectionTool.rotateAngleOffset(s,r),this._sectionTool.clearCapsWireframe(),this._sectionTool.calculateClippingIds())},reset:function(){t.send(e,"reset");var i=this;i.setPlane(i._opt.plane),i.setDirection(i._opt.direction),i.setProgress(i._opt.progress)},getState:function(){return this._sectionTool.store()},isIncluded:function(e){var t=this._opt.viewer,i=t.getViewer().getScene(),n=CLOUD$1.FillClipPlaneManager.getInstance(i),o=n.renderClipPlane.normal.clone().normalize(),a=n.position,r=t.worldToScene(e),s=new THREE.Vector3;return s.subVectors(r,a).normalize(),o.angleTo(s)>Math.PI/2},setPositionByPlane:function(e,t,n){var o=this._opt.viewer;e=o.worldToScene(e),t=o.worldToScene(t);var a=new THREE.Vector3(e.x,e.y,e.z),r=new THREE.Vector3(t.x,t.y,t.z),s=a.clone().add(r.clone().multiplyScalar(n));this._opt.plane=i.SectionPlanePlane.X,this._opt.direction=i.SectionPlaneDirection.Forward,this.reset(),this._sectionTool.update();var l=new THREE.Vector3(1,0,0),u=new THREE.Vector3(0,1,0),c=1,d=r.clone().projectOnPlane(u);if(0!=d.length){d.normalize(),c=l.clone().cross(d).y>0?1:-1;var h=l.clone().angleTo(d);this.rotateByAxis("ZAxis",h*THREE.Math.RAD2DEG*c)}var f=d.clone().angleTo(r.clone());c=r.y<0?1:-1,this.rotateByAxis("YAxis",f*THREE.Math.RAD2DEG*c),this._sectionTool.position.copy(s);var g=this._sectionTool.center.clone();this._sectionTool.planeOffset=g.distanceTo(s),this._sectionTool.update()},setState:function(i){t.send(e,"setState"),this._sectionTool.restore(i)},restoreRotation:function(){this._sectionTool.restoreRotation()},getSectionPlane:function(){var e=this._opt.viewer,t=this._sectionTool.position.clone(),i=this._sectionTool.renderClipPlane.normal.clone();return t=e.sceneToWorld(t),i=e.sceneToWorld(i),i=new THREE.Vector3(i.x,i.y,i.z),i.normalize(),{position:t,normal:i}},setSectionPlane:function(e){var t=this._opt.viewer;this.reset();var i=t.worldToScene(e.position),n=t.worldToScene(e.normal);n=new THREE.Vector3(n.x,n.y,n.z),n.normalize();var o=new THREE.Vector3(1,0,0),a=new THREE.Quaternion;a.setFromUnitVectors(o,n);var r=new THREE.Euler;r.setFromQuaternion(a),r.x=0,a.setFromEuler(r),a.x=-a.x;var s=this._sectionTool.uniforms.vClipPlane.value[0].clone(),l=new THREE.Vector3(s.x,s.y,s.z);l.normalize();var u=new THREE.Vector3(i.x,i.y,i.z),c=u.sub(this._sectionTool.center);this._sectionTool.planeOffset=c.x/l.x,this._sectionTool.quaternion.copy(a),this._sectionTool.position.copy(i),this._sectionTool.update()},resetSectionTool:function(){var e=this._opt.viewer,t=e.getViewer().getScene(),i=t.getBoundingBox();this._sectionTool.resize(i.getSize().multiplyScalar(t.expandScalar)),this._sectionTool.center.copy(i.getCenter()),this._sectionTool.position.copy(i.getCenter()),this._sectionTool.update(),this._sectionTool.clearCapsWireframe(),this._sectionTool.calculateClippingIds()}},i.SectionPlane=r}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Walkthrough"),t=function(){return{viewer:null,time:10,stopCallback:null}};e.WalkthroughConfig=t}(),function(){var e="Bimface.Plugins.Walkthrough",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Walkthrough"),n=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.HttpRequest"),function(){function i(e){_classCallCheck(this,i);var t=e.viewer,n=t.getViewer();return t?t instanceof Glodon.Bimface.Viewer.Viewer3D?(this._viewer=t,this.bPause=!1,this.cameraStatus=null,this._walkthrough=new CLOUD$1.Walkthrough,this._player=new CLOUD$1.WalkthroughPlayer(n),this._player.setWalkthrough(this._walkthrough),e.stopCallback&&this._player.addStopPlayCallback(e.stopCallback),void this.setWalkthroughTime(e.time)):void console.log("Viewer2D is not supported."):void console.log("viewer must not be empty.")}return _createClass(i,[{key:"addKeyFrame",value:function(i){t.send(e,"addKeyFrame");var n=this._viewer,o=n.getViewer().camera,a={id:Glodon.Web.Lang.Utility.UUID.createUUID(),position:o.position.clone(),target:o.target.clone(),name:i};this._walkthrough.addKeyFrame(a);var r=Object.assign({},a);return r.position=n.sceneToWorld(a.position),r.target=n.sceneToWorld(a.target),r.coordinateSystem="world",r}},{key:"setKeyFrameCallback",value:function(i){t.send(e,"setKeyFrameCallback"),this._player.setKeyFrameCallback(i)}},{key:"removeKeyFrame",value:function(i){t.send(e,"removeKeyFrame"),this._walkthrough.removeKeyFrame(i)}},{key:"clearKeyFrames",value:function(){t.send(e,"clearKeyFrames"),this._walkthrough.clearFrames()}},{key:"setKeyFrames",value:function(i){var n=this;t.send(e,"setKeyFrames"),"string"==typeof i&&(i=JSON.parse(i));var o=[];i.forEach(function(e){var t=Object.assign({},e);"world"===t.coordinateSystem&&(t.position=n._viewer.worldToScene(e.position),t.target=n._viewer.worldToScene(e.target)),o.push(t)}),this._walkthrough.setKeyFrameList(o)}},{key:"getKeyFrames",value:function(){var e=this,t=this._walkthrough.getKeyFrames(),i=[];return t.forEach(function(t){var n=Object.assign({},t);n.position=e._viewer.sceneToWorld(t.position),n.target=e._viewer.sceneToWorld(t.target),n.coordinateSystem="world",i.push(n)}),i}},{key:"setWalkthroughTime",value:function(i){t.send(e,"setWalkthroughTime"),this._walkthrough.setWalkthroughTime(i)}},{key:"play",value:function(i){t.send(e,"play");var n=this._viewer.getViewer(),o=this._player,a=this.cameraStatus,r=n.cameraControl.camera;if(r.up.set(0,1,0),r.realUp.set(0,1,0),i&&o.startFrom(i),o.stop(!1),!0===this.bPause){var r=n.getCamera();a&&function(e){var e=JSON.parse(e),t=e.position,i=e.target,n={position:new THREE.Vector3(t.x,t.y,t.z),target:new THREE.Vector3(i.x,i.y,i.z)},o=a,r=n.position.clone().sub(o.position),s=n.target.clone().sub(o.target);return r.length()>0||s.length()>0}(r)&&(this._player.camera.position.copy(this._viewer.worldToScene(a.position)),this._player.camera.target.copy(this._viewer.worldToScene(a.target)))}o.play(),this.bPause=!1}},{key:"pause",value:function(){t.send(e,"pause"),this.bPause=!0,this.cameraStatus=this._viewer.getCameraStatus(),this._player.pause()}},{key:"stop",value:function(){t.send(e,"stop"),this._player.stop(!0),this._stopCallback&&this._stopCallback(),this.bPause=!1}},{key:"stopCallback",value:function(i){t.send(e,"stopCallback"),i&&(this._stopCallback=i,this._player.addStopPlayCallback(i))}}]),i}());i.Walkthrough=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Segment"),t=function(){return{viewer:null}};e.SegmentConfig=t}(),function(){Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Segment").IsolateOption=Object.freeze({Hidden:"Hidden",Translucent:"Translucent",PartlyTranslucent:"PartlyTranslucent"})}(),function(){var e="Bimface.Plugins.Segment",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Segment"),n=function(){function i(e){_classCallCheck(this,i),this._viewer=e.viewer,this._segmentInfoMap=null,this._segmentInfoArray=null,this._segmentIdArray=null,this._elementIdMap={},this._loading=!1,this._segmentInfoAcquired=!1,this._segmentIdMapFromComponentId=null}return _createClass(i,[{key:"destroy",value:function(){this._viewer=null,this._segmentInfoMap=null,this._segmentInfoArray=null,this._segmentIdArray=null,this._elementIdMap=null,this._segmentIdMapFromComponentId=null}},{key:"_hasSegmentInfo",value:function(e){return!(!this._segmentInfoMap||!this._segmentInfoMap[e])}},{
key:"_getSegmentInfoById",value:function(e){return this._segmentInfoMap?this._segmentInfoMap[e]:null}},{key:"_removeDuplication",value:function(e){for(var t={},i=0,n=e.length;i<n;i++)this._hasSegmentInfo(e[i])&&!t[e[i]]&&(t[e[i]]=!0);return Object.keys(t)}},{key:"_getSegmentElementIdsByIdx",value:function(e,t,i){var n=this,o=this._viewer,a=e[t];o.getSegmentElementIds(a,function(e){e.data&&(n._elementIdMap[a]=e.data),i&&i()},function(){i&&i()})}},{key:"_getSegmentElementIds",value:function(e){function t(i,a){var r=a;return function(){o._getSegmentElementIdsByIdx(i,r,function(){r<n-1?requestAnimationFrame(t(i,r+1)):e&&e()})}}var i=this._segmentIdArray,n=i.length,o=this;this._elementIdMap={},n>0?requestAnimationFrame(t(i,0)):e&&e()}},{key:"_getSegmentMetadataByIdx",value:function(e,t,i){var n=this._viewer,o=e[t],a=this.segmentFilePathMap[o].metadata,r=this.segmentFilePathMap[o].databag;n.getSegmentManager().getSegmentMetadata(r,a,function(){i&&i()},function(){i&&i()})}},{key:"_getSegmentMetadata",value:function(e){function t(i,a){var r=a;return function(){o._getSegmentMetadataByIdx(i,r,function(){r<n-1?requestAnimationFrame(t(i,r+1)):e&&e()})}}var i=Object.keys(this.segmentFilePathMap),n=i.length,o=this;n>0?requestAnimationFrame(t(i,0)):e&&e()}},{key:"_loadMetadata",value:function(e){for(var t=this._viewer,i=this._segmentIdArray,n=this.segmentFilePathMap={},o=this.segmentFileInfoMap={},a=0,r=i.length;a<r;a++){var s=i[a],l=this._getSegmentInfoById(s),u=l.partialElementFiles,c=[];if(u)for(var d=0,h=u.length;d<h;d++){var f=u[d].databagId;if(f){var g=null;n[f]?g=n[f]:(g={databag:t.getDatabagResource(f),metadata:t.getPartialElementsMetadataFile(f),fileId:u[d].fileId},n[f]=g),c.push(g)}}o[s]={id:s,paths:c,elementIds:this._elementIdMap[s]}}this._getSegmentMetadata(e)}},{key:"_loadSegments",value:function(e,t){if(!(e=e||this._segmentIdArray))return void(t&&t());for(var i=this._viewer,n=this._removeDuplication(e),o=[],a=0,r=n.length;a<r;a++){var s=this.segmentFileInfoMap[n[a]];s&&o.push(s)}if(0===o.length)return void(t&&t());i.getSegmentManager().loadSegments(o,function(){t&&t()})}},{key:"getSegmentInfo",value:function(i){function n(e,t){if(e.subGroups)for(var i=e.subGroups,o=0,a=i.length;o<a;o++)n(i[o],t);else if(e.segments)for(var r=0,s=e.segments.length;r<s;r++){var l=e.segments[r];t[l.id]=l}}if(t.send(e,"getSegmentInfo"),this._loading)return null;if(this._segmentInfoAcquired)return i&&i(this._segmentInfoArray),this._segmentInfoArray;var o=this;return this._loading=!0,this._viewer.getSegmentTree(function(e){for(var t=e.data,a=o._segmentInfoMap={},r=0,s=t.length;r<s;r++)n(t[r],a);o._segmentIdArray=Object.keys(o._segmentInfoMap),o._segmentInfoArray=[];for(var l=o._segmentInfoArray.length=o._segmentIdArray.length,u=0;u<l;u++)o._segmentInfoArray[u]=o._segmentInfoMap[o._segmentIdArray[u]];o._getSegmentElementIds(function(){o._loadMetadata(function(){o._loading=!1,o._segmentInfoAcquired=!0,i&&i(o._segmentInfoArray)})})},function(e){console.error("request segment data error!")}),null}},{key:"loadSegments",value:function(i,n){if(t.send(e,"loadSegments"),this._segmentInfoAcquired)this._loadSegments(i,n);else{var o=this;this.getSegmentInfo(function(e){o._loadSegments(i,n)})}}},{key:"unloadSegments",value:function(i){t.send(e,"unloadSegments"),(i=i||this._segmentIdArray)&&(this._viewer.getSegmentManager().unloadSegments(this._removeDuplication(i)),this._viewer.render())}},{key:"hideComponentsBySegment",value:function(i){t.send(e,"hideComponentsBySegment"),this._viewer.getSegmentManager().hideComponentsBySegment(this._removeDuplication(i)),this._viewer.render()}},{key:"showComponentsBySegment",value:function(i){t.send(e,"showComponentsBySegment"),this._viewer.getSegmentManager().showComponentsBySegment(this._removeDuplication(i)),this._viewer.render()}},{key:"isolateComponentsBySegment",value:function(i,n){t.send(e,"isolateComponentsBySegment");var o=void 0,a=Glodon.Bimface.Plugins.Segment.IsolateOption;switch(n){case a.Hidden:o=this._viewer.getSegmentManager().getSegmentIsolateOption().HIDDEN;break;case a.Translucent:o=this._viewer.getSegmentManager().getSegmentIsolateOption().TRANSLUCENT;break;case a.PartlyTranslucent:o=this._viewer.getSegmentManager().getSegmentIsolateOption().PARTLYTRANSLUCENT}void 0!==o&&(this._viewer.getSegmentManager().isolateComponentsBySegment(this._removeDuplication(i),o),this._viewer.render())}},{key:"disable",value:function(){this._viewer.getSegmentManager().disable(),this._viewer.render()}},{key:"enable",value:function(){this._viewer.getSegmentManager().enable(),this._viewer.render()}},{key:"getSegementIds",value:function(e){if(!this._segmentInfoAcquired)return console.error("Call the function getSegmentInfo() first!"),null;if(this._segmentIdMapFromComponentId)return this._segmentIdMapFromComponentId[e];for(var t=this._segmentIdMapFromComponentId={},i=Object.keys(this._elementIdMap),n=0,o=i.length;n<o;n++)for(var a=i[n],r=this._elementIdMap[a],s=0,l=r.length;s<l;s++){var u=r[s];t[u]||(t[u]=[]),t[u].push(a)}var c=this._viewer.getSegmentManager().getSegmentIdsByPartialElementId(e);return c&&(t[e]=c),t[e]}}]),i}();i.Segment=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.AxisGrid"),i=function(){function t(e){_classCallCheck(this,t),this.svgContainer=e,this.initialize(),this.visibility=!1}return _createClass(t,[{key:"initialize",value:function(){var t=e.createNS("line","bf-axisgrid-line"),i=t.cloneNode();i.style.strokeWidth=1,i.style.stroke="#ffffff",i.style.opacity=.5,this.svgContainer.appendChild(i),this.lineLeft=i;var n=t.cloneNode();n.style.strokeWidth=1,n.style.stroke="#ffffff",n.style.opacity=.5,this.svgContainer.appendChild(n),this.lineRight=n}},{key:"updateBorderLeft",value:function(e,t){var i=new THREE.Vector2(e.x,e.y),n=new THREE.Vector2(t.x,t.y);e.y==t.y?(i.y-=2,n.y-=2):(i.x-=2,n.x-=2),this.moveLineTo(this.lineLeft,i,n)}},{key:"updateBorderRight",value:function(e,t){var i=new THREE.Vector2(e.x,e.y),n=new THREE.Vector2(t.x,t.y);e.y==t.y?(i.y+=2,n.y+=2):(i.x+=2,n.x+=2),this.moveLineTo(this.lineRight,i,n)}},{key:"hide",value:function(){this.lineLeft.style.display="none",this.lineRight.style.display="none",this.visibility=!1}},{key:"show",value:function(){this.lineLeft.style.display="block",this.lineRight.style.display="block",this.visibility=!0}},{key:"update",value:function(e,t){0!=this.visibility&&(this.updateBorderLeft(e,t),this.updateBorderRight(e,t))}},{key:"moveLineTo",value:function(e,t,i){e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",i.x),e.setAttribute("y2",i.y)}}]),t}();t.HighlightBorderLines=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.AxisGrid"),i=function(){function t(e,i){_classCallCheck(this,t),this.svgContainer=e,this.viewer=i,this.borderline=new Glodon.Bimface.Plugins.AxisGrid.HighlightBorderLines(e),this.initialize(),this.visibility=!1}return _createClass(t,[{key:"initialize",value:function(){var t=e.createNS("line","bf-axisgrid-line");t.style.strokeWidth=2,t.style.stroke="#32D5A7",this.svgContainer.appendChild(t),this.line=t}},{key:"hide",value:function(){this.line.style.display="none",this.borderline.hide(),this.visibility=!1}},{key:"show",value:function(){this.line.style.display="block",this.borderline.show(),this.visibility=!0}},{key:"setLine",value:function(e){this.highlightLine=e}},{key:"setHeight",value:function(e){this.axisgridHeight=e}},{key:"update",value:function(){if(0!=this.visibility){var e=this.highlightLine,t=new THREE.Vector3(e[0],e[1],this.axisgridHeight),i=new THREE.Vector3(e[3],e[4],this.axisgridHeight),n=this.worldPointsToClient(t,i);n&&(this.moveLineTo(this.line,n.start,n.end),this.borderline.update(n.start,n.end))}}},{key:"worldPointsToClient",value:function(e,t){var i=this.viewer.getDomElement(),n=i.getBoundingClientRect(),o=this.viewer.getViewer(),a=o.worldPointsToClient(e,t);return a&&(a.start.x-=n.left,a.start.y-=n.top,a.end.x-=n.left,a.end.y-=n.top),a}},{key:"moveLineTo",value:function(e,t,i){e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",i.x),e.setAttribute("y2",i.y)}}]),t}();t.HighlightLine=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.AxisGrid"),i=function(){function t(e,i){_classCallCheck(this,t),this.svgContainer=e,this.viewer=i,this.horizBorderline=new Glodon.Bimface.Plugins.AxisGrid.HighlightBorderLines(e),this.verticalBorderline=new Glodon.Bimface.Plugins.AxisGrid.HighlightBorderLines(e),this.initialize(),this.visibility=!1}return _createClass(t,[{key:"initialize",value:function(){var t=e.createNS("line","bf-axisgrid-line"),i=t.cloneNode();i.style.strokeWidth=2,i.style.stroke="#32D5A7",this.svgContainer.appendChild(i),this.svgHorizLine=i;var n=t.cloneNode();n.style.strokeWidth=2,n.style.stroke="#32D5A7",this.svgContainer.appendChild(n),this.svgVerticalLine=n;var o=e.createNS("circle","bf-axisgrid-point");o.setAttribute("r",3),o.setAttribute("fill","#32D5A7"),this.svgContainer.appendChild(o),this.hoverPoint=o,this.hide()}},{key:"setLine",value:function(e,t){this.horizLine=e,this.verticalLine=t}},{key:"setPoint",value:function(e){this.intersectPoint=e}},{key:"setHeight",value:function(e){this.axisgridHeight=e}},{key:"update",value:function(){if(0!=this.visibility){var e=this.horizLine,t=this.verticalLine,i=this.viewer.worldToClient(this.intersectPoint),n=new THREE.Vector3(e[0],e[1],this.axisgridHeight),o=new THREE.Vector3(e[3],e[4],this.axisgridHeight),a=new THREE.Vector3(t[0],t[1],this.axisgridHeight),r=new THREE.Vector3(t[3],t[4],this.axisgridHeight),s=this.worldPointsToClient(n,o);s&&(this.moveLineTo(this.svgHorizLine,s.start,s.end),this.horizBorderline.update(s.start,s.end));var l=this.worldPointsToClient(a,r);l&&(this.moveLineTo(this.svgVerticalLine,l.start,l.end),this.verticalBorderline.update(l.start,l.end)),this.movePointTo(this.hoverPoint,i.x,i.y)}}},{key:"worldPointsToClient",value:function(e,t){var i=this.viewer.getDomElement(),n=i.getBoundingClientRect(),o=this.viewer.getViewer(),a=o.worldPointsToClient(e,t);return a&&(a.start.x-=n.left,a.start.y-=n.top,a.end.x-=n.left,a.end.y-=n.top),a}},{key:"hide",value:function(){this.svgHorizLine.style.display="none",this.svgVerticalLine.style.display="none",this.hoverPoint.style.display="none",this.horizBorderline.hide(),this.verticalBorderline.hide(),this.visibility=!1}},{key:"show",value:function(){this.svgHorizLine.style.display="block",this.svgVerticalLine.style.display="block",this.hoverPoint.style.display="block",this.horizBorderline.show(),this.verticalBorderline.show(),this.visibility=!0}},{key:"moveLineTo",value:function(e,t,i){e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",i.x),e.setAttribute("y2",i.y)}},{key:"movePointTo",value:function(e,t,i){e.setAttribute("cx",t),e.setAttribute("cy",i)}}]),t}();t.HighlightIntersectLines=i}(),function(){var e="Bimface.Plugins.AxisGrid",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.AxisGrid"),o=function(){function n(o){_classCallCheck(this,n),t.send(e,"AxisGridManager"),this.snapMinDistance=5,this.viewer=o.viewer,this.registerEvent(),this.domContainer=i.create("div","bf-axisgrid-conext"),this.domContainer.style.position="absolute",this.domContainer.style.left=0,this.domContainer.style.top=0,this.domContainer.style.width="100%",this.domContainer.style.height="100%",this.svgContainer=i.createNS("svg","bf-axisgrid-svg"),this.svgContainer.style.width="100%",this.svgContainer.style.height="100%",this.domContainer.appendChild(this.svgContainer),this.viewer.getDomElement().appendChild(this.domContainer);var a=Glodon.Bimface.Plugins.AxisGrid;this.highlightLine=new a.HighlightLine(this.svgContainer,this.viewer),this.highlightIntersectLines=new a.HighlightIntersectLines(this.svgContainer,this.viewer)}return _createClass(n,[{key:"registerEvent",value:function(){function e(e){var r=!0,s=e.point,l=e.height,u=e.snapLines,c=e.nearestPoint,d=u.intersectLines,h=u.gridLine,f=i.viewer.worldToClient(s),g=i.viewer.worldToClient(c.toGridLine),v=i.viewer.worldToClient(c.toIntersection),m=i.distance(f,g),p=i.distance(f,v),y=null;if(p<=i.snapMinDistance&&void 0!==d){i.highlightIntersectLines.show(),i.highlightLine.hide();var w=d[0],b=d[1];y=w.name+"-"+b.name,i.highlightIntersectLines.setHeight(l),i.highlightIntersectLines.setLine(w,b),i.highlightIntersectLines.setPoint(c.toIntersection),i.highlightIntersectLines.update()}else m<=i.snapMinDistance?(y=h.name,i.highlightLine.show(),i.highlightIntersectLines.hide(),i.highlightLine.setHeight(l),i.highlightLine.setLine(h),i.highlightLine.update(l)):(o=null,i.highlightLine.hide(),i.highlightIntersectLines.hide(),r=!1);return o!=y&&(p<=i.snapMinDistance||m<=i.snapMinDistance)&&(n.fireEvent(t.Hover,{objectType:a.axisGrids,objectId:y,worldPosition:s}),o=y),r}var t=Glodon.Bimface.Viewer.Viewer3DEvent,i=this,n=this.viewer.getEventManager(),o=null,a={component:"Component",room:"Room",axisGrids:"AxisGrids"};this.viewer.addEventListener(t.AxisGridHover,function(t){var i=!0,n=!1,o=void 0;try{for(var a,r=t.snaps[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){if(e(a.value))break}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}}),this.viewer.addEventListener(t.Rendered,function(){var t=t||window.event,n=i.viewer.getViewer(),o=n.getScene(),a=CLOUD.AxisGridManager.getInstance(o);if(t&&"mousewheel"==t.type&&a.getIsEnableHover()){var r=o.getMatrixGlobal(),s=new THREE.Vector2(t.clientX,t.clientY),l=n.cameraControl.getRaycaster(s.x,s.y),u=a.getIntersectPoints(l,r),c=a.snapOnFloors(u);if(c&&0==c.length)return i.highlightLine.hide(),void i.highlightIntersectLines.hide();var d=!0,h=!1,f=void 0;try{for(var g,v=c[Symbol.iterator]();!(d=(g=v.next()).done);d=!0){if(e(g.value))break}}catch(e){h=!0,f=e}finally{try{!d&&v.return&&v.return()}finally{if(h)throw f}}}i.highlightLine.update(),i.highlightIntersectLines.update()})}},{key:"distance",value:function(e,t){var i=e.x-t.x,n=e.y-t.y,o=e.z-t.z;return Math.sqrt(i*i+n*n+o*o)}}]),n}();n.AxisGridManager=o}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.AxisGrid"),t=function(){return{viewer:null}};e.AxisGridManagerConfig=t}(),function(){var e=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RoomEditing")),t=function(){function e(t,i,n){_classCallCheck(this,e),this.viewer3D=t,this.worldPosition=!0===n?null:i,this.clientPosition=!0===n?i:null,this.svgElement=null,this.xmlns="http://www.w3.org/2000/svg",this.glodonColor="#11DAB7",this.gridHighlightColor="#FF7F00",this.observer=function(){},this.uuid=-1,this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.worldPosition?this.clientPosition=this.viewer3D.worldToClient(this.worldPosition):this.worldPosition=this.viewer3D.clientToWorld(this.clientPosition);var e=document.createElementNS(this.xmlns,"circle");e.setAttribute("r",3),e.setAttribute("style","stroke: "+this.glodonColor+"; stroke-width: 1; fill: #ffffff"),e.setAttribute("transform","translate("+this.clientPosition.x+","+this.clientPosition.y+")"),this.svgElement=e}},{key:"setObserver",value:function(e){this.observer=e}},{key:"hightlight",value:function(){this.svgElement.style.stroke=this.gridHighlightColor}},{key:"cancelHightlight",value:function(){this.svgElement.style.stroke=this.glodonColor}},{key:"distanceTo",value:function(e){var t=e.x-this.clientPosition.x,i=e.y-this.clientPosition.y;return Math.sqrt(t*t+i*i)}},{key:"detach",value:function(){this.svgElement.parentNode.removeChild(this.svgElement)}},{key:"update",value:function(e){1==e?this.worldPosition=this.viewer3D.clientToWorld(this.clientPosition):this.clientPosition=this.viewer3D.worldToClient(this.worldPosition),this.svgElement.setAttribute("transform","translate("+this.clientPosition.x+","+this.clientPosition.y+")")}},{key:"isEqualWith",value:function(e){return e.uuid==this.uuid}},{key:"getWorldPosition",value:function(){var e=this.worldPosition;return[e.x,e.y,e.z]}},{key:"getClientPosition",value:function(){return new THREE.Vector2(this.clientPosition.x,this.clientPosition.y)}},{key:"setClientPosition",value:function(e){this.clientPosition.x=e.x,this.clientPosition.y=e.y}},{key:"getSvgElement",value:function(){return this.svgElement}}]),e}();e.EditPoint=t}(),function(){var e=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RoomEditing")),t=function(){function e(t){_classCallCheck(this,e),this.svgElement=null,this.xmlns="http://www.w3.org/2000/svg",this.gridHighlightColor="#FF7F00",this.editPoints=t,this.initialize(),this.hide()}return _createClass(e,[{key:"initialize",value:function(){var e=this.editPoints[0],t=this.editPoints[1],i=document.createElementNS(this.xmlns,"line");i.setAttribute("stroke",this.gridHighlightColor),i.setAttribute("stroke-width",3),i.setAttribute("x1",e.getClientPosition().x+""),i.setAttribute("y1",e.getClientPosition().y+""),i.setAttribute("x2",t.getClientPosition().x+""),i.setAttribute("y2",t.getClientPosition().y+""),this.svgElement=i}},{key:"show",value:function(){this.update(),this.svgElement.style.display="block"}},{key:"hide",value:function(){this.svgElement.style.display="none"}},{key:"update",value:function(){var e=this.editPoints[0],t=this.editPoints[1];this.svgElement.setAttribute("x1",e.getClientPosition().x+""),this.svgElement.setAttribute("y1",e.getClientPosition().y+""),this.svgElement.setAttribute("x2",t.getClientPosition().x+""),this.svgElement.setAttribute("y2",t.getClientPosition().y+"")}},{key:"detach",value:function(){this.svgElement.parentNode.removeChild(this.svgElement)}},{key:"startWithNull",value:function(){return null==this.editPoints[0]}},{key:"endWith",value:function(e){return this.editPoints[1].isEqualWith(e)}},{key:"distanceTo",value:function(e){var t=e.x-this.clientPosition.x,i=e.y-this.clientPosition.y;return Math.sqrt(t*t+i*i)}},{key:"getSvgElement",value:function(){return this.svgElement}}]),e}();e.EditEdge=t}(),function(){var e=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RoomEditing")),t=function(){function e(t){_classCallCheck(this,e),this.editPoints=t,this.polyline=null,this.xmlns="http://www.w3.org/2000/svg",this.glodonColor="#11DAB7",this.boundaryHighlightColor="#FF7F00",this.initialize()}return _createClass(e,[{key:"initialize",value:function(){this.setObserver();var e=this.formatPolyline(this.editPoints),t=document.createElementNS(this.xmlns,"polyline");t.setAttribute("stroke",this.glodonColor),t.setAttribute("stroke-width",2),t.style.fill=this.glodonColor,t.style.fillOpacity="0.4",t.setAttribute("points",e),this.polyline=t}},{key:"setObserver",value:function(){this.updateBinded=this.update.bind(this);var e=!0,t=!1,i=void 0;try{for(var n,o=this.editPoints[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.setObserver(this.updateBinded)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"formatPolyline",value:function(e){var t="",i=!0,n=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value,l=s.getClientPosition();t+=l.x+","+l.y,t+=" "}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}var u=e[0].getClientPosition();return t+=u.x+","+u.y,t+=" "}},{key:"update",value:function(){var e=this.formatPolyline(this.editPoints);this.polyline.setAttribute("points",e)}},{key:"rebuild",value:function(e){this.editPoints=e,this.initialize()}},{key:"getSvgElement",value:function(){return this.polyline}}]),e}();e.Boundary=t}(),function(){var e="Bimface.Plugins.RoomEditing",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RoomEditing")),n=function(){function n(i,o){_classCallCheck(this,n),t.send(e,"RoomData"),this.viewer=i,this.roomBoundary=o,this.editPoints=[],this.editEdges=[],this.boundary=null,this.editPointUuid=0,this.onEditPointDeletion=null,this.onEditPointAddition=null}return _createClass(n,[{key:"build",value:function(){this.makeEditPoints(),this.makeEditEdges(),this.makeBoundary()}},{key:"makeEditPoints",value:function(){for(var e=0;e<this.roomBoundary.length-1;e++){var t=this.roomBoundary[e],n=new THREE.Vector3(t[0],t[1]),o=new i.EditPoint(this.viewer,n);o.uuid=this.editPointUuid++,this.editPoints.push(o)}}},{key:"deleteEditPonit",value:function(e){for(var t=0;t<this.editPoints.length;t++){var i=this.editPoints[t];if(i.isEqualWith(e)){i.detach(),this.editPoints.splice(t,1),this.onEditPointDeletion(i);break}}}},{key:"addEditPonit",value:function(e,t){var n=e.editPoints[0],o=e.editPoints[1];e.detach();var a=this.editEdges.findIndex(function(e){return e.endWith(o)});this.editEdges.splice(a,1);var r=this.editPoints.findIndex(function(e){return e.isEqualWith(n)}),s=new THREE.Vector2(t.x,t.y),l=new i.EditPoint(this.viewer,s,!0);l.uuid=this.editPointUuid++,this.editPoints.splice(r+1,0,l);var u=new i.EditEdge([n,l]);this.editEdges.splice(a,0,u);var c=new i.EditEdge([l,o]);this.editEdges.splice(a+1,0,c),this.onEditPointAddition()}},{key:"getEditPointCounts",value:function(){return this.editPoints.length}},{key:"makeEditEdges",value:function(){for(var e=0;e<this.editPoints.length;e++){var t=[];t.push(this.editPoints[e]);var n=e==this.editPoints.length-1?0:e+1;t.push(this.editPoints[n]);var o=new i.EditEdge(t);this.editEdges.push(o)}}},{key:"mergeEditEdges",value:function(e,t){t=void 0==t?2:t;var n=this.editEdges[e],o=this.editEdges[(e+t-1)%this.editEdges.length],a=[];a.push(n.editPoints[0]),a.push(o.editPoints[1]);var r=new i.EditEdge(a);this.editEdges.splice(e,0,r),this.editEdges.splice(e+1,t)}},{key:"makeBoundary",value:function(){var e=this.editPoints;this.boundary=new i.Boundary(e)}},{key:"getEditPoints",value:function(){return this.editPoints}},{key:"getEditEdges",value:function(){return this.editEdges}},{key:"getBoundary",value:function(){return this.boundary}}]),n}();i.RoomData=n}(),function(){var e="Bimface.Plugins.RoomEditing",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RoomEditing")),n=function(){function i(n,o){_classCallCheck(this,i),t.send(e,"RoomView"),this.roomData=n,this.svgContainer=o,this.eventManager=null;var a=this;this.roomData.onEditPointDeletion=function(e){a.detachDrawables(),a.updateBoundary(),a.updateEditEdges(e),a.attachDrawables()},this.roomData.onEditPointAddition=function(){a.detachDrawables(),a.updateBoundary(),a.attachDrawables()}}return _createClass(i,[{key:"setEventManager",value:function(e){this.eventManager=e}},{key:"getEventManager",value:function(){return this.eventManager}},{key:"getData",value:function(){return this.roomData}},{key:"attachDrawables",value:function(){var e=this.roomData.getBoundary().getSvgElement();this.svgContainer.appendChild(e);var t=!0,i=!1,n=void 0;try{for(var o,a=this.roomData.getEditEdges()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;this.svgContainer.appendChild(r.getSvgElement())}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}var s=!0,l=!1,u=void 0;try{for(var c,d=this.roomData.getEditPoints()[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value;this.svgContainer.appendChild(h.getSvgElement())}}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}}},{key:"detachDrawables",value:function(){for(var e=this.svgContainer.children;e.length>0;){var t=e[0];this.svgContainer.removeChild(t)}}},{key:"update",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.roomData.getEditPoints()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.update()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var a=!0,r=!1,s=void 0;try{for(var l,u=this.roomData.getEditEdges()[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){l.value.update()}}catch(e){r=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw s}}this.roomData.getBoundary().update()}},{key:"updateBoundary",value:function(){var e=this.roomData.getBoundary();e.setObserver(),e.update()}},{key:"updateEditEdges",value:function(e){var t=this.roomData.getEditEdges(),i=t.findIndex(function(t){return t.endWith(e)});this.roomData.mergeEditEdges(i,2)}},{key:"addCloudViewerEvents",value:function(e){this.updateBinded=this.update.bind(this),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,this.updateBinded),e.registerEventListener(CLOUD.EVENTS.ON_EDITOR_PANING,this.updateBinded)}},{key:"removeCloudViewerEvents",value:function(e){e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_ZOOM,this.updateBinded),e.unregisterEventListener(CLOUD.EVENTS.ON_EDITOR_PANING,this.updateBinded)}}]),i}();i.RoomView=n}(),function(){var e=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RoomEditing")),t=function(){function e(t){_classCallCheck(this,e),this.roomView=t,this.roomData=t.getData(),this.snapEditPoint=null}return _createClass(e,[{key:"begin",value:function(e){var t=new THREE.Vector3(e.x,e.y),i=this.snaping(t);this.snapEditPoint=i}},{key:"onEditing",value:function(e){var t=new THREE.Vector3(e.x,e.y);if(null==this.snapEditPoint){var i=this.snaping(t);return void(i?i.hightlight():this.cancelHightlight())}this.snapEditPoint.setClientPosition(t),this.snapEditPoint.update(!0),this.snapEditPoint.observer()}},{key:"end",value:function(e){this.snapEditPoint=null}},{key:"snaping",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=this.roomData.getEditPoints()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;if(r.distanceTo(e)<=5)return r}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}return null}},{key:"cancelHightlight",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.roomData.getEditPoints()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.cancelHightlight()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}]),e}();e.PickEditor=t}(),function(){var e=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RoomEditing")),t=function(){function e(t){_classCallCheck(this,e),this.roomView=t,this.roomData=t.getData(),this.snapEditEdge=null,this.beginPoint=new THREE.Vector2,this.eventManager=this.roomView.getEventManager()}return _createClass(e,[{key:"begin",value:function(e){this.beginPoint.set(e.x,e.y),this.snapEditEdge=this.snaping(this.beginPoint)}},{key:"onEditing",value:function(e){var t=new THREE.Vector2(e.x,e.y);if(null==this.snapEditEdge){var i=this.snaping(t);i?(this.hideAllEdges(),i.show(),this.eventManager.fireEvent("RoomEditorAddEnter")):(this.hideAllEdges(),this.eventManager.fireEvent("RoomEditorAddExit"))}else this.eventManager.fireEvent("RoomEditorAddExit")}},{key:"end",value:function(e){if(null!=this.snapEditEdge){var t=new THREE.Vector2(e.x,e.y);if(!1===t.equals(this.beginPoint))return void(this.snapEditEdge=null);var i=this.snapEditEdge.editPoints[0].getClientPosition(),n=this.snapEditEdge.editPoints[1].getClientPosition();this.roomData.addEditPonit(this.snapEditEdge,this.nearestPointOnSegment(t,i,n)),this.snapEditEdge=null}}},{key:"hideAllEdges",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.roomData.getEditEdges()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.hide()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"snaping",value:function(e){var t=null,i=Number.MAX_SAFE_INTEGER,n=!0,o=!1,a=void 0;try{for(var r,s=this.roomData.getEditEdges()[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value,u=l.editPoints[0].getClientPosition(),c=l.editPoints[1].getClientPosition(),d=this.distanceToSegment(e,u,c);d<i&&(i=d,t=l)}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return i<=5?t:null}},{key:"distanceToSegment",value:function(e,t,i){var n=this.nearestPointOnSegment(e,t,i);return e.distanceTo(n)}},{key:"nearestPointOnSegment",value:function(e,t,i){var n=t.distanceToSquared(i);if(0==n)return e.distanceTo(t);var o=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/n;o=Math.max(0,Math.min(1,o));var a=new THREE.Vector2;return a.x=t.x+o*(i.x-t.x),a.y=t.y+o*(i.y-t.y),a}}]),e}();e.AdditionEditor=t}(),function(){var e=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RoomEditing")),t=function(){function e(t){_classCallCheck(this,e),this.roomView=t,this.roomData=t.getData(),this.snapEditPoint=null,this.beginPoint=new THREE.Vector2,this.eventManager=this.roomView.getEventManager()}return _createClass(e,[{key:"begin",value:function(e){this.beginPoint.set(e.x,e.y),this.snapEditPoint=this.snaping(this.beginPoint)}},{key:"onEditing",value:function(e){var t=new THREE.Vector3(e.x,e.y);if(null==this.snapEditPoint){var i=this.snaping(t);i?(i.hightlight(),this.eventManager.fireEvent("RoomEditorDeleteEnter")):(this.cancelHightlight(),this.eventManager.fireEvent("RoomEditorDeleteExit"))}else this.eventManager.fireEvent("RoomEditorDeleteExit")}},{key:"end",value:function(e){if(null!=this.snapEditPoint){if(!1===new THREE.Vector2(e.x,e.y).equals(this.beginPoint))return void(this.snapEditPoint=null);if(this.roomData.getEditPointCounts()<=3)return this.eventManager.fireEvent("DeletionError"),void(this.snapEditPoint=null);this.roomData.deleteEditPonit(this.snapEditPoint),this.snapEditPoint=null}}},{key:"snaping",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,a=this.roomData.getEditPoints()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;if(r.distanceTo(e)<=5)return r}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}return null}},{key:"cancelHightlight",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.roomData.getEditPoints()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){n.value.cancelHightlight()}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}]),e}();e.DeletionEditor=t}(),function(){var e="Bimface.Plugins.RoomEditing",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RoomEditing"),o=function(){function o(i){_classCallCheck(this,o),t.send(e,"RoomEditor"),this.bIsOnEditing=!1,this.viewer=i.viewer,this.lastAnimationState=null,this.restoreCameraStatus=null,this.roomInfo=this.viewer.mapCustomizedRoom[i.roomId],this.roomId=i.roomId,this.mapUIVisibility={"bf-tree-toolbar":"none","bf-modelTree-panel":"none","bf-toolbar-bottom":"none","bf-property-panel":"none","bf-measurement-panel":"none","bf-sectionPlane-panel":"none","bf-sectionBox-panel":"none","bf-settings-panel":"none","bf-basicInfo-panel":"none","bf-map-panel":"none"},this.initialize()}return _createClass(o,[{key:"initialize",value:function(){this.domContainer=i.create("div","bf-RoomEditor-conext"),this.domContainer.style.position="absolute",this.domContainer.style.left=0,this.domContainer.style.top=0,
this.domContainer.style.width="100%",this.domContainer.style.height="100%",this.svgContainer=i.createNS("svg","bf-RoomEditor-svg"),this.svgContainer.style.width="100%",this.svgContainer.style.height="100%",this.domContainer.appendChild(this.svgContainer),this.viewer.getDomElement().appendChild(this.domContainer),this.addDomEventListeners(),this.offset=this.viewer.getDomElement().getBoundingClientRect();var e=this.viewer.getEventManager(),t=new Glodon.Bimface.Plugins.SpatialRelation.Room({viewer:this.viewer,hasInitialized:!0}),o=t.getBoundaryByRoomId(this.roomId);this.roomData=new n.RoomData(this.viewer,o),this.roomView=new n.RoomView(this.roomData,this.svgContainer),this.roomView.setEventManager(e),this.activeEditor=new n.PickEditor(this.roomView)}},{key:"onEnter",value:function(){var e=this.viewer.getViewer();this.bIsOnEditing=!0,this.restoreCameraStatus=this.viewer.getCameraStatus(),this.lastAnimationState=this.viewer.getCameraAnimation(),this.recordUIVisibility(),this.viewHouseVisibility=this.viewer._getViewHouseVisibility(),this.viewHouseVisibility&&this.viewer.hideViewHouse(),this.viewer._enableCursor(!1),e.getFilter().deactivateAll(),this.viewer._enableSelectionChanged(!1),this.viewer.setCameraAnimation(!1),this.viewer.setCameraType("OrthographicCamera"),this.viewer.setView(Glodon.Bimface.Viewer.ViewOption.Top),this.viewer.zoomToSelectedComponents(2.5),this.viewer.enableOrbit(!1),this.viewer.hideRoomsById([this.roomId]),this.roomData.build(),this.roomView.attachDrawables(),this.roomView.addCloudViewerEvents(e),this.viewer.render()}},{key:"recordUIVisibility",value:function(){var e=Object.keys(this.mapUIVisibility),t=!0,i=!1,n=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value,s=document.getElementsByClassName(r);s.length>0&&(this.mapUIVisibility[r]=s[0].style.display)}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"save",value:function(){var e=this.roomInfo.boundary.offsetZ,t=this.roomInfo.offset,i=[],n=!0,o=!1,a=void 0;try{for(var r,s=this.roomData.getEditPoints()[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value,u=l.getWorldPosition();u[2]=e,i.push(u)}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return{boundary:this.viewer.createBoundary(i),height:t[1]-t[0],id:this.roomId}}},{key:"checkIntersect",value:function(){var e=new THREE.Vector2,t=new THREE.Vector2(10,10),i=[];i.push(e,e,t,t);var n=new Glodon.Bimface.Plugins.Geometry.PlaneBufferGeometry(i),o=[],a=!0,r=!1,s=void 0;try{for(var l,u=this.roomData.getEditPoints()[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value,d=c.getWorldPosition(),h=new THREE.Vector2(d[0],d[1]);o.push(h)}}catch(e){r=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw s}}return n._checkIntersect(o)}},{key:"onExit",value:function(e){var t=this.viewer.getViewer();if(this.roomView.removeCloudViewerEvents(t),this.removeDomEventListeners(),this.roomView.detachDrawables(),this.bIsOnEditing=!1,this.viewHouseVisibility&&this.viewer.showViewHouse(),this.viewer._enableCursor(!0),this.viewer.setCameraAnimation(this.lastAnimationState),t.getFilter().activateAll(),this.viewer._enableSelectionChanged(!0),this.viewer.enableOrbit(!0),!0!==e){var i=this.save(),n=this.roomInfo.faceColor,o=this.roomInfo.frameColor;this.viewer.createRoom(i.boundary,i.height,i.id,n,o)}else this.viewer.showRoomsById([this.roomId]);this.viewer.setSelectedComponentsById([this.roomId]),this.viewer.setCameraType("PerspectiveCamera");var a=this;this.viewer.setCameraStatus(this.restoreCameraStatus,function(){a.viewer.render()})}},{key:"makeSectionPlane",value:function(){this.viewer._sectionPlane&&this.viewer._sectionPlane.exit();var e=new Glodon.Bimface.Plugins.Section.SectionPlaneConfig;e.viewer=this.viewer,e.plane=Glodon.Bimface.Plugins.Section.SectionPlanePlane.Z,e.direction=Glodon.Bimface.Plugins.Section.SectionPlaneDirection.Forward,e.exitSectionBox=!1,this.sectionPlane=new Glodon.Bimface.Plugins.Section.SectionPlane(e),this.sectionPlane.enableCoordinate=!1;var t=this.roomInfo.offset[1],i=this.viewer.getViewer().getBoundingBoxWorld(),n=i.min.z,o=i.max.z,a=100-(t-n)/(o-n)*100;this.sectionPlane.setProgress(a),this.sectionPlane.coordinateSystem.hide(!0),this.sectionPlane.hidePlane()}},{key:"destroySectionPlane",value:function(){this.sectionPlane.exit(),this.sectionPlane=null}},{key:"getIsOnEditing",value:function(){return this.bIsOnEditing}},{key:"setBimfaceUIVisibility",value:function(e){var t=Object.keys(this.mapUIVisibility),i=!0,n=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value,l=document.getElementsByClassName(s);0!=l.length&&(l[0].style.display=0==e?"none":this.mapUIVisibility[s])}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}}},{key:"addDomEventListeners",value:function(){this.onMouseDownBinded=this.onMouseDown.bind(this),this.onMouseMoveBinded=this.onMouseMove.bind(this),this.onMouseUpBinded=this.onMouseUp.bind(this),this.onMouseDoubleClickBinded=this.onMouseDoubleClick.bind(this),this.onWindowResizeBinded=this.onWindowResize.bind(this);var e=this.svgContainer;e.addEventListener("mousemove",this.onMouseMoveBinded,!1),e.addEventListener("mousedown",this.onMouseDownBinded,!1),document.addEventListener("mouseup",this.onMouseUpBinded,!1),e.addEventListener("dblclick",this.onMouseDoubleClickBinded,!1),window.addEventListener("resize",this.onWindowResizeBinded,!1)}},{key:"removeDomEventListeners",value:function(){var e=this.svgContainer;e.removeEventListener("mousemove",this.onMouseMoveBinded),e.removeEventListener("mousedown",this.onMouseDownBinded),document.removeEventListener("mouseup",this.onMouseUpBinded),e.removeEventListener("dblclick",this.onMouseDoubleClickBinded),window.removeEventListener("resize",this.onWindowResizeBinded)}},{key:"destroySvgContainer",value:function(){this.roomView.detachDrawables(),this.domContainer.removeChild(this.svgContainer),this.svgContainer=null,this.viewer.getDomElement().removeChild(this.domContainer),this.domContainer=null}},{key:"activateEditor",value:function(e){switch(e){case"Pick":this.activeEditor=new n.PickEditor(this.roomView);break;case"Add":this.activeEditor=new n.AdditionEditor(this.roomView);break;case"Delete":this.activeEditor=new n.DeletionEditor(this.roomView)}}},{key:"activateByRoomId",value:function(e){this.roomId=e,this.roomInfo=this.viewer.mapCustomizedRoom[e];var t=new Glodon.Bimface.Plugins.SpatialRelation.Room({viewer:this.viewer,hasInitialized:!0}),i=t.getBoundaryByRoomId(e);this.roomData=new n.RoomData(this.viewer,i),this.roomView=new n.RoomView(this.roomData,this.svgContainer),this.roomView.setEventManager(this.viewer.getEventManager()),this.viewer.enableOrbit(!1),this.viewer._enableCursor(!1),this.activateEditor("Pick"),this.addDomEventListeners()}},{key:"onMouseDown",value:function(e){if(e.button===THREE.MOUSE.LEFT){var t={x:e.clientX-this.offset.left,y:e.clientY-this.offset.top};this.activeEditor.begin(t)}}},{key:"onMouseMove",value:function(e){var t={x:e.clientX-this.offset.left,y:e.clientY-this.offset.top};this.activeEditor.onEditing(t)}},{key:"onMouseUp",value:function(e){if(e.button===THREE.MOUSE.LEFT){var t={x:e.clientX-this.offset.left,y:e.clientY-this.offset.top};this.activeEditor.end(t),e.preventDefault(),e.stopPropagation()}}},{key:"onMouseDoubleClick",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"onWindowResize",value:function(){this.roomView.update()}}]),o}();n.RoomEditor=o}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RoomEditing"),t=function(){return{viewer:null,roomId:null}};e.RoomEidtorConfig=t}(),function(){var e="Bimface.Plugins.RevitHelpers",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RevitHelpers")),n=function(){function n(i){_classCallCheck(this,n),t.send(e,"DrawingHelper"),this.viewer3D=i.viewer,this.databagId=i.viewer._data.databagId,this.dataViews=null,this.integrateDataViews={},this.drawingViews=[],this.drawingIds=[],this.drawingList=[],this.integrateDrawingList={},this._config=i,this.mapDrawingVisibility={},this.mapDrawingObject={},this.supportViewTypeMap={FloorPlan:!0,Elevation:!0,Section:!0};var o=i.viewer.getViewer().getScene();this.customPlaneManager=CLOUD.CustomPlaneManager.getInstance(o),this.initialize()}return _createClass(n,[{key:"initialize",value:function(){var e=this;"integrateModel"==this.viewer3D._data.modelType&&null!=this.viewer3D._data.integrateDrawings?e._config.viewer.getLinksJson(function(t){t&&e.formatLinksData(t)}):"singleModel"==this.viewer3D._data.modelType&&this.getViews(function(t){for(var n=JSON.parse(t).viewList,o=0;o<n.length;o++){var a=n[o];if(a.preview.path&&e.supportViewTypeMap[a.viewType]){e.drawingIds.push(a.id);var r=i.DrawingView.toObject(a.viewPoint);r.origin.z+=a.elevation,e.drawingList.push({id:a.id,name:a.name,viewPort:r}),e.drawingViews.push(a)}}})}},{key:"createDrawingView",value:function(){return new i.DrawingView(this.viewer3D,this.drawingViews)}},{key:"formatLinksData",value:function(e){for(var t={},i=function(e,i,n,o){var a=new THREE.Matrix4;return e&&a.set.apply(a,JSON.parse(e)),a.transpose(),o&&a.premultiply(o),t[i]?t[i]instanceof Array?t[i].push(a):t[i]=[a,t[i]]:t[i]=a,a},n=0;n<e.length;n++){var o=e[n],a=void 0,r=o.linkTransform,s=o.fileId,l=o.name,u=o.links;a=r.indexOf("]")>0?i(r,s,l):new THREE.Matrix4,u.length>0&&function e(n,o){for(var a=0;a<n.length;a++){var r=n[a],s=void 0,l=r.linkTransform,u=r.fileId,c=r.name,d=r.links;l.indexOf("]")>0?s=i(l,u,c,o):t[u]?t[u]instanceof Array?t[u].push(o):t[u]=[o,t[u]]:t[u]=o,d.length>0&&e(d,s)}}(u,a)}this.transforms=t}},{key:"getViews",value:function(e){if(this.dataViews)return void(e&&e(this.dataViews));var t=this;this.viewer3D._getMetaDataManager().dataManager.getViews(function(i){t.dataViews=i,e&&e(i.data)})}},{key:"getViewsById",value:function(e,t){if(this.integrateDrawingList[e])return void(t&&t(this.integrateDrawingList[e]));var n=this;this.viewer3D._getMetaDataManager().dataManager.getViewsById(e,function(o){if(!o.data)return t&&t([]);n.integrateDataViews[e]=o,n.integrateDataViews.resourceHost=o.resourceHost;for(var a=JSON.parse(o.data).viewList,r=[],s=0;s<a.length;s++){var l=a[s];if(l.preview.path&&n.supportViewTypeMap[l.viewType]){n.drawingIds.push(l.id);var u=i.DrawingView.toObject(l.viewPoint);u.origin.z+=l.elevation;var c={id:l.id,name:l.name,viewPort:u};r.push(c),n.drawingViews.push(l)}}n.drawingList=n.drawingList.concat(r),n.integrateDrawingList[e]=r,t&&t(r)})}},{key:"isInclude",value:function(e){return this.drawingIds.indexOf(e)>=0}},{key:"getDrawingList",value:function(e,t){if(!e)return this.drawingList;this.getViewsById(e,function(e){t&&t(e)})}},{key:"addDrawingsById",value:function(e,t,i){for(var n=this,o=0,a=0;a<e.length;a++){var r=e[a];if(this.isInclude(r)){this.mapDrawingObject.hasOwnProperty(r)&&(this.removeDrawingsById([r]),console.warn("Duplicate id."));var s=this.createDrawingView();s.activeViewById(r);var l=this.drawingIds.indexOf(r),u=this.drawingViews[l],c=(this.dataViews||this.integrateDataViews).resourceHost+"/"+n.databagId+"/"+u.preview.path;if(null==u.preview.path)return void console.warn("No thumbnail in databag.");if(++o,u.id.indexOf(".")>0){var d=u.id.split(".")[0];if(this.transforms&&this.transforms[d])if(this.transforms[d].slice)for(var h=0,f=this.transforms[d];h<f.length;h++){var g=this.createDrawingView();g.activeViewById(r),g.setLinkFileTranslation(f[h]);var v=g.getOutline3D();this.addPlane(v,t,c,e,o,r,i,h+1==f.length,g)}else{s.setLinkFileTranslation(this.transforms[d]);var m=s.getOutline3D();this.addPlane(m,t,c,e,o,r,i,!0,s)}else{var p=s.getOutline3D();this.addPlane(p,t,c,e,o,r,i,!0,s)}}else{var y=s.getOutline3D();this.addPlane(y,t,c,e,o,r,function(){n.viewer3D.render(),i&&i()},!0,s)}}}}},{key:"addPlane",value:function(e,t,i,n,o,a,r,s,l){var u=this;this.customPlaneManager.addPlane(e.min,e.max,i,function(e){u.mapDrawingObject[a]||(u.mapDrawingObject[a]=[]),"number"!=typeof t&&(t=0),l.update(e,t),l=null,u.mapDrawingObject[a].push(e),s&&o==n.length&&r&&r()})}},{key:"clearDrawings",value:function(){var e=this.drawingIds;this.removeDrawingsById(e)}},{key:"hideAllDrawings",value:function(){var e=this.drawingIds;this.hideDrawingsById(e)}},{key:"hideDrawingsById",value:function(e){for(var t=this,i=0;i<e.length;i++){var n=e[i];this.isInclude(n)&&this.mapDrawingObject[n]&&function(){var e=t;t.mapDrawingObject[n].forEach(function(t){e.customPlaneManager.hidePlane(t)})}()}this.viewer3D.render()}},{key:"removeDrawingsById",value:function(e){for(var t=this,i=0;i<e.length;i++){var n=e[i];this.isInclude(n)&&this.mapDrawingObject[n]&&function(){var e=t;t.mapDrawingObject[n].forEach(function(t){e.customPlaneManager.removePlane(t)}),delete t.mapDrawingObject[n]}()}this.viewer3D.render()}},{key:"setDrawingsOpacityById",value:function(e,t){for(var i=this,n=0;n<e.length;n++){var o=e[n];this.isInclude(o)&&this.mapDrawingObject[o]&&function(){var e=i;i.mapDrawingObject[o].forEach(function(i){e.customPlaneManager.setPlaneOpacity(i,t)})}()}this.viewer3D.render()}},{key:"showAllDrawings",value:function(){var e=this.drawingIds;this.showDrawingsById(e)}},{key:"showDrawingsById",value:function(e){for(var t=this,i=0;i<e.length;i++){var n=e[i];this.isInclude(n)&&this.mapDrawingObject[n]&&function(){var e=t;t.mapDrawingObject[n].forEach(function(t){e.customPlaneManager.showPlane(t)})}()}this.viewer3D.render()}}]),n}();i.DrawingHelper=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RevitHelpers"),t=function(){return{viewer:null}};e.DrawingHelperConfig=t}(),function(){var e="Bimface.Plugins.SpatialRelation",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.SpatialRelation")),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"Room"),this.viewer3D=n.viewer,this.databagId=n.viewer._data.databagId,this.toleranceType={STRICT:"STRICT",ORDINARY:"ORDINARY",LENIENT:"LENIENT"},this.tolerence=.25,this.mapRoomBbox={},this.mapRoomBoundary={},this.mapRoomId={},this.mapArea={},this.allComponentIds=null,!0!==n.hasInitialized&&this.initialize()}return _createClass(i,[{key:"initialize",value:function(){var e=this;"singleMode"===this.viewer3D._data.modelType&&this.getRooms(function(t){var i=JSON.parse(t),n=!0,o=!1,a=void 0;try{for(var r,s=i[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value;e.mapRoomId[l.id]=!0,e.mapRoomBbox[l.id]=(new THREE.Box3).setFromPoints([l.bboxMin,l.bboxMax])}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}})}},{key:"getRooms",value:function(e){this.viewer3D._getMetaDataManager().dataManager.getRooms(function(t){e&&e(t)})}},{key:"getRoomBoundary",value:function(e,t){if(this.mapRoomId[e]){this.viewer3D._getMetaDataManager().dataManager.getRoomBoundary(e,function(e){t&&t(e)})}}},{key:"getAreaByRoomId",value:function(e){var t=this,i=new Array,n=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var l=r.value,u={id:l,unit:"m2",value:null};if(t.mapArea[l])u.value=t.mapArea[l];else{var c=t._getRoomBoundaryById(l);c?u.value=Math.abs(THREE.ShapeUtils.area(c))/1e6:console.warn("Input room id "+l+" is invalid.")}i.push(u)}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return i}},{key:"getBoundaryByRoomId",value:function(e){var t=new Array,i=this.viewer3D.getCustomizedRoom();if(e in i)for(var n=this._getRoomBoundaryById(e),o=0,a=n.length;o<a;o++){var r=new Array;r.push(n[o].x),r.push(n[o].y),r.push(i[e].offset[0]),t.push(r)}else console.warn("Input room id "+e+" is not exist.");return t}},{key:"setBoundaryByRoomId",value:function(e,t){var i=this.viewer3D.getCustomizedRoom();if(e in i){var n=i[e];this.viewer3D.clearRoomsById(e);var o=this.viewer3D.createBoundary(t);if(null==o)return;o.offsetZ-=n.offset[0],this.viewer3D.createRoomByOffset(o,n.offset,e,n.faceColor,n.frameColor),this.viewer3D.render();var a={id:e,unit:"m2",value:null},r=this._getRoomBoundaryById(e);a.value=Math.abs(THREE.ShapeUtils.area(r))/1e6}else console.warn("Input room id "+e+" is not exist.")}},{key:"getModelComponentIds",value:function(){if(this.allComponentIds)return this.allComponentIds;this.allComponentIds=new Array;for(var e=this.viewer3D.getViewer(),t=e.getFilter().getObjectsMap(),i=Object.keys(t),n=0;n<i.length;n++){var o,a=i[n],r=t[a],s=Object.keys(r);(o=this.allComponentIds).push.apply(o,_toConsumableArray(s))}return this.allComponentIds}},{key:"getComponentsByRoomId",value:function(e,t,i,n){void 0==t&&(t=this.toleranceType.ORDINARY),void 0==i&&(i=this.toleranceType.STRICT);var o=this;this.getRoomBoundary(e,function(t){var i=JSON.parse(t);i.hasOwnProperty("loops")&&(i=i.loops[0]);var n=[],a=!0,r=!1,s=void 0;try{for(var l,u=i[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;n.push({x:c[0].x,y:c[0].y})}}catch(e){r=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw s}}o.mapRoomBoundary[e]=n});for(var a=[],r=this.getModelComponentIds(),s=0;s<r.length;s++){var l=r[s],u=this.viewer3D.getViewer().getComponentInfoByUserId(l).boundingBox;this.roomContains(e,u,t,i)&&a.push(l)}n&&n(a)}},{key:"getRoomsByComponentId",value:function(e,t,i,n){void 0==t&&(t=this.toleranceType.ORDINARY),void 0==i&&(i=this.toleranceType.STRICT);for(var o=[],a=this.viewer3D.getCustomizedRoom(),r=Object.keys(a),s=r,l=0;l<s.length;l++){var u=s[l],c=this.viewer3D.getViewer().getComponentInfoByUserId(e).boundingBox;this.roomContains(u,c,t,i)&&o.push(u)}n&&n(o)}},{key:"roomContains",value:function(e,t,i,n){if(!this.viewer3D.getCustomizedRoom()[e]&&!this.mapRoomBoundary[e])return void console.warn("Input room id is invalid.");var o=this.isRoomContainBoundingBoxByZ(e,t,n);if(0==o)return o;var a=this.isRoomBoundingBoxContainBoundingBoxByXY(e,t,i);if(0==a)return a;var r=this.isRoomBoundaryContainBoundingBoxByXY(e,t,i);return 0!=r||r}},{key:"getRoomBoundingBoxById",value:function(e){var t=this.getCustomizedRoom(e);if(t){var i=t.boundingBox,n=t.offset;return i.min.z=n[0],i.max.z=n[1],i}if(this.mapRoomBbox[e])return this.mapRoomBbox[e]}},{key:"getCustomizedRoom",value:function(e){var t=this.viewer3D.getCustomizedRoom()[e];if(!t)return null;if(t.boundary&&"user"!=t.boundary.belong){var i=[],n=t.boundary,o=n.loops[0],a=!0,r=!1,s=void 0;try{for(var l,u=o[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;i.push([c[0].x,c[0].y,c[0].z])}}catch(e){r=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(r)throw s}}var d=this.viewer3D.createBoundary(i);return d.offset=[],d.offset[0]=t.offset[0]+d.offsetZ,d.offset[1]=t.offset[1]+d.offsetZ,d}return t.boundary.offset=t.offset,t.boundary}},{key:"_getRoomBoundaryById",value:function(e){return this.viewer3D.getCustomizedRoom()[e]?this.getCustomizedRoom(e).roomBoundary:this.mapRoomBoundary[e]}},{key:"isRoomContainBoundingBoxByZ",value:function(e,t,i){var n=this.getRoomBoundingBoxById(e),o=n.min.z,a=n.max.z,r=t.max.z,s=t.min.z,l=this.tolerence;if(i==this.toleranceType.STRICT)return s>=o-l&&r<=a+l;if(i==this.toleranceType.ORDINARY){var u=(s+r)/2;return this.isBetween(u,o,a)&&(this.isBetween(s,o,a)||this.isBetween(r,o,a))}return i==this.toleranceType.LENIENT?s<=a+l&&r>=o-l:void 0}},{key:"isRoomBoundingBoxContainBoundingBoxByXY",value:function(e,t,i){var n=this.getRoomBoundingBoxById(e),o=n.min.x,a=n.max.x,r=n.min.y,s=n.max.y,l=t.min.x,u=t.max.x,c=t.min.y,d=t.max.y,h=this.tolerence;return i==this.toleranceType.STRICT?l>=o-h&&u<=a+h&&c>=r-h&&d<=s+h:i==this.toleranceType.ORDINARY||i==this.toleranceType.LENIENT?l<=a+h&&u>=o-h&&c<=s+h&&d>=r-h:void 0}},{key:"isRoomBoundaryContainBoundingBoxByXY",value:function(e,t,i){for(var n=this.toFivePos(t),o=this._getRoomBoundaryById(e),a=0,r=0;r<n.length;r++){var s=n[r];this.containsInBoundary(s,o)&&a++}var l=!1;return i==this.toleranceType.STRICT?l=5==a:i==this.toleranceType.ORDINARY?l=a>=3:i==this.toleranceType.LENIENT&&(l=a>=1),l}},{key:"isBetween",value:function(e,t,i){var n=this.tolerence;return e<=i+n&&e>=t-n}},{key:"toFivePos",value:function(e){var t=[];return t.push(new THREE.Vector2(e.min.x,e.min.y)),t.push(new THREE.Vector2(e.max.x,e.min.y)),t.push(new THREE.Vector2(e.max.x,e.max.y)),t.push(new THREE.Vector2(e.min.x,e.max.y)),t.push(new THREE.Vector2((e.min.x+e.max.x)/2,(e.min.y+e.max.y)/2)),t}},{key:"containsInBoundary",value:function(e,t){for(var i=!1,n=0;n<t.length-1;n++)if(this.isOnSegment(e,t[n],t[n+1])){i=!0;break}if(i)return!0;for(var o=e.x,a=e.y,r=!1,s=0,l=t.length-1;s<t.length;l=s++){var u=t[s].x||t[s][0],c=t[s].y||t[s][1],d=t[l].x||t[l][0],h=t[l].y||t[l][1];c>a!=h>a&&o<(d-u)*(a-c)/(h-c)+u&&(r=!r)}return r}},{key:"isOnSegment",value:function(e,t,i){if(e.x>Math.max(t.x,i.x)||e.x<Math.min(t.x,i.x))return!1;if(e.y>Math.max(t.y,i.y)||e.y<Math.min(t.y,i.y))return!1;if(t.x!=i.x){var n=(i.y-t.y)/(i.x-t.x),o=i.y-n*i.x;if(n*e.x+o==e.y)return!0}else if(e.x==t.x)return!0;return!1}}]),i}();i.Room=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.SpatialRelation"),t=function(){return{viewer:null}};e.RoomConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.SpatialRelation"),t=Object.freeze({Saved:"Saved",Cancelled:"Cancelled"});e.RoomEditorToolbarEvent=t}(),function(){var e="Bimface.Plugins.SpatialRelation",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),n=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.SpatialRelation"),o=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Application.UI.Button"),Glodon.Bimface.Plugins.SpatialRelation.RoomEditorToolbarEvent),a=function(){function n(i){_classCallCheck(this,n),t.send(e,"RoomEditorToolbar"),this.id="RoomEditorToolbar",this.viewer=i.viewer,this.roomId=i.roomId,this.databagId=i.viewer._data.databagId,this.eventManager=new Glodon.Web.Lang.EventManager,this.initialize(),this.toolBarDom()}return _createClass(n,[{key:"initialize",value:function(){var e=Glodon.Bimface.Plugins.RoomEditing,t=new e.RoomEidtorConfig;t.viewer=this.viewer,t.roomId=this.roomId,this.roomEditor=new e.RoomEditor(t),this.roomEditor.onEnter(),this.registerRoomEditorEvents()}},{key:"toolBarDom",value:function(){var e=this,t=[],n=i.create("div","bf-roomEditorToolbar");if(e.domElement=n,void 0===this.switchToolbar){var a=Glodon.Bimface.UI.Toolbar.ToolbarConfig();a.className="bf-toolbar bf-toolbar-roomEditor",a.element=n,a.buttons=["RoomEditingDrag","RoomEditingAdd","RoomEditingDelete"];this.viewer.getDomElement().appendChild(n),this.switchToolbar=new Glodon.Bimface.Application.UI.Toolbar.Toolbar(a),t.push(this.switchToolbar)}var r=Glodon.Bimface.UI.Control.ControlEvent,s=this.switchToolbar.getControls();this.uncheckOthers("Drag",s);for(var l=["Pick","Add","Delete"],u=0;u<s.length;u++)!function(t){var i=s[t];i.addEventListener(r.Click,function(){i.isChecked()?(e.roomEditor.activateEditor(l[t]),e.uncheckOthers(i.getId(),s)):i.toggleCheckedState()})}(u);var c=new Glodon.Bimface.UI.Toolbar.ToolbarConfig;c.element=n,c.className="bf-toolbar bf-toolbar-roomEditor";var d=e.roomToolbar=new Glodon.Bimface.UI.Toolbar.Toolbar(c);e.roomToolbar=d,t.push(d);var h=new Glodon.Bimface.UI.Button.ButtonConfig;h.className="bf-save",h.title=BimfaceLanguage.bf_general_save;var f=new Glodon.Bimface.UI.Button.SingleButton(h);f.setHtml(BimfaceLanguage.bf_general_save),f.addEventListener("Click",function(){e.eventManager.fireEvent(o.Saved),e.update()}),d.addControl(f);var g=new Glodon.Bimface.UI.Button.ButtonConfig;g.className="bf-cancel",g.title=BimfaceLanguage.bf_general_cancel;var v=new Glodon.Bimface.UI.Button.SingleButton(g);v.setHtml(BimfaceLanguage.bf_general_cancel),v.addEventListener("Click",function(){e.eventManager.fireEvent(o.Cancelled),e.exit()}),d.addControl(v),this.viewer.getDomElement().appendChild(n)}},{key:"registerRoomEditorEvents",value:function(){var e=this;this.viewer.addEventListener("DeletionError",function(){if(!e.deletionErrorTips){var t=new Glodon.Bimface.UI.Tips.TipsConfig;t.element=e.viewer.getDomElement(),t.className="bf-tips bf-roomEditor-tips",t.timeOut=3e3,t.html='<div><i class="icon-warning"></i>'+BimfaceLanguage.bf_panel_roomEdit_insufficientNode+"</div>",e.deletionErrorTips=new Glodon.Bimface.UI.Tips.Tips(t)}e.deletionErrorTips.show()});var t=this.viewer.getDomElement();this.viewer.addEventListener("RoomEditorAddEnter",function(){t.addClass("roomEditor-addtion")}),this.viewer.addEventListener("RoomEditorAddExit",function(){t.removeClass("roomEditor-addtion")}),this.viewer.addEventListener("RoomEditorDeleteEnter",function(){t.addClass("roomEditor-deletion")}),this.viewer.addEventListener("RoomEditorDeleteExit",function(){t.removeClass("roomEditor-deletion")})}},{key:"uncheckOthers",value:function(e,t){var i=!0,n=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(i=(a=r.next()).done);i=!0){var s=a.value;s.getId()===e?s.setCheckedState(!0):s.setCheckedState(!1)}}catch(e){n=!0,o=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw o}}}},{key:"getEventManager",value:function(){return this.eventManager}},{key:"addEventListener",value:function(e,t){this.getEventManager().addEvent(e,t)}},{key:"removeEventListener",value:function(e,t){this.getEventManager().removeEvent(e,t)}},{key:"show",value:function(){this.roomEditor.setBimfaceUIVisibility(!1),this.roomToolbar.show(),this.switchToolbar.show()}},{key:"hide",value:function(){this.roomEditor.setBimfaceUIVisibility(!0),this.roomToolbar.hide(),this.switchToolbar.hide()}},{key:"update",value:function(){if(!0===this.roomEditor.checkIntersect()){if(!this.intersectTips){var e=new Glodon.Bimface.UI.Tips.TipsConfig;e.element=this.viewer.getDomElement(),e.className="bf-tips bf-roomEditor-tips",e.timeOut=3e3,e.html='<div><i class="icon-warning"></i>'+BimfaceLanguage.bf_panel_roomEdit_selfIntersection+"</div>",this.intersectTips=new Glodon.Bimface.UI.Tips.Tips(e)}return void this.intersectTips.show()}this.hide(),this.roomEditor.onExit()}},{key:"exit",value:function(){this.hide(),this.roomEditor.onExit(!0)}}]),n}();n.RoomEditorToolbar=a}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.SpatialRelation"),t=function(){return{viewer:null,roomId:null,app:null}};e.RoomEditorToolbarConfig=t}(),function(){var e="Bimface.Plugins.RevitHelpers",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=(Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RevitHelpers")),n=function(){function i(n){_classCallCheck(this,i),t.send(e,"MEPTopologyHelper"),this.databagId=n.viewer._data.databagId,this.modelType=n.viewer._data.modelType}return _createClass(i,[{key:"_findNetworkById",value:function(e,t){var i,n=this;n._FILEID_CACHE!=n.fileId&&(n._API_CACHE=null),"integrateModel"==n.modelType?(i=hostConfig.resourceHost+"/"+n.databagId+"/metadata/"+n.fileId+"/mepsystem.json",n._FILEID_CACHE=n.fileId):i=hostConfig.resourceHost+"/"+n.databagId+"/metadata/mepsystem.json",n._API_CACHE?n._getNetwork(e,n._API_CACHE,function(e){t(e)}):Glodon.Web.Lang.Utility.HttpRequest.ajax({url:i,success:function(i){var o=JSON.parse(i);n._API_CACHE=o,n._getNetwork(e,o,function(e){t(e)})}})}},{key:"_getNetwork",value:function(e,t,i){var n=this;n._NETWORK_LENGTH=0,t.systems.map(function(o,a){o.network[e]&&(n._NETWORK_LENGTH++,i(o.network)),a==t.systems.length-1&&0==n._NETWORK_LENGTH&&console.log("æ­¤IDä¸å­˜åœ¨äºŽNetworkä¸­")})}},{key:"_transform",value:function(e){var t=[];for(var i in e)/^__STEP/.test(i)||(t[t.length]={type:i,id:e[i]});return t}},{key:"_walk",value:function(e,t,i,n){for(var o="up"===i?"flowFrom":"flowInto",a=[t];a.length;){var r=a.pop(),s=e[r];if(s){s.id=r,n(s,e);var l=s[o];l&&[].push.apply(a,l.reverse())}}}},{key:"_BFSwalk",value:function(e,t,i,n){for(var o="up"===i?"flowFrom":"flowInto",a=[t];0!==a.length;){var r=a.shift(),s=e[r];s&&(s.id=r,n(s,s[o],e),[].push.apply(a,s[o]))}}},{key:"_deduplicate",value:function(e){return e.map(function(e){return e.reduce(function(e,t,i){return i%2==0?-1===e.indexOf(t)&&e.push(t):/\d+/.test(e[e.length-1])||e.push(t),e},[])})}},{key:"_formatToObj",value:function(e){var t,i=this,n={};return e.forEach(function(e){e.forEach(function(e,o){if(o%2==0)t=e,n[e]||(n[e]=[]);else{var a=void 0;a="integrateModel"==i.modelType?i.fileId+"."+e:e,-1===n[t].indexOf(a)&&n[t].push(a)}})}),n}},{key:"getDownstreamComponentsById",value:function(e,t){var i=this;"integrateModel"==i.modelType&&(i.fileId=e.split(".")[0],e=e.split(".")[1]),i._findNetworkById(e,function(n){if(!n)return t();var o={};i._BFSwalk(n,e,"down",function(t){t.id!==e&&("integrateModel"==i.modelType&&(t.id=i.fileId+"."+t.id),o[t.type]?o[t.type].push(t.id):o[t.type]=[t.id])}),t(i._transform(o))})}},{key:"getConnectedComponentsById",value:function(e,t){var i=this,n=this;"integrateModel"==n.modelType&&(n.fileId=e.split(".")[0],e=e.split(".")[1]),n._findNetworkById(e,function(o){if(!o)return t();var a={up:{routes:[[]]},down:{routes:[[]]}};["up","down"].forEach(function(t){return i._walk(o,e,t,function(i,n){var o=a[t],r=o.routes,s=r.length-1;if("æœ«ç«¯"===r[s].slice(-2,-1)[0]){if("æœ«ç«¯"===i.type)return r[r.length]=r[s].slice(0,-1).concat(i.id);var l=i["up"===t?"flowInto":"flowFrom"][0];r[r.length]=r[s].slice(0,r[s].indexOf(l)+1),s++}e!=i.id&&(r[s].push(i.type),r[s].push(i.id))})});var r=n._deduplicate(a.up.routes),s=n._deduplicate(a.down.routes),l=i._transform(n._formatToObj(r)),u=i._transform(n._formatToObj(s));t({up:l,down:u})})}}]),i}();i.MEPTopologyHelper=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RevitHelpers"),t=function(){return{viewer:null}};e.MEPTopologyHelperConfig=t}(),function(){var e="Bimface.Plugins.RevitHelpers",t=Glodon.Bimface.Data.StatisticsDataManager.getInstance(),i=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.RevitHelpers"),n=function(){function i(n,o){_classCallCheck(this,i),t.send(e,"DrawingView"),this.viewer3D=n,this.drawingViews=o,this.activeViewId=null,this.activeDrawingView=null,this.viewPoint=null,this.planTranslation=null,this.linkFileTranslation=new THREE.Vector3}return _createClass(i,[{key:"activeViewById",value:function(e){this.activeViewId=e;var t=!0,i=!1,n=void 0;try{for(var o,a=this.drawingViews[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var r=o.value;if(r.id==this.activeViewId){this.activeDrawingView=r;var s=r.viewPoint.origin;this.coordViewPoint=new THREE.Vector3(s[0],s[1],s[2])}}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"formatViewMatrix",value:function(e){var t=this.activeDrawingView.viewPoint.rightDirection,i=this.activeDrawingView.viewPoint.upDirection,n=new THREE.Vector3(t[0],t[1],t[2]),o=new THREE.Vector3(i[0],i[1],i[2]);e=void 0==e?new THREE.Vector3:e;var a=new THREE.Matrix4;return a.makeBasis(n,o,e),a}},{key:"update",value:function(e,t){this.makeTranslation(e,t),"FloorPlan"==this.activeDrawingView.viewType?this.rotateFloorPlan(e):this.rotateElevation(e)}},{key:"makeTranslation",value:function(e,t){var i=this.activeDrawingView.viewPoint.viewDirection,n=new THREE.Vector3(i[0],i[1],i[2]),o=n.multiplyScalar(t),a=this.planTranslation,r=this.linkFileTranslation;e.translateX(a.x+r.x+o.x),e.translateY(a.y+r.y+o.y),e.translateZ(a.z+r.z+o.z)}},{key:"rotateFloorPlan",value:function(e){var t=this.activeDrawingView.viewPoint.upDirection,i=new THREE.Vector3(t[0],t[1],t[2]),n=new THREE.Vector3(0,1,0).angleTo(i);new THREE.Vector3(0,1,0).cross(i).length()>0&&(n=-n),e.rotateZ(n),e.updateMatrixWorld()}},{key:"rotateElevation",value:function(e){
var t=this.activeDrawingView.viewPoint.viewDirection,i=new THREE.Vector3(t[0],t[1],t[2]),n=i.angleTo(new THREE.Vector3(0,-1,0));i.cross(new THREE.Vector3(0,-1,0)).z>0&&(n=-n),e.rotateX(Math.PI/2),e.rotateY(n),e.updateMatrixWorld()}},{key:"getOutline3D",value:function(){var e=this.activeDrawingView.outline,t=this.activeDrawingView.viewPoint.scale,i=this.activeDrawingView.elevation,n=new THREE.Vector3(e[0]*t,e[1]*t,0),o=new THREE.Vector3(e[0]*t,e[3]*t,0),a=new THREE.Vector3(e[2]*t,e[3]*t,0),r=new THREE.Vector3(e[2]*t,e[1]*t,0),s=this.formatViewMatrix(),l=n.applyMatrix4(s),u=o.applyMatrix4(s),c=a.applyMatrix4(s),d=r.applyMatrix4(s);this.planTranslation=l.clone().add(c).multiplyScalar(.5),this.planTranslation.add(this.coordViewPoint);var h=u.clone().sub(l).length(),f=d.clone().sub(l).length(),g=new THREE.Vector3(-f/2,-h/2,i),v=new THREE.Vector3(f/2,h/2,i);return new THREE.Box3(g,v)}},{key:"setLinkFileTranslation",value:function(e){this.linkFileTranslation.x=e.elements[12],this.linkFileTranslation.y=e.elements[13],this.linkFileTranslation.z=e.elements[14]}}]),i}();n.toObject=function(e){var t={};for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n instanceof Array&&(t[i]={x:n[0],y:n[1],z:n[2]})}return t},i.DrawingView=n}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Snap"),t=function(){return{id:null,color:new Glodon.Web.Graphics.Color(249,157,11,1),hoverColor:new Glodon.Web.Graphics.Color(17,218,183,.2),objectColor:new Glodon.Web.Graphics.Color(17,218,183,.9),width:3,radius:25,viewer:null}};e.SnapConfig=t}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Snap"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=function(e){this.viewer=e.viewer,this.maxPointsNum=1;var i=new Glodon.Web.Graphics.Color(17,218,183,.2),n=t.createNS("circle","bf-snap-handle");n.setAttribute("r",e.width),n.setAttribute("fill",i.getRGB()),n.style.fill=i.getRGB();var o=t.createNS("line","bf-snap-line");o.style.strokeWidth=2,o.style.stroke=i.getRGB();var a=t.createNS("polygon","bf-snap-rect");a.setAttribute("fill",i.getRGBA()),a.setAttribute("stroke",i.getRGB()),a.setAttribute("stroke-width",1),this.hoverLine=o,this.hoverPoint=n,this.hoverPanel=a,this.hoverPanelSize={width:20,height:20}},n={stretchOnDirection:function(e,t,i){var n=e.clone().add(t).multiplyScalar(.5),o=t.clone().sub(e).normalize();return[n.clone().sub(o.clone().multiplyScalar(i/2)),n.clone().add(o.clone().multiplyScalar(i/2))]},draw:function(e){var t=this.hoverLine,i=this.hoverPoint,n=this.hoverPanel,o=this.hoverPanelSize;switch(e.hoverObjectType){case"Point":i.setAttribute("cx",e.hoverPosition.x),i.setAttribute("cy",e.hoverPosition.y),e.svg.appendChild(i);break;case"Line":t.setAttribute("x1",e.lineStartPoint.x),t.setAttribute("y1",e.lineStartPoint.y),t.setAttribute("x2",e.lineEndPoint.x),t.setAttribute("y2",e.lineEndPoint.y),e.svg.appendChild(t);break;case"Panel":var a=e.clientPts,r=a[0].distanceTo(a[1]),s=a[0].distanceTo(a[3]),l=r/o.width,u=s/o.height;if(1!=l){var c=this.stretchOnDirection(a[0],a[1],o.width),d=this.stretchOnDirection(a[2],a[3],o.width);a=c.concat(d)}if(1!=u){var c=this.stretchOnDirection(a[0],a[3],o.height),d=this.stretchOnDirection(a[1],a[2],o.height);a=[c[0],d[0],d[1],c[1]]}for(var h="",f=0;f<a.length;f++)h+=a[f].x+",",h+=a[f].y+" ";n.setAttribute("points",h),e.svg.appendChild(n)}}};i.prototype=Object.assign(i.prototype,n),e.SnapItem=i}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Snap"),t=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Web.Lang.Utility.Dom"),i=null,n=[],o=null,a=null,r=function(e){var i=e.viewer,n=this;this.snapMode=e.snapMode,n.isOpen=!1;var o=new Glodon.Web.Lang.EventManager,a=t.create("div","bf-snap-conext");this.context={rootDomElement:a},this._opt=e,this.getEventManager=function(){return o},n.init(e),i.addEventListener("Rendered",function(){n.isOpen&&n.update()})};r.prototype={init:function(e){var i=this,n=i.context,o=i._opt.viewer;i.isOpen=!0,o.getDomElement().appendChild(n.rootDomElement),o.setSelectedComponentsById();var a=t.createNS("svg","bf-snap-svg");n.rootDomElement.innerHTML="",n.rootDomElement.appendChild(a),n.svg=a;var r=new Glodon.Bimface.Plugins.Snap.SnapItem(e);i.snapItem=r,o.render()},snapByPoint:function(e){this.isNeedSnap(e)&&(i=e.pickPoint?e.pickPoint:null,e.pickPlane?(o="Panel",a=e.normal):e.pickLine?(o="Line",n=e.pickLine):o=e.pickPoint?"Point":null,this.update())},isNeedSnap:function(e){if(!this.snapMode)return!0;if(!e||!e.userId)return this.reset(),!1;var t=this.snapMode.getSnap3DList(),i={Plane:"face",Line:"line",Point:"endpoint"},n=!1;e.pickPlane?n=t.includes(i.Plane):e.pickLine?n=t.includes(i.Line):e.pickPoint&&(n=t.includes(i.Point));var o=this.snapMode.getSnapConditions(),a=this._opt.viewer.getViewer(),r=a.getUserdataByUserId(e.userId),s=this.isMatchConditions(r,o),l=n&&s;return l||this.reset(),l},isMatchConditions:function(e,t){for(var i=!0,n=0,o=t.length;n<o;n++){var a=t[n];for(var r in a)if(e[r]!==a[r]){i=!1;break}if(i)break;n<t.length-1&&(i=!0)}return i},update:function(){var e=this.context,t=this._opt.viewer,r=t.getDomElement(),s=r.getBoundingClientRect(),l=t.getViewer(),u=[],c=[];if(this.context.svg.innerHTML="",i?(e.hoverPosition=t.worldToClient(i),e.hoverPositionDS=l.getScene().worldToDrawing(i)):e.hoverPosition=null,e.hoverObjectType=o,"Line"==o&&2==n.length){e.lineStartPoint=t.worldToClient(n[0]),e.lineEndPoint=t.worldToClient(n[1]);var d=new THREE.Vector2(e.lineStartPoint.x,e.lineStartPoint.y),h=new THREE.Vector2(e.lineEndPoint.x,e.lineEndPoint.y),f=new THREE.Box2;f.min.set(r.clientLeft,r.clientTop),f.max.set(f.min.x+r.clientWidth,f.min.y+r.clientHeight);var g=!f.containsPoint(d),v=!f.containsPoint(h),m={start:d,end:h},p=CLOUD$1.CameraUtil.lineIntersectWithRect(m,f);if(g&&v)2==p.length&&(e.lineStartPoint=p[0],e.lineEndPoint=p[1]);else if(g||v)for(var y=new THREE.Vector2(e.hoverPosition.x,e.hoverPosition.y),w=g?h.clone():d.clone(),b=w.clone().sub(y).normalize(),C=0;C<p.length;C++){var x=w.clone().sub(p[C]).normalize();if(x.dot(b)>0){e.lineStartPoint=w,e.lineEndPoint=p[C];break}}}if("Panel"==e.hoverObjectType){e.normal=l.getScene().worldToDrawing(a),e.normal.normalize();var E=l.cameraControl,P=new THREE.Plane;P.setFromNormalAndCoplanarPoint(e.normal,e.hoverPositionDS);var k=new THREE.Vector2(e.hoverPosition.x-10,e.hoverPosition.y-10),M=new THREE.Vector2(e.hoverPosition.x+10,e.hoverPosition.y-10),I=e.hoverPositionDS,S=E.getRaycaster(k.x,k.y),d=S.ray.intersectPlane(P);S=E.getRaycaster(M.x,M.y);var h=S.ray.intersectPlane(P);if(null==d||null==h)return;var B=new THREE.Vector3(1,0,0),_=new THREE.Vector3(0,1,0),D=new THREE.Vector3(0,0,1),L=Math.abs(e.normal.clone().dot(B))<=.0025,A=Math.abs(e.normal.clone().dot(D))<=.0025;if(L&&A)var T=B.clone(),G=D.clone();else var N=_.clone(),T=N.cross(e.normal).normalize(),G=e.normal.clone().cross(T).normalize();var O=d.distanceTo(h)/2,V=T.clone().multiplyScalar(O),U=G.clone().multiplyScalar(O),W=I.clone().sub(V).add(U),R=I.clone().add(V).add(U),H=I.clone().sub(V).sub(U),z=I.clone().add(V).sub(U),F=[];F.push(W,R,z,H);for(var j=[],X=E.getContainerDimensions(),Y=0;Y<F.length;Y++){var Z=CLOUD$1.CameraUtil.drawingToCanvas(E.camera,F[Y],X.width,X.height);j.push(new THREE.Vector3(Z.x,Z.y,0))}e.clientPts=j}for(var C=0;C<u.length-1;C++){var q=l.worldPointsToClient(u[C],u[C+1]);if(q){var J={x:q.start.x-s.left,y:q.start.y-s.top};c.push(J)}}e.clientPoints=c,this.snapItem.draw(e)},reset:function(){o=null,this.context.svg.innerHTML=""},destroy:function(){var e=this.context.rootDomElement,t=this;t.reset(),e.remove(),t.snapItem=null,t.isOpen=!1}},e.Snap=r}(),function(){var e=Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Walkthrough"),t=function(){return{viewer:null}};e.WalkthroughManagerConfig=t}(),function(){var e=(Glodon.Bimface.Data.StatisticsDataManager.getInstance(),Glodon.Web.Lang.Utility.Namespace.ensureNamespace(Glodon,"Bimface.Plugins.Walkthrough")),t=function(){function e(t){_classCallCheck(this,e);var i=t.viewer;return i?i instanceof Glodon.Bimface.Viewer.Viewer3D?(this._viewer=i,void(this._walkthroughMap={})):void console.log("Viewer2D is not supported."):void console.log("viewer must not be empty.")}return _createClass(e,[{key:"addWalkthrough",value:function(e,t){var i=Glodon.Web.Lang.Utility.UUID.createUUID(),n={id:i,walkthrough:t};return t._walkthrough.setName(e),this._walkthroughMap[i]=n,i}},{key:"removeWalkthrough",value:function(e){var t=this;"[object String]"===Object.prototype.toString.call(e)&&(e=[e]),"[object Array]"===Object.prototype.toString.call(e)&&e.forEach(function(e){delete t._walkthroughMap[e]})}},{key:"setWalkthroughList",value:function(e){var t=this;if("[object Object]"===Object.prototype.toString.call(e)){var i=e.coordinate;e.data.forEach(function(e){var n=new Glodon.Bimface.Plugins.Walkthrough.WalkthroughConfig;n.viewer=t._viewer;var o=new Glodon.Bimface.Plugins.Walkthrough.Walkthrough(n),a=e.coordinateSystem||i;"world"===a&&e.keyFrames.forEach(function(e){e.coordinateSystem=a}),o.setKeyFrames(e.keyFrames),o.setWalkthroughTime(e.time),o._walkthrough.setName(e.name),t._walkthroughMap[e.id]={id:e.id,walkthrough:o}})}}},{key:"getWalkthroughList",value:function(){var e={data:[],version:1};for(var t in this._walkthroughMap){var i={id:t},n=this._walkthroughMap[t].walkthrough;i.keyFrames=n.getKeyFrames(),i.keyFrames.forEach(function(e){delete e.coordinateSystem}),i.name=n._walkthrough.getName(),i.time=n._walkthrough.walkthroughTime,i.coordinateSystem="world",e.data.push(i)}return e}}]),e}();e.WalkthroughManager=t}(),function(e){function t(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=10)}([function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return o(e,[{key:"init",value:function(e){this.notify("enter")}},{key:"redraw",value:function(e){e.updateOverlays()}},{key:"onDrawing",value:function(e,t){}},{key:"begin",value:function(e,t,i,n){}},{key:"end",value:function(e,t,i,n){}},{key:"onKeyDown",value:function(e,t){this.keyDown&&this.keyDown(e,t)}},{key:"onKeyUp",value:function(e,t){this.keyUp&&this.keyUp(e,t)}},{key:"onDoubleClick",value:function(e,t){}},{key:"onMouseWheel",value:function(e,t){var i=t.deltaY||-t.wheelDelta||t.detail,n=Math.abs(e.ratio-1),o=n+1,a=1/o,r=i<0?o:a,s=e.getZoomFactor();i>0&&s<.15||(e.zoomPan(r,t.offsetX,t.offsetY),this.observer&&this.observer(null,"zoomFactorChanged",e.getZoomFactor()))}},{key:"onMouseMove",value:function(e,t){var i=this.formatEventOffset(e,t);this.isPanMode(t.buttons)&&e.panTo(i.x,i.y),this.onEditing(e,i.x,i.y,t.buttons)}},{key:"onMouseDown",value:function(e,t){var i=this.formatEventOffset(e,t);e.setStartPoint(i.x,i.y),this.begin(e,i.x,i.y,t.buttons)}},{key:"onMouseUp",value:function(e,t){var i=this.formatEventOffset(e,t);return this.end(e,i.x,i.y,t.buttons)}},{key:"onEditing",value:function(e,t,i,n){}},{key:"onExit",value:function(e){this.notify("exit")}},{key:"formatEventOffset",value:function(e,t){var i=t.offsetX,n=t.offsetY;if("CANVAS"!=t.target.tagName.toLocaleUpperCase()){var o=e.dom.getBoundingClientRect();i=t.clientX-o.x,n=t.clientY-o.y}return{x:i,y:n}}},{key:"notify",value:function(e,t,i,n,o){this.observer&&this.observer(this.name,e,t,i,n,o)}},{key:"isPanMode",value:function(t){return t==e.MiddleButton||t==e.RightButton}}]),e}();a.CONTINUE=0,a.FINISHED=1,a.LelftButton=1,a.RightButton=2,a.MiddleButton=4,a.MouseMode=1,a.TouchMode=2,t.default=a},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return o(e,null,[{key:"distance",value:function(e,t){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}},{key:"center",value:function(e,t){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}},{key:"centerByArr",value:function(e,t){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}},{key:"distanceByArr",value:function(e,t){var i=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(i*i+n*n)}},{key:"normalize",value:function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]}},{key:"isPointInBBox",value:function(e,t,i,n){var o=.5*n[0];if(e<i[0]-o||e>i[0]+o)return!1;var a=.5*n[1];return!(t<i[1]-a||t>i[1]+a)}}]),e}();t.default=a},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(12),s=n(r),l=i(5),u=n(l),c=i(6),d=n(c),h=function(){function e(t,i,n,a){o(this,e);var r=document.getElementById(a);this.width=r.clientWidth,this.height=r.clientHeight,this.viewer=Module.createViewer(a,this.width,this.height),this.divId=a,this.dom=r,this.dc=s.default.create(t,i,n),this.ratio=1.1,this.drawHandle=null,this.scale=1,this.snapDistance=5,this.hover=!0,this.bindRendering=this.rendering.bind(this),this.customManager=new u.default,this.onViewChanges=function(){};var l=this;this.dc.overlayDrawers.custom=function(e){l.customManager.draw(l,e)},this.sendHighlightMsg=!0}return a(e,[{key:"setZoomRatio",value:function(e){this.ratio=e}},{key:"getZoomRatio",value:function(){return this.ratio}},{key:"getViewScale",value:function(e){return this.scale}},{key:"setViewScale",value:function(e){this.scale=e}},{key:"setSnapDistance",value:function(e){this.snapDistance=e}},{key:"snapshot",value:function(e){var t=this.dc.canvasMain,i=(this.dc.canvasOverlay,this.getDivId()),n=document.getElementById(i),o=document.createElement("canvas");o.width=n.clientWidth,o.height=n.clientHeight;var a=o.getContext("2d");return a.beginPath(),a.fillStyle=e||t.style.background,a.fillRect(0,0,o.width,o.height),a.drawImage(t,0,0),o.toDataURL()}},{key:"snapshotPure",value:function(){var e=this.dc.canvasMain,t=(this.dc.canvasOverlay,this.getDivId()),i=document.getElementById(t),n=document.createElement("canvas");n.width=i.clientWidth,n.height=i.clientHeight;var o=n.getContext("2d");return o.beginPath(),o.drawImage(e,0,0),n}},{key:"setBackgroundColor",value:function(e){this.dc.setBackgroundColor(e)}},{key:"showFilledFace",value:function(e){this.viewer.FilledFace=e}},{key:"isShowFilledFace",value:function(){return this.viewer.FilledFace}},{key:"setModel",value:function(e){if(this.viewer.SetModel(e),this.dc.setResourceUrl(e.Url),this.viewer.UpdateVisibleSettings(),void 0!=e.indexJson.sealImages){var t;for(t=0;t<e.indexJson.sealImages.length;++t){var i=e.indexJson.sealImages[t],n=i.path,o=n.split("\\"),a=o[o.length-1];this.viewer.AddSealImage(a,parseFloat(i.x),parseFloat(i.y),parseFloat(i.width),parseFloat(i.height))}}}},{key:"rendering",value:function(){this.viewer.Draw(this.dc)>0?this.rendering():(this.updateOverlays(),requestAnimationFrame(this.bindRendering))}},{key:"getDivId",value:function(){return this.divId}},{key:"getModel",value:function(){return this.viewer.GetModel()}},{key:"getViewAngle",value:function(){return this.viewer.ViewAngle}},{key:"setViewAngle",value:function(e){this.viewer.ViewAngle=e,this.update()}},{key:"getLayers",value:function(){for(var e=[],t=this.getModel(),i=t.GetLayerIds(),n=0,o=i.size();n<o;++n){var a=i.get(n),r=t.GetLayer(a);null!=r?e.push({id:r.Id,name:r.Name,color:r.Color,visible:r.Visible}):console.log("Layer not found!"+a)}return e}},{key:"changeLayers",value:function(e){for(var t=this.getModel(),i=0;i<e.length;++i){var n=e[i];t.GetLayer(n.id).Visible=n.visible}this.viewer.UpdateVisibleSettings()}},{key:"getLayouts",value:function(){var e=[],t=this.getModel(),i=t.GetLayoutIds();e.push({id:0,name:"Model"});for(var n=0,o=i.size();n<o;++n){var a=i.get(n),r=t.GetLayout(a);e.push({id:r.Id,name:r.Name})}return e}},{key:"activeLayoutById",value:function(e){this.viewer.ActiveLayout(e),this.update()}},{key:"getActiveLayoutId",value:function(){return this.viewer.GetActiveLayoutId()}},{key:"isModelView",value:function(){return 0==this.getActiveLayoutId()}},{key:"updateOverlays",value:function(){this.dc.drawingOverlay(this.width,this.height)}},{key:"update",value:function(e){function t(){i.viewer.Draw(i.dc)>0?i.drawHandle=requestAnimationFrame(t):(i.drawHandle=null,i.updateOverlays())}1==e&&(this.viewer.RequstDraw(Module.EnumRedrawHints.FinialDraw),this.onViewChanges());var i=this;null!==i.drawHandle&&cancelAnimationFrame(i.drawHandle),this.minimap&&this.minimap.update(),i.drawHandle=requestAnimationFrame(t)}},{key:"onResize",value:function(){this.resize(this.dom.clientWidth,this.dom.clientHeight)}},{key:"clearAll",value:function(){this.dc.clearAll(this.width,this.height)}},{key:"resize",value:function(e,t){this.width=e||this.dom.clientWidth,this.height=t||this.dom.clientHeight,this.dc.resize(e,t),this.viewer.Resize(e,t),this.update(),this.onViewChanges()}},{key:"zoomToExtent",value:function(e){void 0==e&&(e=1),this.viewer.ZoomToExtent(e),this.onViewChanges()}},{key:"zoomToObject",value:function(e,t){void 0==t&&(t=1),("string"==typeof e||e instanceof String)&&(e=parseInt(e)),this.viewer.ZoomToElement(e,t),this.onViewChanges()}},{key:"zoomToObjectWithBlock",value:function(e,t,i){void 0==i&&(i=1),("string"==typeof e||e instanceof String)&&(e=parseInt(e)),("string"==typeof t||t instanceof String)&&(t=parseInt(t)),this.viewer.ZoomToElementWithBlock(e,t,i),this.onViewChanges()}},{key:"setStartPoint",value:function(e,t){this.startX=e,this.startY=t}},{key:"zoom",value:function(e,t,i,n){this.viewer.ZoomToRect(e,t,i,n),this.update(!0),this.onViewChanges()}},{key:"panTo",value:function(e,t){return this.startX&&this.startY?(this.offsetX=e-this.startX,this.offsetY=t-this.startY,(0!=this.offsetX||0!=this.offsetY)&&(this.viewer.Pan(this.offsetX,this.offsetY),this.update(),this.startX=e,this.startY=t,this.onViewChanges(),!0)):(this.startX=e,this.startY=t,!1)}},{key:"zoomPan",value:function(e,t,i){this.offsetX=(t||this.width/2)-this.width/2,this.offsetY=(i||this.height/2)-this.height/2,this.viewer.ZoomPan(e,this.offsetX,this.offsetY),this.update(),this.onViewChanges()}},{key:"preSelect",value:function(e,t,i){return i?this.viewer.PreSelect(this.startX,this.startY,e,t):this.viewer.PreSelect(e,t,e,t)}},{key:"select",value:function(){this.viewer.Select()}},{key:"getSelectedIds",value:function(){for(var e=[],t=this.viewer.GetSelection(),i=0,n=t.size();i<n;++i)e.push(t.get(i));return e}},{key:"getHighlightIds",value:function(){for(var e=[],t=this.viewer.GetHighlightIds(),i=0,n=t.size();i<n;++i)e.push(t.get(i));return e}},{key:"clearSelection",value:function(){this.viewer.ClearSelection()}},{key:"clearHighlight",value:function(){this.viewer.ClearHighlight()}},{key:"selectByIds",value:function(e){var t=this.viewer.GetSelection();t.resize(0,0);for(var i=0,n=e.length;i<n;++i)t.push_back(parseInt(e[i]));this.viewer.SelectIds(t)}},{key:"highlightById",value:function(e){this.viewer.HighlightId(parseInt(e))}},{key:"getObjectBoundingBox",value:function(e){var t=this.getModel().FindElement(e);if(t){var i=t.BoundingBox;return[i.GetMinPt(),i.GetMaxPt()]}return null}},{key:"enableHover",value:function(e){this.hover=e}},{key:"toWorldPoint",value:function(e){return this.viewer.ToWorldPoint(e)}},{key:"toScreenPoint",value:function(e){return this.viewer.ToScreenPoint(e)}},{key:"toViewportScreenPoint",value:function(e){return this.viewer.ToViewportScreenPoint(e)}},{key:"toModelWorld",value:function(e){return this.viewer.ToModelWorldPoint(e)}},{key:"snapToPoint",value:function(e,t,i){return void 0==i&&(i=this.snapDistance),this.viewer.SnapToPoint(e,t,i)}},{key:"snapToPoint2",value:function(e,t,i,n,o){return void 0==o&&(o=this.snapDistance),this.viewer.SnapToPoint2(e,t,i,n,o)}},{key:"getZoomFactor",value:function(){var e=this.viewer.GetWorldSize();return this.viewer.WorldScale/Math.min(1/e[0],1/e[1])}},{key:"getState",value:function(){var e={ver:1,WorldScale:this.viewer.WorldScale,ViewAngle:this.viewer.ViewAngle,ViewCenter:this.viewer.ViewCenter,ZoomFactor:this.getZoomFactor()};return JSON.stringify(e)}},{key:"setState",value:function(e){var t=JSON.parse(e);return 1===t.ver&&(this.viewer.WorldScale=t.WorldScale,this.viewer.ViewAngle=t.ViewAngle,this.viewer.ViewCenter=t.ViewCenter,this.viewer.UpdateViewMatrix(),!0)}},{key:"getAlignState",value:function(){var e={ver:1,AlignMatrixCol1:this.viewer.GetAlignMatrixCol(0),AlignMatrixCol2:this.viewer.GetAlignMatrixCol(1),AlignMatrixCol3:this.viewer.GetAlignMatrixCol(2),AlignMatrixCol4:this.viewer.GetAlignMatrixCol(3)};return JSON.stringify(e)}},{key:"setAlignState",value:function(e){var t=JSON.parse(e);return 1===t.ver&&(void 0!=t.AlignMatrixCol1&&null!=t.AlignMatrixCol1&&(this.viewer.SetAlignMatrixCol(0,t.AlignMatrixCol1),this.viewer.SetAlignMatrixCol(1,t.AlignMatrixCol2),this.viewer.SetAlignMatrixCol(2,t.AlignMatrixCol3),this.viewer.SetAlignMatrixCol(3,t.AlignMatrixCol4)),this.viewer.UpdateViewMatrix(),!0)}},{key:"showElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.ShowElementBox(e)}},{key:"showElementBoxByBBox",value:function(e,t){e&&this.customManager.add([e[0][0],e[0][1]],[e[1][0],e[1][1]],t)}},{key:"setElementBoxColor",value:function(e,t,i,n){this.customManager.setColor(e,t,i,n)}},{key:"getElementBoxColor",value:function(){return this.customManager.getColor()}},{key:"getElementBoxStyle",value:function(){return this.customManager.getStyle()}},{key:"setElementBoxStyle",value:function(e){this.customManager.setStyle(e)}},{key:"hideElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.HideElementBox(e)}},{key:"clearElementBox",value:function(){this.viewer.ClearElementBox(),this.customManager.clear()}},{key:"getVisibleBoxIds",value:function(){for(var e=[],t=this.viewer.GetVisibleBoxIds(),i=0;i<t.size();++i)e.push(t.get(i));return e}},{key:"enableHighlightEvent",value:function(e){this.sendHighlightMsg=e}},{key:"isHighlightEventEnabled",value:function(){return this.sendHighlightMsg}},{key:"addClickCallback",value:function(e){this.clickCallback=e}},{key:"getClickCallback",value:function(){return this.clickCallback}},{key:"getModelBBox",value:function(){return this.viewer.GetModelBBox()}},{key:"enableSelectInBlock",value:function(){this.viewer.EnableSelectInBlock()}},{key:"disableSelectInBlock",value:function(){this.viewer.DisableSelectInBlock()}},{key:"canSelectInBlock",value:function(){return this.viewer.CanSelectInBlock()}},{key:"getSelectionWithBlock",value:function(){return this.viewer.GetSelectionWithBlock()}},{key:"GetHighlightIdsWithBlock",value:function(){return this.viewer.GetHighlightIdsWithBlock()}},{key:"highlightIdWithBlock",value:function(e,t){this.viewer.HighlightIdWithBlock(e,t)}},{key:"selectIdWithBlock",value:function(e,t){this.viewer.SelectIdWithBlock(e,t)}},{key:"createMinimap",value:function(e,t,i,n){if(0==this.isModelView())return void console.warn("Only model view support minimap.");void 0==this.minimap&&(this.minimap=new d.default(e,t,i,n),this.minimap.setDrawingImpl(this),this.minimap.initialize())}},{key:"enableMinimap",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.enableMiniMap(e)}},{key:"setMinimapBoundingBox",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.setDrawingContentsBbox(e)}},{key:"setMinimapOffset",value:function(e){this.minimap.setOffset(e)}},{key:"hasMinimap",value:function(){return 0==this.isModelView()?void console.warn("Only model view support minimap."):void 0!=this.minimap}},{key:"setGlobalColor",value:function(e){this.dc.customColor=e}},{key:"getGlobalColor",value:function(){return this.dc.customColor}},{key:"setPrintMode",value:function(e){this.dc.setPrintMode(e)}},{key:"zoomToWorldBox",value:function(e,t,i){void 0==i&&(i=1);var n=this.getModelBBox();n.SetMinMax(e,t),this.viewer.ZoomToWorldBox(n,i)}},{key:"alignDrawing",value:function(e,t){this.viewer.AlignDrawing(e,t)}},{key:"getAlignTranslate",value:function(){return this.viewer.GetAlignTranslate()}},{key:"scaleDrawing",value:function(e,t){this.viewer.AlignDrawingWithScale(e,t)}},{key:"getAlignScale",value:function(){return this.viewer.GetAlignScale()}},{key:"getViewportBBox",value:function(e){var t=this.viewer.GetViewportBBox(e),i=t.GetMinPt(),n=t.GetMaxPt();return{min:[i[0],i[1]],max:[n[0],n[1]]}}},{key:"getCustomManager",value:function(){return this.customManager}},{key:"setSnapMode",value:function(e){this.snapMode=e}},{key:"getSnapMode",value:function(){return this.snapMode}}]),e}();t.default=h},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function e(){n(this,e)};o.Measure={lineWidth:3,color:"#F99D0B",snapColor:"#11DAB7",auxLineDash:[6,4],auxLineWidth:1,auxColorX:"#7CCF21",auxColorY:"#CC021B",outlineColor:"#FFFFFF",outlineWidth:2},o.Zoom={color:"#00ff00",lineWidth:2},t.default=o},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(0),u=n(l),c=i(3),d=n(c),h=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.step=0,e.tmpPoint=null,e.viewPort=null,e.originPoint=null,e.points=[],e.isMatchSnapMode=!0,e.isEnableSnap=!0,e}return r(t,e),s(t,[{key:"drawSnapPoint",value:function(e,t){if(this.drawing2D||(this.drawing2D=e,this.ctx=t),!this.ctx&&(this.ctx=t),null!=this.tmpPoint&&(0!=this.tmpPoint.GetID()||"Intersection"==this.tmpPoint.GetSnapTypeName())){if(!this.isMatchSnapMode)return!0;this.isFootPoint=!1;var i=void 0,n=this.tmpPoint;if(this.points[0]&&this.step>0){var o=e.toScreenPoint(this.points[0].GetPoint()),a=this.tmpPointScreenPoint;n=e.snapToPoint2(a[0],a[1],o[0],o[1]),i=n.GetSnapTypeName()}else i=this.tmpPoint.GetSnapTypeName();var r=void 0;return r=e.viewer.IsActiveLayoutElement(n.GetID())?e.toScreenPoint(n.GetPoint()):e.toViewportScreenPoint(n.GetPoint()),this.drawTmpPoint(e,t,r,i),!0}return this.finalScreenPoint=null,this.captureFail(this.tmpPointScreenPoint),!1}},{key:"captureFail",value:function(e){}},{key:"drawTmpPoint",value:function(e,t,i,n){this.isEnableSnap&&(e=e||this.drawing2D,t=t||this.ctx,t.strokeStyle=t.fillStyle=d.default.Measure.snapColor,t.beginPath(),"EndPoint"==n?(t.lineWidth=2,t.rect(i[0]-4,i[1]-4,8,8),t.stroke()):"PointOnLine"==n?(t.arc(i[0],i[1],4.5,0,2*Math.PI,!0),t.fill()):"MiddlePoint"==n?(t.lineWidth=2,t.moveTo(i[0],i[1]-4),t.lineTo(i[0]-5,i[1]+4),t.lineTo(i[0]+5,i[1]+4),t.closePath(),t.stroke()):"FootPoint"==n?(this.points[1]=this.tmpPoint,this.isFootPoint=!0,t.lineWidth=2,t.moveTo(i[0]-6,i[1]-6),t.lineTo(i[0]-6,i[1]+6),t.lineTo(i[0]+6,i[1]+6),t.moveTo(i[0]-6,i[1]-1),t.lineTo(i[0]+1,i[1]-1),t.lineTo(i[0]+1,i[1]+6),t.stroke()):"Intersection"==n&&(t.lineWidth=2,t.moveTo(i[0]-4,i[1]-4),t.lineTo(i[0]+4,i[1]+4),t.moveTo(i[0]-4,i[1]+4),t.lineTo(i[0]+4,i[1]-4),t.stroke()),this.finalScreenPoint=i,this.tmpPointScreenPoint=i)}},{key:"onDrawing",value:function(e,t){if(this.drawSnapPoint(e,t),this.markPoint){var i=e.toScreenPoint(this.markPoint.slice(0,2));t.beginPath(),t.lineWidth=2,t.strokeStyle=d.default.Measure.color,t.fillStyle=t.strokeStyle,t.moveTo(i[0]-7.5,i[1]),t.lineTo(i[0]+7.5,i[1]),t.moveTo(i[0],i[1]-7.5),t.lineTo(i[0],i[1]+7.5),t.stroke(),t.rect(i[0]-2.5,i[1]-2.5,5,5),t.fill(),this.tmpPointScreenPoint&&(t.save(),t.lineDashOffset=10,t.setLineDash([3,3]),t.globalAlpha=.5,t.strokeStyle="#FF9D0B",t.moveTo(i[0],i[1]),t.lineTo(this.tmpPointScreenPoint[0],this.tmpPointScreenPoint[1]),t.stroke(),t.restore())}}},{key:"setIsOnlySnap",value:function(e){this.onlySnap=e}},{key:"begin",value:function(e,t,i,n){1!=n||this.onlySnap||(this.markPoint?this.markPoint=null:this.finalScreenPoint?this.markPoint=e.toModelWorld([this.finalScreenPoint[0],this.finalScreenPoint[1]]):this.markPoint=e.toModelWorld([t,i]),this.redraw(e))}},{key:"onEditing",value:function(e,t,i,n){this.tmpPointScreenPoint=[t,i],this.tmpPoint=e.snapToPoint(t,i),this.isMatchSnapMode=this.matchSnapMode(this.tmpPoint,e.getSnapMode()),this.redraw(e)}},{key:"end",value:function(e,t,i,n){}},{key:"onExit",value:function(e){this.redraw(e)}},{key:"setIsEnableSnap",value:function(e){this.isEnableSnap=e}},{key:"matchSnapMode",value:function(e,t){if(!e)return!1;if(!t)return!0;var i=e.GetSnapTypeName(),n=t.snapList,o={PointOnLine:"line",Intersection:"intersection",MiddlePoint:"midpoint",EndPoint:"endpoint"};return n.includes(o[i])}}]),t}(u.default);t.default=h},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(13),s=n(r),l=i(14),u=n(l),c=i(15),d=n(c),h=function(){function e(){o(this,e),this.markups=[],this.red=255,this.green=0,this.blue=0,this.alpha=1,this.strokeStyle="rgba(255,0,0,1)",this.lineWidth=3,this.fontSize=14,this.fontFamily="Arial",this.type="Rectangle",this.fillStyle="red",this.enableFillStyle=!1}return a(e,[{key:"add",value:function(e,t,i,n,o){var a=void 0,r={strokeStyle:this.strokeStyle,lineWidth:this.lineWidth};switch(this.type){case"Rectangle":a=new s.default(e,t,r,i);break;case"CloudRect":a=new u.default(e,t,r,i);break;case"Chartlet":a=new d.default(n,e,t,o,i)}this.markups.push(a)}},{key:"setColor",value:function(e,t,i,n){this.red=e,this.green=t,this.blue=i,this.alpha=n,this.strokeStyle="rgba("+e+","+t+","+i+","+n+")"}},{key:"getColor",value:function(){return{red:this.red,green:this.green,blue:this.blue,alpha:this.alpha}}},{key:"setStyle",value:function(e){this.type=e}},{key:"getStyle",value:function(){return this.type}},{key:"clear",value:function(){this.markups=[]}},{key:"draw",value:function(e,t){
for(var i=this.markups,n=0,o=i.length;n<o;++n){var a=i[n];t.strokeStyle=a.strokeStyle,t.lineWidth=a.lineWidth,t.fillStyle=a.fillStyle,a.draw(e,t)}}},{key:"setFillColor",value:function(e){this.enableFillStyle=!0,this.fillStyle=e}},{key:"setFillStyleState",value:function(e){this.enableFillStyle=e}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"setFont",value:function(e){this.font=e}},{key:"get",value:function(e){return this.markups[e]}},{key:"remove",value:function(e){e<0||this.markups.splice(e,1)}},{key:"setFontSize",value:function(e){this.fontSize=e}},{key:"getMarkupSize",value:function(e,t){var i=this.getMarkupBbox(e,t);return[Math.abs(i[2]-i[0]),Math.abs(i[3]-i[1])]}},{key:"setFontFamily",value:function(e){this.fontFamily=e}},{key:"translatePos",value:function(e,t,i,n){for(var o=(this.getMarkupCenter(e,t),n[0]-i[0]),a=n[1]-i[1],r=this.markups[t],s=r.getPoints(),l=0;l<s.length;l+=2)s[l]+=o,s[l+1]+=a;r.setPoints(s)}},{key:"hitGrip",value:function(e,t,i){for(var n=this.markups[i],o=n.getGrips(e),a=0;a<o.length;a+=2){var r=[o[a],o[a+1]];if(r=e.toScreenPoint(r),this.isPointInCircle(t,r,8))return 4==o.length?0==a?0:4:a/2}return-1}}]),e}();t.default=h},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(16),r=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(t,i,o,a){n(this,e),this.width=o||300,this.height=a||240,this.imageUrl=i,this.domContainer=document.getElementById(t),this.xmlns="http://www.w3.org/2000/svg",this.naviAlgorithm=new r.default,this.boundingBox=null,this.originalDrawingContentsBbox=null,this.drawingImpl=null,this.isEnabled=!0}return o(e,[{key:"initialize",value:function(){this.initMinimapContainer(),this.initImageNode(this.imageUrl),this.initOutline(),this.initSvgRect()}},{key:"initMinimapContainer",value:function(){this.minimapContainer=document.createElementNS(this.xmlns,"svg");var e={width:this.width+"",height:this.height+""};this.setAttribute(this.minimapContainer,e);var t={position:"absolute","z-index":10,right:"10px",bottom:"60px",display:"block",backgroundColor:"#000000",opacity:"0.88"};this.setStyle(this.minimapContainer,t),this.domContainer.appendChild(this.minimapContainer);var i=this;this.minimapContainer.addEventListener("mousedown",function(e){i.bMousedown=!0,e.stopPropagation()}),this.minimapContainer.addEventListener("mouseup",function(e){if(1==i.bMousedown){i.bMousedown=!1,e.stopPropagation();var t={x:e.offsetX,y:e.offsetY},n=i.naviAlgorithm;n.minimapToNormalizedPoint(t,i.getMinimapContentsBbox()),n.normalizedPointToWorld(t,i.getDrawingContentsBbox());var o=i.drawingImpl.toScreenPoint([t.x,t.y]),a=i.drawingImpl.toScreenPoint([i.lastPoint.x,i.lastPoint.y]),r=[a[0]-o[0],a[1]-o[1]];i.drawingImpl.viewer.Pan(r[0],r[1]),i.drawingImpl.update(),i.drawingImpl.onViewChanges()}})}},{key:"setOffset",value:function(e){var t=this.minimapContainer;this.setStyle(t,e)}},{key:"initImageNode",value:function(e){this.svgImage=document.createElementNS(this.xmlns,"image"),this.svgImage.href.baseVal=e;var t={preserveAspectRatio:"xMidYMid meet",width:this.width+"",height:this.height+""};this.setAttribute(this.svgImage,t),this.minimapContainer.appendChild(this.svgImage)}},{key:"initSvgRect",value:function(){this.svgRect=document.createElementNS(this.xmlns,"rect");var e={width:"300",height:"240"};this.setAttribute(this.svgRect,e);var t={position:"absolute",display:"block",fillOpacity:"0.1",fill:"#11DAB7",stroke:"#11DAB7",strokeWidth:"2px"};this.setStyle(this.svgRect,t),this.minimapContainer.appendChild(this.svgRect),this.resize(this.width-2,this.height-2),this.moveTo(1,1)}},{key:"initOutline",value:function(){this.outline=document.createElementNS(this.xmlns,"rect");var e={width:"300",height:"240"};this.setAttribute(this.outline,e);var t={position:"absolute",fill:"none",stroke:"#555555",strokeWidth:"1px"};this.setStyle(this.outline,t),this.minimapContainer.appendChild(this.outline)}},{key:"moveTo",value:function(e,t){this.svgRect.setAttribute("transform","translate("+e+","+t+")")}},{key:"resize",value:function(e,t){var i={width:e+"",height:t+""};this.setAttribute(this.svgRect,i)}},{key:"setStyle",value:function(e,t){for(var i in t)e.style[i]=t[i]}},{key:"setAttribute",value:function(e,t){for(var i in t)e.setAttribute(i,t[i])}},{key:"enableMiniMap",value:function(e,t){var i={display:"none"};!0===e&&(i.display="block"),1!=t&&(this.isEnabled=e),this.setStyle(this.minimapContainer,i)}},{key:"setDrawingImpl",value:function(e){this.drawingImpl=e}},{key:"getMinimapContentsBbox",value:function(){var e=this.height,t=this.width,i=(this.width-this.height)/2,n={x:this.width/2,y:this.height/2};return{min:{x:n.x-t/2+i,y:n.y-e/2},max:{x:n.x+t/2-i,y:n.y+e/2}}}},{key:"setDrawingContentsBbox",value:function(e){this.setOriginalDrawingContentsBbox(e);var t=Math.abs(e.max.x-e.min.x),i=Math.abs(e.max.y-e.min.y),n={x:(e.max.x+e.min.x)/2,y:(e.max.y+e.min.y)/2},o=Math.max(t,i);e.min.x=n.x-o/2,e.min.y=n.y-o/2,e.max.x=n.x+o/2,e.max.y=n.y+o/2,void 0==this.lastPoint&&(this.lastPoint={x:(e.min.x+e.max.x)/2,y:(e.min.y+e.max.y)/2}),this.boundingBox=e}},{key:"getDrawingContentsBbox",value:function(){return this.boundingBox}},{key:"setOriginalDrawingContentsBbox",value:function(e){var t=JSON.parse(JSON.stringify(e));this.originalDrawingContentsBbox=t}},{key:"getOriginalDrawingContentsBbox",value:function(){return JSON.parse(JSON.stringify(this.originalDrawingContentsBbox))}},{key:"update",value:function(){if(0==this.drawingImpl.isModelView())return void this.enableMiniMap(!1,!0);this.enableMiniMap(this.isEnabled);var e=this.domContainer.clientWidth,t=this.domContainer.clientHeight,i=this.drawingImpl.toWorldPoint([0,t]),n=this.drawingImpl.toWorldPoint([e,0]);this.lastPoint={x:(n[0]+i[0])/2,y:(n[1]+i[1])/2};var o={x:i[0],y:i[1]},a={x:n[0],y:n[1]},r=this.naviAlgorithm,s=this.getOriginalDrawingContentsBbox(),l={min:o,max:a};if(r.containsBox(l,s))return this.resize(this.width-2,this.height-2),void this.moveTo(1,1);r.worldToNormalizedPoint(o,this.getDrawingContentsBbox()),r.normalizedPointToMinimap(o,this.getMinimapContentsBbox()),r.worldToNormalizedPoint(a,this.getDrawingContentsBbox()),r.normalizedPointToMinimap(a,this.getMinimapContentsBbox());var u=[(o.x+a.x)/2,(o.y+a.y)/2],c=Math.abs(a.x-o.x),d=Math.abs(a.y-o.y);s={min:{x:u[0]-c/2,y:u[1]-d/2},max:{x:u[0]+c/2,y:u[1]+d/2}},l={min:{x:0,y:0},max:{x:this.width,y:this.height}};var h=r.intersect(s,l);r.boundsChecking(h,{x:this.width,y:this.height}),u=[(h.min.x+h.max.x)/2,(h.min.y+h.max.y)/2],c=Math.abs(h.max.x-h.min.x),d=Math.abs(h.max.y-h.min.y),this.resize(c,d),this.moveTo(u[0]-c/2,u[1]-d/2)}}]),e}();t.default=s},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(2),u=(n(l),i(1)),c=n(u),d=i(0),h=n(d),f=i(8),g=n(f),v=i(22),m=n(v),p=function(e){function t(e){o(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,h.default.TouchMode));return i.rltTopHeight=i.relativeHight(e),i.auxMobileMeasureTool=new m.default(e,i.editors),i}return r(t,e),s(t,[{key:"relativeHight",value:function(e){var t=e.getDivId();return document.getElementById(t).getBoundingClientRect().top}},{key:"__getMobileEvt",value:function(e){for(var e=e.originalEvent||e,t=[],i=null,n=0,o=e.touches.length;n<o;n++)i=e.touches[n],t.push({x:i.pageX,y:i.pageY});return 0==e.touches.length&&(i=e.changedTouches[0],t.push({x:i.pageX,y:i.pageY})),t.length<=1?{isMulti:!1,point:t[0]}:{isMulti:!0,distance:c.default.distance(t[0],t[1]),point:t}}},{key:"onTouchStart",value:function(e){var t=this.__getMobileEvt(e);if(t.isMulti){var i=c.default.center(t.point[0],t.point[1]);this.drawing2D.setStartPoint(i.x,i.y)}else if("measure"==this.getEditorName())this.auxMobileMeasureTool.setEditor(this.getEditor()),t.point.y-=this.rltTopHeight,this.auxMobileMeasureTool.onTouchStart(t);else{this.drawing2D.setStartPoint(t.point.x,t.point.y-this.rltTopHeight);var n=this.getEditor();n.begin(this.drawing2D,t.point.x,t.point.y-this.rltTopHeight,1)}this.startEvent=t}},{key:"onTouchEnd",value:function(e){var t=e.changedTouches;if(1==t.length){if("measure"==this.getEditorName()){var i=this.__getMobileEvt(e);return i.point.y-=this.rltTopHeight,void this.auxMobileMeasureTool.onTouchEnd(i)}var n=this.getEditor();if(n.end(this.drawing2D,t[0].pageX,t[0].pageY-this.rltTopHeight,1)===h.default.FINISHED&&(n.onExit(this.drawing2D),this.editors.pop()),1==e.touches.length){var o=e.touches[0];this.drawing2D.setStartPoint(o.pageX,o.pageY-this.rltTopHeight)}}}},{key:"onTouchMove",value:function(e){var t=this.__getMobileEvt(e);if(t.isMulti){if(!this.startEvent.distance)return;var i=t.distance/this.startEvent.distance;if(1!=i){var n=t.point;this.drawing2D.zoomPan(i,(n[0].x+n[1].x)/2,(n[0].y+n[1].y)/2)}}else if("measure"==this.getEditorName())t.point.y-=this.rltTopHeight,this.auxMobileMeasureTool.onTouchMove(t);else{var o=this.getEditor();o.onEditing(this.drawing2D,t.point.x,t.point.y-this.rltTopHeight,1)}this.startEvent=t}},{key:"bindEvents",value:function(){function e(e){e.preventDefault(),n.onTouchStart(e)}function t(e){e.preventDefault(),n.onTouchEnd(e)}function i(e){e.preventDefault(),n.onTouchMove(e)}var n=this;this.allEvent={onTouchStart:e,onTouchEnd:t,onTouchMove:i};var o=n.getDom();o.addEventListener("touchstart",this.allEvent.onTouchStart,!1),o.addEventListener("touchend",this.allEvent.onTouchEnd,!1),o.addEventListener("touchmove",this.allEvent.onTouchMove,!1)}},{key:"unbindAllEvent",value:function(){var e=this.getDom();e.removeEventListener("touchstart",this.allEvent.onTouchStart,!1),e.removeEventListener("touchend",this.allEvent.onTouchEnd,!1),e.removeEventListener("touchmove",this.allEvent.onTouchMove,!1)}}]),t}(g.default);t.default=p},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(2),s=(n(r),i(0)),l=(n(s),i(17)),u=n(l),c=i(18),d=n(c),h=i(19),f=n(h),g=i(20),v=n(g),m=i(21),p=n(m),y=i(4),w=n(y),b=function(){function e(t,i){o(this,e),this.drawing2D=t,this.id="editor-"+i,this.mode=i,this.editors=[],this.editors.push(new d.default),this.observer=null,e.editorMode=this.mode;var n=this;t.dc.overlayDrawers[this.id]=function(e){for(var i=0;i<n.editors.length;++i)n.editors[i].onDrawing(t,e)}}return a(e,[{key:"destroy",value:function(){delete this.drawing2D.dc.overlayDrawers[this.id],this.drawing2D=null}},{key:"getDom",value:function(){return this.drawing2D.dom}},{key:"getEditor",value:function(){return this.editors[this.editors.length-1]}},{key:"getEditorName",value:function(){return this.getEditor().name}},{key:"activeEditorByName",value:function(e){var t=null;switch(e){case"zoom":t=new u.default;break;case"pick":t=new f.default;break;case"pan":t=new d.default;break;case"measure":t=new v.default;break;case"area-measure":t=new p.default;break;case"capture":t=new w.default}if(t.name=e,t.mode=this.mode,t.observer=this.observer,t.init(this.drawing2D),"zoom"==e){var i=this.editors.length;i>0&&this.editors[i-1].name==e||this.editors.push(t)}else this.getEditor().onExit(this.drawing2D),this.editors=[],this.editors.push(t)}},{key:"enableSnap",value:function(e){this.getEditor().enableSnap&&this.getEditor().enableSnap(e)}},{key:"setSnapMode",value:function(e){this.getEditor().setSnapMode&&this.getEditor().setSnapMode(e)}}]),e}();b.editorMode=-1,t.default=b},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(2),u=(n(l),i(0)),c=n(u),d=i(8),h=n(d),f=function(e){function t(e){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,c.default.MouseMode))}return r(t,e),s(t,[{key:"onDoubleClick",value:function(e){this.getEditor().onDoubleClick(this.drawing2D,e)}},{key:"onMouseDown",value:function(e){this.getEditor().onMouseDown(this.drawing2D,e);var t=this.drawing2D.getClickCallback();t&&t([e.offsetX,e.offsetY])}},{key:"onMouseUp",value:function(e){var t=this.getEditor();t.onMouseUp(this.drawing2D,e)===c.default.FINISHED&&(t.onExit(this.drawing2D),this.editors.pop())}},{key:"onMouseMove",value:function(e){this.getEditor().onMouseMove(this.drawing2D,e)}},{key:"onMouseWheel",value:function(e){this.getEditor().onMouseWheel(this.drawing2D,e)}},{key:"onKeyDown",value:function(e){var t=this.getEditor();t.onKeyDown(this.drawing2D,e)==c.default.FINISHED&&(t.onExit(this.drawing2D),this.editors.pop())}},{key:"onKeyUp",value:function(e){var t=this.getEditor();t.onKeyUp(this.drawing2D,e)==c.default.FINISHED&&(t.onExit(this.drawing2D),this.editors.pop())}},{key:"unbindAllEvent",value:function(){var e=this.getDom();e.removeEventListener("dblclick",this.allEvent.onDoubleClick,!1),e.removeEventListener("mousedown",this.allEvent.onMouseDown,!1),e.removeEventListener("mouseup",this.allEvent.onMouseUp,!1),e.removeEventListener("mousemove",this.allEvent.onMouseMove,!1),e.removeEventListener("mousewheel",this.allEvent.onMouseWheel,!1),e.removeEventListener("DOMMouseScroll",this.allEvent.onMouseWheel,!1),document.removeEventListener("keydown",this.allEvent.onKeyDown),document.removeEventListener("keyup",this.allEvent.onKeyUp)}},{key:"bindEvents",value:function(){function e(e){e.preventDefault(),s.onDoubleClick(e)}function t(e){e.preventDefault(),s.onMouseDown(e)}function i(e){s.onMouseMove(e)}function n(e){e.preventDefault(),s.onMouseWheel(e)}function o(e){e.preventDefault(),s.onMouseUp(e)}function a(e){s.onKeyDown(e)}function r(e){s.onKeyUp(e)}var s=this;this.allEvent={onDoubleClick:e,onMouseDown:t,onMouseMove:i,onMouseWheel:n,onMouseUp:o,onKeyDown:a,onKeyUp:r};var l=s.getDom();l.addEventListener("dblclick",this.allEvent.onDoubleClick,!1),l.addEventListener("mousedown",this.allEvent.onMouseDown,!1),l.addEventListener("mouseup",this.allEvent.onMouseUp,!1),l.addEventListener("mousemove",this.allEvent.onMouseMove,!1),l.addEventListener("mousewheel",this.allEvent.onMouseWheel,!1),l.addEventListener("DOMMouseScroll",this.allEvent.onMouseWheel,!1),l.oncontextmenu=function(e){e.preventDefault()},document.addEventListener("keydown",this.allEvent.onKeyDown),document.addEventListener("keyup",this.allEvent.onKeyUp)}}]),t}(h.default);t.default=f},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}var o=i(11),a=n(o),r=i(23),s=n(r),l=i(26),u=n(l),c={preRun:[],postRun:[],print:function(e){console.log(e)},printErr:function(e){e=Array.prototype.slice.call(arguments).join(" "),console.log(e)},progress:function(e,t,i){""==e?(console.log("Initialized."),a.default.ready()):console.log(e)},locateFile:function(e){return a.default.sdkUrl+e},setStatus:function(e){if(c.setStatus.last||(c.setStatus.last={time:Date.now(),text:""}),e!==c.setStatus.text){var t=e.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);t?c.progress(e,100*parseInt(t[2]),100*parseInt(t[4])):c.progress(e,null,null)}},totalDependencies:0,monitorRunDependencies:function(e){this.totalDependencies=Math.max(this.totalDependencies,e),c.setStatus(e?"Preparing... ("+(this.totalDependencies-e+1)+"/"+this.totalDependencies+")":"Complete.")}};c.setStatus("20180528"),a.default.loadModel=function(e,t,i){var n=new XMLHttpRequest,o=this;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status||0==n.status){var r=c.LoadCallback.extend("LoadCallback",{OnLoad:function(e){e.indexJson=JSON.parse(n.responseText),t(e)},OnError:function(){t(null)},OnDownloading:function(e){a.default.onLoadProgress(e)}}),s=JSON.parse(n.responseText),l=!0;0!=s.metadata.gz&&"false"!=s.metadata.gz||(l=!1);var u=new r;c.loadModel(e+"/",u,l)}else 404===n.status&&(i?o.loadModel(e,t):t(null))},n.open("GET",e+"/index.json"+(i&&".gz"||"")),n.send()},a.default.loadGrids=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status||0==i.status){var e=JSON.parse(i.responseText);t(e)}else 404===i.status&&t(null)},i.open("GET",e+"/grids.json"),i.send()},s.default.loadModel=function(e,t,i,n,o,a){var r=new XMLHttpRequest,l=this;r.onreadystatechange=function(){if(r.readyState===XMLHttpRequest.DONE)if(200===r.status||0==r.status){var u=JSON.parse(r.responseText),c=!0;if(!o){0!=u.metadata.gz&&"false"!=u.metadata.gz||(c=!1);var d=0,h=0;void 0!=u.metadata.translate_x&&null!=u.metadata.translate_x&&(d=parseFloat(u.metadata.translate_x)),void 0!=u.metadata.translate_y&&null!=u.metadata.translate_y&&(h=parseFloat(u.metadata.translate_y))}var f=i.viewer,g=new i.butterfly.LoadReactor;g.OnLoad=function(){0==f.PrepareModel()&&console.error("The model data is not ready!"),f.translateX=d,f.translateY=h,n(f)},g.OnDownloading=function(e){s.default.onLoadProgress(1-e)},g.OnError=function(){console.error("error when parse")},o&&(e=e+"/"+o),f.url=e,f.Load(e,g,c)}else 404===r.status&&(a?l.loadModel(e,t,i,n,o):n(null))},r.open("GET",e+"/index.json"+(a&&".gz"||"")),r.send()},s.default.addModel=function(e,t,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE)if(200===n.status||0==n.status){var o=JSON.parse(n.responseText);0!=o.metadata.gz&&o.metadata.gz;var a=new t.butterfly.LoadReactor;a.OnLoad=function(){0==t.viewer.PrepareLastModel()&&console.error("The model data is not ready!"),i()},a.OnDownloading=function(e){s.default.onLoadProgress(1-e)},a.OnError=function(){console.error("error when parse")},t.viewer.Add(e,a)}else 404===n.status&&i(null)},n.open("GET",e+"/index.json"),n.send()},s.default.loadGrids=function(e,t){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE)if(200===i.status||0==i.status){var e=JSON.parse(i.responseText);t(e)}else 404===i.status&&t(null)},i.open("GET",e+"/grids.json"),i.send()},window.Module=c,window.Glodon=window.Glodon||{},window.Glodon.Bimface=window.Glodon.Bimface||{},window.Glodon.Bimface.DrawingSheet=a.default,window.Glodon.Bimface.WebglDrawingSheet=s.default,window.Glodon.Bimface.RevitInterop=u.default},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(2),s=n(r),l=i(7),u=n(l),c=i(9),d=n(c),h=function(){function e(){o(this,e)}return a(e,null,[{key:"initialize",value:function(t){void 0!==t&&(e.ready=t);var i=document.getElementsByTagName("HEAD").item(0),n=document.createElement("script");n.type="text/javascript",n.src=e.sdkUrl+"/mdvjs.js",i.appendChild(n)}},{key:"ready",value:function(){console.log("Drawing2D engine is ready!")}},{key:"onLoadProgress",value:function(e){console.log(e)}},{key:"loadModel",value:function(e,t){console.log("not implemented!")}},{key:"createDrawing",value:function(e){var t=document.getElementById(e),i=document.createElement("canvas");i.id=e+"-main-drawing",i.width=t.clientWidth,i.height=t.clientHeight,i.style.position="absolute",t.appendChild(i);var n=document.createElement("canvas");n.id=e+"-aux-drawing",n.width=t.clientWidth,n.height=t.clientHeight,n.style.position="absolute",t.appendChild(n);var o=document.createElement("canvas");return o.id=e+"-ovl-drawing",o.width=t.clientWidth,o.height=t.clientHeight,o.style.position="absolute",t.appendChild(o),new s.default(i,n,o,e)}},{key:"createMouseEditorManager",value:function(e){return new d.default(e)}},{key:"createTouchEditorManager",value:function(e){return new u.default(e)}}]),e}();h.sdkUrl="js/",t.default=h},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(1),r=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){n(this,e)}return o(e,null,[{key:"create",value:function(e,t,i){var n=Module.DeviceContext.extend("DeviceContext",{initialize:function(e,t){this.canvasMain=e,this.canvasTemp=t,this.canvasOverlay=i,this.ctxMain=this.canvasMain.getContext("2d"),this.ctxTemp=this.canvasTemp.getContext("2d"),this.ctxOverlay=this.canvasOverlay.getContext("2d"),this.inPath=!1,this.fontSize=12,this.colorTable={},this.faceColorTable={},this.globalOpacity=null,this.Normal=0,this.White=1,this.Black=2,this.Gray=3,this.Custom=4,this.printMode=this.Normal,this.printColorTable={},this.printFaceColorTable={},this.resUrl="",this.images={},this.ignoreImage=!1,this.targetId=0,this.overlayDrawers={},this.customColor=-1},drawingOverlay:function(e,t){var i=this.ctxOverlay;i.clearRect(0,0,e,t);var n=this.overlayDrawers;for(var o in n)n[o](i)},setBackgroundColor:function(e){this.canvasMain.style.background=e},setPrintMode:function(e){if("Normal"==e)this.printMode=this.Normal;else if("Gray"==e)this.printMode=this.Gray;else if("Black"==e)this.printMode=this.Black;else if("White"==e)this.printMode=this.White;else{if("Custom"!=e)return;this.printMode=this.Custom}},setResourceUrl:function(e){this.resUrl=e},setGlobalOpacity:function(e){this.globalOpacity=e},getGlobalOpacity:function(){return this.globalOpacity},restoreGlobalOpacity:function(){this.globalOpacity=null},getHexColor:function(e){var t=null===this.globalOpacity?1:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var a=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printColorTable[e]="rgba("+a+","+a+","+a+","+t+")",this.printColorTable[e]}return this.colorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.colorTable[e]},getFaceColor:function(e){var t=null===this.globalOpacity?.9:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var a=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printFaceColorTable[e]="rgba("+a+","+a+","+a+","+t+")",this.printFaceColorTable[e]}return this.faceColorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.faceColorTable[e]},resize:function(e,t){this.canvasMain.setAttribute("width",e),this.canvasMain.setAttribute("height",t),this.canvasTemp.setAttribute("width",e),this.canvasTemp.setAttribute("height",t),this.canvasOverlay.setAttribute("width",e),this.canvasOverlay.setAttribute("height",t)},clearAll:function(e,t){this.ctxMain.clearRect(0,0,e,t),this.ctxTemp.clearRect(0,0,e,t),this.ctxOverlay.clearRect(0,0,e,t)},SetTarget:function(e){0==e?this.ctx=this.ctxMain:(this.ctx=this.ctxTemp,this.ctx.strokeStyle="#ff0000"),this.targetId=e},BeginDraw:function(e,t){this.ctx.clearRect(t[0],t[1],t[2],t[3])},EndDraw:function(e){},BeginPath:function(){this.inPath=!0,this.ctx.beginPath()},EndPath:function(e,t){this.inPath=!1,e&&(this.ctx.fillStyle=this.getFaceColor(t),this.ctx.closePath(),this.ctx.fill()),this.ctx.stroke()},BeginClip:function(e){e&&(this.ctx.save(),this.ctx.clip())},EndClip:function(e){e&&this.ctx.restore()},SetLineColor:function(e){var t=this.getHexColor(e);this.ctx.strokeStyle=t,this.ctx.fillStyle=t},SetLineWidth:function(e){this.ctx.lineWidth=e},SetLineDash:function(e,t){if(0==e)return void this.ctx.setLineDash([]);if(1==e)return void this.ctx.setLineDash([10]);for(var i=[],n=0,o=t.size();n<o;++n)i.push(t.get(n));this.ctx.setLineDash(i)},SetFont:function(e){this.fontSize=e,this.ctx.font=this.fontSize+"px ä»¿å®‹"},DrawPoint:function(e,t,i){},DrawLine:function(e,t){if(this.inPath)this.ctx.moveTo(e[0],e[1]),this.ctx.lineTo(t[0],t[1]);else{for(var i=this.ctx.getLineDash(),n=0,o=0;o<i.length;++o)n+=i[o];this.ctx.beginPath(),this.ctx.moveTo(e[0],e[1]),(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])<n*n&&this.ctx.setLineDash([]),this.ctx.lineTo(t[0],t[1]),this.ctx.stroke(),this.ctx.setLineDash(i)}},DrawArc:function(e,t,i,n){this.inPath?this.ctx.arc(e[0],e[1],t,-i,-n,!0):(this.ctx.beginPath(),this.ctx.arc(e[0],e[1],t,-i,-n,!0),this.ctx.stroke())},DrawRec:function(e,t){this.inPath?this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]):(this.ctx.beginPath(),this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]),this.ctx.stroke())},DrawCloudRec:function(e,t,i){var n=e,o=t;i=i||this.ctx,n=[n[0]+18/3.5,n[1]+18/3.5],o=[o[0]-18/3.5,o[1]-18/3.5];var a=o[1]-n[1],r=o[0]-n[0],s=Math.abs(r),l=Math.abs(a),u=parseInt(s/18),c=parseInt(l/18),d=0==u?s:s/u,h=0==c?l:l/c;i.beginPath(),this.drawSide("orientation",d,s,n[0],n[1],i),this.drawSide("orientation",d,s,n[0]+s,n[1]+l,i,!0),this.drawSide("portrait",h,l,n[0]+s,n[1],i),this.drawSide("portrait",h,l,n[0],n[1]+l,i,!0),i.stroke()},drawSide:function(e,t,i,n,o,a,r){var s=0,l=0,u=i/t,c=void 0,d=n,h=o;"orientation"==e?s=t:l=t;for(var f=0;f<u;f++){a.moveTo(n,o),c=r?[n-s,o-l]:[n+s,o+l],s&&Math.abs(c[0]-d)>i?c[0]=r?d-i:d+i:l&&Math.abs(c[1]-h)>i&&(c[1]=r?h-i:h+i);var g=this.getControlPt([n,o],c);a.quadraticCurveTo(g[0],g[1],c[0],c[1]),n=c[0],o=c[1]}},getControlPt:function(e,t,i){var n=[(e[0]+t[0])/2,(e[1]+t[1])/2],o=.4*r.default.distanceByArr(e,t),a=[t[1]-e[1],e[0]-t[0]];return a=r.default.normalize(a),[n[0]+a[0]*o,n[1]+a[1]*o]},DrawPolyline:function(e){var t=e.size();if(!(t<1))if(this.inPath){this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var i=1;i<t;++i)this.pt=e.get(i),this.ctx.lineTo(this.pt[0],this.pt[1])}else{for(var n=this.ctx.getLineDash(),o=0,a=0;a<n.length;++a)o+=n[a];this.ctx.beginPath(),this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var r=1;r<t;++r){var s=(this.pt[0]-e.get(r)[0])*(this.pt[0]-e.get(r)[0])+(this.pt[1]-e.get(r)[1])*(this.pt[1]-e.get(r)[1]);s<o*o?this.ctx.setLineDash([]):this.ctx.setLineDash(n),this.pt=e.get(r),this.ctx.lineTo(this.pt[0],this.pt[1]),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.pt[0],this.pt[1])}this.ctx.setLineDash(n)}},DrawText:function(e,t){this.ctx.fillText(e,t[0],t[1])},DrawTextW:function(e,t,i){0!=i?(this.ctx.save(),this.ctx.translate(t[0],t[1]),this.ctx.rotate(i),this.ctx.fillText(e,0,0),this.ctx.restore()):this.ctx.fillText(e,t[0],t[1])},DrawImageImpl:function(e,t,i,n,o,a,r){function s(t,i,n,o,a,r){0==r?e.drawImage(t,i,n,o,a):(e.save(),e.translate(i,n+a),e.rotate(r),e.drawImage(t,0,-a,o,a),e.restore())}var l=this,u=l.images[t];if(l.ignoreImage)return!1;void 0===u?(u=new Image,u.onload=function(){s(u,i,n,o,a,r),l.images[t]=u},u.src=t):s(u,i,n,o,a,r)},DrawImage:function(e,t,i,n,o,a){this.DrawImageImpl(this.ctx,this.resUrl+"image/"+e,t,i,n,o,a)}}),o=new n;return o.initialize(e,t),o}}]),e}();t.default=s},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t,i,o,a){n(this,e),this.min=t,this.max=i,this.markupType="Rect",this.strokeStyle=o.strokeStyle,this.lineWidth=o.lineWidth||4,this.fontSize=14,this.fontFamily="Arial",this.margin=a||0,this.fillStyle="white",this.id=""}return o(e,[{key:"draw",value:function(e,t){var i=e.toScreenPoint([this.min[0]-this.margin,this.min[1]-this.margin]),n=e.toScreenPoint([this.max[0]+this.margin,this.max[1]+this.margin]);if(e.dc.ctx)e.dc.ctx.strokeStyle=this.strokeStyle,e.dc.SetLineWidth(this.lineWidth),e.dc.SetLineDash(0),e.dc.DrawRec([i[0],n[1]],[n[0],i[1]]);else{e.dc.ctxOverlay.strokeStyle=this.strokeStyle,e.dc.ctxOverlay.lineWidth=this.lineWidth;var o=[i[0],n[1]],a=[n[0],i[1]];this.inPath?e.dc.ctxOverlay.rect(o[0],o[1],a[0]-o[0],a[1]-o[1]):(e.dc.ctxOverlay.beginPath(),e.dc.ctxOverlay.rect(o[0],o[1],a[0]-o[0],a[1]-o[1]),e.dc.ctxOverlay.stroke())}}}]),e}();t.default=a},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t,i,o,a){n(this,e),this.min=t,this.max=i,this.margin=a||0,this.markupType="CloudRect",this.strokeStyle=o.strokeStyle,this.lineWidth=o.lineWidth||4,this.fontSize=14,this.fontFamily="Arial",this.fillStyle="white",this.id=""}return o(e,[{key:"draw",value:function(e,t){var i=e.toScreenPoint([this.min[0]-this.margin,this.min[1]-this.margin]),n=e.toScreenPoint([this.max[0]+this.margin,this.max[1]+this.margin]);e.dc.ctx?(e.dc.ctx.strokeStyle=this.strokeStyle,e.dc.SetLineWidth(this.lineWidth),e.dc.SetLineDash(0),e.dc.DrawCloudRec([i[0],n[1]],[n[0],i[1]])):(e.dc.ctxOverlay.strokeStyle=this.strokeStyle,e.dc.ctxOverlay.lineWidth=this.lineWidth,e.dc.DrawCloudRec([i[0],n[1]],[n[0],i[1]],e.dc.ctxOverlay))}}]),e}();t.default=a},function(e,t,i){
function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t,i,o,a,r){n(this,e),this.min=i,this.max=o,this.markupType="Chartlet",this.margin=r||0,this.id=a,this.img=t}return o(e,[{key:"draw",value:function(e){var t=e.toScreenPoint([this.min[0]-this.margin,this.min[1]-this.margin]),i=e.toScreenPoint([this.max[0]+this.margin,this.max[1]+this.margin]),n=i[0]-t[0],o=i[1]-t[1];e.dc.ctx?e.dc.ctx.drawImage(this.img,t[0],t[1],n,o):e.dc.ctxOverlay.drawImage(this.img,t[0],t[1],n,o)}}]),e}();t.default=a},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e)}return o(e,[{key:"worldToNormalizedPoint",value:function(e,t){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=(e.x-t.min.x)/i*2-1,e.y=(e.y-t.min.y)/n*2-1,e.y=-e.y}},{key:"normalizedPointToWorld",value:function(e,t){e.y=-e.y;var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=.5*(e.x+1)*i+t.min.x,e.y=.5*(e.y+1)*n+t.min.y}},{key:"normalizedPointToMinimap",value:function(e,t){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=.5*(e.x+1)*i+t.min.x,e.y=.5*(e.y+1)*n+t.min.y}},{key:"minimapToNormalizedPoint",value:function(e,t){var i=t.max.x-t.min.x,n=t.max.y-t.min.y;e.x=(e.x-t.min.x)/i*2-1,e.y=(e.y-t.min.y)/n*2-1}},{key:"containsBox",value:function(e,t){return e.min.x<=t.min.x&&t.max.x<=e.max.x&&e.min.y<=t.min.y&&t.max.y<=e.max.y}},{key:"intersect",value:function(e,t){var i={x:0,y:0},n={x:0,y:0};return i.x=Math.max(e.min.x,t.min.x),i.y=Math.max(e.min.y,t.min.y),n.x=Math.min(e.max.x,t.max.x),n.y=Math.min(e.max.y,t.max.y),{min:i,max:n}}},{key:"boundsChecking",value:function(e,t){0===e.min.x&&e.min.x++,0===e.min.y&&e.min.y++,e.max.x===t.x&&e.max.x--,e.max.y===t.y&&e.max.y--}},{key:"intersectsBox",value:function(e,t){return!(e.max.x<t.min.x||e.min.x>t.max.x||e.max.y<t.min.y||e.min.y>t.max.y)}}]),e}();t.default=a},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=i(0),u=n(l),c=i(3),d=n(c),h=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.startPt=[0,0],e.endPt=null,e}return r(t,e),s(t,[{key:"onDrawing",value:function(e,t){null!=this.endPt&&(t.strokeStyle=d.default.Zoom.color,t.lineWidth=d.default.Zoom.lineWidth,t.strokeRect(this.startPt[0],this.startPt[1],this.endPt[0]-this.startPt[0],this.endPt[1]-this.startPt[1]))}},{key:"begin",value:function(e,t,i,n){n==u.default.LelftButton&&(this.startPt[0]=t,this.startPt[1]=i,this.starting=!0)}},{key:"onEditing",value:function(e,t,i,n){this.starting&&(this.endPt=[t,i],this.redraw(e))}},{key:"end",value:function(e,t,i,n){return!this.starting||t==this.startPt[0]&&i==this.startPt[1]||e.zoom(this.startPt[0],this.startPt[1],t,i),this.endPt=null,this.redraw(e),u.default.FINISHED}}]),t}(u.default);t.default=h},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=i(0),l=function(e){return e&&e.__esModule?e:{default:e}}(s),u=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),r(t,[{key:"begin",value:function(e,t,i,n){this.isPanMode(n)||(this.start=!0)}},{key:"onEditing",value:function(e,t,i,n){this.start&&e.panTo(t,i)}},{key:"end",value:function(e,t,i,n){1==this.start&&(e.update(!0),this.start=!1)}}]),t}(l.default);t.default=u},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0},l=i(4),u=function(e){return e&&e.__esModule?e:{default:e}}(l),c=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.snapIsEnabled=!1,e}return a(t,e),r(t,[{key:"init",value:function(e){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.picked=!1,this.preSelectCount=0}},{key:"begin",value:function(e,t,i,n){n==u.default.LelftButton?(this.picked=!0,this.start=!0):n==u.default.MiddleButton&&(this.moving=!0,this.start=!0),this.mode==u.default.TouchMode&&(this.pickMode=!0,e.isHighlightEventEnabled()&&this.notify("highlight",e.getHighlightIds(),t,i))}},{key:"onEditing",value:function(e,t,i,n,o){if(this.mode==u.default.TouchMode)e.panTo(t,i)&&(this.pickMode=!1);else if(this.pickMode=!0,e.hover){var a=e.preSelect(t,i,1===n);if(a==this.preSelectCount&&0==this.preSelectCount||(e.update(),this.preSelectCount=a),e.isHighlightEventEnabled()&&this.notify("highlight",e.getHighlightIds(),t,i,o),this.snapIsEnabled){this.tmpPointScreenPoint=[t,i],this.tmpPoint=e.snapToPoint(t,i),this.isMatchSnapMode=this.matchSnapMode(this.tmpPoint,e.getSnapMode());var r=e.dc.ctxOverlay;this.redraw(e,r)}}}},{key:"end",value:function(e,t,i,n){!0===this.pickMode&&this.picked&&(this.mode==u.default.TouchMode&&e.preSelect(t,i,!1),e.preSelect(t,i,!1),e.select(),e.update(),this.notify("selection",e.getSelectedIds()),this.pickMode=!1,this.picked=!1),this.start&&(this.start=!1)}},{key:"onMouseMove",value:function(e,t){var i=this.formatEventOffset(e,t);1!=t.ctrlKey&&this.isPanMode(t.buttons)?this.start&&e.panTo(i.x,i.y)&&(this.pickMode=!1):this.onEditing(e,i.x,i.y,t.buttons,t)}},{key:"isPanMode",value:function(e){return 0!=e}},{key:"enableSnap",value:function(e){this.snapIsEnabled=e}}]),t}(u.default);t.default=c},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0},u=i(1),c=n(u),d=i(3),h=n(d),f=i(4),g=n(f),v=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.worldPtForOtherDrawing={},e.pressShift=!1,e.parallel=!1,e.viewPortBBox={},e.viewPortBBoxMask={},e}return r(t,e),s(t,[{key:"reset",value:function(){this.step=0,this.points=[],this.needMaskVPId=0}},{key:"captureFail",value:function(e){return!1}},{key:"clearSnapPoint",value:function(){this.finalScreenPoint=null,this.tmpPoint=null}},{key:"needToMaskViewport",value:function(e,t){if(void 0==this.needMaskVPId||0==this.needMaskVPId)return!1;var i=void 0,n=void 0;if(this.viewPortBBoxMask[this.needMaskVPId])i=this.viewPortBBoxMask[this.needMaskVPId].min,n=this.viewPortBBoxMask[this.needMaskVPId].max;else{var o=e.getViewportBBox(this.needMaskVPId);i=o.min,n=o.max,this.viewPortBBoxMask[this.needMaskVPId]={min:i,max:n}}var a=e.toScreenPoint(i),r=e.toScreenPoint(n);return t.globalAlpha=.7,0==e.dc.printMode?t.fillStyle="#444444":t.fillStyle="#DDDDDD",t.fillRect(a[0],a[1],r[0]-a[0],r[1]-a[1]),!0}},{key:"onDrawing",value:function(e,t){if(this.showMask){var i=void 0,n=void 0;if(this.viewPortBBox[this.viewPort])i=this.viewPortBBox[this.viewPort].min,n=this.viewPortBBox[this.viewPort].max;else{var o=e.getViewportBBox(this.needMaskVPId);i=o.min,n=o.max,this.viewPortBBox[this.viewPort]={min:i,max:n}}var a=e.toScreenPoint(i),r=e.toScreenPoint(n);t.globalAlpha=.7,0==e.dc.printMode?t.fillStyle="#444444":t.fillStyle="#DDDDDD",t.fillRect(0,0,3e3,3e3),t.globalCompositeOperation="destination-out",t.globalAlpha=1,t.fillRect(a[0],a[1],r[0]-a[0],r[1]-a[1]),t.globalCompositeOperation="source-over"}else if(!this.needToMaskViewport(e,t)&&!this.drawSnapPoint(e,t)&&this.points.length>0){var s=e.toScreenPoint(this.points[0].GetPoint());this.strokeCircle(t,s),t.strokeStyle=h.default.Measure.color,t.lineWidth=h.default.Measure.lineWidth,t.fillStyle=t.strokeStyle,t.beginPath(),t.arc(s[0],s[1],4,0,2*Math.PI,!0),t.fill()}if(0!=this.points.length){if(1==this.points.length){var l=void 0,u=this.points[0].GetPoint();return l=this.points[0].GetID()&&!e.viewer.IsActiveLayoutElement(this.points[0].GetID())?e.toViewportScreenPoint(u):e.toScreenPoint(u),this.strokeCircle(t,l),t.fillStyle=h.default.Measure.color,t.beginPath(),t.arc(l[0],l[1],4,0,2*Math.PI,!0),void t.fill()}var c=this.points[0].GetPoint(),d=this.points[1].GetPoint(),f=void 0,g=void 0;if(f=this.points[0].GetID()&&!e.viewer.IsActiveLayoutElement(this.points[0].GetID())?e.toViewportScreenPoint(c):e.toScreenPoint(c),g=this.points[1].GetID()&&!e.viewer.IsActiveLayoutElement(this.points[1].GetID())?e.toViewportScreenPoint(d):e.toScreenPoint(d),this.pressShift){this.originPoint=g;var v=Math.abs(g[0]-f[0]),m=Math.abs(g[1]-f[1]),p=v<10,y=m<10;p||y?(p&&y?v>m?(g=[g[0],f[1]],this.parallel="Y"):(g=[f[0],g[1]],this.parallel="X"):p?(g=[f[0],g[1]],this.parallel="X"):(g=[g[0],f[1]],this.parallel="Y"),this.points[1]=e.snapToPoint(g[0],g[1])):this.parallel=!1}else this.parallel=!1;if(0==this.step){if(f[0]!=g[0]&&f[1]!=g[1]){var w=[f[0],g[1]];t.setLineDash(h.default.Measure.auxLineDash),t.lineWidth=h.default.Measure.auxLineWidth,t.strokeStyle=h.default.Measure.auxColorX,t.beginPath(),t.moveTo(f[0],f[1]),t.lineTo(w[0],w[1]),t.stroke(),t.strokeStyle=h.default.Measure.auxColorY,t.beginPath(),t.moveTo(g[0],g[1]),t.lineTo(w[0],w[1]),t.stroke(),t.setLineDash([])}this.strokeCircle(t,g),t.strokeStyle=h.default.Measure.color,t.fillStyle=t.strokeStyle,t.lineWidth=h.default.Measure.lineWidth,t.beginPath(),t.arc(g[0],g[1],4,0,2*Math.PI,!0),t.fill()}t.strokeStyle=h.default.Measure.color,t.lineWidth=h.default.Measure.lineWidth,t.beginPath(),t.moveTo(f[0],f[1]),t.lineTo(g[0],g[1]),t.stroke(),this.strokeCircle(t,f),t.fillStyle=t.strokeStyle,t.beginPath(),t.arc(f[0],f[1],4,0,2*Math.PI,!0),t.fill()}}},{key:"begin",value:function(e,t,i,n){if(!this.isPanMode(n)){var o=e.toModelWorld([t,i]);if(this.showMask||this.needMaskVPId>0)return;if(0==this.step&&(this.points=[],this.viewPort=o[2],-1==o[2]?this.firstPointOutsideVP=!0:this.firstPointOutsideVP=!1),this.parallel||(this.finalScreenPoint?(this.points[this.step]=e.snapToPoint(this.finalScreenPoint[0],this.finalScreenPoint[1]),this.worldPtForOtherDrawing[this.step]=e.toModelWorld([this.finalScreenPoint[0],this.finalScreenPoint[1]])):(this.points[this.step]=e.snapToPoint(t,i),this.worldPtForOtherDrawing[this.step]=null)),o[2]!=this.viewPort)return this.points.splice(1,1);if(this.step=this.step+1,this.step>=2){var a=this.points[0].GetPoint(),r=this.points[1].GetPoint(),s=[a,r];if(this.worldPtForOtherDrawing[0])s[0]=this.worldPtForOtherDrawing[0];else if(!this.points[0].GetID()){var l=e.toScreenPoint(a),u=e.toModelWorld(l);u[2]>0&&(s[0]=u)}if(this.worldPtForOtherDrawing[1])s[1]=this.worldPtForOtherDrawing[1];else if(!this.points[1].GetID()){var d=e.toScreenPoint(r),h=e.toModelWorld(d);h[2]>0&&(s[1]=h)}"X"==this.parallel?s[1][0]=s[0][0]:"Y"==this.parallel&&(s[1][1]=s[0][1]);var f=c.default.distanceByArr(s[0],s[1]);this.notify("change",{distance:f,start:s[0],end:s[1],isOnLayout:o[2]>0}),this.points=[],this.step=0,this.pressShift=!1,this.parallel=!1,this.viewPort=null}else this.notify("change",null);this.redraw(e)}}},{key:"onEditing",value:function(e,t,i,n){if(this.tmpPointScreenPoint=[t,i],this.tmpPoint=e.snapToPoint(t,i),this.step>0){var o=e.toModelWorld([t,i]);this.viewPort&&o[2]!=this.viewPort&&-1!=this.viewPort?this.showMask=!0:this.showMask=!1,this.firstPointOutsideVP&&o[2]>0?this.needMaskVPId=o[2]:this.needMaskVPId=0,this.points[this.step]=this.tmpPoint}this.redraw(e)}},{key:"keyDown",value:function(e,t){this.pressShift||16!=t.keyCode||0==this.step?27==t.keyCode&&this.step>0&&(this.points=[],this.step=0,t.stopImmediatePropagation(),this.redraw(e)):(this.pressShift=!0,this.redraw(e),this.onDrawing(e,this.ctx))}},{key:"keyUp",value:function(e,t){this.pressShift=!1,16==t.keyCode&&0!=this.step&&this.originPoint&&this.onEditing(e,this.originPoint[0],this.originPoint[1])}},{key:"end",value:function(e,t,i,n){}},{key:"onExit",value:function(e){this.reset(),this.redraw(e),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onExit",this).call(this,e)}},{key:"strokeCircle",value:function(e,t){e.save(),e.globalCompositeOperation="source-over",e.strokeStyle=h.default.Measure.outlineColor,e.lineWidth=h.default.Measure.outlineWidth,e.beginPath(),e.arc(t[0],t[1],5,0,2*Math.PI,!0),e.stroke(),e.closePath(),e.restore()}}]),t}(g.default);t.default=v},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),l=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,i,n)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(n):void 0},u=i(0),c=n(u),d=i(1),h=(n(d),i(3)),f=n(h),g=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.worldPtForOtherDrawing={},e.tmpPoint=null,e.viewPort=null,e.originPoint=null,e.pressShift=!1,e.parallel=!1,e.closePath=!1,e.points=[],e.viewPort=null,e.viewPortBBox={},e.viewPortBBoxMask={},e.isEnableSnap=!0,e}return r(t,e),s(t,[{key:"reset",value:function(){this.points=[],this.needMaskVPId=0}},{key:"captureFail",value:function(e){return!1}},{key:"drawTmpPoint",value:function(e,t,i,n){this.isEnableSnap&&(e=e||this.drawing2D,t=t||this.ctx,t.strokeStyle=t.fillStyle=f.default.Measure.snapColor,t.beginPath(),"EndPoint"==n?(t.lineWidth=2,t.rect(i[0]-4,i[1]-4,8,8),t.stroke()):"PointOnLine"==n?(t.arc(i[0],i[1],4.5,0,2*Math.PI,!0),t.fill()):"MiddlePoint"==n?(t.lineWidth=2,t.moveTo(i[0],i[1]-4),t.lineTo(i[0]-5,i[1]+4),t.lineTo(i[0]+5,i[1]+4),t.closePath(),t.stroke()):"FootPoint"==n?(this.isFootPoint=!0,t.lineWidth=2,t.moveTo(i[0]-6,i[1]-6),t.lineTo(i[0]-6,i[1]+6),t.lineTo(i[0]+6,i[1]+6),t.moveTo(i[0]-6,i[1]-1),t.lineTo(i[0]+1,i[1]-1),t.lineTo(i[0]+1,i[1]+6),t.stroke()):"Intersection"==n&&(t.lineWidth=2,t.moveTo(i[0]-4,i[1]-4),t.lineTo(i[0]+4,i[1]+4),t.moveTo(i[0]-4,i[1]+4),t.lineTo(i[0]+4,i[1]-4),t.stroke()),this.finalScreenPoint=i)}},{key:"drawSnapPoint",value:function(e,t){if(!this.ctx&&(this.ctx=t),this.tmpPoint&&(0!=this.tmpPoint.GetID()||"Intersection"==this.tmpPoint.GetSnapTypeName())){this.isFootPoint=!1;var i=void 0,n=this.points.length,o=this.tmpPoint;if(n&&!this.closePath){var a=e.toScreenPoint(this.points[n-1].GetPoint()),r=this.tmpPointScreenPoint;o=e.snapToPoint2(r[0],r[1],a[0],a[1]),i=o.GetSnapTypeName()}else i=this.tmpPoint.GetSnapTypeName();var s=void 0;return s=e.viewer.IsActiveLayoutElement(o.GetID())?e.toScreenPoint(o.GetPoint()):e.toViewportScreenPoint(o.GetPoint()),this.drawTmpPoint(e,t,s,i),!0}return this.finalScreenPoint=null,this.captureFail(this.tmpPointScreenPoint,e,t)}},{key:"needToMaskViewport",value:function(e,t){if(void 0==this.needMaskVPId||0==this.needMaskVPId)return!1;var i=void 0,n=void 0;if(this.viewPortBBoxMask[this.needMaskVPId])i=this.viewPortBBoxMask[this.needMaskVPId].min,n=this.viewPortBBoxMask[this.needMaskVPId].max;else{var o=e.viewer.GetViewportBBox(this.needMaskVPId);i=o.GetMinPt(),n=o.GetMaxPt(),this.viewPortBBoxMask[this.needMaskVPId]={min:i,max:n}}var a=e.toScreenPoint(i),r=e.toScreenPoint(n);return t.globalAlpha=.7,0==e.dc.printMode?t.fillStyle="#444444":t.fillStyle="#DDDDDD",t.fillRect(a[0],a[1],r[0]-a[0],r[1]-a[1]),!0}},{key:"onDrawing",value:function(e,t){if(this.showMask){var i=void 0,n=void 0;if(this.viewPortBBox[this.viewPort])i=this.viewPortBBox[this.viewPort].min,n=this.viewPortBBox[this.viewPort].max;else{var o=e.viewer.GetViewportBBox(this.viewPort);i=o.GetMinPt(),n=o.GetMaxPt(),this.viewPortBBox[this.viewPort]={min:i,max:n}}var a=e.toScreenPoint(i),r=e.toScreenPoint(n);t.globalAlpha=.7,0==e.dc.printMode?t.fillStyle="#444444":t.fillStyle="#DDDDDD",t.fillRect(0,0,3e3,3e3),t.globalCompositeOperation="destination-out",t.globalAlpha=1,t.fillRect(a[0],a[1],r[0]-a[0],r[1]-a[1]),t.globalCompositeOperation="source-over"}else this.needToMaskViewport(e,t)||this.drawSnapPoint(e,t);var s=this.points,l=s.length;if(l>0){if(this.pressShift&&this.tmpPoint){var u=this.points[l-1].GetPoint(),c=this.tmpPoint.GetPoint(),d=void 0,h=void 0;d=this.points[l-1].GetID()&&!e.viewer.IsActiveLayoutElement(this.points[l-1].GetID())?e.toViewportScreenPoint(u):e.toScreenPoint(u),h=this.tmpPoint.GetID()&&!e.viewer.IsActiveLayoutElement(this.tmpPoint.GetID())?e.toViewportScreenPoint(c):e.toScreenPoint(c),this.originPoint=h;var g=Math.abs(h[0]-d[0]),v=Math.abs(h[1]-d[1]),m=g<10,p=v<10;m||p?(this.parallel=!0,h=m&&p?g>v?[h[0],d[1]]:[d[0],h[1]]:m?[d[0],h[1]]:[h[0],d[1]],this.tmpPoint=e.snapToPoint(h[0],h[1])):this.parallel=!1}else this.parallel=!1;t.strokeStyle=f.default.Measure.color,t.lineWidth=f.default.Measure.lineWidth,t.fillStyle=t.strokeStyle;var y=s;!this.closePath&&this.tmpPoint&&(y=s.concat(this.tmpPoint));for(var w=0;w<y.length-1;w++){var b=void 0,C=void 0;b=y[w].GetID()&&!e.viewer.IsActiveLayoutElement(y[w].GetID())?e.toViewportScreenPoint(y[w].GetPoint()):e.toScreenPoint(y[w].GetPoint()),C=y[w+1].GetID()&&!e.viewer.IsActiveLayoutElement(y[w+1].GetID())?e.toViewportScreenPoint(y[w+1].GetPoint()):e.toScreenPoint(y[w+1].GetPoint()),this.closePath?(0==w&&(t.beginPath(),t.moveTo(b[0],b[1])),t.lineTo(C[0],C[1]),w==y.length-2&&(t.closePath(),t.globalAlpha=.2,t.fill(),t.globalAlpha=1,t.stroke())):(t.beginPath(),t.arc(b[0],b[1],4,0,2*Math.PI,!0),t.fill(),t.moveTo(b[0],b[1]),t.lineTo(C[0],C[1]),t.stroke(),this.strokeCircle(t,b))}}}},{key:"begin",value:function(e,t,i,n){if(!this.isPanMode(n)){var o=e.toModelWorld([t,i]);if(this.showMask||this.needMaskVPId>0)return;if(0==this.points.length&&(this.viewPort=o[2],-1==o[2]?this.firstPointOutsideVP=!0:this.firstPointOutsideVP=!1),this.closePath&&(this.points=[],this.viewPort=o[2],this.closePath=!1),this.finalScreenPoint){var a=e.snapToPoint(this.finalScreenPoint[0],this.finalScreenPoint[1]);this.worldPtForOtherDrawing[this.points.length]=e.toModelWorld([this.finalScreenPoint[0],this.finalScreenPoint[1]])}else{var a=e.snapToPoint(t,i);this.worldPtForOtherDrawing[this.points.length]=null}if(this.parallel?this.points[this.points.length]=this.tmpPoint:this.points[this.points.length]=a,o[2]!=this.viewPort)return this.points.splice(1,1);var r=this.points,s=r.length,l=r[0].GetPoint(),u=a.GetPoint();if(s>2&&this.isClosePath(e,l,u)){this.closePath=!0,this.pressShift=!1,this.parallel=!1,this.viewPort=null,r.pop();var c=this.getArea(r.slice()),d=[],h=!0,f=!1,g=void 0;try{for(var v,m=r[Symbol.iterator]();!(h=(v=m.next()).done);h=!0){var p=v.value,y=p.GetID()>0&&!e.viewer.IsActiveLayoutElement(p.GetID());d.push({point:p.GetPoint(),isActiveLayoutElement:!y})}}catch(e){f=!0,g=e}finally{try{!h&&m.return&&m.return()}finally{if(f)throw g}}this.notify("change",{area:c,points:d}),this.points=[]}else this.notify("change",null);this.redraw(e)}}},{key:"isClosePath",value:function(e,t,i){var n=e.toScreenPoint(t),o=e.toScreenPoint(i);return Math.abs(n[0]-o[0])<6&&Math.abs(n[1]-o[1])<6}},{key:"getArea",value:function(e){for(var t=e.length,i=0;i<t;i++)e[i]=this.worldPtForOtherDrawing[i]||e[i].GetPoint();if(t<3)return 0;for(var n=e[0][1]*(e[t-1][0]-e[1][0]),i=1;i<t;++i)n+=e[i][1]*(e[i-1][0]-e[(i+1)%t][0]);return Math.abs(n/2)}},{key:"onEditing",value:function(e,t,i,n){if(this.mode!=c.default.TouchMode){this.tmpPointScreenPoint=[t,i];var o=e.toModelWorld([t,i]);this.viewPort&&o[2]!=this.viewPort&&-1!=this.viewPort?this.showMask=!0:this.showMask=!1,this.firstPointOutsideVP&&o[2]>0?this.needMaskVPId=o[2]:this.needMaskVPId=0,this.tmpPoint=e.snapToPoint(t,i),this.redraw(e)}}},{key:"keyDown",value:function(e,t){this.pressShift||16!=t.keyCode?27==t.keyCode&&this.points.length&&!this.closePath&&(this.points.pop(),t.stopImmediatePropagation(),this.redraw(e)):(this.pressShift=!0,this.redraw(e),this.onDrawing(e,this.ctx))}},{key:"keyUp",value:function(e,t){this.pressShift=!1,16==t.keyCode&&this.originPoint&&this.onEditing(e,this.originPoint[0],this.originPoint[1])}},{key:"end",value:function(e,t,i,n){}},{key:"onExit",value:function(e){this.reset(),this.redraw(e),l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onExit",this).call(this,e)}},{key:"strokeCircle",value:function(e,t){e.save(),e.globalCompositeOperation="source-over",e.strokeStyle=f.default.Measure.outlineColor,e.lineWidth=f.default.Measure.outlineWidth,e.beginPath(),e.arc(t[0],t[1],5,0,2*Math.PI,!0),e.stroke(),e.closePath(),e.restore()}},{key:"setIsEnableSnap",value:function(e){this.isEnableSnap=e}}]),t}(c.default);t.default=g},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(t){n(this,e),this.drawing2D=t,this.touchEndCounts=0,this.outerCircleRadius=60,this.outerCircleFillStyle="rgba(255, 255, 255, 0.3)",this.outerCircleBorderWidth=2,this.outerCircleBorderColor="#999999",this.innerCircleRadius=50,this.innerCircleFillStyle="rgba(204, 204, 204, 0.5)",this.innerCircleBorderWidth=2,this.triangleWidth=20,this.triangleFillStyle="rgba(204, 204, 204, 0.5)",this.triangleBorderWidth=2,this.triangleBorderColor="#999999"}return o(e,[{key:"setEditor",value:function(e){this.editor=e}},{key:"updateAuxMeasure",value:function(e){var t={};t.outerCircle={},t.outerCircle.center=e,t.outerCircle.radius=this.outerCircleRadius,t.innerCircle={},t.innerCircle.center=e,t.innerCircle.radius=this.innerCircleRadius,t.triangle=[];var i={x:e.x-this.outerCircleRadius,y:e.y-this.outerCircleRadius};return t.triangle.push({x:i.x,y:i.y}),t.triangle.push({x:i.x+this.triangleWidth,y:i.y}),t.triangle.push({x:i.x,y:i.y+this.triangleWidth}),t}},{key:"draw",value:function(e){var t=this.drawing2D.dc.ctxOverlay,i=e.outerCircle;t.strokeStyle=this.outerCircleBorderColor,t.lineWidth=this.outerCircleBorderWidth,t.fillStyle=this.outerCircleFillStyle,t.beginPath(),t.arc(i.center.x,i.center.y,i.radius,0,2*Math.PI,!0),t.fill(),t.stroke();var n=e.innerCircle;t.fillStyle=this.innerCircleFillStyle,t.beginPath(),t.arc(n.center.x,n.center.y,n.radius,0,2*Math.PI,!0),t.fill();var o=e.triangle;t.lineWidth=this.triangleBorderWidth,t.fillStyle=this.triangleFillStyle,t.beginPath(),t.moveTo(o[0].x,o[0].y),t.lineTo(o[1].x,o[1].y),t.lineTo(o[2].x,o[2].y),t.closePath(),t.fill(),t.stroke()}},{key:"getRealPoint",value:function(e){var t={x:this.outerCircleRadius,y:this.outerCircleRadius};return{x:e.x-t.x,y:e.y-t.y}}},{key:"onTouchStart",value:function(e,t){var i=this.updateAuxMeasure({x:e.point.x,y:e.point.y});this.draw(i),this.saveAction(e)}},{key:"onTouchMove",value:function(e){var t=this.updateAuxMeasure({x:e.point.x,y:e.point.y}),i=this.editor,n=this.getRealPoint(e.point);i.onEditing(this.drawing2D,n.x,n.y,1),this.draw(t),this.saveAction(e)}},{key:"onTouchEnd",value:function(e,t){var i=this.editor,n=this.getRealPoint(e.point);++this.touchEndCounts%2==1&&this.drawing2D.setStartPoint(n.x,n.y),i.clearSnapPoint(),i.begin(this.drawing2D,n.x,n.y,1),this.touchEndCounts%2==0&&i.end(this.drawing2D,n.x,n.y,1),!t&&i.redraw(this.drawing2D),this.prevActionEvent=null}},{key:"saveAction",value:function(e){this.prevActionEvent=e}},{key:"redraw",value:function(){if(this.prevActionEvent){var e=this.prevActionEvent,t=this.updateAuxMeasure({x:e.point.x,y:e.point.y});this.draw(t)}}}]),e}();t.default=a},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(24),s=n(r),l=i(7),u=n(l),c=i(9),d=n(c),h=function(){function e(){o(this,e)}return a(e,null,[{key:"initialize",value:function(t){void 0!==t&&(e.ready=t);var i=document.getElementsByTagName("HEAD").item(0),n=document.createElement("script");n.type="text/javascript",i.appendChild(n)}},{key:"ready",value:function(){console.log("Drawing2D engine is ready!")}},{key:"onLoadProgress",value:function(e){console.log(e)}},{key:"loadModel",value:function(e,t,i){console.log("not implemented!")}},{key:"addModel",value:function(e,t,i){console.log("not implemented!")}},{key:"createDrawing",value:function(t){var i=document.getElementById(t),i=document.getElementById(t),n=document.createElement("canvas");n.id=t+"-main-drawing",n.width=i.clientWidth,n.height=i.clientHeight,n.style.position="absolute",i.appendChild(n);var o=BimButterfly({canvas:n}),a={preserveDrawingBuffer:!0};n.getContext("webgl",a);for(var r=new o.DrawingView("No.1");e.drawingIDs.indexOf(r.ptr)>-1;)r=new o.DrawingView("No.1");e.drawingIDs.push(r.ptr),r.Create(i.clientWidth,i.clientHeight);var l=document.createElement("canvas");l.id=t+"-aux-drawing",l.width=i.clientWidth,l.height=i.clientHeight,l.style.position="absolute",i.appendChild(l);var u=document.createElement("canvas");return u.id=t+"-ovl-drawing",u.width=i.clientWidth,u.height=i.clientHeight,u.style.position="absolute",i.appendChild(u),new s.default(n,l,u,t,r,o)}},{key:"createMouseEditorManager",value:function(e){return new d.default(e)}},{key:"createTouchEditorManager",value:function(e){var t=new u.default(e);return e.auxMobileMeasureTool=t.auxMobileMeasureTool,t}}]),e}();h.sdkUrl="js/",h.drawingIDs=[],t.default=h},function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=i(25),s=n(r),l=i(5),u=n(l),c=i(6),d=n(c),h=function(){function e(t,i,n,a,r,l){o(this,e),console.log(r.GetId());var c=document.getElementById(a);this.width=c.clientWidth,this.height=c.clientHeight,this.viewer=r,this.translateX=void 0!=r.translateX?r.translateX:0,this.translateY=void 0!=r.translateY?r.translateY:0,this.divId=a,this.dom=c,this.dc=s.default.create(t,i,n),this.ratio=1.1,this.drawHandle=null,this.scale=1,this.snapDistance=5,this.hover=!0,this.bindRendering=this.rendering.bind(this),this.butterfly=l,this.customManager=new u.default,this.onViewChanges=function(){};var d=this;this.dc.overlayDrawers.custom=function(e){d.customManager.draw(d,e)},this.sendHighlightMsg=!0,this.url=void 0!=r.url?r.url+"/":null,this.model={Url:void 0!=r.url?r.url+"/":null}}return a(e,[{key:"getUrl",value:function(){return this.url}},{key:"setUrl",value:function(e){this.url=e}},{key:"setZoomRatio",value:function(e){this.ratio=e}},{key:"getZoomRatio",value:function(){return this.ratio}},{key:"getViewScale",value:function(e){return this.scale
}},{key:"setViewScale",value:function(e){this.scale=e}},{key:"setSnapDistance",value:function(e){this.snapDistance=e}},{key:"snapshot",value:function(e){var t=this.dc.canvasMain,i=(this.dc.canvasOverlay,this.getDivId()),n=document.getElementById(i),o=document.createElement("canvas");o.width=n.clientWidth,o.height=n.clientHeight;var a=o.getContext("2d");return a.beginPath(),a.fillStyle=e||t.style.background,a.fillRect(0,0,o.width,o.height),a.drawImage(t,0,0),o.toDataURL()}},{key:"snapshotPure",value:function(){var e=this.dc.canvasMain,t=(this.dc.canvasOverlay,this.getDivId()),i=document.getElementById(t),n=document.createElement("canvas");n.width=i.clientWidth,n.height=i.clientHeight;var o=n.getContext("2d");return o.beginPath(),o.drawImage(e,0,0),n}},{key:"setBackgroundColor",value:function(e){this.dc.setBackgroundColor(e)}},{key:"showFilledFace",value:function(e){this.viewer.FilledFace=e}},{key:"isShowFilledFace",value:function(){return this.viewer.FilledFace}},{key:"setModel",value:function(e){if(console.error("abondon! DON't use this function"),this.viewer.SetModel(e),this.dc.setResourceUrl(e.Url),this.viewer.UpdateVisibleSettings(),void 0!=e.indexJson.sealImages){var t;for(t=0;t<e.indexJson.sealImages.length;++t){var i=e.indexJson.sealImages[t],n=i.path,o=n.split("\\"),a=o[o.length-1];this.viewer.AddSealImage(a,parseFloat(i.x),parseFloat(i.y),parseFloat(i.width),parseFloat(i.height))}}}},{key:"rendering",value:function(){this.viewer.Draw(),this.rendering(),this.updateOverlays()}},{key:"getDivId",value:function(){return this.divId}},{key:"getModel",value:function(){return console.log("carefully to use getModel()"),this.model}},{key:"getViewAngle",value:function(){return this.viewer.GetViewAngle()}},{key:"setViewAngle",value:function(e){this.viewer.SetViewAngle(e)}},{key:"getLayers",value:function(){for(var e=[],t=this.viewer.GetLayerIds(),i=0,n=t.size();i<n;++i){var o=t.at(i),a=this.viewer.GetLayer(o);null!=a?e.push({id:a.id,name:a.name,color:a.color,visible:a.visible}):console.log("Layer not found!"+o)}return e}},{key:"changeLayers",value:function(e){for(var t=0;t<e.length;++t){var i=e[t];i.visible?this.viewer.ShowByLayerId(i.id):this.viewer.HideByLayerId(i.id)}}},{key:"getLayouts",value:function(){for(var e=[],t=this.viewer.GetLayoutIds(),i=this.viewer.GetLayoutNames(),n=0,o=t.size();n<o;++n){var a=t.at(n);e.push({id:a,name:i.at(n)})}return e}},{key:"activeLayoutById",value:function(e){this.viewer.ActiveLayout(e),this.update()}},{key:"getActiveLayoutId",value:function(){return this.viewer.GetActiveLayoutId()}},{key:"isModelView",value:function(){return 0==this.getActiveLayoutId()}},{key:"updateOverlays",value:function(){this.dc.drawingOverlay(this.width,this.height,this)}},{key:"update",value:function(e){function t(){i.viewer.Draw(),i.drawHandle=requestAnimationFrame(t),i.updateOverlays()}1==e&&this.onViewChanges();var i=this;null!==i.drawHandle&&cancelAnimationFrame(i.drawHandle),this.minimap&&this.minimap.update(),i.drawHandle=requestAnimationFrame(t)}},{key:"onResize",value:function(){this.resize(this.dom.clientWidth,this.dom.clientHeight)}},{key:"clearAll",value:function(){this.viewer.ReleaseModel(),this.dc.clearAll(this.width,this.height)}},{key:"resize",value:function(e,t){this.width=e||this.dom.clientWidth,this.height=t||this.dom.clientHeight,this.dc.resize(e,t),this.viewer.Resize(e,t),this.update(),this.onViewChanges()}},{key:"zoomToExtent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.viewer.ZoomToExtent(e),this.onViewChanges()}},{key:"zoomToObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;("string"==typeof e||e instanceof String)&&(e=parseInt(e)),this.viewer.ZoomToElement(e,t),this.onViewChanges()}},{key:"zoomToObjectWithBlock",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;("string"==typeof e||e instanceof String)&&(e=parseInt(e)),("string"==typeof t||t instanceof String)&&(t=parseInt(t)),this.viewer.ZoomToElementWithBlock(e,t,i),this.onViewChanges()}},{key:"zoomToWorldBox",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;this.viewer.ZoomToWorldBoxMinMax(e[0],e[1],e[2],t[0],t[1],t[2],i)}},{key:"setStartPoint",value:function(e,t){this.startX=e,this.startY=t}},{key:"zoom",value:function(e,t,i,n){this.viewer.ZoomToRect(e,t,i,n),this.update(!0),this.onViewChanges()}},{key:"panTo",value:function(e,t){return this.startX&&this.startY?(this.offsetX=e-this.startX,this.offsetY=t-this.startY,(0!=this.offsetX||0!=this.offsetY)&&(this.viewer.Pan(this.offsetX,this.offsetY),this.update(),this.startX=e,this.startY=t,this.onViewChanges(),!0)):(this.startX=e,this.startY=t,!1)}},{key:"zoomPan",value:function(e,t,i){this.offsetX=(t||this.width/2)-this.width/2,this.offsetY=(i||this.height/2)-this.height/2,this.viewer.ZoomPan(this.offsetX,this.offsetY,e),this.update(),this.onViewChanges()}},{key:"preSelect",value:function(e,t,i){return i?this.viewer.PreSelect(this.startX,this.startY,e,t):this.viewer.PreSelect(e,t,e,t)}},{key:"select",value:function(){this.viewer.Select()}},{key:"getSelectedIds",value:function(){for(var e=[],t=this.viewer.GetSelection(),i=0,n=t.size();i<n;++i)e.push(t.at(i));return e}},{key:"getHighlightIds",value:function(){for(var e=[],t=this.viewer.GetHighlightIds(),i=0,n=t.size();i<n;++i)e.push(t.at(i));return e}},{key:"clearSelection",value:function(){this.viewer.ClearSelection()}},{key:"clearHighlight",value:function(){this.viewer.ClearHighlight()}},{key:"selectByIds",value:function(e){var t=this.viewer.GetSelection();t.clear();for(var i=0,n=e.length;i<n;++i)t.push_back(parseInt(e[i]));this.viewer.SelectIds(t)}},{key:"highlightById",value:function(e){this.viewer.HighlightId(parseInt(e))}},{key:"getObjectBoundingBox",value:function(e){var t=this.viewer.GetObjectBoundingBox(e),i=t.GetMinPt(),n=t.GetMaxPt();return[[i.x+this.translateX,i.y+this.translateY,i.z],[n.x+this.translateX,n.y+this.translateY,n.z]]}},{key:"getViewportBBox",value:function(e){var t=this.viewer.GetViewportBBox(e),i=t.GetMinPt(),n=t.GetMaxPt();return{min:[i.x,i.y],max:[n.x,n.y]}}},{key:"enableHover",value:function(e){this.hover=e}},{key:"normalizePt",value:function(e){return e.constructor==Array?void 0==e[2]?{x:e[0],y:e[1]}:{x:e[0],y:e[1],z:e[2]}:void 0!=e.x&&void 0!=e.y?e:null}},{key:"toWorldPoint",value:function(e){var t=this.normalizePt(e),i=this.viewer.ToWorldPointXY(t.x,t.y);return[i.x+this.translateX,i.y+this.translateY]}},{key:"toScreenPoint",value:function(e){var t=this.normalizePt(e);t.x=t.x-this.translateX,t.y=t.y-this.translateY;var i=this.viewer.ToScreenPointXY(t.x,t.y);return[i.x,i.y]}},{key:"toViewportScreenPoint",value:function(e){var t=this.normalizePt(e);t.x=t.x-this.translateX,t.y=t.y-this.translateY;var i=this.viewer.ToViewportScreenPointXY(t.x,t.y);return[i.x,i.y,i.z]}},{key:"toModelWorld",value:function(e){var t=this.normalizePt(e),i=this.viewer.ToModelWorldPointXY(t.x,t.y);return[i.x+this.translateX,i.y+this.translateY,i.z]}},{key:"snapToPoint",value:function(e,t,i){void 0==i&&(i=this.snapDistance);var n=this.viewer.SnapToPoint(e,t,i),o=[n.snapPoint.x+this.translateX,n.snapPoint.y+this.translateY,void 0!=n.snapPoint.z?n.snapPoint.z:-1],a=["None","Vertex","PointOnLine","Inner","PointInText","FootPoint","MiddlePoint","EndPoint","Intersection"],r=n.snapID,s=n.snapType;return{GetPoint:function(){return o},GetID:function(){return r},GetSnapType:function(){return s},GetSnapTypeName:function(){return n.snapType<a.length?a[s]:a[0]}}}},{key:"snapToPoint2",value:function(e,t,i,n,o){void 0==o&&(o=this.snapDistance);var a=this.viewer.SnapToPoint2(e,t,i,n,o),r={x:a.snapPoint.x+this.translateX,y:a.snapPoint.y+this.translateY,z:void 0!=a.snapPoint.z?a.snapPoint.z:-1},s=["None","Vertex","PointOnLine","Inner","PointInText","FootPoint","MiddlePoint","EndPoint","Intersection"],l=a.snapID,u=a.snapType;return{GetPoint:function(){return r},GetID:function(){return l},GetSnapType:function(){return u},GetSnapTypeName:function(){return a.snapType<s.length?s[a.snapType]:s[0]}}}},{key:"getZoomFactor",value:function(){var e=this.viewer.GetWorldSize();return this.viewer.GetWorldScale()/Math.min(1/e.x,1/e.y)}},{key:"getState",value:function(){var e={ver:1,WorldScale:this.viewer.GetWorldScale(),ViewAngle:this.viewer.GetViewAngle(),ViewCenter:{x:this.viewer.GetViewCenter().x,y:this.viewer.GetViewCenter().y},ZoomFactor:this.getZoomFactor()};return JSON.stringify(e)}},{key:"setState",value:function(e){var t=JSON.parse(e);if(1!==t.ver)return!1;this.viewer.SetWorldScale(t.WorldScale),this.viewer.SetViewAngle(t.ViewAngle);var i;return i=t.ViewCenter instanceof Array?{x:t.ViewCenter[0],y:t.ViewCenter[1]}:{x:t.ViewCenter.x,y:t.ViewCenter.y},this.viewer.SetViewCenter(i.x,i.y),this.viewer.UpdateViewMatrix(),!0}},{key:"showElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.ShowElementBox(e)}},{key:"showElementBoxByBBox",value:function(e,t){e&&this.customManager.add([e[0][0],e[0][1]],[e[1][0],e[1][1]],t)}},{key:"setElementBoxColor",value:function(e,t,i,n){this.customManager.setColor(e,t,i,n)}},{key:"getElementBoxColor",value:function(){return this.customManager.getColor()}},{key:"getElementBoxStyle",value:function(){return this.customManager.getStyle()}},{key:"setElementBoxStyle",value:function(e){this.customManager.setStyle(e)}},{key:"hideElementBox",value:function(e){void 0!=e&&e>0&&this.viewer.HideElementBox(e)}},{key:"clearElementBox",value:function(){this.viewer.ClearElementBox(),this.customManager.clear()}},{key:"getVisibleBoxIds",value:function(){for(var e=[],t=this.viewer.GetVisibleBoxIds(),i=0;i<t.size();++i)e.push(t.get(i));return e}},{key:"enableHighlightEvent",value:function(e){this.sendHighlightMsg=e}},{key:"isHighlightEventEnabled",value:function(){return this.sendHighlightMsg}},{key:"addClickCallback",value:function(e){this.clickCallback=e}},{key:"getClickCallback",value:function(){return this.clickCallback}},{key:"getModelBBox",value:function(){var e=this.viewer.GetModelBBox(),t=e.GetMinPt(),i=e.GetMaxPt();return new function(e,t,i,n){this.GetMinPt=function(){return[e.x+i,e.y+n,e.z]},this.GetMaxPt=function(){return[t.x+i,t.y+n,t.z]}}(t,i,this.translateX,this.translateY)}},{key:"enableSelectInBlock",value:function(){this.viewer.EnableSelectInBlock()}},{key:"disableSelectInBlock",value:function(){this.viewer.DisableSelectInBlock()}},{key:"canSelectInBlock",value:function(){return this.viewer.CanSelectInBlock()}},{key:"getSelectionWithBlock",value:function(){return this.viewer.GetSelectionWithBlock()}},{key:"GetHighlightIdsWithBlock",value:function(){return this.viewer.GetHighlightIdsWithBlock()}},{key:"highlightIdWithBlock",value:function(e,t){this.viewer.HighlightIdWithBlock(e,t)}},{key:"selectIdWithBlock",value:function(e,t){this.viewer.SelectIdWithBlock(e,t)}},{key:"createMinimap",value:function(e,t,i,n){if(0==this.isModelView())return void console.warn("Only model view support minimap.");void 0==this.minimap&&(this.minimap=new d.default(e,t,i,n),this.minimap.setDrawingImpl(this),this.minimap.initialize())}},{key:"enableMinimap",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.enableMiniMap(e)}},{key:"setMinimapBoundingBox",value:function(e){if(0==this.isModelView())return void console.warn("Only model view support minimap.");this.minimap&&this.minimap.setDrawingContentsBbox(e)}},{key:"setMinimapOffset",value:function(e){this.minimap.setOffset(e)}},{key:"hasMinimap",value:function(){return 0==this.isModelView()?void console.warn("Only model view support minimap."):void 0!=this.minimap}},{key:"setGlobalColor",value:function(e){this.dc.printMode==this.dc.Custom&&(this.dc.customColor=e),this.dc.globalColor=e,this.setElementColor(e.red,e.green,e.blue,e.alpha)}},{key:"restoreGlobalColor",value:function(){this.dc.printMode==this.dc.Custom?this.setGlobalColor({red:128,green:128,blue:128,alpha:1}):this.dc.printMode==this.dc.Black?this.setGlobalColor({red:0,green:0,blue:0,alpha:1}):this.viewer.RestoreGlobalColor()}},{key:"getGlobalColor",value:function(){return this.dc.globalColor}},{key:"setPrintMode",value:function(e){this.dc.setPrintMode(e),"Black"==e?(this.setGlobalColor({red:0,green:0,blue:0,alpha:1}),this.viewer.RestoreOverrideElementsColor()):"Custom"==e?(this.setGlobalColor(this.dc.customColor),this.viewer.RestoreOverrideElementsColor()):(this.viewer.RestoreGlobalColor(),this.viewer.RestoreOverrideElementsColor())}},{key:"overrideElementsColorById",value:function(e,t){var i=.0039*t.red,n=.0039*t.green,o=.0039*t.blue,a=new this.butterfly.ObjectIDList;a.clear();for(var r=0,s=e.length;r<s;r++)a.push_back(e[r]);this.viewer.OverrideElementsColorById(a,i,n,o,t.alpha)}},{key:"restoreElementsColorById",value:function(e){var t=new this.butterfly.ObjectIDList;t.clear();for(var i=0,n=e.length;i<n;i++)t.push_back(e[i]);this.viewer.RestoreElementsColorById(t)}},{key:"setClearColor",value:function(e,t,i,n){var o=.0039*e,a=.0039*t,r=.0039*i;this.viewer.SetClearColor(o,a,r,n)}},{key:"setElementColor",value:function(e,t,i,n){var o=.0039*e,a=.0039*t,r=.0039*i;this.viewer.SetGlobalColor(o,a,r,n)}},{key:"alignDrawing",value:function(e,t){this.viewer.AlignDrawing(e[0],e[1],t[0],t[1])}},{key:"getAlignTranslate",value:function(){var e=this.viewer.GetAlignTranslate();return[e.x,e.y]}},{key:"scaleDrawing",value:function(e,t){this.viewer.AlignDrawingWithScale(e[0],e[1],t)}},{key:"getAlignScale",value:function(){return this.viewer.GetAlignScale()}},{key:"getAlignState",value:function(){var e=this.viewer.GetAlignMatrixCol(0),t={x:e.x,y:e.y,z:e.z,w:e.w},i=this.viewer.GetAlignMatrixCol(1),n={x:i.x,y:i.y,z:i.z,w:i.w},o=this.viewer.GetAlignMatrixCol(2),a={x:o.x,y:o.y,z:o.z,w:o.w},r=this.viewer.GetAlignMatrixCol(3),s={x:r.x,y:r.y,z:r.z,w:r.w},l={ver:1,AlignMatrixCol1:[t.x,t.y,t.z,t.w],AlignMatrixCol2:[n.x,n.y,n.z,n.w],AlignMatrixCol3:[a.x,a.y,a.z,a.w],AlignMatrixCol4:[s.x,s.y,s.z,s.w]};return JSON.stringify(l)}},{key:"setAlignState",value:function(e){var t=JSON.parse(e);return 1===t.ver&&(void 0!=t.AlignMatrixCol1&&null!=t.AlignMatrixCol1&&(this.viewer.SetAlignMatrixCol(0,t.AlignMatrixCol1[0],t.AlignMatrixCol1[1],t.AlignMatrixCol1[2],t.AlignMatrixCol1[3]),this.viewer.SetAlignMatrixCol(1,t.AlignMatrixCol2[0],t.AlignMatrixCol2[1],t.AlignMatrixCol2[2],t.AlignMatrixCol2[3]),this.viewer.SetAlignMatrixCol(2,t.AlignMatrixCol3[0],t.AlignMatrixCol3[1],t.AlignMatrixCol3[2],t.AlignMatrixCol3[3]),this.viewer.SetAlignMatrixCol(3,t.AlignMatrixCol4[0],t.AlignMatrixCol4[1],t.AlignMatrixCol4[2],t.AlignMatrixCol4[3])),this.viewer.UpdateViewMatrix(),!0)}},{key:"activeDrawing",value:function(e){this.viewer.ActiveDrawing(e)}},{key:"getActiveDrawing",value:function(){return this.viewer.GetActiveDrawingIndex()}},{key:"getDrawingCount",value:function(){return this.viewer.GetDrawingCount()}},{key:"replaceElementColor",value:function(e,t,i,n,o,a){this.viewer.RaplaceElementColor(e,t,i,n,o,a)}},{key:"enableReplaceElementColor",value:function(e){this.viewer.EnableRaplaceElementColor(e)}},{key:"enableViewport",value:function(e){this.viewer.EnaleViewport(e)}},{key:"getLayerIdFromElementId",value:function(e){return this.viewer.GetLayerIdFromElementId(e)}},{key:"hideElementsById",value:function(e){var t=new this.butterfly.ObjectIDList;t.clear();for(var i=0,n=e.length;i<n;i++)t.push_back(e[i]);this.viewer.HideElementsById(t)}},{key:"showElementsById",value:function(e){var t=new this.butterfly.ObjectIDList;t.clear();for(var i=0,n=e.length;i<n;i++)t.push_back(e[i]);this.viewer.ShowElementsById(t)}},{key:"showAllElements",value:function(){this.viewer.ShowAllElements()}},{key:"getCustomManager",value:function(){return this.customManager}},{key:"setSnapMode",value:function(e){this.snapMode=e}},{key:"getSnapMode",value:function(){return this.snapMode}},{key:"setSelectWireframeColor",value:function(e,t,i,n){this.viewer.SetSelectWireframeColor(e,t,i,n)}}]),e}();t.default=h},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(1),r=function(e){return e&&e.__esModule?e:{default:e}}(a),s=function(){function e(){n(this,e)}return o(e,[{key:"initialize",value:function(e,t,i){this.canvasMain=e,this.canvasTemp=t,this.canvasOverlay=i,this.ctxMain=this.canvasMain.getContext("2d"),this.ctxTemp=this.canvasTemp.getContext("2d"),this.ctxOverlay=this.canvasOverlay.getContext("2d"),this.inPath=!1,this.fontSize=12,this.colorTable={},this.faceColorTable={},this.globalOpacity=null,this.Normal=0,this.White=1,this.Black=2,this.Gray=3,this.Custom=4,this.printMode=this.Normal,this.printColorTable={},this.printFaceColorTable={},this.resUrl="",this.images={},this.ignoreImage=!1,this.targetId=0,this.overlayDrawers={},this.customColor={red:128,green:128,blue:128,alpha:1},this.globalColor=this.customColor}},{key:"drawingOverlay",value:function(e,t,i){var n=this.ctxOverlay;n.clearRect(0,0,e,t);var o=this.overlayDrawers;for(var a in o)o[a](n);i.auxMobileMeasureTool&&i.auxMobileMeasureTool.redraw()}},{key:"setBackgroundColor",value:function(e){this.canvasMain.style.background=e}},{key:"setPrintMode",value:function(e){if("Normal"==e)this.printMode=this.Normal;else if("Gray"==e)this.printMode=this.Gray;else if("Black"==e)this.printMode=this.Black;else if("White"==e)this.printMode=this.White;else{if("Custom"!=e)return;this.printMode=this.Custom}}},{key:"setResourceUrl",value:function(e){this.resUrl=e}},{key:"setGlobalOpacity",value:function(e){this.globalOpacity=e}},{key:"getGlobalOpacity",value:function(){return this.globalOpacity}},{key:"restoreGlobalOpacity",value:function(){this.globalOpacity=null}},{key:"getHexColor",value:function(e){var t=null===this.globalOpacity?1:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var a=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printColorTable[e]="rgba("+a+","+a+","+a+","+t+")",this.printColorTable[e]}return this.colorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.colorTable[e]}},{key:"getFaceColor",value:function(e){var t=null===this.globalOpacity?.9:this.globalOpacity;if(this.printMode==this.Custom&&void 0!=this.customColor.red)return null==this.globalOpacity&&1!=this.customColor.alpha&&(t=this.customColor.alpha),"rgba("+this.customColor.red+","+this.customColor.green+","+this.customColor.blue+","+t+")";var i=e>>16,n=e>>8&255,o=255&e;if(2==this.printMode||1==this.printMode&&255==i&&255==n&&255==o)return"rgba(0,0,0,"+t+")";if(3==this.printMode){var a=255==i&&255==n&&255==o?0:.299*i+.587*n+.114*o;return this.printFaceColorTable[e]="rgba("+a+","+a+","+a+","+t+")",this.printFaceColorTable[e]}return this.faceColorTable[e]="rgba("+o+","+n+","+i+","+t+")",this.faceColorTable[e]}},{key:"resize",value:function(e,t){this.canvasMain.setAttribute("width",e),this.canvasMain.setAttribute("height",t),this.canvasTemp.setAttribute("width",e),this.canvasTemp.setAttribute("height",t),this.canvasOverlay.setAttribute("width",e),this.canvasOverlay.setAttribute("height",t)}},{key:"clearAll",value:function(e,t){this.ctxTemp.clearRect(0,0,e,t),this.ctxOverlay.clearRect(0,0,e,t)}},{key:"SetTarget",value:function(e){0==e?this.ctx=this.ctxMain:(this.ctx=this.ctxTemp,this.ctx.strokeStyle="#ff0000"),this.targetId=e}},{key:"BeginDraw",value:function(e,t){this.ctx.clearRect(t[0],t[1],t[2],t[3])}},{key:"EndDraw",value:function(e){}},{key:"BeginPath",value:function(){this.inPath=!0,this.ctx.beginPath()}},{key:"EndPath",value:function(e,t){this.inPath=!1,e&&(this.ctx.fillStyle=this.getFaceColor(t),this.ctx.closePath(),this.ctx.fill()),this.ctx.stroke()}},{key:"BeginClip",value:function(e){e&&(this.ctx.save(),this.ctx.clip())}},{key:"EndClip",value:function(e){e&&this.ctx.restore()}},{key:"SetLineColor",value:function(e){var t=this.getHexColor(e);this.ctx.strokeStyle=t,this.ctx.fillStyle=t}},{key:"SetLineWidth",value:function(e){this.ctx.lineWidth=e}},{key:"SetLineDash",value:function(e,t){if(0==e)return void this.ctx.setLineDash([]);if(1==e)return void this.ctx.setLineDash([10]);for(var i=[],n=0,o=t.size();n<o;++n)i.push(t.get(n));this.ctx.setLineDash(i)}},{key:"SetFont",value:function(e){this.fontSize=e,this.ctx.font=this.fontSize+"px ä»¿å®‹"}},{key:"DrawPoint",value:function(e,t,i){}},{key:"DrawLine",value:function(e,t){if(this.inPath)this.ctx.moveTo(e[0],e[1]),this.ctx.lineTo(t[0],t[1]);else{for(var i=this.ctx.getLineDash(),n=0,o=0;o<i.length;++o)n+=i[o];this.ctx.beginPath(),this.ctx.moveTo(e[0],e[1]),(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])<n*n&&this.ctx.setLineDash([]),this.ctx.lineTo(t[0],t[1]),this.ctx.stroke(),this.ctx.setLineDash(i)}}},{key:"DrawArc",value:function(e,t,i,n){this.inPath?this.ctx.arc(e[0],e[1],t,-i,-n,!0):(this.ctx.beginPath(),this.ctx.arc(e[0],e[1],t,-i,-n,!0),this.ctx.stroke())}},{key:"DrawRec",value:function(e,t){this.inPath?this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]):(this.ctx.beginPath(),this.ctx.rect(e[0],e[1],t[0]-e[0],t[1]-e[1]),this.ctx.stroke())}},{key:"DrawCloudRec",value:function(e,t,i){var n=e,o=t;i=i||this.ctx,n=[n[0]+18/3.5,n[1]+18/3.5],o=[o[0]-18/3.5,o[1]-18/3.5];var a=o[1]-n[1],r=o[0]-n[0],s=Math.abs(r),l=Math.abs(a),u=parseInt(s/18),c=parseInt(l/18),d=0==u?s:s/u,h=0==c?l:l/c;i.beginPath(),this.drawSide("orientation",d,s,n[0],n[1],i),this.drawSide("orientation",d,s,n[0]+s,n[1]+l,i,!0),this.drawSide("portrait",h,l,n[0]+s,n[1],i),this.drawSide("portrait",h,l,n[0],n[1]+l,i,!0),i.stroke()}},{key:"drawSide",value:function(e,t,i,n,o,a,r){var s=0,l=0,u=i/t,c=void 0,d=n,h=o;"orientation"==e?s=t:l=t;for(var f=0;f<u;f++){a.moveTo(n,o),c=r?[n-s,o-l]:[n+s,o+l],s&&Math.abs(c[0]-d)>i?c[0]=r?d-i:d+i:l&&Math.abs(c[1]-h)>i&&(c[1]=r?h-i:h+i);var g=this.getControlPt([n,o],c);a.quadraticCurveTo(g[0],g[1],c[0],c[1]),n=c[0],o=c[1]}}},{key:"getControlPt",value:function(e,t,i){var n=[(e[0]+t[0])/2,(e[1]+t[1])/2],o=.4*r.default.distanceByArr(e,t),a=[t[1]-e[1],e[0]-t[0]];return a=r.default.normalize(a),[n[0]+a[0]*o,n[1]+a[1]*o]}},{key:"DrawPolyline",value:function(e){var t=e.size();if(!(t<1))if(this.inPath){this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var i=1;i<t;++i)this.pt=e.get(i),this.ctx.lineTo(this.pt[0],this.pt[1])}else{for(var n=this.ctx.getLineDash(),o=0,a=0;a<n.length;++a)o+=n[a];this.ctx.beginPath(),this.pt=e.get(0),this.ctx.moveTo(this.pt[0],this.pt[1]);for(var r=1;r<t;++r){var s=(this.pt[0]-e.get(r)[0])*(this.pt[0]-e.get(r)[0])+(this.pt[1]-e.get(r)[1])*(this.pt[1]-e.get(r)[1]);s<o*o?this.ctx.setLineDash([]):this.ctx.setLineDash(n),this.pt=e.get(r),this.ctx.lineTo(this.pt[0],this.pt[1]),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.pt[0],this.pt[1])}this.ctx.setLineDash(n)}}},{key:"DrawText",value:function(e,t){this.ctx.fillText(e,t[0],t[1])}},{key:"DrawTextW",value:function(e,t,i){0!=i?(this.ctx.save(),this.ctx.translate(t[0],t[1]),this.ctx.rotate(i),this.ctx.fillText(e,0,0),this.ctx.restore()):this.ctx.fillText(e,t[0],t[1])}},{key:"DrawImageImpl",value:function(e,t,i,n,o,a,r){function s(t,i,n,o,a,r){0==r?e.drawImage(t,i,n,o,a):(e.save(),e.translate(i,n+a),e.rotate(r),e.drawImage(t,0,-a,o,a),e.restore())}var l=this,u=l.images[t];if(l.ignoreImage)return!1;void 0===u?(u=new Image,u.onload=function(){s(u,i,n,o,a,r),l.images[t]=u},u.src=t):s(u,i,n,o,a,r)}},{key:"DrawImage",value:function(e,t,i,n,o,a){this.DrawImageImpl(this.ctx,this.resUrl+"image/"+e,t,i,n,o,a)}}],[{key:"create",value:function(t,i,n){var o=new e;return o.initialize(t,i,n),o}}]),e}();t.default=s},function(e,t,i){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=function(){function e(){n(this,e),this.revitIds={}}return o(e,[{key:"initialize",value:function(e){function t(e){return new Promise(function(t,i){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(){200==n.status||0==n.status?t(JSON.parse(n.response)):i(n.statusText)},n.send()})}var i=this;i.revitIds={},i.linkRevitIds={},i.revitToCad={};var n,o=e.getModel().Url,a=o+"index.json",r=o+"revitIds.json",s=!1,l=".gz";t(a).then(function(e){return n=e,0!=e.metadata.gz&&"false"!=e.metadata.gz||(l=""),r+=l,t(r)},function(e){console.warn(e)}).then(function(e){if(i.revitIds=e,n.metadata.hasOwnProperty("links")&&""!=n.metadata.links)return s=!0,a=o+n.metadata.links,t(a)}).then(function(n){if(0!=s){i.linkRevitIds=n,n&&e.enableSelectInBlock();var a=[],r=[];for(var u in i.linkRevitIds)if(0!=u){var c=o+"links/"+u+".json"+l,d=t(c);r.push(d),a.push(u)}Promise.all(r).then(function(e){for(var t=0;t<e.length;t++){var n=e[t],o={};for(var r in n)i.revitIds[r]=n[r],o.hasOwnProperty(n[r])||(o[n[r]]=[]),o[n[r]].push(r);var s=a[t];i.revitToCad[i.linkRevitIds[s]]=o}})}},function(e){console.warn(e)})}},{key:"toRevitId",value:function(e){return this.revitIds[e]}},{key:"toLinkRevitId",value:function(e,t){return 0==e||void 0==this.linkRevitIds?this.toRevitId(t):this.linkRevitIds.hasOwnProperty(e)?{fileId:this.linkRevitIds[e],revitId:this.toRevitId(t)}:this.toRevitId(e)}},{key:"fromRevitId",value:function(e){var t=this.revitIds;for(var i in t)if(t[i]==e)return i}},{key:"fromLinkRevitId",value:function(e,t){if(0==e||void 0==this.linkRevitIds||""==e)return this.fromRevitId(t);var i=0;for(var n in this.linkRevitIds)this.linkRevitIds[n]==e&&(i=n);var o=this.revitToCad[e];return o?{blockId:i,ids:o[t]}:null}}]),e}();t.default=a}]),window.Glodon=Glodon;