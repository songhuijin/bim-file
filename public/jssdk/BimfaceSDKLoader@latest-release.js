"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var a=0,t=Array(e.length);a<e.length;a++)t[a]=e[a];return t}return Array.from(e)}var version="2020-8-12-17-40";if(!hostConfig)var hostConfig={APIHost:"https://api.bimface.com",resourceHost:"https://m.bimface.com",staticHost:"https://static.bimface.com",dataEnvType:"BIMFACE"};void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(e),t=1;t<arguments.length;t++){var i=arguments[t];if(void 0!==i&&null!==i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(a[n]=i[n])}return a});var BimfaceConfigrationOption$1=Object.freeze({Release:"Release",Debug:"Debug"}),BimfaceViewTypeOption$1=Object.freeze({Normal:"Normal",DrawingView:"drawingView"}),BimfaceEnvOption=Object.freeze({BIMFACE:"BIMFACE",Local:"Local"}),BimfaceLanguageOption=Object.freeze({zh_CN:"zh_CN",en_GB:"en_GB",sv_SE:"sv_SE"}),BimfaceVisualStyle=Object.freeze({Normal:"Normal",Bake:"Bake"}),BimfaceSDKLoaderConfig=function(){return{staticHost:hostConfig.staticHost+"/api",APIHost:hostConfig.APIHost,language:"zh_CN",viewToken:null,configuration:BimfaceConfigrationOption$1.Release,dataEnvType:hostConfig.dataEnvType||"BIMFACE",viewType:BimfaceViewTypeOption$1.Normal,visualStyle:BimfaceVisualStyle.Bake}};window.BimfaceConfigrationOption=BimfaceConfigrationOption$1,window.BimfaceViewTypeOption=BimfaceViewTypeOption$1,window.BimfaceSDKLoaderConfig=BimfaceSDKLoaderConfig,window.BimfaceEnvOption=BimfaceEnvOption,window.BimfaceVisualStyle=BimfaceVisualStyle;var transfromPath=function(e){var a=e.split("/");return a.pop(),a.join("/")+"/"},getConfig=function(e){var a=Object.assign({},e),t="/Glodon";return e.path?(a.dataEnvType=BimfaceEnvOption.Local,a.url=a.path,a.staticHost=a.sdkPath||transfromPath(a.path),a.resourcePath=transfromPath(a.path),a.path=transfromPath(a.path),t=a.sdkPath?"":"/jssdk"):e.resourcePath?(a.dataEnvType=BimfaceEnvOption.Local,a.url=a.resourcePath,a.resourcePath=transfromPath(a.resourcePath)):a.url=e.APIHost+"/inside/databag?viewToken="+e.viewToken,a.staticHost+=t,e.build!=BimfaceConfigrationOption.Debug&&a.configuration!=BimfaceConfigrationOption.Release||(a.configuration=""),a.configuration=a.configuration?"-"+a.configuration.toLowerCase():"",a},transformFullUrl=function(e,a){for(var t=0;t<a.length;t++)a[t]=e+a[t]},isDrawingView=function(e,a){return"drawingView"==e.renderType||a.viewType==BimfaceViewTypeOption.DrawingView},getLoadModules=function(e){var a=e.sdkVersion,t=e.uiVersion,i=e.options,n=i.configuration,o=[],r=["/"+a+"/"+i.language+".js","/"+t+"/Application"+n+".js"];return o=isDrawingView(e.metadata,e.options)?[].concat(_toConsumableArray(o),r,["/"+a+"/Drawing.css","/"+a+"/bimface.bufferfly.js","/"+a+"/Drawing"+n+".js"]):[].concat(_toConsumableArray(o),r,["/"+a+"/Bimface.css","/"+a+"/thirdparty.js","/"+a+"/BimTilesLoader.js","/"+a+"/Bimface"+n+".js"])};window.postProcessing=function(e){var a=e.metadata,t=e.options,i=e.successCb,n=getLoadModules(e);transformFullUrl(t.staticHost,n),a.databagId=""+a.databagId,t.path?(a.path=t.path,a.dataPath="./"):t.resourcePath&&(a.path=t.resourcePath.replace("viewToken","")),a.sdkPath=t.sdkPath,0==n.length?i(a):loadResource(n,function(){if(t.build===BimfaceConfigrationOption.Debug&&t.dataPath){var e=t.dataPath.split("/");i({databagId:e.pop(),path:e.join("/")})}i(a)})};var loadResource=function e(a,t,i){var n=a.length,o=0,r=function r(s){if(s&&"error"==s.message&&s.element.indexOf("bimface.index")>-1){o=0;var c=i.options;c.build,BimfaceConfigrationOption.Release;var f=getLoadModules(i);return transformFullUrl(c.staticHost,f),void e(f,t)}o++,o==n?t():createResource(a[o],r)};createResource(a[o],r)},loaded=[],createResource=function(e,a){if(loaded.indexOf(e.split("/").pop())>-1)return void a();var t,i=document.getElementsByTagName("head")[0];return e.indexOf(".css")>-1?(t=document.createElement("link"),t.setAttribute("href",e),t.setAttribute("rel","stylesheet")):(t=document.createElement("script"),t.setAttribute("src",e)),t.url=e,i.appendChild(t),t.addEventListener("load",function(){loaded.push(this.url.split("/").pop()),a&&a({message:"success"})}),t.addEventListener("error",function(){a&&a({element:e,message:"error"})}),t},ajax=function(e){var a,t={type:"get",data:null,success:null,failure:null},i=Object.assign(t,e);a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a.onreadystatechange=function(){if(4==a.readyState){var e=a.status;e>=200&&e<300||0==e?i.success&&i.success(a.responseText,a.responseXML):i.failure&&i.failure(e)}},a.open(i.type,i.url,i.async),a.send(i.data)},getMetadata=function(e,a,t){ajax({url:e,success:function(e){var a=JSON.parse(e);a=a.data||a,t&&t(a)},failure:function(e){a&&a(e)}})},getVersion=function(e,a){var t,i;if("Debug"==a.build)i="Application",t="drawingView"==e.renderType||a.viewType==BimfaceViewTypeOption.DrawingView?"Drawing":"Bimface";else if(a.viewType==BimfaceViewTypeOption.DrawingView&&"drawingView"!=e.renderType){var n=e.subRenders;if(n&&0!=n.length)for(var o=0;o<n.length;o++)n[o].renderType==BimfaceViewTypeOption.DrawingView&&(t=n[o].jsSDKVersion,i=n[o].jsSDKVersion)}else i=e.jsSDKVersion,t=e.jsSDKVersion;return{ui:i,sdk:t}},loaderPreProcessing=function(e,a,t){getMetadata(e.url,t,function(t){var i=getVersion(t,e);window.bimfaceStaticHost="Local"==BimfaceLoaderConfig.dataEnvType?e.staticHost+"/bimface":e.staticHost+"/"+i.sdk;var n={metadata:t,options:e,successCb:a,sdkVersion:i.sdk,uiVersion:i.ui},o=bimfaceStaticHost+"/bimface.index.js";loadResource([o],function(){postProcessing(n)},n)})},formatData=function(e,a){var t="bimView"==e.renderType?"3DView":e.renderType,i=(e.subRenders,{dataEnvType:a.dataEnvType,viewToken:a.viewToken,staticHost:a.staticHost,APIHost:a.APIHost,viewType:t});return Object.assign(i,e)},BimfaceSDKLoader={Version:version,load:function(e,a,t){window.BimfaceLoaderConfig=e,void 0==e.build&&(e.build=BimfaceConfigrationOption.Release);var i=getConfig(e);loaderPreProcessing(i,function(t){a(formatData(t,e))},t)}};window.BimfaceSDKLoader=BimfaceSDKLoader;